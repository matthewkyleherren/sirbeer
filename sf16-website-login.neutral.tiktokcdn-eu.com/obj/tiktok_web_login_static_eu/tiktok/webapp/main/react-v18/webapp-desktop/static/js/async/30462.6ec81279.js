"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["30462"],{56269:function(t,e,i){i.d(e,{Ay:function(){return eU},PI:function(){return tb},Yd:function(){return tZ},EL:function(){return tR}});var n,r,o,s,a,l,c,u,h,f,d,_,p,g,E,v,y,P,S,C,m,I,T,N,O,b,R,D,U,M,w,A,L,F,j,k,$,J=i(4237),Y=i(12687);let G="0.0.0",K="pns_sdk_common_modules";(n=E||(E={})).US_EAST="US-East",n.US_EASTRED="US-EastRed",n.SINGAPORE_CENTRAL="Singapore-Central",n.EU_TTP="EU-TTP",n.EU_TTP2="EU-TTP2",n.US_TTP="US-TTP",n.US_TTP2="US-TTP2",(r=v||(v={})).PRODUCTION="production",r.DEV="dev",r.BOE="boe";var B=i(77077);class x{constructor(t,e){this.sendEvent=t=>{this._client&&this._client.sendEvent&&this._client.sendEvent(t)},this.captureException=t=>{this._client&&this._client.captureException&&this._client.captureException(t)},this.reportActualFMP=()=>{};let{slardar:i}=null!=t?t:{},{region:n=E.US_EAST,bid:r=K,mode:o=v.PRODUCTION,consumerBid:s,version:a=G,appId:l,appVersion:c,tenant:u}=null!=e?e:{};this._client=(0,B.createBrowserClient)();let h={};switch(n){case E.US_EASTRED:case E.EU_TTP:case E.EU_TTP2:h={domain:"https://mon16-normal-useastred.tiktokv.eu",pluginPathPrefix:"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/slardar/fe/sdk-web/plugins"};break;case E.US_TTP:case E.US_TTP2:h={domain:"https://mon16-normal-useast5.tiktokv.us",pluginPathPrefix:"https://lf16-cdn-tos.tiktokcdn-us.com/obj/static-tx/slardar/fe/sdk-web/plugins"};break;case E.US_EAST:case E.SINGAPORE_CENTRAL:default:h={domain:"https://mon.tiktokv.com",pluginPathPrefix:"https://sf16-website-login.neutral.ttwstatic.com/obj/tiktok_web_login_static/slardar/fe/sdk-web/plugins"}}this._client&&(this._client("context.merge",{appId:String(l),appVersion:String(null!=c?c:"0.0.0"),tenant:String(u)}),this._client("init",function(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):(function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i.push.apply(i,n)}return i})(Object(e)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t}(function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){var n;n=i[e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n})}return t}({},h,i),{bid:r,pid:s||window.location.href,release:a,env:o,plugins:{pageview:!1,jsError:{onerror:!1,onunhandledrejection:!1},tti:!1,performance:!1,resource:!1,ajax:!1,fetch:!1,fmp:!1,blankScreen:!1}})),this._client("start"))}}var H=i(80249);function V(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){var n;n=i[e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n})}return t}var W=class{constructor(t){this._tea=null,this._slardar=null,this._useSingleton=!1,this._isInitialized=!1,this.init=(t,e)=>{if(this._isInitialized)return;this._isInitialized=!0;let{bid:i=K,version:n=G,appId:r,appVersion:o,tenant:s}=null!=e?e:{};this._name=`${i}_${n}_${Date.now()}`,this._trackingModule=this._useSingleton?Y.Wk:(0,Y.Q_)(this._name),this._tea=((t,e)=>{let i=null;if((null==t?void 0:t.tea)!==!1)try{let{tea:o}=null!=t?t:{},{appId:s,region:a,debug:l}=null!=e?e:{},c=(t=>{let e={};switch(t){case E.US_EASTRED:e={channel:"in",channel_type:"tcpy",channel_domain:"https://mcs16-normal-useastred.tiktokw.eu"};break;case E.EU_TTP:e={channel:"ie",channel_type:"ttp",channel_domain:"https://mcs-ie.tiktokw.eu"};break;case E.EU_TTP2:e={channel:"ie2",channel_type:"ttp",channel_domain:"https://mcs-ie2.tiktokw.eu"};break;case E.US_TTP:e={channel_type:"ttp",channel_domain:"https://mcs.tiktokv.us"};break;case E.US_TTP2:e={channel_type:"ttp",channel_domain:"https://mcs.tiktokw.us"};break;case E.SINGAPORE_CENTRAL:e={channel:"sg",channel_type:"tcpy",channel_domain:"https://mcs-sg.tiktokv.com"};break;case E.US_EAST:e={channel:"va",channel_type:"tcpy",channel_domain:"https://mcs-va.tiktokv.com"}}return e})(a),u=V({},c,null!=o?o:{});if(s&&u&&u.channel_type&&(u.channel||u.channel_domain)){var n,r;(i=new H.Collector(`${K}_${G}_${Date.now()}`)).init((n=V({},u),r={app_id:s,log:l,enable_debug:l},r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):(function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i.push.apply(i,n)}return i})(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))}),n)),i.start()}}catch(t){}return i})(t,e),this._teaEventNameFormatter=null==t?void 0:t.teaEventNameFormatter,this._slardar=((t,e)=>{let i=null;if((null==t?void 0:t.slardar)!==!1)try{i=new x(t,e)}catch(t){}return i})(t,e),this._slardar&&this._trackingModule.init({slardarContainer:this._slardar,shouldReportJSError:{cuj:!0},shouldRegisterUserDrop:!1,context:{appId:r,appVersion:o,tenant:s}})},this.reportCUJ=(t,e,i)=>{if(t)try{if(this._trackingModule.reportCUJ(t,e,i),this._tea){var n,r;this._tea.event(null!=(r=null==(n=this._teaEventNameFormatter)?void 0:n.call(this,t))?r:t,function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){var n;n=i[e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n})}return t}({status:e},null!=i?i:{}))}}catch(t){}},this._useSingleton=null!=t&&t}},z=class{init(t,e){var i,n;this.debug=null!=(i=null==e?void 0:e.debug)&&i,this.meta=null!=(n=null==t?void 0:t.meta)?n:{}}send(t){}info(t,e){}warn(t,e){}error(t,e){}getMeta(){return function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){var n;n=i[e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n})}return t}({},this.meta)}reportCUJ(t,e,i){}destruct(){}constructor(){this.debug=!1,this.meta={}}};function q(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){var n;n=i[e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n})}return t}(o=y||(y={})).INFO="info",o.WARN="warn",o.ERROR="error";class Q extends z{init(t,e){var i;this._isInitialized||(this.meta=q({},null!=(i=t.meta)?i:{},e),this.debug=!!(null==e?void 0:e.debug),t.monitorModuleConfig&&this._monitorModule.init(t.monitorModuleConfig,e),t.customLoggingModule&&t.customLoggingModule instanceof z?this._customLogger=t.customLoggingModule:this.warn("[LoggingModule]: init - incorrect implementation of LoggingModule"))}sendDebugMessage(t){if(this.debug){let{level:e}=t;console[e](t.message,t);try{chrome.runtime.sendMessage(t)}catch(t){}}}send(t){var e;this.sendDebugMessage(t),"function"==typeof(null==(e=this._customLogger)?void 0:e.send)&&this._customLogger.send(t)}getMeta(){return q({},this.meta)}info(t,e){this.send({message:t,level:y.INFO,meta:this.getMeta(),data:e})}warn(t,e){this.send({message:t,level:y.WARN,meta:this.getMeta(),data:e})}error(t,e){this.send({message:t,level:y.ERROR,meta:this.getMeta(),data:e})}destruct(){var t;"function"==typeof(null==(t=this._customLogger)?void 0:t.destruct)&&this._customLogger.destruct(),this._isInitialized=!1}reportCUJ(t,e,i){this._monitorModule.reportCUJ(t,e,i)}constructor(){return super(),this._monitorModule=new W,this._isInitialized=!1,this.debug=!1,Q._instance||(Q._instance=this),Q._instance}}var X=new Q,Z=i(24163),tt=i.n(Z);function te(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){var n;n=i[e],e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n})}return t}let ti=/^(https?:\/\/)/;class tn{constructor(){return this.init=t=>{X.info("[ServiceModule]: init"),this._domain=t.domain||"https://www.tiktok.com",this._commonParams=t.commonParams||{}},this.sendRequest=(t,e,i,n)=>{let r=new URL(ti.test(t)?t:`${this._domain}${t}`),o=Array.from(r.searchParams.entries()).reduce((t,e)=>{let[i,n]=e;return(void 0!==n||""!==n)&&(t[i]=n),t},{}),s=null!=n?n:{},{params:a,timeout:l}=s,c=function(t,e){if(null==t)return{};var i,n,r=function(t,e){if(null==t)return{};var i,n,r={},o=Object.keys(t);for(n=0;n<o.length;n++)i=o[n],e.indexOf(i)>=0||(r[i]=t[i]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)i=o[n],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}(s,["params","timeout"]),u=te({},this._commonParams,o,null!=a?a:{});"GET"===e&&i&&"object"==typeof i&&(u=te({},u,i));let h=new URLSearchParams((t=>{if(!t)return"";let e=new URLSearchParams;return Object.entries(t).forEach(([t,i])=>{Array.isArray(i)?i.forEach(i=>{e.append(t,i)}):null!=i&&e.append(t,i)}),e.toString()})(u)),f=new URL(`${r.origin}${r.pathname}?${h.toString()}`),d=(0,J.A)({},c,{method:e,timeout:null!=l?l:0,data:i});return X.info("[ServiceModule]: sendRequest start",d),tt()(f.href,d).then(t=>(X.info("[ServiceModule]: sendRequest finish",t),t)).catch(t=>{throw X.error("[ServiceModule]: sendRequest error",t),t})},this.destruct=()=>{X.info("[ServiceModule]: destruct")},tn._instance||(tn._instance=this),tn._instance}}new tn;var tr=((s=tr||{}).SDK_INIT="sdk_init",s.FETCH_DATA="fetch_data",s.FETCH_USER="fetch_user",s.SUBSCRIBE_EVENT="subscribe_event",s.UNSUBSCRIBE_EVENT="unsubscribe_event",s.GET_RECORD="get_record",s.FETCH_RECORD="fetch_record",s.GET_RECORDS="get_records",s.FETCH_RECORDS="fetch_records",s.GET_ENTITY="get_entity",s.FETCH_ENTITY="fetch_entity",s.GET_ENTITIES="get_entities",s.FETCH_ENTITIES="fetch_entities",s.FETCH_COLLECTION_POINT="fetch_collection_point",s.GET_COLLECTION_POINT="get_collection_point",s.UPDATE_RECORD="update_record",s.UPDATE_RECORDS_BY_COLLECTION_POINT="update_records_by_collection_point",s.SEND_REQUEST="send_request",s);let to={sdk_init:"consent_init_sdk",fetch_data:"consent_fetch_data",fetch_user:"consent_fetch_user",subscribe_event:"consent_subscribe_event",unsubscribe_event:"consent_unsubscribe_event",fetch_record:"consent_fetch_record",fetch_records:"consent_fetch_records",get_record:"consent_get_record",get_records:"consent_get_records",fetch_entity:"consent_fetch_entity",fetch_entities:"consent_fetch_entities",get_entity:"consent_get_entity",get_entities:"consent_get_entities",fetch_collection_point:"consent_fetch_collection_point",get_collection_point:"consent_get_collection_point",update_records_by_collection_point:"consent_update_records_by_collection_point",update_record:"consent_create_record_api",send_request:"consent_send_request"};var ts=i(75959),ta=i.n(ts);let tl="2.0.5",tc=`_ccfs_${tl}`,tu=`${tc}_consent`,th=`${tc}_notifications`;var tf=((a=tf||{}).US_EAST="US-East",a.US_EASTRED="US-EastRed",a.SINGAPORE_CENTRAL="Singapore-Central",a.EU_TTP="EU-TTP",a.EU_TTP2="EU-TTP2",a.US_TTP="US-TTP",a.US_TTP2="US-TTP2",a),td=((l=td||{}).PRODUCTION="production",l.DEV="dev",l.BOE="boe",l),t_=((c=t_||{}).UNSUPPORTED="Unsupported",c.WEB="Web",c.ANDROID="Android",c.IOS="IOS",c.PC_MAC="PC_MAC",c.PC_WINDOWS="PC_WINDOWS",c);let tp={},tg=()=>{var t,e,i,n;if(Object.keys(tp).length)return tp;let{browser:r,os:o}=new(ta())().getResult();return tp={platform:t_.WEB,browser:null!=(t=null==r?void 0:r.name)?t:"",browser_version:null!=(e=null==r?void 0:r.version)?e:"",os:null!=(i=null==o?void 0:o.name)?i:"",os_version:null!=(n=null==o?void 0:o.version)?n:""}};var tE=Object.defineProperty,tv=Object.getOwnPropertySymbols,ty=Object.prototype.hasOwnProperty,tP=Object.prototype.propertyIsEnumerable,tS=(t,e,i)=>e in t?tE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,tC=(t,e)=>{for(var i in e||(e={}))ty.call(e,i)&&tS(t,i,e[i]);if(tv)for(var i of tv(e))tP.call(e,i)&&tS(t,i,e[i]);return t};let tm=/^(https?:\/\/)/;class tI{constructor(){return this._region="",this._bid="",this._debug=!1,this.init=t=>{X.info("[ServiceModule]: init");let{region:e="",bid:i="",appId:n,domain:r}=null!=t?t:{};this._appId=n,this._region=e,this._bid=i,this._domain=r},this.sendRequest=(t,e,i,n)=>{Y.Wk.reportCUJ(tr.SEND_REQUEST,Y.PY.START,{detail:t});let r=new URL(tm.test(t)?t:`${this._domain}${t}`),o=Array.from(r.searchParams.entries()).reduce((t,e)=>{let[i,n]=e;return(void 0!==n||""!==n)&&(t[i]=n),t},{}),s=null!=n?n:{},{params:a,timeout:l}=s,c=((t,e)=>{var i={};for(var n in t)ty.call(t,n)&&0>e.indexOf(n)&&(i[n]=t[n]);if(null!=t&&tv)for(var n of tv(t))0>e.indexOf(n)&&tP.call(t,n)&&(i[n]=t[n]);return i})(s,["params","timeout"]),u=tC(tC(tC({region:this._region,aid:this._appId,bid:this._bid},o),null!=a?a:{}),tg());"GET"===e&&i&&"object"==typeof i&&(u=tC(tC({},u),i));let h=new URLSearchParams((t=>{if(!t)return"";let e=new URLSearchParams;return Object.entries(t).forEach(([t,i])=>{Array.isArray(i)?i.forEach(i=>{e.append(t,i)}):null!=i&&e.append(t,i)}),e.toString()})(u)),f=new URL(`${r.origin}${r.pathname}?${h.toString()}`),d=(0,J.A)({},c,{method:e,timeout:null!=l?l:0,data:i});return X.info("[ServiceModule]: sendRequest start",d),Y.Wk.reportCUJ(tr.SEND_REQUEST,Y.PY.IN_PROGRESS,{stepName:"request_start",detail:t}),tt()(f.href,d).then(e=>(Y.Wk.reportCUJ(tr.SEND_REQUEST,Y.PY.FINISH,{detail:t}),X.info("[ServiceModule]: sendRequest finish",e),e)).catch(e=>{throw Y.Wk.reportCUJ(tr.SEND_REQUEST,Y.PY.FAILURE,{error:e,detail:t}),X.error("[ServiceModule]: sendRequest error",e),e})},this.destruct=()=>{X.info("[ServiceModule]: destruct")},tI._instance||(tI._instance=this),tI._instance}}var tT=new tI,tN=((u=tN||{}).beforeFetchUserInfo="beforeFetchUserInfo",u.afterFetchUserInfo="afterFetchUserInfo",u.beforeFetchConsentData="beforeFetchConsentData",u.afterFetchConsentData="afterFetchConsentData",u.beforeFetchCollectionPoint="beforeFetchCollectionPoint",u.afterFetchCollectionPoint="afterFetchCollectionPoint",u.beforeFetchEntities="beforeFetchEntities",u.afterFetchEntities="afterFetchEntities",u.beforeFetchNotificationData="beforeFetchNotificationData",u.afterFetchNotificationData="afterFetchNotificationData",u.beforeUpdateRecords="beforeUpdateRecords",u.afterUpdateRecords="afterUpdateRecords",u.beforeNotify="beforeNotify",u.afterNotify="afterNotify",u.beforeRemoveNotification="beforeRemoveNotification",u.afterRemoveNotification="afterRemoveNotification",u.beforeThirdPartyApprove="beforeThirdPartyApprove",u.afterThirdPartyApprove="afterThirdPartyApprove",u.beforeThirdPartyReject="beforeThirdPartyReject",u.afterThirdPartyReject="afterThirdPartyReject",u),tO=((h=tO||{}).sessionStorage="sessionStorage",h.localStorage="localStorage",h.inMem="inMem",h),tb=((f=tb||{}).UNSUPPORTED="Unsupported",f.APPROVE="Approve",f.REJECT="Reject",f.NOT_DETERMINED="NotDetermined",f.PENDING_REVIEW="PENDING_REVIEW",f.REVOKE="REVOKE",f),tR=((d=tR||{})[d.UNSUPPORTED=0]="UNSUPPORTED",d[d.APPROVE=1]="APPROVE",d[d.REJECT=2]="REJECT",d[d.NOT_DETERMINED=3]="NOT_DETERMINED",d[d.PENDING_REVIEW=4]="PENDING_REVIEW",d[d.REVOKE=5]="REVOKE",d),tD=((_=tD||{}).ENTITIES="entities",_.COLLECTION_POINTS="collectionPoints",_.NOTIFICATIONS="notifications",_);let tU={0:"Unsupported",1:"Approve",2:"Reject",3:"NotDetermined",4:"PENDING_REVIEW",5:"REVOKE"};var tM=i(54122),tw=i(9518),tA=Object.defineProperty,tL=Object.getOwnPropertySymbols,tF=Object.prototype.hasOwnProperty,tj=Object.prototype.propertyIsEnumerable,tk=(t,e,i)=>e in t?tA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;let t$={data:{},timestamp:0};var tJ=class{constructor(t="BaseStorageWrapper"){this._getConsentData=({userInfo:t,entityKeys:e,collectionPointId:i})=>{var n,r,o,s;X.info(`[${this.name}]: _getConsentData`,{userInfo:t,entityKeys:e,collectionPointId:i});let a={entityMap:null,collectionPoint:null};try{let l=this.getConsentStore(t),c=l[tD.ENTITIES],u=l[tD.COLLECTION_POINTS],h=[];if(i&&(a.collectionPoint=(null==(n=null==u?void 0:u.data)?void 0:n[i])?(0,tM.A)(u.data[i]):null,h=null!=(o=null==(r=a.collectionPoint)?void 0:r.entity_keys)?o:[]),a.entityMap=(0,tM.A)(null!=(s=null==c?void 0:c.data)?s:{}),Object.keys(a.entityMap).length){if(i){let t={};h.forEach(e=>{var i;(null==(i=a.entityMap)?void 0:i[e])&&(t[e]=a.entityMap[e])}),a.entityMap=t}else if(null==e?void 0:e.length){let t={};e.forEach(e=>{var i;(null==(i=a.entityMap)?void 0:i[e])&&(t[e]=a.entityMap[e])}),a.entityMap=t}}}catch(n){X.error(`[${this.name}]: getConsentData Error`,{userInfo:t,entityKeys:e,collectionPointId:i,error:n})}return a},this._updateUserInfo=(t,e)=>{X.info(`[${this.name}]: _updateUserInfo`,{userId:e,deviceId:t}),this._did=t,this._uid=e},this._formatConsentRecord=t=>{let{key:e,record:i,version:n}=null!=t?t:{};return i&&e?((t,e)=>{for(var i in e||(e={}))tF.call(e,i)&&tk(t,i,e[i]);if(tL)for(var i of tL(e))tj.call(e,i)&&tk(t,i,e[i]);return t})({entity_key:e,entity_version:n},i):null},this.getUserInfo=()=>({device_id:this._did,user_id:this._uid}),this.cleanUpUnrelatedUserData=t=>{X.info(`[${this.name}]: cleanUpUnrelatedUserData`,{userInfo:t});let{device_id:e="",user_id:i=""}=null!=t?t:{};(e||i)&&e===this._did&&i===this._uid||(this.cleanConsentData(),this._updateUserInfo(e,i))},this.insertDataByStorageName=(t,e,i,n)=>{X.info(`[${this.name}]: insertDataByStorageName`,{data:i,storageName:e,timestamp:n});let{data:r={},timestamp:o=0}=t[e];if(o<n){let o=(0,tw.A)({},i,r);t[e]={data:o,timestamp:n}}},this.getNotificationData=t=>(X.info(`[${this.name}]: getNotificationData`,{userInfo:t}),this.getNotificationStore(t).notification.data),this.insertConsentDataIntoStore=(t,e,i)=>{X.info(`[${this.name}]: insertConsentDataIntoStore`,{userInfo:i,data:t,timestamp:e});let n=this.getConsentStore(i),{entityMap:r,collectionPoint:o}=t;return((null==i?void 0:i.user_id)||(null==i?void 0:i.device_id))&&(this.insertDataByStorageName(n,tD.ENTITIES,r,e),(null==o?void 0:o.id)&&this.insertDataByStorageName(n,tD.COLLECTION_POINTS,{[o.id]:o},e)),n},this.getRecord=(t,e)=>{var i;X.info(`[${this.name}]: getRecord`,{userInfo:e,key:t});let{entityMap:n}=this._getConsentData({userInfo:e,entityKeys:[t]}),r=null==n?void 0:n[t],o=null!=(i=this._formatConsentRecord(r))?i:null;return o||X.info(`[${this.name}]: getRecord - no record for ${t}`,{key:t}),{record:o}},this.getEntity=(t,e)=>{var i;X.info(`[${this.name}]: getEntity`,{userInfo:e,key:t});let{entityMap:n}=this._getConsentData({userInfo:e,entityKeys:[t]}),r=null!=(i=null==n?void 0:n[t])?i:null;return r||X.info(`[${this.name}]: getEntity - no entity for ${t}`,{key:t}),{entity:r}},this.getEntities=(t,e)=>{X.info(`[${this.name}]: getEntities`,{userInfo:e,keys:t});let{entityMap:i}=this._getConsentData({userInfo:e,entityKeys:t});return{entityMap:i}},this.getRecords=(t,e)=>{X.info(`[${this.name}]: getRecords`,{userInfo:e,keys:t});let i=[],{entityMap:n}=this._getConsentData({userInfo:e,entityKeys:t});if(null==t?void 0:t.length){let e=[];t.forEach(t=>{let r=null==n?void 0:n[t],o=this._formatConsentRecord(r);o?i.push(o):e.push(t)}),e.length&&X.info(`[${this.name}]: getRecords - missing some records`,{entityKeys:e})}else Object.keys(null!=n?n:{}).forEach(t=>{let e=this._formatConsentRecord(null==n?void 0:n[t]);e&&i.push(e)});return{records:i}},this.getCollectionPoint=(t,e)=>(X.info(`[${this.name}]: getCollectionPoint`,{userInfo:e,collectionPointId:t}),this._getConsentData({userInfo:e,collectionPointId:t})),this.clean=()=>{this.cleanConsentData(),this.cleanNotificationData()},this.destruct=()=>{this.clean()},this.name=t}};let tY={[tD.ENTITIES]:(0,tM.A)(t$),[tD.COLLECTION_POINTS]:(0,tM.A)(t$)},tG={[tD.NOTIFICATIONS]:(0,tM.A)(t$)};var tK=class extends tJ{constructor(){super("InMemStorageWrapper"),this.insertConsentData=(t,e,i)=>{X.info(`[${this.name}]: insertConsentData`,{data:t,timestamp:e,userInfo:i});try{this.insertConsentDataIntoStore(t,e,i)}catch(t){X.error(`[${this.name}]: insert - ${t.message}`,t)}},this.insertNotificationData=(t,e,i)=>{X.info(`[${this.name}]: insertNotificationData`,{data:t,timestamp:e,userInfo:i});try{let n=this.getNotificationStore(i);this.insertDataByStorageName(n,tD.NOTIFICATIONS,t,e)}catch(t){X.error(`[${this.name}]: insert - ${t.message}`,t)}},this.getConsentStore=t=>(this.cleanUpUnrelatedUserData(t),this._consentStore),this.getNotificationStore=t=>this._notificationStore,this.cleanConsentData=()=>{this._consentStore[tD.COLLECTION_POINTS]=(0,tM.A)(t$),this._consentStore[tD.ENTITIES]=(0,tM.A)(t$)},this.cleanNotificationData=()=>{this._notificationStore[tD.NOTIFICATIONS]=(0,tM.A)(t$)},this.clean=()=>{this._consentStore=(0,tM.A)(tY),this._notificationStore=(0,tM.A)(tG)},this.destruct=()=>{this.clean()},this.clean()}},tB=i(17461),tx=i.n(tB);class tH extends tJ{constructor(t="WebStorageWrapper",e=tO.sessionStorage){super(t),this._decrypt=(t,e,i)=>{X.info(`[${this.name}]: _decrypt`);let n=null;if(e||i){let r=`${null!=e?e:""}_${null!=i?i:""}`;try{let e=tx().AES.decrypt(t,r).toString(tx().enc.Utf8),i=JSON.parse(e);(null==i?void 0:i.data)&&"number"==typeof(null==i?void 0:i.timestamp)&&(n=i)}catch(t){X.info(`[${this.name}]: _decrypt - ${t.message}`,t)}}return X.info(`[${this.name}]: _decrypt - finish`,n),n},this._encrypt=(t,e)=>{X.info(`[${this.name}]: _encrypt`);let{device_id:i="",user_id:n=""}=null!=e?e:{},r="";if(i||n){let e=`${null!=i?i:""}_${null!=n?n:""}`;r=tx().AES.encrypt(JSON.stringify(t),e).toString()}return r},this._encryptConsentStorage=(t,e)=>({[tD.ENTITIES]:this._encrypt(t[tD.ENTITIES],e),[tD.COLLECTION_POINTS]:JSON.stringify(t[tD.COLLECTION_POINTS])}),this._setConsentWebStorage=(t,e)=>{let i=this._encryptConsentStorage(t,e);window[this._storageName].setItem(tu,JSON.stringify(i))},this.insertConsentData=(t,e,i)=>{X.info(`[${this.name}]: insertConsentData`,{data:t,timestamp:e,userInfo:i});try{let n=this.insertConsentDataIntoStore(t,e,i);this._setConsentWebStorage(n,i)}catch(t){throw X.error(`[${this.name}]: insertConsentData - ${t.message}`,t),t}},this.insertNotificationData=(t,e,i)=>{X.info(`[${this.name}]: insertNotificationData`,{data:t,timestamp:e,userInfo:i});try{let n=this.getNotificationStore(i);this.insertDataByStorageName(n,tD.NOTIFICATIONS,t,e),window[this._storageName].setItem(th,JSON.stringify(n))}catch(t){throw X.error(`[${this.name}]: insertNotificationData - ${t.message}`,t),t}},this.getConsentStore=t=>{var e,i;X.info(`[${this.name}]: getConsentStore`,{userInfo:t}),this.cleanUpUnrelatedUserData(t);let{device_id:n="",user_id:r=""}=null!=t?t:{},o=(0,tM.A)(t$),s=(0,tM.A)(t$);try{let t=null!=(e=window[this._storageName].getItem(tu))?e:"{}",a=null!=(i=JSON.parse(t))?i:{};o=this._retrieveEntitiesData(a,n,r),s=this._retrieveCollectionPointData(a)}catch(t){X.error(`[${this.name}]: getConsentStore - ${t.message}`,t)}return{[tD.ENTITIES]:o,[tD.COLLECTION_POINTS]:s}},this.getNotificationStore=t=>{var e,i;X.info(`[${this.name}]: getNotificationStore`,{userInfo:t});let n=(0,tM.A)(t$);try{let t=null!=(e=window[this._storageName].getItem(th))?e:"{}";n=null!=(i=JSON.parse(t))?i:{}}catch(t){X.error(`[${this.name}]: getNotificationStore - ${t.message}`,t)}return{[tD.NOTIFICATIONS]:n}},this.cleanConsentData=()=>{X.info(`[${this.name}]: cleanConsentData`),window[this._storageName].removeItem(tu)},this.cleanNotificationData=()=>{X.info(`[${this.name}]: cleanNotificationData`),window[this._storageName].removeItem(th)},this.clean=()=>{window[this._storageName].removeItem(tu),window[this._storageName].removeItem(th)},this.destruct=()=>{this.clean()},this._storageName=e}_retrieveEntitiesData(t,e,i){let n=(0,tM.A)(t$),r=this._decrypt(t[tD.ENTITIES],e,i);return r||n}_retrieveCollectionPointData(t){var e;let i=(0,tM.A)(t$),n=null;try{n=JSON.parse(null!=(e=t[tD.COLLECTION_POINTS])?e:{})}catch(t){X.info(`[${this.name}]: _retrieveCollectionPointData - ${t.message}`,t)}return n||i}}class tV extends tH{constructor(){super("LocalStorageWrapper",tO.localStorage)}}class tW extends tH{constructor(){super("SessionStorageWrapper",tO.sessionStorage)}}let tz={[tO.inMem]:tK,[tO.localStorage]:tV,[tO.sessionStorage]:tW};class tq{constructor(){return tq._instance||(tq._instance=this),tq._instance}init(t){X.info("[StorageModule]: init");let{storageType:e=tO.sessionStorage}=null!=t?t:{};e&&(Object.values(tO).includes(e)||X.error(`[StorageModule]: init - Invalid Storage Type ${e}`,{storageType:e}),this._setupStorage(e))}getRecord(t,e){return X.info("[StorageModule]: getRecord",{key:t}),this._store.getRecord(t,e)}getRecords(t,e){return X.info("[StorageModule]: getRecords",{keys:t}),this._store.getRecords(t,e)}getEntity(t,e){return X.info("[StorageModule]: getEntity",{key:t}),this._store.getEntity(t,e)}getEntities(t,e){return X.info("[StorageModule]: getEntities",{keys:t}),this._store.getEntities(t,e)}getCollectionPoint(t,e){return X.info("[StorageModule]: getCollectionPoint",{collectionPointId:t}),this._store.getCollectionPoint(t,e)}insertConsentData(t,e,i){X.info("[StorageModule]: insertConsentData",{data:t,timestamp:e});try{this._inMemStore.insertConsentData(t,e,i),this._store.insertConsentData(t,e,i)}catch(t){t instanceof DOMException&&"QuotaExceededError"===t.name?X.error("[StorageModule]: insertConsentData - Storage limit exceeded, switch to in mem storage",t):X.error("[StorageModule]: insertConsentData - Error",t),this._store.destruct(),this._store=this._inMemStore}}getNotificationData(t){return X.info("[StorageModule]: getNotificationData",{userInfo:t}),this._store.getNotificationData(t)}insertNotificationData(t,e,i){X.info("[StorageModule]: insertNotificationData",{data:t,timestamp:e});try{this._inMemStore.insertNotificationData(t,e,i),this._store.insertNotificationData(t,e,i)}catch(t){t instanceof DOMException&&"QuotaExceededError"===t.name?X.error("[StorageModule]: insertNotificationData - Storage limit exceeded, switch to in mem storage",t):X.error("[StorageModule]: insertNotificationData - Error",t),this._store.destruct(),this._store=this._inMemStore}}_checkStorage(t){if(X.info("[StorageModule]: checkStorage",{storageType:t}),t===tO.inMem)return!0;try{let e=window[t].getItem(tu);if(!e)return window[t].setItem(tu,"{}"),window[t].removeItem(tu),!0;return window[t].setItem(tu,e),!0}catch(t){return!1}}_setupStorage(t){if(X.info("[StorageModule]: setupStorage",{storageType:t}),this._inMemStore=new tK,t&&this._checkStorage(t)){let e=tz[t];this._store=new e}else this._checkStorage(tO.sessionStorage)?this._store=new tW:this._checkStorage(tO.localStorage)?this._store=new tV:this._store=this._inMemStore}clean(){X.info("[StorageModule]: clean"),this._store&&this._store.clean(),this._inMemStore&&this._inMemStore.clean()}destruct(){X.info("[StorageModule]: destruct"),this.clean()}}var tQ=new tq,tX=((p=tX||{}).USAGE_BEFORE_INIT="Usage before init",p.INVALID_PARAM="Invalid param",p.INVALID_USER_INFO="Empty user info",p.INVALID_RESPONSE="Invalid response",p.ENTITY_MAX_PAGE_SIZE="Max page size for entity is 20. If you need to fetch all, remove page size & page token settings",p),tZ=class{constructor(){this.userInfo={}}init(t){X.info("[BaseInfoModule]: init")}getUserInfo(){return X.info("[BaseInfoModule]: getUserInfo"),this.userInfo}setUserInfo(t){X.info("[BaseInfoModule]: setUserInfo"),this.userInfo=t}fetchUserInfo(){return X.info("[BaseInfoModule]: fetchUserInfo"),Promise.resolve({})}},t0=class{getName(){return this.constructor.name}getLifeCycleEvents(){return Object.values(tN).filter(t=>"function"==typeof(this==null?void 0:this[t]))}},t1=Object.defineProperty,t2=Object.getOwnPropertySymbols,t6=Object.prototype.hasOwnProperty,t5=Object.prototype.propertyIsEnumerable,t7=(t,e,i)=>e in t?t1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;let t3=Object.keys(tN).reduce((t,e)=>(t[tN[e]]={},t),{});P=tN.beforeFetchUserInfo,S=tN.afterFetchUserInfo,C=tN.beforeFetchConsentData,m=tN.afterFetchConsentData,I=tN.beforeFetchEntities,T=tN.afterFetchEntities,N=tN.beforeFetchCollectionPoint,O=tN.afterFetchCollectionPoint,b=tN.beforeFetchNotificationData,R=tN.afterFetchNotificationData,D=tN.beforeUpdateRecords,U=tN.afterUpdateRecords,M=tN.beforeNotify,w=tN.afterNotify,A=tN.beforeRemoveNotification,L=tN.afterRemoveNotification,F=tN.beforeThirdPartyApprove,j=tN.afterThirdPartyApprove,k=tN.beforeThirdPartyReject,$=tN.afterThirdPartyReject;var t4=class extends t0{constructor(){super(...arguments),this.addEventListener=(t,e,i)=>{var n,r;if(X.info("[DefaultEventPlugin]: addEventListener"),null==(r=null==(n=this._registeredCallbackMap)?void 0:n[t])?void 0:r[e])return void X.error("[DefaultEventPlugin]: addEventListener - id for this event callback has been used");this._registeredCallbackMap[t][e]=i},this.removeEventListener=(t,e)=>{var i,n;X.info("[DefaultEventPlugin]: removeEventListener"),(null==(n=null==(i=this._registeredCallbackMap)?void 0:i[t])?void 0:n[e])&&delete this._registeredCallbackMap[t][e]},this[P]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeFetchUserInfo}`),this._triggerEvent(tN.beforeFetchUserInfo,t)},this[S]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterFetchUserInfo}`),this._triggerEvent(tN.afterFetchUserInfo,t)},this[C]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeFetchConsentData}`),this._triggerEvent(tN.beforeFetchConsentData,t)},this[m]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterFetchConsentData}`),this._triggerEvent(tN.afterFetchConsentData,t)},this[I]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeFetchEntities}`),this._triggerEvent(tN.beforeFetchEntities,t)},this[T]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterFetchEntities}`),this._triggerEvent(tN.afterFetchEntities,t)},this[N]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeFetchCollectionPoint}`),this._triggerEvent(tN.beforeFetchCollectionPoint,t)},this[O]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterFetchCollectionPoint}`),this._triggerEvent(tN.afterFetchCollectionPoint,t)},this[b]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeFetchNotificationData}`),this._triggerEvent(tN.beforeFetchNotificationData,t)},this[R]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterFetchNotificationData}`),this._triggerEvent(tN.afterFetchNotificationData,t)},this[D]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeUpdateRecords}`),this._triggerEvent(tN.beforeUpdateRecords,t)},this[U]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterUpdateRecords}`),this._triggerEvent(tN.afterUpdateRecords,t)},this[M]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeNotify}`),this._triggerEvent(tN.beforeNotify,t)},this[w]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterNotify}`),this._triggerEvent(tN.afterNotify,t)},this[A]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeRemoveNotification}`),this._triggerEvent(tN.beforeRemoveNotification,t)},this[L]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterRemoveNotification}`),this._triggerEvent(tN.afterRemoveNotification,t)},this[F]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeThirdPartyApprove}`),this._triggerEvent(tN.beforeThirdPartyApprove,t)},this[j]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterThirdPartyApprove}`),this._triggerEvent(tN.afterThirdPartyApprove,t)},this[k]=t=>{X.info(`[DefaultEventPlugin]: ${tN.beforeThirdPartyReject}`),this._triggerEvent(tN.beforeThirdPartyReject,t)},this[$]=t=>{X.info(`[DefaultEventPlugin]: ${tN.afterThirdPartyReject}`),this._triggerEvent(tN.afterThirdPartyReject,t)},this.destruct=()=>{Object.keys(tN).forEach(t=>{let e=tN[t];Object.keys(this._registeredCallbackMap[e]).forEach(t=>{delete this._registeredCallbackMap[e][t]}),this._registeredCallbackMap[e]={}})}}init(){this._registeredCallbackMap=(0,tM.A)(t3)}_triggerEvent(t,e){let i,n;return i=this,n=function*(){X.info("[DefaultEventPlugin]: triggerEvent");let i=[];Object.values(this._registeredCallbackMap[t]).forEach(t=>{if("function"==typeof t){let{plugin:n}=e,r=((t,e)=>{var i={};for(var n in t)t6.call(t,n)&&0>e.indexOf(n)&&(i[n]=t[n]);if(null!=t&&t2)for(var n of t2(t))0>e.indexOf(n)&&t5.call(t,n)&&(i[n]=t[n]);return i})(e,["plugin"]);i.push(t(((t,e)=>{for(var i in e||(e={}))t6.call(e,i)&&t7(t,i,e[i]);if(t2)for(var i of t2(e))t5.call(e,i)&&t7(t,i,e[i]);return t})({plugin:n},(0,tM.A)(r))))}});try{yield Promise.all(i)}catch(t){X.warn("[DefaultEventPlugin]: plugin callback error",t)}},new Promise((t,e)=>{var r=t=>{try{s(n.next(t))}catch(t){e(t)}},o=t=>{try{s(n.throw(t))}catch(t){e(t)}},s=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);s((n=n.apply(i,null)).next())})}},t9=i(37172),t8=i(53036);let et=(t,e)=>e?Error(`${t}: ${JSON.stringify(e)}`):Error(t);var ee=Object.defineProperty,ei=Object.defineProperties,en=Object.getOwnPropertyDescriptors,er=Object.getOwnPropertySymbols,eo=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable,ea=(t,e,i)=>e in t?ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,el=(t,e)=>{for(var i in e||(e={}))eo.call(e,i)&&ea(t,i,e[i]);if(er)for(var i of er(e))es.call(e,i)&&ea(t,i,e[i]);return t},ec=(t,e)=>ei(t,en(e)),eu=(t,e,i)=>new Promise((n,r)=>{var o=t=>{try{a(i.next(t))}catch(t){r(t)}},s=t=>{try{a(i.throw(t))}catch(t){r(t)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,s);a((i=i.apply(t,e)).next())});let eh={fetchEntities:{},fetchCollectionPoint:{},updateRecords:{}};var ef=class{constructor(){this._validateStatus=t=>Object.keys(tR).map(t=>tR[t]).includes(t),this._validateEntityKeys=t=>(null==t?void 0:t.length)>0&&t.every(t=>!!this._validateEntityKey(t)),this._validateEntityKey=t=>/^(conditions|permissions|data)/.test(t),this._validateUserInfo=t=>{if(!(null==t?void 0:t.user_id)&&!(null==t?void 0:t.device_id))throw X.error("[ConsentModule]: updateRecords - invalid user info"),et(tX.INVALID_USER_INFO)},this._validateUpdateParam=t=>(null==t?void 0:t.length)>0&&t.every(t=>{if(!t)return!1;let{key:e,status:i}=t;return!!/^(conditions|permissions|data)/.test(e)&&!!this._validateStatus(i)}),this._formatExtra=(t,e)=>{let i={};try{let t=JSON.parse(null!=e?e:"");i=el({},t)}catch(t){}return this._debug&&(i=ec(el({},i),{appId:this._appId,domain:t||this._domain,tenant:this._tenant,path:"/consent/api/record/create/v2",debug:!0,vregion:this._vregion})),JSON.stringify(i)},this.destruct=()=>{X.info("[ConsentModule]: destruct")}}_getAPIConfig(t){var e,i;let n={};return(null==(e=this._config)?void 0:e[t])&&(n="function"==typeof this._config[t]?this._config[t]():null!=(i=this._config[t])?i:{}),n}init(t){X.info("[ConsentModule]: init");let{api:e,appId:i,debug:n,domain:r,tenant:o,region:s}=null!=t?t:{};this._appId=i,this._debug=null!=n&&n,this._domain=r,this._tenant=o,this._vregion=null!=s?s:tf.SINGAPORE_CENTRAL;let{consent:a}=null!=e?e:{};this._config=(0,tw.A)({},a,eh)}getRecord(t,e){return X.info("[ConsentModule]: getRecord",{entityKey:t,userInfo:e}),tQ.getRecord(t,e)}getRecords(t,e){return X.info("[ConsentModule]: getRecords",{entityKeys:t,userInfo:e}),tQ.getRecords(t,e)}getEntity(t,e){return X.info("[ConsentModule]: getEntity",{entityKey:t,userInfo:e}),tQ.getEntity(t,e)}getEntities(t,e){return X.info("[ConsentModule]: getEntities",{entityKeys:t,userInfo:e}),tQ.getEntities(t,e)}fetchEntities(t,e){return eu(this,null,function*(){if(X.info("[ConsentModule]: fetchEntities",{entityKeys:t,userInfo:e}),this._validateUserInfo(e),!this._validateEntityKeys(t))throw et(tX.INVALID_PARAM,{entityKeys:t});X.reportCUJ(tr.FETCH_ENTITIES,Y.PY.IN_PROGRESS,{stepName:"api"});let{domain:i="",timeout:n,requestConfig:r,pageSize:o}=this._getAPIConfig("fetchEntities");if(o&&o>20)throw et(tX.ENTITY_MAX_PAGE_SIZE);let s={entityMap:{},collectionPoint:null},a=new Date().getTime();return Promise.all((o?(0,t9.A)(t,o):[t]).map(t=>(X.reportCUJ(tr.FETCH_ENTITIES,Y.PY.IN_PROGRESS,{stepName:"pagination_api"}),this._fetchEntitiesWithPagination(t,e,i,o,n,"",r).then(e=>{var i,n;let{data:r,status_code:o,status_msg:l,extra:c}=null!=(i=null==e?void 0:e.data)?i:{};if(0===o){X.reportCUJ(tr.FETCH_ENTITIES,Y.PY.IN_PROGRESS,{stepName:"pagination_api_finish"});let t=null==(n=null==r?void 0:r.reduce)?void 0:n.call(r,(t,e)=>{let{key:i}=null!=e?e:{};return i&&(t[i]=e),t},{});s.entityMap=el(el({},s.entityMap),null!=t?t:{}),(null==c?void 0:c.now)&&a<c.now&&(a=c.now)}else throw et(tX.INVALID_RESPONSE,{entityKey:t,statusCode:o,statusMessage:l})}).catch(t=>{throw X.error("[ConsentModule]: fetchEntities - fail to fetch",t),t})))).then(t=>(X.reportCUJ(tr.FETCH_ENTITIES,Y.PY.IN_PROGRESS,{stepName:"api_finish"}),tQ.insertConsentData(s,a,e),X.reportCUJ(tr.FETCH_ENTITIES,Y.PY.IN_PROGRESS,{stepName:"storage"}),s)).catch(t=>{throw X.error("[ConsentModule]: fetch - fail to fetch",t),t})})}getCollectionPoint(t,e){return X.info("[ConsentModule]: getCollectionPoint",{collectionPointId:t,userInfo:e}),tQ.getCollectionPoint(t,e)}fetchCollectionPoint(t,e){return eu(this,null,function*(){var i;if(X.info("[ConsentModule]: fetchCollectionPoint",{collectionPointId:t,userInfo:e}),this._validateUserInfo(e),!t)throw et(tX.INVALID_PARAM,{collectionPointId:t});X.reportCUJ(tr.FETCH_COLLECTION_POINT,Y.PY.IN_PROGRESS,{stepName:"api"});let{domain:n="",timeout:r,requestConfig:o}=this._getAPIConfig("fetchCollectionPoint");return tT.sendRequest(`${n}/consent/api/collection-point-records/list/v1`,"POST",{collection_point_id:t},ec(el({},o),{timeout:r,params:el({},null!=(i=(0,t8.A)(e,"user_id"))?i:{})})).then(i=>{var n,r,o;let{data:s=[],collection_point:a=null,status_code:l,status_msg:c,extra:u}=null!=(n=null==i?void 0:i.data)?n:{};if(0===l){X.reportCUJ(tr.FETCH_COLLECTION_POINT,Y.PY.IN_PROGRESS,{stepName:"api_finish"});let t=null;return a&&(t=null!=(r=null==s?void 0:s.reduce((t,e)=>{let{key:i}=null!=e?e:{};return i&&(t[i]=e),t},{}))?r:null,tQ.insertConsentData({entityMap:t,collectionPoint:a},null!=(o=null==u?void 0:u.now)?o:Date.now(),e),X.reportCUJ(tr.FETCH_COLLECTION_POINT,Y.PY.IN_PROGRESS,{stepName:"storage"})),{collectionPoint:a,entityMap:t}}throw et(tX.INVALID_RESPONSE,{collectionPointId:t,statusCode:l,statusMessage:c})}).catch(t=>{throw X.error("[ConsentModule]: fetchCollectionPoint - fail to fetch",t),t})})}getEntitiesWithApprovedRecord(t,e){X.info("[ConsentModule]: getEntitiesWithApprovedRecord",{entityKeys:t,userInfo:e});let{entityMap:i}=tQ.getEntities(t,e);return i?Object.keys(i).map(t=>{var e;let n=i[t];return(null==(e=null==n?void 0:n.record)?void 0:e.status)===tb.APPROVE?n:null}).filter(t=>t):[]}shouldFetch(){return X.info("[ConsentModule]: shouldFetch"),!0}_fetchEntitiesWithPagination(t,e,i,n,r,o,s){var a;return tT.sendRequest(`${i}/consent/api/combine/list/v3`,"POST",el({entity_keys:t},n?{page_size:n,page_token:null!=o?o:""}:{}),ec(el({},s),{timeout:r,params:el({},null!=(a=(0,t8.A)(e,"user_id"))?a:{})}))}updateRecords(t,e){return eu(this,null,function*(){var i;if(X.info("[ConsentModule]: updateRecords"),this._validateUserInfo(e),!this._validateUpdateParam(t))throw X.error("[ConsentModule]: updateRecords - invalid param",{params:t}),et(tX.INVALID_PARAM,{params:t});X.reportCUJ(tr.UPDATE_RECORD,Y.PY.IN_PROGRESS,{stepName:"api"});let{domain:n="",timeout:r,requestConfig:o}=this._getAPIConfig("updateRecords"),s=t.map(t=>t.key),a=t.map(t=>{var e;return{entity_key:t.key,status:t.status,coll_point_id:t.collectionPointId,extra:this._formatExtra(n,null!=(e=t.extra)?e:"")}});return tT.sendRequest(`${n}/consent/api/record/create/v2`,"POST",{records:a},ec(el({},null!=o?o:{}),{timeout:r,params:el({},null!=(i=(0,t8.A)(e,"user_id"))?i:{})})).then(i=>{var r,o;let{status_code:a,status_msg:l,extra:c={now:Date.now()}}=null!=(r=null==i?void 0:i.data)?r:{};if(0===a){if(X.reportCUJ(tr.UPDATE_RECORD,Y.PY.IN_PROGRESS,{stepName:"api_finish"}),t.length){let i=t.reduce((t,e)=>{var i;return t[e.key]={key:e.key,record:{entity_key:e.key,status:tU[e.status],extra:this._formatExtra(n,e.extra),coll_point_id:e.collectionPointId,app_id:this._appId,created_at:null!=(i=null==c?void 0:c.now)?i:Date.now()}},t},{});tQ.insertConsentData({entityMap:i,collectionPoint:null},null!=(o=null==c?void 0:c.now)?o:Date.now(),e),X.reportCUJ(tr.UPDATE_RECORD,Y.PY.IN_PROGRESS,{stepName:"storage"})}return tQ.getEntities(s,e)}throw et(tX.INVALID_RESPONSE,{params:t,statusCode:a,statusMessage:l})}).catch(t=>{throw X.error("[ConsentModule]: updateRecords - fail to create records",t),t})})}},ed=class{init(t){}getData(){return null}shouldNotify(t){return!0}notify(t){}canNotificationBeRemoved(t){return!1}removeNotification(t){}shouldFetch(){return!0}fetch(){return Promise.resolve(null)}destruct(){}},e_=Object.defineProperty,ep=Object.defineProperties,eg=Object.getOwnPropertyDescriptors,eE=Object.getOwnPropertySymbols,ev=Object.prototype.hasOwnProperty,ey=Object.prototype.propertyIsEnumerable,eP=(t,e,i)=>e in t?e_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,eS=(t,e)=>{for(var i in e||(e={}))ev.call(e,i)&&eP(t,i,e[i]);if(eE)for(var i of eE(e))ey.call(e,i)&&eP(t,i,e[i]);return t},eC=(t,e,i)=>new Promise((n,r)=>{var o=t=>{try{a(i.next(t))}catch(t){r(t)}},s=t=>{try{a(i.throw(t))}catch(t){r(t)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,s);a((i=i.apply(t,e)).next())});class em{constructor(){return this._thirdPartyMap={},this._cleanUpPlugins=()=>{this._pluginsMap&&Object.keys(this._pluginsMap).forEach(t=>{let e=this._pluginsMap[t];(null==e?void 0:e.length)&&(e.forEach(t=>{var e;null==(e=null==t?void 0:t.destruct)||e.call(t)}),delete this._pluginsMap[t])}),this._defaultPlugin=null},this.dispatch=(t,e)=>eC(this,null,function*(){var i;if(X.info("[LifeCycleModule]: dispatch start"),this._currentEvent.has(t))return void X.error("[LifeCycleModule]: Dispatch is already in process",{currentEvent:[...this._currentEvent],upcomingEvent:t});this._currentEvent.add(t);let n=null==(i=this._pluginsMap)?void 0:i[t],r=[];(null==n?void 0:n.length)&&n.forEach(i=>{var n;(null==i?void 0:i[t])&&"function"==typeof i[t]&&r.push(null==(n=null==i?void 0:i[t])?void 0:n.call(i,{name:t,data:(0,tM.A)(e),plugin:i}))});try{yield Promise.all(r)}catch(t){X.warn("[LifeCycleModule]: plugin callback error",t)}this._currentEvent.delete(t),X.info("[LifeCycleModule]: dispatch finish")}),this._dispatchAfterEvent=(t,e)=>{X.info("[LifeCycleModule]: dispatchAfterEvent"),e instanceof Promise?e.then(e=>{this.dispatch(t,e)}).catch(e=>{this.dispatch(t,e)}):this.dispatch(t,e)},this.addEventListener=(t,e,i)=>{var n;null==(n=this._defaultPlugin)||n.addEventListener(t,e,i)},this.removeEventListener=(t,e)=>{var i;null==(i=this._defaultPlugin)||i.removeEventListener(t,e)},em._instance||(em._instance=this),em._instance}init(t){var e,i;X.info("[LifeCycleModule]: init"),this._entityKeys=null!=(e=t.entityKeys)?e:[],this._collectionPointId=null!=(i=t.collectionPointId)?i:"",this._entityKeys.length||this._collectionPointId||X.warn("[LifeCycleModule]: no entityKeys or collectionPointId provided"),this._currentEvent=new Set,this._initPlugins(t),this._initModules(t),this._registerThirdParties(t)}_initModules(t){var e,i;X.info("[LifeCycleModule]: initModules"),this._consentModule=new ef,this._consentModule.init(t),(null==(e=null==t?void 0:t.modules)?void 0:e.notification)&&(t.modules.notification instanceof ed?(this._notificationModule=t.modules.notification,this._notificationModule.init(t)):X.warn("[LifeCycleModule]: initModules - incorrect implementation of NotificationModule, will skip")),(null==(i=null==t?void 0:t.modules)?void 0:i.info)?t.modules.info instanceof tZ?(this._infoModule=t.modules.info,this._infoModule.init(t)):X.error("[LifeCycleModule]: initModules - incorrect implementation of InfoModule"):X.error("[LifeCycleModule]: initModules - info module is required")}_initPlugins(t){var e;X.info("[LifeCycleModule]: initPlugins"),this._cleanUpPlugins(),this._pluginsMap=Object.values(tN).reduce((t,e)=>(t[e]=[],t),{}),this._defaultPlugin=new t4;let i=[this._defaultPlugin];(null==(e=t.plugins)?void 0:e.length)&&(i=i.concat(t.plugins));let n=new Set;i.forEach((t,e)=>{var i;null==(i=t.init)||i.call(t),this._registerPlugin(t,e,n)})}_registerPlugin(t,e,i){var n,r,o;let s=null==(n=null==t?void 0:t.getName)?void 0:n.call(t);if(!s)return void X.error(`[LifeCycleModule]: registerPlugin - Plugin on index ${e} is an invalid Plugin. Plugin should always have a unique name`,{index:e,plugin:t});if(i.has(s))return void X.error(`[LifeCycleModule]: registerPlugin - Duplicate Plugin ${s}.`,{index:e,pluginName:s,plugin:t});if(!(t instanceof t0))return void X.error(`[LifeCycleModule]: registerPlugin - ${s} incorrectly implements of Plugin.`,{index:e,pluginName:s,plugin:t});X.info(`[LifeCycleModule]: registerPlugin ${s} start`);let a=null==(o=null==(r=t.getLifeCycleEvents)?void 0:r.call(t))?void 0:o.filter(t=>t in tN);(null==a?void 0:a.length)&&a.forEach(e=>{this._pluginsMap[e].push(t)}),X.info(`[LifeCycleModule]: registerPlugin ${s} finish`,{plugin:s,events:a})}_registerThirdParties(t){var e,i,n;X.info("[LifeCycleModule]: registerThirdParties");let{thirdParties:r}=null!=(e=null==t?void 0:t.modules)?e:{};this._thirdPartyMap=null!=(n=null==(i=null==r?void 0:r.reduce)?void 0:i.call(r,(t,e)=>{for(let i of e.getRelatedEntities())t[i]?t[i].push(e):t[i]=[e];return t},{}))?n:{}}_initThirdParties(t){var e,i;X.info("[LifeCycleModule]: initThirdParties");let{entityMap:n}=t;if(n&&(null==(e=Object.values(n))?void 0:e.length)){let t=new Set,e=new Set;if(Object.values(n).forEach(i=>{var n;let r=null==(n=this._thirdPartyMap)?void 0:n[null==i?void 0:i.key];(null==r?void 0:r.length)&&r.forEach(i=>{if(i){let n=i.getRelatedEntities();(null==n?void 0:n.length)&&(n.forEach(e=>{t.add(e)}),e.add(i))}})}),e.size){let n=this._getUserInfo(),r=(null!=(i=this._consentModule.getEntitiesWithApprovedRecord([...t],n))?i:[]).reduce((t,e)=>(t[e.key]=e,t),{});for(let t of e)t.initThirdPartyModule(r,this.dispatch,this._dispatchAfterEvent)}}}fetch(t){return eC(this,null,function*(){var e;X.info("[LifeCycleModule]: fetch");try{let i,n;yield this.fetchUserInfo();let r=[this.shouldFetchConsentData()?this.fetchConsentData({collectionPointId:this._collectionPointId,entityKeys:this._entityKeys}):Promise.resolve({}),this.shouldFetchNotificationData()?this.fetchNotificationData(null==t?void 0:t.notificationParam):Promise.resolve({})],[o,s]=yield Promise.all(r),{entityMap:a,collectionPoint:l}=null!=o?o:{};return a&&(null==(e=Object.keys(a))?void 0:e.length)&&this._initThirdParties(o),s&&this._triggerNotification({notificationData:s,relatedEntityMap:a,collectionPoint:l}),i=eS({},o),n={notificationData:s},ep(i,eg(n))}catch(t){return X.error("[LifeCycleModule]: fetch failure",t),{entityMap:null,notificationData:null,collectionPoint:null}}})}fetchUserInfo(){return eC(this,null,function*(){var t,e,i,n;X.info("[LifeCycleModule]: fetchUserInfo"),this.dispatch(tN.beforeFetchUserInfo);let r={};try{r=null!=(i=yield null!=(e=null==(t=this._infoModule)?void 0:t.fetchUserInfo())?e:Promise.resolve({}))?i:{},null==(n=this._infoModule)||n.setUserInfo(r)}catch(t){X.error("[LifeCycleModule]: fetchUserInfo - error",t)}return this.dispatch(tN.afterFetchUserInfo,{userInfo:r}),r})}_getUserInfo(){var t,e;return X.info("[LifeCycleModule]: _getUserInfo"),null!=(e=null==(t=this._infoModule)?void 0:t.getUserInfo())?e:{}}shouldFetchConsentData(){var t,e;return X.info("[LifeCycleModule]: shouldFetchConsentData"),null!=(e=null==(t=this._consentModule)?void 0:t.shouldFetch())&&e}shouldFetchNotificationData(){var t,e,i;return(X.info("[LifeCycleModule]: shouldFetchNotificationData"),this._notificationModule)?null!=(i=null==(e=null==(t=this._notificationModule)?void 0:t.shouldFetch)?void 0:e.call(t))&&i:(X.info("[LifeCycleModule]: no notification module"),!1)}fetchNotificationData(...t){var e,i;return(X.info("[LifeCycleModule]: fetchNotificationData"),this._notificationModule)?(this.dispatch(tN.beforeFetchNotificationData,{notificationParams:t}),null==(i=null==(e=this._notificationModule)?void 0:e.fetch)?void 0:i.call(e,...t).then(e=>{let{data:i}=null!=e?e:{};return this.dispatch(tN.afterFetchNotificationData,{notificationParams:t,data:i}),i}).catch(e=>{X.error("[LifeCycleModule]: fetchNotificationData failure",e),this.dispatch(tN.afterFetchNotificationData,{notificationParams:t,data:null,error:e})})):(X.info("[LifeCycleModule]: no notification module"),Promise.resolve(null))}getNotificationData(){return(X.info("[LifeCycleModule]: getNotificationData"),this._notificationModule)?this._notificationModule.getData():(X.info("[LifeCycleModule]: no notification module"),null)}removeNotification(t){if(X.info("[LifeCycleModule]: removeNotification"),!this._notificationModule)return void X.info("[LifeCycleModule]: no notification module");if(!this._notificationModule.canNotificationBeRemoved(t))return;this.dispatch(tN.beforeRemoveNotification,t);let e=this._notificationModule.removeNotification(t);this._dispatchAfterEvent(tN.afterRemoveNotification,e)}notify(t){var{relatedEntityKeys:e=[]}=t,i=((t,e)=>{var i={};for(var n in t)ev.call(t,n)&&0>e.indexOf(n)&&(i[n]=t[n]);if(null!=t&&eE)for(var n of eE(t))0>e.indexOf(n)&&ey.call(t,n)&&(i[n]=t[n]);return i})(t,["relatedEntityKeys"]);if(X.info("[LifeCycleModule]: notify"),!this._notificationModule)return void X.info("[LifeCycleModule]: no notification module");let{entityMap:n}=this.getEntities(e);this._triggerNotification(eS({relatedEntityKeys:e,notificationData:this.getNotificationData(),relatedEntityMap:n},i))}_triggerNotification(t){if(X.info("[LifeCycleModule]: triggerNotification"),!this._notificationModule)return void X.info("[LifeCycleModule]: no notification module");if(!this._notificationModule.shouldNotify(t))return;this.dispatch(tN.beforeNotify,t);let e=this._notificationModule.notify(t);this._dispatchAfterEvent(tN.afterNotify,e)}fetchConsentData({collectionPointId:t,entityKeys:e}){X.info("[LifeCycleModule]: fetchConsentData"),this.dispatch(tN.beforeFetchConsentData,{entityKeys:e,collectionPointId:t});let i=Promise.resolve({entityMap:null,collectionPoint:null});return t?i=this.fetchCollectionPoint(t):e&&(i=this.fetchEntities(e)),i.then(i=>(this.dispatch(tN.afterFetchConsentData,{entityKeys:e,collectionPointId:t,data:i}),i)).catch(i=>(X.error("[LifeCycleModule]: fetchConsentData failure",i),this.dispatch(tN.afterFetchConsentData,{entityKeys:e,collectionPointId:t,data:{entityMap:null,collectionPoint:null},error:i}),{entityMap:null,collectionPoint:null,error:i}))}getConsentRecord(t){X.info("[LifeCycleModule]: getConsentRecord",{entityKey:t});let e=this._getUserInfo();return this._consentModule.getRecord(t,e)}getConsentRecords(t){var e;X.info("[LifeCycleModule]: getConsentRecords",{entityKeys:t});let i=this._getUserInfo();return null!=(e=this._consentModule.getRecords(t,i))?e:[]}getEntity(t){X.info("[LifeCycleModule]: getEntity",{entityKey:t});let e=this._getUserInfo();return this._consentModule.getEntity(t,e)}getEntities(t){X.info("[LifeCycleModule]: getEntities",{entityKeys:t});let e=this._getUserInfo();return this._consentModule.getEntities(t,e)}fetchEntities(t){X.info("[LifeCycleModule]: fetchEntities"),this.dispatch(tN.beforeFetchEntities,{entityKeys:t});let e=this._getUserInfo();return this._consentModule.fetchEntities(t,e).then(e=>(this.dispatch(tN.afterFetchEntities,{entityKeys:t,data:e}),e)).catch(e=>{throw X.error("[LifeCycleModule]: fetchEntities failure",e),this.dispatch(tN.afterFetchEntities,{entityKeys:t,data:null,error:e}),e})}getCollectionPoint(t){X.info("[LifeCycleModule]: getCollectionPoint",{collectionPointId:t});let e=this._getUserInfo();return this._consentModule.getCollectionPoint(t,e)}fetchCollectionPoint(t){X.info("[LifeCycleModule]: fetchByCollectionPoint"),this.dispatch(tN.beforeFetchCollectionPoint,{collectionPointId:t});let e=this._getUserInfo();return this._consentModule.fetchCollectionPoint(t,e).then(e=>(this.dispatch(tN.afterFetchCollectionPoint,{collectionPointId:t,data:e}),e)).catch(e=>{throw X.error("[LifeCycleModule]: fetchByCollectionPoint failure",e),this.dispatch(tN.afterFetchCollectionPoint,{collectionPointId:t,data:null,error:e}),e})}updateConsentRecords(t){return eC(this,null,function*(){X.info("[LifeCycleModule]: updateConsentRecords",{params:t}),this.dispatch(tN.beforeUpdateRecords,{params:t});let e={entityMap:null,collectionPoint:null},i=this._getUserInfo();try{e=yield this._consentModule.updateRecords(t,i),this.dispatch(tN.afterUpdateRecords,{data:e})}catch(i){throw X.error("[LifeCycleModule]: updateConsentRecords",i),this.dispatch(tN.afterUpdateRecords,{params:t,data:e,error:i}),i}return this._initThirdParties(e),e})}destruct(){this._cleanUpPlugins(),X.info("[LifeCycleModule]: destruct")}}var eI=new em;let eT=t=>to[t];var eN=(t,e,i)=>new Promise((n,r)=>{var o=t=>{try{a(i.next(t))}catch(t){r(t)}},s=t=>{try{a(i.throw(t))}catch(t){r(t)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,s);a((i=i.apply(t,e)).next())});let eO={appId:-1,domain:"",tenant:"",entityKeys:[],mode:td.PRODUCTION,isPPE:!1,debug:!1,fetchDataAtInit:!0,region:tf.SINGAPORE_CENTRAL,storageType:tO.sessionStorage,modules:{info:new tZ}};class eb{constructor(){return this._isInitialized=!1,this._validateInitStatus=()=>!!this._isInitialized||(console.error("[SDK]: SDK is used before init"),!1),this.getConsentRecord=t=>{if(!this._validateInitStatus())return{record:null,error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.GET_RECORD,Y.PY.START);try{X.info("[SDK]: getConsentRecord",{entityKey:t});let e=eI.getConsentRecord(t);return X.reportCUJ(tr.GET_RECORD,Y.PY.FINISH),e}catch(t){return X.reportCUJ(tr.GET_RECORD,Y.PY.FAILURE,{error:t}),{record:null,error:t}}},this.getConsentRecords=t=>{if(!this._validateInitStatus())return{records:[],error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.GET_RECORDS,Y.PY.START);try{X.info("[SDK]: getConsentRecords",{entityKeys:t});let e=eI.getConsentRecords(t);return X.reportCUJ(tr.GET_RECORDS,Y.PY.FINISH),e}catch(t){return X.reportCUJ(tr.GET_RECORDS,Y.PY.FAILURE,{error:t}),{records:[],error:t}}},this.getEntity=t=>{if(!this._validateInitStatus())return{entity:null,error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.GET_ENTITY,Y.PY.START);try{X.info("[SDK]: getEntity",{entityKey:t});let e=eI.getEntity(t);return X.reportCUJ(tr.GET_ENTITY,Y.PY.FINISH),e}catch(t){return X.reportCUJ(tr.GET_ENTITY,Y.PY.FAILURE,{error:t}),{entity:null,error:t}}},this.getEntities=t=>{if(!this._validateInitStatus())return{collectionPoint:null,entityMap:null,error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.GET_ENTITIES,Y.PY.START);try{X.info("[SDK]: getEntities",{entityKeys:t});let e=eI.getEntities(t);return X.reportCUJ(tr.GET_ENTITIES,Y.PY.FINISH),e}catch(t){return X.reportCUJ(tr.GET_ENTITIES,Y.PY.FAILURE,{error:t}),{collectionPoint:null,entityMap:null,error:t}}},this.fetchEntities=t=>eN(this,null,function*(){if(!this._validateInitStatus())return{collectionPoint:null,entityMap:null,error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.FETCH_ENTITIES,Y.PY.START);try{X.info("[SDK]: fetchEntities",{entityKeys:t});let e=yield eI.fetchEntities(t);return X.reportCUJ(tr.FETCH_ENTITIES,Y.PY.FINISH),e}catch(t){return X.reportCUJ(tr.FETCH_ENTITIES,Y.PY.FAILURE,{error:t}),{collectionPoint:null,entityMap:null,error:t}}}),this.getCollectionPoint=t=>{if(!this._validateInitStatus())return{collectionPoint:null,entityMap:null,error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.GET_COLLECTION_POINT,Y.PY.START);try{X.info("[SDK]: getCollectionPoint",{collectionPointId:t});let e=eI.getCollectionPoint(t);return X.reportCUJ(tr.GET_COLLECTION_POINT,Y.PY.FINISH),e}catch(t){return X.reportCUJ(tr.GET_COLLECTION_POINT,Y.PY.FAILURE,{error:t}),{collectionPoint:null,entityMap:null,error:t}}},this.fetchCollectionPoint=t=>eN(this,null,function*(){if(!this._validateInitStatus())return{collectionPoint:null,entityMap:null,error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.FETCH_COLLECTION_POINT,Y.PY.START);try{X.info("[SDK]: fetchCollectionPoint",{collectionPointId:t});let e=yield eI.fetchCollectionPoint(t);return X.reportCUJ(tr.FETCH_COLLECTION_POINT,Y.PY.FINISH),e}catch(t){return X.reportCUJ(tr.FETCH_COLLECTION_POINT,Y.PY.FAILURE,{error:t}),{collectionPoint:null,entityMap:null,error:t}}}),this.updateConsentRecords=t=>eN(this,null,function*(){if(!this._validateInitStatus())return{collectionPoint:null,entityMap:null,error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.UPDATE_RECORD,Y.PY.START,{data:t});try{X.info("[SDK]: updateConsentRecords",{params:t});let e=yield eI.updateConsentRecords(t);return X.reportCUJ(tr.UPDATE_RECORD,Y.PY.FINISH,{data:t}),e}catch(t){return X.reportCUJ(tr.UPDATE_RECORD,Y.PY.FAILURE,{error:t}),{collectionPoint:null,entityMap:null,error:t}}}),this.removeNotification=t=>{this._validateInitStatus()&&(X.info("[SDK]: removeNotification",{arg:t}),eI.removeNotification(t))},this.notify=t=>{this._validateInitStatus()&&(X.info("[SDK]: notify",{arg:t}),eI.notify(t))},this.fetch=t=>eN(this,null,function*(){if(!this._validateInitStatus())return{error:et(tX.USAGE_BEFORE_INIT)};X.reportCUJ(tr.FETCH_DATA,Y.PY.START);try{X.info("[SDK]: fetch",{arg:t});let e=yield eI.fetch(t);return X.reportCUJ(tr.FETCH_DATA,Y.PY.FINISH),e}catch(t){return X.reportCUJ(tr.FETCH_DATA,Y.PY.FAILURE,{error:t}),{error:t}}}),this.addEventListener=(t,e,i)=>{if(this._validateInitStatus()){if(X.reportCUJ(tr.SUBSCRIBE_EVENT,Y.PY.START),X.info("[SDK]: addEventListener"),!t||!tN[t]||!e||"function"!=typeof i){let t="[SDK]: addEventListener - invalid param for adding new event listener",e=Error(t);X.error(t,e),X.reportCUJ(tr.SUBSCRIBE_EVENT,Y.PY.FAILURE,{error:e});return}try{eI.addEventListener(t,e,i),X.reportCUJ(tr.SUBSCRIBE_EVENT,Y.PY.FINISH)}catch(t){X.reportCUJ(tr.SUBSCRIBE_EVENT,Y.PY.FAILURE,{error:t})}}},this.removeEventListener=(t,e)=>{if(this._validateInitStatus()){X.reportCUJ(tr.UNSUBSCRIBE_EVENT,Y.PY.START),X.info("[SDK]: removeEventListener");try{eI.removeEventListener(t,e),X.reportCUJ(tr.UNSUBSCRIBE_EVENT,Y.PY.FINISH)}catch(t){X.reportCUJ(tr.UNSUBSCRIBE_EVENT,Y.PY.FAILURE,{error:t})}}},this.destruct=()=>{X.info("[SDK]: destruct"),eI.destruct(),tT.destruct(),tQ.destruct(),X.destruct(),this._isInitialized=!1},eb._instance||(eb._instance=this),eb._instance}init(t){return eN(this,null,function*(){if("undefined"==typeof window)return console.warn("ConsentClientFrameworkSDK can not be init on server"),Promise.resolve();if(this._isInitialized)throw Error("ConsentClientFrameworkSDK has been initialized");let e=(0,tw.A)({},t,eO),{debug:i=!1,fetchDataAtInit:n,modules:r,region:o,appId:s,bid:a,tea:l,slardar:c,mode:u,appVersion:h,tenant:f}=e;i&&(window.consentSDK=this,window.consentSDK.storage=tQ),X.init({customLoggingModule:r.logging,monitorModuleConfig:{tea:l,slardar:c,teaEventNameFormatter:eT},meta:tg()},{bid:"pns_consent_system",consumerBid:a,version:tl,appId:s,appVersion:h,tenant:f,mode:u,region:o,debug:i}),X.reportCUJ(tr.SDK_INIT,Y.PY.START);try{if(X.info("[SDK]: init global module"),tT.init(e),tQ.init(e),X.info("[SDK]: init life cycle"),eI.init(e),this._isInitialized=!0,!n)return X.reportCUJ(tr.FETCH_USER,Y.PY.START),yield eI.fetchUserInfo(),X.reportCUJ(tr.FETCH_USER,Y.PY.FINISH),X.reportCUJ(tr.SDK_INIT,Y.PY.FINISH),Promise.resolve();{X.reportCUJ(tr.FETCH_DATA,Y.PY.START);let t=yield eI.fetch();return X.reportCUJ(tr.FETCH_DATA,Y.PY.FINISH),X.reportCUJ(tr.SDK_INIT,Y.PY.FINISH),t}}catch(t){throw X.reportCUJ(tr.SDK_INIT,Y.PY.FAILURE,{error:t}),t}})}isInitialized(){return X.info("[SDK]: isInitialized"),this._isInitialized}}let eR=new eb;var eD=((g=eD||{}).ad_storage="ad_storage",g.ad_user_data="ad_user_data",g.ad_personalization="ad_personalization",g.analytics_storage="analytics_storage",g.functionality_storage="functionality_storage",g.personalization_storage="personalization_storage",g.security_storage="security_storage",g),eU=eR}}]);