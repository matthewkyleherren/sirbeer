"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["49538"],{66973:function(e,t,n){n.d(t,{Cx:function(){return d},EB:function(){return l},rP:function(){return f}});var r=n(5377),s=n(45996),i=n(82887),o=n(66905),a=n(10625),u=(0,i._)((0,a.p)("commentPanelAtom@tiktok/webapp-atoms",{isActive:!1,showSkeleton:!1}),{rehydrationKey:"webapp.comment.panel"}),c=(0,o.i)(u,function(e,t){return{setItemId:function(e){t(u,function(t){return(0,s._)((0,r._)({},t),{isActive:!0,itemId:e})})},setShowSkeleton:function(e){t(u,function(t){return(0,s._)((0,r._)({},t),{showSkeleton:e})})},removeActiveItem:function(){t(u,{isActive:!1,showSkeleton:!1})},setCloseMethod:function(e){t(u,function(t){return(0,s._)((0,r._)({},t),{closeMethod:null!=e?e:void 0})})},closeCommentPanel:function(e){t(u,function(t){return(0,s._)((0,r._)({},t),{isActive:!1,showSkeleton:!1,closeMethod:e})})}}}),l=c.useAtomService,d=c.useServiceState,f=c.useServiceDispatchers;c.getStaticApi},27352:function(e,t,n){n.d(t,{US:function(){return g},n4:function(){return h},pt:function(){return d}});var r=n(79066),s=n(5377),i=n(45996),o=n(72516),a=n(66905),u=n(10625),c=n(44957),l=n(54149),d=(0,u.p)("conversationTagAtom@tiktok/webapp-atoms",{allConversationTagGroupList:[],allConversationTagList:[],selectedConversationTagList:[],unreadOnly:!1,isLoading:!0}),f=(0,a.i)(d,function(e,t){return{setSelectedConversationTagList:function(e){t(d,function(t){return(0,i._)((0,s._)({},t),{selectedConversationTagList:e})})},setAllConversationTagGroupList:function(e){t(d,function(t){return(0,i._)((0,s._)({},t),{allConversationTagGroupList:e})})},setAllConversationTagList:function(e){t(d,function(t){return(0,i._)((0,s._)({},t),{allConversationTagList:e})})},setUnreadOnly:function(e){t(d,function(t){return(0,i._)((0,s._)({},t),{unreadOnly:e})})},setLoading:function(e){t(d,function(t){return(0,i._)((0,s._)({},t),{isLoading:e})})},getAllConversationTags:function(){return(0,r._)(function(){var e,n,a;return(0,o.__generator)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,3,4]),t(d,function(e){return(0,i._)((0,s._)({},e),{isLoading:!0})}),[4,(0,r._)(function(){return(0,o.__generator)(this,function(e){return[2,c.h.get("/api/ba/business/suite/contact/label/mapping",{baseUrlType:l.Z4.FixedWww})]})})()];case 1:return a=(n=null!=(e=u.sent().label_groups)?e:[]).filter(function(e){return e.labels&&e.labels.length>0}).map(function(e){return e.labels}).flat(2),this.setAllConversationTagGroupList(n),this.setAllConversationTagList(a),[3,4];case 2:return u.sent(),[3,4];case 3:return t(d,function(e){return(0,i._)((0,s._)({},e),{isLoading:!1})}),[7];case 4:return[2]}})}).call(this)}}}),g=(f.useServiceState,f.useServiceDispatchers),h=f.useAtomService;f.getStaticApi},76365:function(e,t,n){n.d(t,{Yl:function(){return O},IA:function(){return N},by:function(){return V},nU:function(){return A},VI:function(){return E}});var r,s=n(79066),i=n(35383),o=n(5377),a=n(45996),u=n(16327),c=n(72516),l=n(26869),d=n(66905),f=n(10625),g=n(51379),h=n(66868),_=n(44957),v=n(54149),p=n(39304),m=n(85443),M=(0,p.y)(m.$),y=n(63004),S=n(34826),C=n(10734),I=n(13750),b=n(20776),w=n(77348),L=n(35083),T=function(e,t){return(0,s._)(function(){return(0,c.__generator)(this,function(n){return[2,_.h.get("/api/im/item_detail/",{query:{itemId:e,coverFormat:t},baseUrlType:v.Z4.FixedWww})]})})()},U=function(e){var t=e.conversationId,n=e.shortId,r=e.uid,i=e.selfUid,o=e.content,a=e.messageId,u=e.serverMsgId,d=e.decisionRuleId,f=e.checkMessageStatusCode;return(0,s._)(function(){var e;return(0,c.__generator)(this,function(s){return e=l.stringify({conv_id:t,con_short_id:n,receiver_uid:r,content:o,msg_type:"7",biz_app_id:1988,scene:"sending_ban",msg_id:a,event:"tt_web_im",content_pb:"",server_msg_id:u,decision_rule_id:d,check_message_status_code:f,sending_ban_messages:"[".concat(JSON.stringify({msg_id:a,server_msg_id:u,msg_type:"7",sender_uid:i,content:o,content_pb:"",banned:!1}),"]")}),[2,_.h.post("/aweme/v1/im/msg/feedback/",{query:{report_type:"im",appId:1233},headers:{"Content-Type":v.Ty.FORM_ENCODE},body:e})]})})()},k=["group_create"],R=function(e){if(!e.visible||e.scene&&/streak/.test(e.scene))return!1;if(e.content&&e.type===w.Go.StartChatTip&&e.scene&&!k.includes(e.scene))try{var t=JSON.parse(e.content);if((null==t?void 0:t.template.length)>0)return!1}catch(e){return!1}return!0},P=(r={},(0,i._)(r,w.om.Friends,{}),(0,i._)(r,w.om.Strangers,{}),(0,i._)(r,"hasProcessedGroupChatUserMap",{}),(0,i._)(r,"selectedConversation",void 0),(0,i._)(r,"currentMessage",{list:[],refMsgMap:new Map,hasMore:!0}),(0,i._)(r,"isLoadingMoreMessage",!1),(0,i._)(r,"failedMessageMap",{}),(0,i._)(r,"hasFeedbackMap",{}),(0,i._)(r,"fetchingVideoCodeMap",{}),(0,i._)(r,"failedVideoCodeMap",{}),(0,i._)(r,"itemListByMessageId",[]),(0,i._)(r,"recordedFocusOrigin",""),(0,i._)(r,"moderationResultMap",{}),(0,i._)(r,"sendingProgressMap",{}),(0,i._)(r,"lastUpdatedMap",{}),r),A=(0,f.p)("conversationAtom@tiktok/webapp-atoms",P),F=(0,d.i)(A,function(e,t){var r;return r={setSelectedConversation:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{selectedConversation:e,refMessage:void 0})})},setActionOpenedConversation:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{actionOpenedConversation:e})})},setUser:function(n){var r=n.item,s=n.isStranger,u=e(A);s?t(A,(0,a._)((0,o._)({},u),{strangers:(0,a._)((0,o._)({},u.strangers),(0,i._)({},r.id,r))})):t(A,(0,a._)((0,o._)({},u),{friends:(0,a._)((0,o._)({},u.friends),(0,i._)({},r.id,r))}))},addFailedMessage:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{failedMessageMap:(0,o._)({},t.failedMessageMap,e)})})},setModerationResult:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{moderationResultMap:e})})},setProcessedGroupChatUsers:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{hasProcessedGroupChatUserMap:(0,a._)((0,o._)({},t.hasProcessedGroupChatUserMap),(0,i._)({},e,!0))})})},setLastUpdated:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{lastUpdatedMap:e})})},setSendingProgress:function(n){var r=n.messageId,s=n.sendingProgress,i=e(A).sendingProgressMap,u=(0,o._)({},i);u[r]=s,t(A,function(e){return(0,a._)((0,o._)({},e),{sendingProgressMap:u})})},multiSetConversation:function(n){var r=n.list,s=n.isStranger,i=e(A),u={};r.forEach(function(e){u[e.id]=e}),s?t(A,(0,a._)((0,o._)({},i),{strangers:(0,o._)({},i.strangers,u)})):t(A,(0,a._)((0,o._)({},i),{friends:(0,o._)({},i.friends,u)}))},setMessageListAction:function(e){var n=this;t(A,function(t){var r=t.currentMessage.refMsgMap,s=(0,I.fI)().getInstance().option.userId;return null==e||e.forEach(function(e){if(e.referenceInfo){var t=e.referenceInfo.referenced_message_id.toString();if(!r.has(t))return void r.set(t,null)}}),null==e||e.forEach(function(e){var t=n.getReactionList(e,s),i=t.reactionCountList,o=t.reactionList;e.reactionCountList=i,e.reactionList=o,null===r.get(e.serverId)&&r.set(e.serverId,e)}),(0,a._)((0,o._)({},t),{currentMessage:(0,a._)((0,o._)({},t.currentMessage),{list:null!=e?e:[]})})})},setRecordedFocusOrigin:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{recordedFocusOrigin:e})})},setMessageHasMore:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{currentMessage:(0,a._)((0,o._)({},t.currentMessage),{hasMore:e})})})},setIsLoadingMoreMessage:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{isLoadingMoreMessage:e})})},setHasFeedbackMap:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{hasFeedbackMap:(0,a._)((0,o._)({},t.hasFeedbackMap),(0,i._)({},e,!0))})})},setFailedVideoCodeMap:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{failedVideoCodeMap:(0,o._)({},t.failedVideoCodeMap,e)})})},setItemListByMessageId:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{itemListByMessageId:e})})},setRefMessage:function(e){t(A,function(t){return(0,a._)((0,o._)({},t),{refMessage:e})})},removeRefMessage:function(){t(A,function(e){return(0,a._)((0,o._)({},e),{refMessage:void 0})})},setMessageList:function(t){return(0,s._)(function(){var n,r,s,i,o,a,u,l,d;return(0,c.__generator)(this,function(c){switch(c.label){case 0:if(n=t.list,r=t.shouldHandleVideoMessage,s=t.abTestVersion,o=(i=e(A)).failedVideoCodeMap,a=i.fetchingVideoCodeMap,!r)return[2,void this.setMessageListAction(n)];return u=[],l=[],d=[],n.forEach(function(e){var t=e.type,n=e.content,r=e.clientId;if(t===w.Go.Video||t===w.Go.Story){var s={};try{s=JSON.parse(n)}catch(e){return null}var i=s.itemId;!o[i]&&(l.push(i),d.push(r),(0,S.ud)().getStaticItem(i)||a[i]||u.push(i))}}),this.setMessageListAction(n),[4,this.getVideoListV2({needRequestList:u,allList:l,allListByMessageId:d,abTestVersion:s})];case 1:return c.sent(),[2]}})}).call(this)},handleMessageUpsert:function(t){return(0,s._)(function(){var n,r,s;return(0,c.__generator)(this,function(i){switch(i.label){case 0:if(n=t.message,r=t.abTestVersion,!(s=e(A).selectedConversation)||![w.Go.MsgTypeTemplatePictureCard,w.Go.MsgTypeTemplateVideoCard].includes(n.type)||7!==n.source)return[2];return[4,this.getMessageList({id:null==s?void 0:s.id,shouldHandleVideoMessage:!1,abTestVersion:r})];case 1:return i.sent(),[2]}})}).call(this)},handleConversationLeave:function(t){return(0,s._)(function(){var n;return(0,c.__generator)(this,function(r){switch(r.label){case 0:return(null==(n=e(A).selectedConversation)?void 0:n.id)===t.id&&this.setSelectedConversation(void 0),[4,(0,I.fI)().deleteConversation({conversation:t})];case 1:return r.sent(),[2]}})}).call(this)},handleConversationUpsert:function(e){return(0,s._)(function(){return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getMessageList({id:e.id,shouldHandleVideoMessage:!1})];case 1:return t.sent(),[2]}})}).call(this)},handleConversationDelete:function(t){var n=e(A).selectedConversation;if((null==n?void 0:n.id)===t.id){if(!n.isGroupChat){var r,s,i,o=null!=(s=n.toParticipantUserId)?s:"",a=null!=(i=null==(r=(0,L.py)().getUser(o))?void 0:r.uniqueId)?i:"";(0,b.Hz)(w.jh.UserDelete,{uid:o,uniqueId:a,conversationShortId:n.shortId})}this.setSelectedConversation(void 0)}},getMessageList:function(t){return(0,s._)(function(){var n,r,s,i,o,a,u,l,d,f;return(0,c.__generator)(this,function(c){switch(c.label){case 0:if(c.trys.push([0,2,,3]),n=t.id,r=t.shouldHandleVideoMessage,s=t.abTestVersion,o=(i=e(A)).friends,a=i.strangers,u=i.selectedConversation,!(d=null!=(l=o[n])?l:a[n])||n!==(null==u?void 0:u.id))return[2];return f=d.getMessageList(R),[4,this.setMessageList({list:f,shouldHandleVideoMessage:r,abTestVersion:s})];case 1:case 2:return c.sent(),[3,3];case 3:return[2]}})}).call(this)},loadMoreMessage:function(n){return(0,s._)(function(){var r,s,i,u,l;return(0,c.__generator)(this,function(c){switch(c.label){case 0:if(c.trys.push([0,3,4,5]),t(A,function(e){return(0,a._)((0,o._)({},e),{isLoadingMoreMessage:!0})}),r=n.conversation,s=n.abTestVersion,(null==(i=e(A).selectedConversation)?void 0:i.id)!==r.id)return[2];return[4,(0,I.fI)().getMessagesByConversation({conversation:r})];case 1:return u=c.sent().hasMore,l=r.getMessageList(R),this.setMessageHasMore(u),[4,this.setMessageList({list:l,shouldHandleVideoMessage:!0,abTestVersion:s})];case 2:case 3:return c.sent(),[3,5];case 4:return t(A,function(e){return(0,a._)((0,o._)({},e),{isLoadingMoreMessage:!1})}),[7];case 5:return[2]}})}).call(this)},setConversationSettingInfo:function(t){return(0,s._)(function(){var n,r,s,i,o,a,u,l,d;return(0,c.__generator)(this,function(c){switch(c.label){case 0:return r=(n=e(A)).friends,s=n.strangers,i=t.id,o=t.mute,a=t.stickOnTop,d=null!=(l=null!=(u=r[i])?u:s[i])?l:{},[4,(0,I.fI)().setConversationSettingInfo({conversation:d,mute:o,stickOnTop:a})];case 1:return c.sent(),[2]}})})()},deleteConversation:function(t){return(0,s._)(function(){var n,r,s,i,o,a,u,l,d,f,g;return(0,c.__generator)(this,function(c){switch(c.label){case 0:return n=t.id,s=(r=e(A)).friends,i=r.selectedConversation,a=null!=(o=s[n])?o:{},[4,(0,I.fI)().deleteConversation({conversation:a})];case 1:return c.sent(),(null==i?void 0:i.shortId)===a.shortId&&(i.isGroupChat||(d=null!=(l=i.toParticipantUserId)?l:"",g=null!=(f=null==(u=(0,L.py)().getUser(d))?void 0:u.uniqueId)?f:"",(0,b.Hz)(w.jh.UserDelete,{uid:d,uniqueId:g,conversationShortId:i.shortId})),this.setSelectedConversation(void 0)),[2]}})}).call(this)},markConversationRead:function(t){return(0,s._)(function(){var n,r,s,i,o,a,u;return(0,c.__generator)(this,function(c){switch(c.label){case 0:return n=t.id,s=(r=e(A)).friends,i=r.strangers,u=null!=(a=null!=(o=s[n])?o:i[n])?a:{},[4,(0,I.fI)().markConversationRead({conversation:u})];case 1:return c.sent(),[2]}})})()},handleMessageSend:function(t){return(0,s._)(function(){var n,r;return(0,c.__generator)(this,function(s){switch(s.label){case 0:if(!(n=e(A).selectedConversation))return[2];return r=t.type===w.Go.Video||t.type===w.Go.Story,[4,this.getMessageList({id:n.id,shouldHandleVideoMessage:r,abTestVersion:t.abTestVersion})];case 1:return s.sent(),[2]}})}).call(this)},handleReceiveNewMessage:function(t){return(0,s._)(function(){var n,r;return(0,c.__generator)(this,function(s){switch(s.label){case 0:if(!(n=e(A).selectedConversation))return[2];return r=t.type===w.Go.Video||t.type===w.Go.Story,[4,this.getMessageList({id:n.id,shouldHandleVideoMessage:r,abTestVersion:t.abTestVersion})];case 1:return s.sent(),[2]}})}).call(this)},handleMessageDelete:function(t){return(0,s._)(function(){var n,r,s,i,o,a,u;return(0,c.__generator)(this,function(c){switch(c.label){case 0:if(!(n=e(A).selectedConversation))return[2];return r=t.type===w.Go.Video||t.type===w.Go.Story,[4,this.getMessageList({id:n.id,shouldHandleVideoMessage:r,abTestVersion:t.abTestVersion})];case 1:return c.sent(),0===n.getMessageList(R).length&&(this.setSelectedConversation(void 0),n.isGroupChat||(o=null!=(i=n.toParticipantUserId)?i:"",u=null!=(a=null==(s=(0,L.py)().getUser(o))?void 0:s.uniqueId)?a:"",(0,b.Hz)(w.jh.UserDelete,{uid:o,uniqueId:u,conversationShortId:n.shortId}))),[2]}})}).call(this)},deleteMessage:function(e){return(0,s._)(function(){var t;return(0,c.__generator)(this,function(n){switch(n.label){case 0:return t=e.message,[4,(0,I.fI)().deleteMessage({message:t})];case 1:return n.sent(),[2]}})})()},likeMessage:function(e){return(0,s._)(function(){var t,r,s,i;return(0,c.__generator)(this,function(o){switch(o.label){case 0:return t=e.message,r=e.isLiked,[4,n.e("65404").then(n.bind(n,62327))];case 1:return s=o.sent().im_proto,[4,null==(i=(0,I.fI)().getInstance())?void 0:i.modifyMessageProperty({message:t,modifyContent:[{operation:r?s.OPERATION_TYPE.REMOVE_PROPERTY_ITEM:s.OPERATION_TYPE.ADD_PROPERTY_ITEM,key:"e:love"}]})];case 2:return[2,o.sent()];case 3:return[2]}})})()},reactToMessage:function(e){return(0,s._)(function(e){var t,r,s,i,o,a;return(0,c.__generator)(this,function(u){switch(u.label){case 0:return t=e.message,r=e.currentReaction,s=e.newReaction,[4,n.e("65404").then(n.bind(n,62327))];case 1:if(i=u.sent().im_proto,o=(0,I.fI)().getInstance(),!r&&s&&(a=[{operation:i.OPERATION_TYPE.ADD_PROPERTY_ITEM,key:s},{operation:i.OPERATION_TYPE.ADD_PROPERTY_ITEM,key:"e:love"}]),r&&s&&(a="e:love"===r?[{operation:i.OPERATION_TYPE.ADD_PROPERTY_ITEM,key:s}]:[{operation:i.OPERATION_TYPE.REMOVE_PROPERTY_ITEM,key:r},{operation:i.OPERATION_TYPE.ADD_PROPERTY_ITEM,key:s}]),(r&&!s||r===s)&&(a=[{operation:i.OPERATION_TYPE.REMOVE_PROPERTY_ITEM,key:r},{operation:i.OPERATION_TYPE.REMOVE_PROPERTY_ITEM,key:"e:love"}]),!a)return[2,void console.warn("invalid operation",{currentReaction:r,newReaction:s})];return[4,null==o?void 0:o.modifyMessageProperty({message:t,modifyContent:a})];case 2:return[2,u.sent()];case 3:return[2]}})}).apply(this,arguments)},getReactionList:function(e,t){var n,r,s={},i={},u=Object.keys(e.property);if(0===u.length||!(null==(n=e.property["e:love"])?void 0:n.length))return{};i["e:love"]={count:e.property["e:love"].length,latestCreateTime:e.property["e:love"][0].createTime,hasMyReaction:void 0!==e.property["e:love"].find(function(e){return e.userId===t}),emoji:"\u2764\uFE0F"},e.property["e:love"].forEach(function(e){s[e.userId]={reaction:e,emoji:"\u2764\uFE0F"}}),u.forEach(function(n){if("e:love"!==n&&"e:\u2764\uFE0F"!==n){var r=n.split(":")[1],u=e.property[n];i["e:love"]=(0,a._)((0,o._)({},i["e:love"]),{count:i["e:love"].count-u.length}),i[n]={emoji:r,count:u.length,latestCreateTime:u[0].createTime,hasMyReaction:void 0!==e.property[n].find(function(e){return e.userId===t})},u.forEach(function(e){e.createTime>i[n].latestCreateTime&&(i[n].latestCreateTime=e.createTime),s[e.userId]={reaction:e,emoji:r}})}}),e.property["e:love"].forEach(function(e){s[e.userId].reaction===e&&e.createTime>i["e:love"].latestCreateTime&&(i["e:love"].latestCreateTime=e.createTime,"\u2764\uFE0F"===s[e.userId].emoji&&(i["e:love"].hasMyReaction=!0))}),null==(r=e.property["e:\u2764\uFE0F"])||r.forEach(function(e){s[e.userId]&&e.createTime>i["e:love"].latestCreateTime&&(i["e:love"].latestCreateTime=e.createTime,"\u2764\uFE0F"===s[e.userId].emoji&&(i["e:love"].hasMyReaction=!0))});var c=s[t];c&&delete s[t];var l=Object.values(s).sort(function(e,t){return t.reaction.createTime.getTime()-e.reaction.createTime.getTime()});return c&&l.unshift(c),{reactionCountList:Object.values(i).filter(function(e){return e.count>0}).sort(function(e,t){return e.hasMyReaction?-1:t.hasMyReaction?1:e.count===t.count?t.latestCreateTime.getTime()-e.latestCreateTime.getTime():t.count-e.count}),reactionList:l}}},(0,i._)(r,"handleMessagePropertyUpsert",function(t){return(0,s._)(function(){var n,r,s,i,o,a,l,d,f,g,h,_,v,p,m,M,y,S,C,I;return(0,c.__generator)(this,function(c){switch(c.label){case 0:if(r=(n=e(A)).friends,s=n.strangers,i=n.selectedConversation,a=null!=(o=t.uid)?o:"",g=null!=(f=null!=(d=r[l=t.conversationId])?d:s[l])?f:{},!t.property["e:love"])return[3,2];if(t.sender!==a)return[2];for(_=(h=t.property)["e:love"],v=(0,u._)(h,["e:love"]),p="",m=[],(M=Object.keys(v)).length>0?(p=M[0].split(":")[1],m=v[M[0]]):(p="\u2764\uFE0F",m=_),y=[],S=0;S<m.length;S++)(C=m[S]).userId!==a&&(y.push(C.userId),I=i===g,!g.customLocalLike||g.customLocalLike.date<C.createTime?g.customLocalLike={like:!0,date:C.createTime,hasRead:I,likedMessage:t,senderUid:C.userId,reaction:p}:g.customLocalLike=null,this.multiSetConversation({list:[g],isStranger:g.isStrangerConversation}));return[4,(0,b.YJ)().getMultiUsersByUids({uidList:y})];case 1:return c.sent(),[3,3];case 2:g.customLocalLike=null,c.label=3;case 3:return[2]}})}).call(this)}),(0,i._)(r,"handleRefreshMessage",function(e){var t=Number(e.ext["a:moderation_result"]);if("true"===e.ext["a:is_violative"]&&(t=3),t>1){var n=e.content.match(/"server_message_id":(\d+)/);if(!n)return;var r=n[1];this.setModerationResult((0,i._)({},r,t))}}),(0,i._)(r,"updateMessageFromServer",function(e){return(0,s._)(function(){var t,n;return(0,c.__generator)(this,function(r){switch(r.label){case 0:if(!(t=(0,I.fI)().getConversationByMessage({message:e})))return[3,2];return[4,(0,I.fI)().getMessages({messages:[e],conversation:t,upsert:!0})];case 1:n=r.sent(),this.setLastUpdated((0,i._)({},e.clientId,{timestamp:Date.now(),success:!!(n&&n.length>0)})),r.label=2;case 2:return[2]}})}).call(this)}),(0,i._)(r,"handleLoadMediaFail",function(e){var t=e.message,n=e.mediaType,r=e.mediaUrl,s=e.error,i=e.scene;console.log(t,r,s),g.w.handleMediaMessageShowFail({media_type:n,scene:i})}),(0,i._)(r,"handleMediaModerationTimeout",function(e){console.log(e.message,e.mediaType,e.mediaUrl)}),(0,i._)(r,"feedbackMessage",function(t){return(0,s._)(function(){var n,r,s,i,o,a,u,l,d,f,g,_,v;return(0,c.__generator)(this,function(c){switch(c.label){case 0:r=(n=(0,y.T)())("direct_meaasge_sending_ban_feedback_again"),s=n("Sorry, something wrong with the server, please try again."),c.label=1;case 1:if(c.trys.push([1,3,,4]),i=e(A).hasFeedbackMap,o=t.conversationId,a=t.shortId,u=t.uid,l=t.selfUid,d=t.content,f=t.messageId,g=t.serverMsgId,_=t.decisionRuleId,v=t.checkMessageStatusCode,i[f])return[2,void h.F.open({content:r,duration:3,widthType:"half"})];return[4,U({conversationId:o,shortId:a,uid:u,selfUid:l,content:d,messageId:f,serverMsgId:g,decisionRuleId:_,checkMessageStatusCode:v})];case 2:return 0===c.sent().status_code?(h.F.open({content:r,duration:3,widthType:"half"}),this.setHasFeedbackMap(f)):h.F.open({content:s,duration:3,widthType:"half"}),[3,4];case 3:return c.sent(),h.F.open({content:s,duration:3,widthType:"half"}),[3,4];case 4:return[2]}})}).call(this)}),(0,i._)(r,"getVideoListV1",function(t){return(0,s._)(function(){var n,r,i,o,a,u,l;return(0,c.__generator)(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,3]),n=e(M),r=t.needRequestList,i=t.allList,o=t.allListByMessageId,r.length||((0,C.Cg)().setItemListById({list:i}),this.setItemListByMessageId(o)),[4,Promise.all(r.map(function(e){return(0,s._)(function(){var t,r;return(0,c.__generator)(this,function(s){switch(s.label){case 0:return[4,T(e,null==(r=n.bizContext)||null==(t=r.videoCoverSettings)?void 0:t.format)];case 1:return[2,s.sent()]}})})()}))];case 1:return a=d.sent(),u={},l=[],a.forEach(function(e,t){var n=e.statusCode,s=e.itemInfo,a=r[t];if(0!==n){u[a]=n;var c=i.indexOf(a);c>-1&&(i.splice(c,1),o.splice(c,1))}else l.push(null==s?void 0:s.itemStruct)}),this.setFailedVideoCodeMap(u),(0,S.ud)().addItems(l),(0,C.Cg)().setItemListById({list:i}),this.setItemListByMessageId(o),[3,3];case 2:return console.error(d.sent()),[3,3];case 3:return[2]}})}).call(this)}),(0,i._)(r,"getVideoListV2",function(t){return(0,s._)(function(){var n,r,s,i,o,a,u;return(0,c.__generator)(this,function(c){switch(c.label){case 0:n=this,c.label=1;case 1:return c.trys.push([1,3,,4]),r=e(A).failedVideoCodeMap,s=t.needRequestList,i=t.allList,o=t.allListByMessageId,s.length||((0,C.Cg)().setItemListById({list:i}),this.setItemListByMessageId(o)),[4,Promise.all(s.map(function(e){return n.getSingleItem(e)}))];case 2:return a=c.sent(),u=[],a.forEach(function(e,t){var n=e.statusCode,a=e.itemStruct,c=s[t];if(0!==n){r[c]=n;var l=i.indexOf(c);l>-1&&(i.splice(l,1),o.splice(l,1))}else u.push(a)}),(0,C.Cg)().setItemListById({list:i}),this.setItemListByMessageId(o),[3,4];case 3:return console.error(c.sent()),[3,4];case 4:return[2]}})}).call(this)}),(0,i._)(r,"getSingleItem",function(t){return(0,s._)(function(){var n,r,s,i,o,a,u,l,d;return(0,c.__generator)(this,function(c){switch(c.label){case 0:if(r=(n=e(A)).fetchingVideoCodeMap,s=n.failedVideoCodeMap,i=e(M),(0,S.ud)().getStaticItem(t))return[2,{itemStruct:(0,S.ud)().getStaticItem(t),statusCode:0}];if(s[t])return[2,{itemStruct:void 0,statusCode:s[t]}];if(!r[t])return[3,2];return[4,r[t]];case 1:return o=c.sent(),[3,4];case 2:return r[t]=T(t,null==(u=i.bizContext)||null==(a=u.videoCoverSettings)?void 0:a.format),[4,r[t]];case 3:o=c.sent(),c.label=4;case 4:return l=o.statusCode,d=o.itemInfo,0!==l?(s[t]=l,this.setFailedVideoCodeMap(s)):(0,S.ud)().addItems([d.itemStruct]),delete r[t],[2,{itemStruct:null==d?void 0:d.itemStruct,statusCode:l}]}})}).call(this)}),r}),V=F.useServiceState,O=F.useServiceDispatchers,E=F.useAtomService,N=F.getStaticApi},13750:function(e,t,n){n.d(t,{A5:function(){return v},I9:function(){return p},Ye:function(){return M},fI:function(){return S},rp:function(){return y}});var r=n(79066),s=n(5377),i=n(45996),o=n(72516),a=n(66905),u=n(10625),c=n(66868),l=n(67500),d=n(63004),f=n(27352),g=n(20776),h=n(67745),_=n(77348),v=1,p=(0,u.p)("imSdkAtom@tiktok/webapp-atoms",{instance:void 0,options:void 0,friendsCursor:"0",groupCursor:"0",strangerCursor:"0",conversationTagCursor:"0",hasMoreFriends:!0,hasMoreGroup:!0,hasMoreStranger:!0,hasMoreConversationTag:!0,isFromBusiness:!1}),m=(0,a.i)(p,function(e,t){return{getInstance:function(){return e(p).instance},initSdk:function(a,u){return(0,r._)(function(){var f,h,_,m,M,y,S,C,I,b,w,L,T,U,k,R,P,A,F,V,O,E,N,G,B,x;return(0,o.__generator)(this,function(D){switch(D.label){case 0:return D.trys.push([0,9,,10]),[4,n.e("65404").then(n.bind(n,62327))];case 1:if(f=D.sent(),e(p).instance)return[2];if(_=(null!=(h=(0,l.V7)(u,"web_dm_share_panel_fix"))?h:"v1")==="v2",M=(null!=(m=(0,l.V7)(u,"web_dm_runtime_share"))?m:"v1")==="v2",S=(null!=(y=(0,l.V7)(u,"web_dm_runtime_share"))?y:"v1")==="v3",I=(null!=(C=(0,l.V7)(u,"web_dm_runtime_share"))?C:"v1")==="v4"||M||S,b=f.BytedIM,w=f.ExtensionPlugin,L=f.StrangerPlugin,T=f.MultimediaPlugin,U=f.RuntimeSharePlugin,k=f.ComboPlugin,R=f.im_proto,P=f.IMEvent,A=f.InitResult,a.authType=R.AuthType.SESSION_AUTH,a.enablePassivePullControl=!0,F=[w,L,T,k],I&&(F.push(U),a.onlyShareInitState=M,a.shareAllForBelowP50=S),t(p,function(e){return(0,i._)((0,s._)({},e),{options:a,instance:new b(a,F)})}),O=(V=e(p)).options,null==(E=V.instance)?void 0:E.event)N=[P.ConversationChange,P.MessageSend,P.ReceiveNewMessage,P.MessageDelete,P.MessagePropertyUpsert,P.ConversationLeave,P.MessageUpsert,P.RefreshMessage,P.ConversationUpsert,P.StrangerUpgrade,P.ConversationDelete],I&&N.push(P.InitLoadPage),N.forEach(function(e){E.event.subscribe(e,function(t){return(0,r._)(function(){return(0,o.__generator)(this,function(n){switch(n.label){case 0:return[4,null==O?void 0:O.eventListener({event:e,params:t,uid:O.userId})];case 1:return n.sent(),[2]}})})()})});else throw Error("[IM SDK] init failed!");return[4,E.init()];case 2:if((G=D.sent())!==A.Succeeded)return[3,7];if((0,g.YJ)().setListLoading(!0),!_)return[3,3];return this.loadFullFriendConversationV2(),this.loadFullStrangerConversationV2(),Array.isArray(null==O?void 0:O.inboxType)&&(null==O?void 0:O.inboxType.includes(v))&&this.loadFullGroupConversation(),[3,5];case 3:return[4,Promise.all([this.loadFullFriendConversationV1(),this.loadFullStrangerConversationV1()])];case 4:D.sent(),D.label=5;case 5:return(0,g.YJ)().setInitialized(!0),[4,(0,g.YJ)().startConversationChange()];case 6:D.sent(),D.label=7;case 7:return[2,G];case 8:return[3,10];case 9:return B=D.sent(),x=(0,d.T)(),c.F.open({content:x("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"}),console.error("[IM SDK] init failed, e=".concat(B)),[3,10];case 10:return[2]}})}).call(this)},getConversationparticipants:function(t){var n,r=e(p).instance,s=null==r?void 0:r.getConversationParticipants({conversation:t});return null!=(n=null==s?void 0:s.map(function(e){return e.userId}))?n:[]},getLocalConversationList:function(t){var n,r=e(p).instance;return null!=(n=null==r?void 0:r.getConversationList({filter:t}))?n:[]},getConversationListOnline:function(t){return(0,r._)(function(){var n,r,s;return(0,o.__generator)(this,function(i){switch(i.label){case 0:if(i.trys.push([0,2,,3]),!(n=e(p).instance))throw Error("sdk is not defined");return[4,n.getConversationListOnline({filter:t})];case 1:return[2,i.sent()];case 2:return r=i.sent(),s=(0,d.T)(),c.F.open({content:s("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"}),console.error(r),[3,3];case 3:return[2]}})})()},loadMoreFriendConversation:function(){return(0,r._)(function(){var n,r,a,u,l,f,g,h;return(0,o.__generator)(this,function(o){switch(o.label){case 0:if(o.trys.push([0,3,,4]),r=(n=e(p)).instance,a=n.friendsCursor,!n.hasMoreFriends)return[3,2];return[4,null==r?void 0:r.getMessagesByUserInit({inboxType:0,cursor:a})];case 1:l=null==(u=o.sent())?void 0:u.cursor.toString(),f=null==u?void 0:u.hasMore,t(p,function(e){return(0,i._)((0,s._)({},e),{friendsCursor:null!=l?l:"0",hasMoreFriends:null!=f&&f})}),o.label=2;case 2:return[3,4];case 3:return g=o.sent(),h=(0,d.T)(),c.F.open({content:h("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"}),console.error(g),[3,4];case 4:return[2]}})})()},loadMoreGroupConversation:function(){return(0,r._)(function(){var n,r,a,u,l,f,g,h;return(0,o.__generator)(this,function(o){switch(o.label){case 0:if(o.trys.push([0,3,,4]),r=(n=e(p)).instance,a=n.groupCursor,!n.hasMoreGroup)return[3,2];return[4,null==r?void 0:r.getMessagesByUserInit({inboxType:v,cursor:a})];case 1:l=null==(u=o.sent())?void 0:u.cursor.toString(),f=null==u?void 0:u.hasMore,t(p,function(e){return(0,i._)((0,s._)({},e),{groupCursor:null!=l?l:"0",hasMoreGroup:null!=f&&f})}),o.label=2;case 2:return[3,4];case 3:return g=o.sent(),h=(0,d.T)(),c.F.open({content:h("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"}),console.error(g),[3,4];case 4:return[2]}})})()},loadMoreStrangerConversation:function(){return(0,r._)(function(){var n,r,a,u,l,f,g,h;return(0,o.__generator)(this,function(o){switch(o.label){case 0:if(o.trys.push([0,3,,4]),r=(n=e(p)).instance,a=n.strangerCursor,!n.hasMoreStranger)return[3,2];return[4,null==r?void 0:r.getMessagesByUserInit({inboxType:3,cursor:a})];case 1:l=null==(u=o.sent())?void 0:u.cursor.toString(),f=null==u?void 0:u.hasMore,t(p,function(e){return(0,i._)((0,s._)({},e),{strangerCursor:null!=l?l:"0",hasMoreStranger:null!=f&&f})}),o.label=2;case 2:return[3,4];case 3:return g=o.sent(),h=(0,d.T)(),c.F.open({content:h("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"}),console.error(g),[3,4];case 4:return[2]}})})()},createConversation:function(t){return(0,r._)(function(t){var n,r,s;return(0,o.__generator)(this,function(i){switch(i.label){case 0:return n=t.uid,r=t.inboxType,[4,null==(s=e(p).instance)?void 0:s.createConversation({participants:n,inboxType:r})];case 1:return[2,i.sent()]}})}).apply(this,arguments)},createMessage:function(t){return(0,r._)(function(t){var n,r,s,i,a,u,c,l,d,f,g,h,_,v,m,M,y;return(0,o.__generator)(this,function(o){switch(o.label){case 0:if(n=t.type,r=t.content,s=t.conversation,i=t.referenceMessage,a=t.fileInfo,u=t.scene,c=e(p).instance,i&&(l=JSON.stringify({content:i.content,refmsg_content:JSON.stringify(i.content||{}),refmsg_sec_uid:i.secSender,refmsg_type:i.type,refmsg_uid:i.sender,refmsg_sub_type:"",refmsg_template_quote:""})),!a)return[3,2];return f=a.fileType,g=a.fileHandler,h=a.width,_=a.height,v=a.onUploadProcess,m=a.onUploadComplete,M=a.onUploadError,y=f.startsWith("image"),[4,null==c?void 0:c.createFileMessage({conversation:s,type:n,referenceMessage:i,referenceHint:l,fileInfo:{type:y?"image":"video",fileHandler:g,displayType:"media",encrypt:!0,imagePreviewWidth:h,imagePreviewHeight:_,ext:y?{}:{"s:file_ext_key_video_width":"".concat(h||0),"s:file_ext_key_video_height":"".concat(_||0)},onUploadProcess:function(e){var t;null==v||v(null!=(t=null==d?void 0:d.clientId)?t:"",e)},onUploadComplete:function(e){var t;null==m||m(null!=(t=null==d?void 0:d.clientId)?t:"",e)},onUploadError:function(e){var t;null==M||M(null!=(t=null==d?void 0:d.clientId)?t:"",e)}},scene:"private_".concat(y?"image":"video")})];case 1:return d=o.sent(),[3,4];case 2:return[4,null==c?void 0:c.createMessage({conversation:s,type:n,content:r,referenceMessage:i,referenceHint:l,scene:u})];case 3:d=o.sent(),o.label=4;case 4:return[2,d]}})}).apply(this,arguments)},sendMessage:function(t){return(0,r._)(function(t){var n,r;return(0,o.__generator)(this,function(s){switch(s.label){case 0:return n=t.message,[4,null==(r=e(p).instance)?void 0:r.sendMessage({message:n})];case 1:return[2,s.sent()]}})}).apply(this,arguments)},setConversationSettingInfo:function(t){return(0,r._)(function(t){var n,r,s,i;return(0,o.__generator)(this,function(o){switch(o.label){case 0:return n=t.conversation,r=t.mute,s=t.stickOnTop,[4,null==(i=e(p).instance)?void 0:i.setConversationSettingInfo({conversation:n,mute:r,stickOnTop:s})];case 1:return[2,o.sent()]}})}).apply(this,arguments)},deleteConversation:function(t){return(0,r._)(function(t){var n,r;return(0,o.__generator)(this,function(s){switch(s.label){case 0:return n=t.conversation,[4,null==(r=e(p).instance)?void 0:r.deleteConversation({conversation:n})];case 1:return[2,s.sent()]}})}).apply(this,arguments)},markConversationRead:function(t){return(0,r._)(function(t){var n,r;return(0,o.__generator)(this,function(s){switch(s.label){case 0:return n=t.conversation,[4,null==(r=e(p).instance)?void 0:r.markConversationRead({conversation:n})];case 1:return[2,s.sent()]}})}).apply(this,arguments)},getStrangerPreview:function(){return(0,r._)(function(){var t;return(0,o.__generator)(this,function(n){switch(n.label){case 0:return[4,null==(t=e(p).instance)?void 0:t.getStrangerPreview({})];case 1:return[2,n.sent()]}})})()},getMessagesByConversation:function(t){return(0,r._)(function(t){var n,r;return(0,o.__generator)(this,function(s){switch(s.label){case 0:if(n=t.conversation,!(r=e(p).instance))throw Error("sdk is not defined");return[4,r.getMessagesByConversation({conversation:n})];case 1:return[2,s.sent()]}})}).apply(this,arguments)},getStrangerConversationMessage:function(t){return(0,r._)(function(t){var n,r;return(0,o.__generator)(this,function(s){switch(s.label){case 0:return n=t.conversation,[4,null==(r=e(p).instance)?void 0:r.getStrangerConversationMessage({conversation:n})];case 1:return[2,s.sent()]}})}).apply(this,arguments)},deleteMessage:function(t){return(0,r._)(function(t){var n,r;return(0,o.__generator)(this,function(s){switch(s.label){case 0:return n=t.message,[4,null==(r=e(p).instance)?void 0:r.deleteMessage({message:n})];case 1:return[2,s.sent()]}})}).apply(this,arguments)},decryptMedia:function(t){return(0,r._)(function(t){var n,r,s;return(0,o.__generator)(this,function(i){switch(i.label){case 0:return n=t.message,r=t.fetchIndex,[4,null==(s=e(p).instance)?void 0:s.decryptMedia({message:n,fetchIndex:r})];case 1:return[2,i.sent()]}})}).apply(this,arguments)},getConversationByMessage:function(t){var n=t.message,r=e(p).instance;return null==r?void 0:r.getConversation({conversationId:n.conversationId})},getMessages:function(t){return(0,r._)(function(t){var n,r,s,i;return(0,o.__generator)(this,function(o){switch(o.label){case 0:return n=t.messages,r=t.conversation,s=t.upsert,[4,null==(i=e(p).instance)?void 0:i.getMessages({messages:n,conversation:r,upsert:s})];case 1:return[2,o.sent()]}})}).apply(this,arguments)},loadMoreConversationsWithTags:function(n){return(0,r._)(function(n){var r,a,u,c,l,d;return(0,o.__generator)(this,function(o){switch(o.label){case 0:if(n.isReset&&t(p,function(e){return(0,i._)((0,s._)({},e),{hasMoreConversationTag:!0,conversationTagCursor:"0"})}),a=(r=e(p)).hasMoreConversationTag,u=r.conversationTagCursor,c=r.instance,l=e(f.pt).selectedConversationTagList,!a)return[3,2];return[4,null==c?void 0:c.getMessagesAndConversationsByTags({limit:20,cursor:u,tags:l.map(function(e){return e.label_id}),inboxType:0})];case 1:(d=o.sent())&&t(p,function(e){return(0,i._)((0,s._)({},e),{hasMoreConversationTag:d.hasMore,conversationTagCursor:d.nextCursor.toString()})}),o.label=2;case 2:return[2]}})}).apply(this,arguments)},getConversationListByTags:function(){var t,n,r=e(p).instance,s=e(f.pt).selectedConversationTagList;return e(h.G7).conversationListType===_.om.Friends?(null!=(t=null==r?void 0:r.getConversationList({filter:function(e){return!e.isStrangerConversation}}))?t:[]).filter(function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=s.map(function(e){return e.label_id})[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(!e.userConversationTags.includes(String(a)))return!1}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return!0}):(null!=(n=null==r?void 0:r.getConversationList({filter:function(e){return e.isStrangerConversation}}))?n:[]).filter(function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=s.map(function(e){return e.label_id})[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(!e.userConversationTags.includes(String(a)))return!1}}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}return!0})},loadFullFriendConversationV1:function(){return(0,r._)(function(){var t,n,r,s;return(0,o.__generator)(this,function(i){switch(i.label){case 0:if(t=e(p).options,r=(n=e(p)).hasMoreFriends,s=n.hasMoreGroup,!(Array.isArray(null==t?void 0:t.inboxType)&&(null==t?void 0:t.inboxType.includes(v))))return[3,7];i.label=1;case 1:if(!(r||s))return[3,6];if(!r)return[3,3];return[4,this.loadMoreFriendConversation()];case 2:i.sent(),i.label=3;case 3:if(!s)return[3,5];return[4,this.loadMoreGroupConversation()];case 4:i.sent(),i.label=5;case 5:return r=e(p).hasMoreFriends,s=e(p).hasMoreGroup,[3,1];case 6:return[3,9];case 7:if(!r)return[3,9];return[4,this.loadMoreFriendConversation()];case 8:return i.sent(),r=e(p).hasMoreFriends,[3,7];case 9:return[2]}})}).call(this)},loadFullStrangerConversationV1:function(){return(0,r._)(function(){var t;return(0,o.__generator)(this,function(n){switch(n.label){case 0:t=e(p).hasMoreStranger,n.label=1;case 1:if(!t)return[3,3];return[4,this.loadMoreStrangerConversation()];case 2:return n.sent(),t=e(p).hasMoreStranger,[3,1];case 3:return[2]}})}).call(this)},loadFullFriendConversationV2:function(){var t=this,n=function(){return(0,r._)(function(){return(0,o.__generator)(this,function(t){switch(t.label){case 0:if(e(p).hasMoreFriends)return[3,2];return[4,(0,g.YJ)().startConversationChange()];case 1:return[2,void t.sent()];case 2:return[4,this.loadMoreFriendConversation()];case 3:return t.sent(),setTimeout(function(){n()},0),[2]}})}).call(t)};n()},loadFullGroupConversation:function(){var t=this,n=function(){return(0,r._)(function(){return(0,o.__generator)(this,function(t){switch(t.label){case 0:if(e(p).hasMoreGroup)return[3,2];return[4,(0,g.YJ)().startConversationChange()];case 1:return[2,void t.sent()];case 2:return[4,this.loadMoreGroupConversation()];case 3:return t.sent(),setTimeout(function(){n()},0),[2]}})}).call(t)};n()},loadFullStrangerConversationV2:function(){var t=this,n=function(){return(0,r._)(function(){return(0,o.__generator)(this,function(t){switch(t.label){case 0:if(!e(p).hasMoreStranger)return[2];return[4,this.loadMoreStrangerConversation()];case 1:return t.sent(),setTimeout(function(){n()},0),[2]}})}).call(t)};n()}}}),M=m.useServiceState,y=m.useServiceDispatchers,S=(m.useAtomService,m.getStaticApi)},67745:function(e,t,n){n.d(t,{G7:function(){return w},Ks:function(){return k},Xq:function(){return U},g9:function(){return T}});var r=n(79066),s=n(35383),i=n(5377),o=n(45996),a=n(54333),u=n(72516),c=n(26869),l=n(66905),d=n(10625),f=n(26984),g=n(66868),h=n(44957),_=n(54149),v=n(63004),p=n(76365),m=n(13750),M=n(20776),y=n(77348),S=n(35083),C=function(e){var t=e.id,n=e.uid;return(0,r._)(function(){return(0,u.__generator)(this,function(e){return[2,h.h.post("/api/im/stranger/unlimit",{query:{aid:1988},headers:(0,s._)({},_.nk,h.h.csrfToken),body:c.stringify({conversation_id:t,to_user_id:n}),baseUrlType:_.Z4.FixedWww})]})})()},I={conversationListType:y.om.Friends,chatMode:y.M5.Default,notice:"",clickableNotice:null,showSettingModal:!1,acceptedStrangerList:[],reportResons:[],selectedReportReasons:[],isShowReportSelectModal:!1,isShowReportSuccessModal:!1,isShowContactButton:!1,isUsingV3Reasons:!0},b=function(){var e=[];try{var t,n=null!=(t=localStorage.getItem(y.BR))?t:"";e=Array.isArray(JSON.parse(n))?JSON.parse(n):[]}catch(t){e=[]}return e},w=(0,d.p)("messagePageAtom@tiktok/webapp-atoms",I),L=(0,l.i)(w,function(e,t){return{setIsUsingV3Reasons:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{isUsingV3Reasons:e})})},setConversationListType:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{conversationListType:e})})},setChatMode:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{chatMode:e})})},setNotice:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{notice:e})})},setClickableNotice:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{clickableNotice:e})})},addAcceptedStranger:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{acceptedStrangerList:(0,a._)(t.acceptedStrangerList).concat([e])})})},setReportReasons:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{reportResons:e})})},setSelectedReportReasons:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{selectedReportReasons:e})})},setIsShowReportSelectModal:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{isShowReportSelectModal:e})})},setIsShowContactButton:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{isShowContactButton:e})})},setIsShowReportSuccessModal:function(e){t(w,function(t){return(0,o._)((0,i._)({},t),{isShowReportSuccessModal:e})})},getConversationNotice:function(e){return(0,r._)(function(){var t,n,s,i,o,a,c,l,d;return(0,u.__generator)(this,function(f){switch(f.label){case 0:var g;if(f.trys.push([0,2,,3]),t=e.secUid,n=e.conversationId,!t||!n)return this.setNotice(""),this.setClickableNotice(null),[2];return[4,(g={secUid:t,conversationId:n},(0,r._)(function(){var e,t;return(0,u.__generator)(this,function(n){return e=g.secUid,t=g.conversationId,[2,h.h.get("/api/im/chat/notice",{query:{sec_to_user_id:e,conversation_id:t,aid:1988},baseUrlType:_.Z4.FixedWww})]})})())];case 1:return(s=f.sent().data).msg_type===y.eh?(o=(i=s.msg_content).tips,(a=i.template)?(l=(c=a[0]||{}).key,d=c.name,this.setClickableNotice({desc:o,clickText:d,template:"{{".concat(l,"}}"),action:y.hr.OpenPrivacySetting})):(this.setNotice(o),this.setClickableNotice(null))):(this.setNotice(""),this.setClickableNotice(null)),[3,3];case 2:return f.sent(),this.setNotice(""),this.setClickableNotice(null),[3,3];case 3:return[2]}})}).call(this)},acceptStranger:function(e){return(0,r._)(function(){var t,n,r,s,i;return(0,u.__generator)(this,function(o){switch(o.label){case 0:return t=e.id,n=e.uid,[4,C({id:t,uid:n})];case 1:return 0===(r=o.sent()).status_code?((s=b()).push(t),localStorage.setItem(y.BR,JSON.stringify(s)),this.addAcceptedStranger(t)):(i=(0,v.T)(),g.F.open({content:i("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"})),[2,r]}})}).call(this)},deleteStranger:function(t){return(0,r._)(function(){var n,r,s,i,o,a,c,l;return(0,u.__generator)(this,function(u){switch(u.label){case 0:return n=t.conversation,r=e(p.nU).selectedConversation,[4,(0,m.fI)().deleteConversation({conversation:n})];case 1:return u.sent(),s=e(M.lU).strangerConversationList,(0,M.YJ)().setStrangerConversationList(s.filter(function(e){return e.id!==n.id})),(null==r?void 0:r.shortId)===n.shortId&&(a=null!=(o=n.toParticipantUserId)?o:"",l=null!=(c=null==(i=(0,S.py)().getUser(a))?void 0:i.uniqueId)?c:"",(0,M.Hz)(y.jh.UserDelete,{uid:a,uniqueId:l,conversationShortId:n.shortId}),(0,p.IA)().setSelectedConversation(void 0)),[2]}})})()},getReportReasons:function(t){return(0,r._)(function(){var n,s,i;return(0,u.__generator)(this,function(o){switch(o.label){case 0:return[4,(n=e(w).isUsingV3Reasons,(0,r._)(function(){return(0,u.__generator)(this,function(e){return[2,h.h.get("/node/report/reasons",{query:{report_type:f.n.Im,lang:t,api_version:n?3:2},baseUrlType:_.Z4.FixedWww})]})})())];case 1:return i=void 0===(s=o.sent().body)?[]:s,this.setReportReasons(i),[2]}})}).call(this)},postReport:function(e){return(0,r._)(function(){var t;return(0,u.__generator)(this,function(n){switch(n.label){case 0:t=(0,v.T)(),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(0,r._)(function(){return(0,u.__generator)(this,function(t){return[2,h.h.post("/aweme/v2/aweme/feedback/",{query:e,baseUrlType:_.Z4.FixedWww})]})})()];case 2:if(0!==n.sent().status_code)return[2,void g.F.open({content:t("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"})];return this.setChatMode(y.M5.Default),this.setIsShowReportSuccessModal(!0),[3,4];case 3:return n.sent(),g.F.open({content:t("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"}),[3,4];case 4:return[2]}})}).call(this)}}}),T=L.useServiceState,U=L.useServiceDispatchers,k=L.useAtomService;L.getStaticApi},20776:function(e,t,n){n.d(t,{Hz:function(){return N},lU:function(){return G},YJ:function(){return Y},_q:function(){return D},D1:function(){return q},VB:function(){return x}});var r=n(79066),s=n(35383),i=n(5377),o=n(45996),a=n(16327),u=n(54333),c=n(79262),l=n(72516),d=n(96266),f=n.n(d),g=n(66905),h=n(10625),_=n(73515),v=n(50870),p=n(51379),m=n(61741),M=n(44957),y=n(54149),S=n(22481),C=n(21708),I=n(12293),b=n(44089),w=function(e){var t,n;return null!=(n=null==e||null==(t=e.url_list)?void 0:t.find(function(e){return!/\.webp/.test(e)}))?n:""},L=function(e){var t=e.is_block,n=e.is_blocked,r=e.follow_status;if(null!=r)return t?v.yf.BLOCK:n?v.yf.BLOCKED:b.i[r]},T=function(e){var t=e.avatar_medium,n=e.avatar_thumb,r=e.uid,s=e.short_id,i=e.unique_id,o=e.sec_uid,a=e.nickname,u=e.is_block,c=e.follow_status,l=e.signature,d=e.custom_verify,f=e.enterprise_verify_reason,g=e.follower_status;return{avatarLarger:"",avatarMedium:w(t),avatarThumb:w(n),id:r,shortId:s,uniqueId:null!=i?i:"",secUid:null!=o?o:"",nickname:a,relation:L({is_block:u,is_blocked:void 0,follow_status:c}),signature:l,verified:!!(d||f),createTime:0,extraInfo:{followerStatus:g}}},U=function(e){var t=e.users;return(void 0===t?[]:t).map(function(e){var t,n,r,s,i;return{avatar_medium:e.im_user_profile.avatars.avatar_medium,avatar_thumb:null!=(n=e.im_user_profile.avatars.avatar_small)?n:{},uid:e.im_user_profile.user_id.toString(),short_id:"",unique_id:e.im_user_profile.unique_id,nickname:e.im_user_profile.nick_name,is_block:null!=(r=null==(t=e.im_user_profile.block_info)?void 0:t.block)&&r,follow_status:e.im_user_profile.follow_status,signature:"",custom_verify:null!=(s=e.im_user_profile.user_verify_reason)?s:"",enterprise_verify_reason:null!=(i=e.im_user_profile.enterprise_verify_reason)?i:"",follower_status:e.im_user_profile.follower_status}}).map(function(e){return T(e)})},k=function(e,t,n){var r=JSON.parse((0,S._S)(e));r[t]=n,(0,S.AP)(e,JSON.stringify(r))},R=n(27352),P=n(76365),A=n(13750),F=n(67745),V=n(77348),O=n(35083),E="web_dm_storage_",N=function(e,t){try{if(new URLSearchParams(window.location.search).get("scene")!==V.Z5.Business)return;window.parent.postMessage({type:e,params:t},window.location.origin)}catch(e){console.error("postMessage error",e)}},G=(0,h.p)("messageAtom@tiktok/webapp-atoms",{initialized:!1,messageCount:0,recentUserList:[],recentUserNameList:[],recentUidList:[],allUidList:[],followingUser:{list:[],nicknameList:[],uidList:[],hasMore:!0,maxCursor:0,minCursor:0},isFollowingLoading:!1,isSendMessageFailed:!1,isSendMessageLoading:!1,conversationMap:{},allConversationList:[],conversationList:[],strangerConversationList:[],strangerMessagesUnreadCount:0,successSentMessageCount:0,isListLoading:!0,recentUids:"",otherUid:"",isFirstTimeLoadHistory:!0,isFirstTimeLoadStranger:!0,isMediaSafeTipShown:!0,isMediaSelectionTipShown:!0,videoPlayerVolume:0}),B=(0,g.i)(G,function(e,t){return{setMessageCount:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{messageCount:e})}),N(V.jh.MessageCountChange,{count:e})},setConversationMap:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{conversationMap:e})})},setConversationList:function(e){e.sort(function(e,t){if(e.isStickOnTop&&t.isStickOnTop||!e.isStickOnTop&&!t.isStickOnTop){var n=Math.max(e.customLocalLike?e.customLocalLike.date.getTime():-1,e.lastVisibleMessage?e.lastVisibleMessage.createdAt.getTime():-1);return Math.max(t.customLocalLike?t.customLocalLike.date.getTime():-1,t.lastVisibleMessage?t.lastVisibleMessage.createdAt.getTime():-1)-n}return 0}),t(G,function(t){return(0,o._)((0,i._)({},t),{conversationList:e})})},setAllConversationList:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{allConversationList:e})})},setStrangerConversationList:function(e){var n=e.reduce(function(e,t){return e+t.unreadCount},0);t(G,function(t){return(0,o._)((0,i._)({},t),{strangerConversationList:e,strangerMessagesUnreadCount:n})})},setListLoading:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{isListLoading:e})})},setRecentUids:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{recentUids:e})})},updateRecentUserList:function(e){var n=e.uniqueIdList,r=e.nicknameList,s=e.uidList;t(G,function(e){return(0,o._)((0,i._)({},e),{recentUserList:(0,u._)(n),recentUserNameList:(0,u._)(r),recentUidList:(0,u._)(s)})})},updateFollowingUserList:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{followingUser:e})})},setFollowingLoading:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{isFollowingLoading:e})})},setUidList:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{allUidList:e})})},addSentMessageSuccessCount:function(){var n=e(G).successSentMessageCount;t(G,function(e){return(0,o._)((0,i._)({},e),{successSentMessageCount:n+1})})},setSendMessageStatus:function(e){var n=e.isFailed,r=e.isLoading,s=e.successCount;t(G,function(e){return(0,o._)((0,i._)({},e),{isSendMessageFailed:null!=n&&n,isSendMessageLoading:null!=r&&r,successSentMessageCount:null!=s?s:e.successSentMessageCount})})},setOtherUid:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{otherUid:e})})},setInitialized:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{initialized:e})})},setIsMediaSafeTipShown:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{isMediaSafeTipShown:e})})},setIsMediaSelectionTipShown:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{isMediaSelectionTipShown:e})})},setVideoPlayerVolume:function(e){t(G,function(t){return(0,o._)((0,i._)({},t),{videoPlayerVolume:e})})},initWebDMLocalStorage:function(e){var t="".concat(E).concat(e),n=!0;try{localStorage.getItem(t)}catch(e){n=!1}if(n){var r=(0,S._S)(t),s={},i=!1;try{r&&(s=JSON.parse(r))}catch(e){i=!0}(!r||i||"object"!=(void 0===s?"undefined":(0,c._)(s)))&&((0,S.AP)(t,"{}"),s={}),s.isMediaSafeTipShown||this.setIsMediaSafeTipShown(!1),s.isMediaSelectionTipShown||this.setIsMediaSelectionTipShown(!1),"number"==typeof s.videoPlayerVolume&&this.setVideoPlayerVolume(s.videoPlayerVolume)}},closeMediaSafeTip:function(e){k("".concat(E).concat(e),"isMediaSafeTipShown",!0),this.setIsMediaSafeTipShown(!0)},closeMediaSelectionTip:function(e){k("".concat(E).concat(e),"isMediaSelectionTipShown",!0),this.setIsMediaSelectionTipShown(!0)},saveVideoPlayerVolume:function(e){var t=e.uid,n=e.volume;k("".concat(E).concat(t),"videoPlayerVolume",n),this.setVideoPlayerVolume(n)},handleIMEvent:function(t){return(0,r._)(function(){var r,s,a,u,c;return(0,l.__generator)(this,function(l){switch(l.label){case 0:return[4,n.e("65404").then(n.bind(n,62327))];case 1:switch(r=l.sent().IMEvent,s=t.event,a=t.params,u=t.abTestVersion,c=t.uid,s){case r.InitLoadPage:return[3,2];case r.ConversationChange:return[3,5];case r.MessageSend:return[3,7];case r.ReceiveNewMessage:return[3,9];case r.MessageDelete:return[3,11];case r.MessagePropertyUpsert:return[3,13];case r.RefreshMessage:return[3,15];case r.MessageUpsert:return[3,16];case r.ConversationLeave:return[3,18];case r.ConversationDelete:return[3,20];case r.ConversationUpsert:return[3,21];case r.StrangerUpgrade:return[3,23]}return[3,25];case 2:if(e(G).initialized)return[3,4];return[4,this.startConversationChange(!0)];case 3:l.sent(),l.label=4;case 4:return[3,26];case 5:return[4,this.startConversationChange()];case 6:case 8:case 10:case 12:case 14:case 17:case 19:case 22:case 24:return l.sent(),[3,26];case 7:return[4,(0,P.IA)().handleMessageSend((0,o._)((0,i._)({},a),{abTestVersion:u}))];case 9:return[4,(0,P.IA)().handleReceiveNewMessage((0,o._)((0,i._)({},a),{abTestVersion:u}))];case 11:return[4,(0,P.IA)().handleMessageDelete((0,o._)((0,i._)({},a),{abTestVersion:u}))];case 13:return[4,(0,P.IA)().handleMessagePropertyUpsert((0,o._)((0,i._)({},a),{uid:c}))];case 15:return(0,P.IA)().handleRefreshMessage((0,i._)({},a)),[3,26];case 16:return[4,(0,P.IA)().handleMessageUpsert({message:a,abTestVersion:u})];case 18:return[4,(0,P.IA)().handleConversationLeave(a)];case 20:return(0,P.IA)().handleConversationDelete(a),[3,26];case 21:return[4,(0,P.IA)().handleConversationUpsert(a)];case 23:return[4,this.getStrangerConversationList({isLoadMore:!1,forceRefresh:!0})];case 25:case 26:return[2]}})}).call(this)},startConversationChange:function(t){return(0,r._)(function(){var n,r,s,i,o,a,u,c,d,f,g,h,_,v,p,m,M,y,S,C,I,b,w,L,T;return(0,l.__generator)(this,function(l){switch(l.label){case 0:if(l.trys.push([0,7,,8]),n=e(G).initialized,s=(r=e(A.I9)).friendsCursor,i=r.groupCursor,o=r.hasMoreFriends,a=r.hasMoreGroup,c=Array.isArray(null==(u=r.options)?void 0:u.inboxType)&&(null==u?void 0:u.inboxType.includes(A.A5)),!t&&(!n||!c&&"0"===s&&o||c&&"0"===s&&o&&"0"===i&&a))return[2];return this.setListLoading(!0),[4,(0,A.fI)().getConversationListOnline(function(e){return!e.isStrangerConversation})];case 1:return f=null!=(d=l.sent())?d:[],g=e(P.nU).selectedConversation,_=(h=e(G)).otherUid,v=h.recentUserNameList,p=new Set,m=[],M={},_&&p.add(_),y=f.reduce(function(e,t){var n,r=t.id,s=t.toParticipantUserId,i=t.unreadCount,o=t.isMuted;return(t.isGroupChat?(null==(n=t.lastMessage)?void 0:n.sender)&&p.add(t.lastMessage.sender):s&&s!==_&&(p.add(s),m.push(s),M[s]=t),0===i||o||r===(null==g?void 0:g.id))?e:e+i},0),C=(S=e(R.pt)).selectedConversationTagList,I=S.unreadOnly,b=Array.from(p),w=m.slice(0,20),L=[this.setConversationMap(M),this.setUidList(b),this.getMultiUsersByUids({uidList:b}),(0,P.IA)().multiSetConversation({list:f,isStranger:!1}),this.getStrangerConversationList({isLoadMore:!1,forceRefresh:!0}),this.setAllConversationList(f)],I||C.length>0?L.push(this.getConversationListWithFilter()):L.push(this.setConversationList(f)),[4,Promise.all(L)];case 2:if(l.sent(),T=e(G).strangerMessagesUnreadCount,this.setMessageCount(y+T),!(!I&&0===C.length))return[3,4];return[4,this.getStrangerPreview()];case 3:l.sent(),l.label=4;case 4:if(!(v.length<w.length))return[3,6];return[4,this.getMultiUsersByUids({uidList:w,isGetRecentUsers:!0})];case 5:l.sent(),l.label=6;case 6:return this.setListLoading(!1),[3,8];case 7:return l.sent(),this.setListLoading(!1),[3,8];case 8:return[2]}})}).call(this)},getConversationListWithFilter:function(){return(0,r._)(function(){var t,n,r,s,i,o,a;return(0,l.__generator)(this,function(u){switch(u.label){case 0:if(n=(t=e(R.pt)).unreadOnly,r=t.selectedConversationTagList,s=e(F.G7).conversationListType,i=e(P.nU).selectedConversation,o=(0,A.fI)().getConversationListByTags(),!n)return[3,1];return a=o.filter(function(e){return e.unreadCount>0||(null==i?void 0:i.shortId)===e.shortId}),s===V.om.Friends?this.setConversationList(a):this.setStrangerConversationList(a),[3,5];case 1:if(s!==V.om.Friends)return[3,4];if(this.setConversationList(o),0!==r.length)return[3,3];return[4,this.getStrangerPreview()];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:this.setStrangerConversationList(o),u.label=5;case 5:return[2]}})}).call(this)},getStrangerPreview:function(){return(0,r._)(function(){var t,n,r,s,i,o,a,c,d,f;return(0,l.__generator)(this,function(l){switch(l.label){case 0:if(l.trys.push([0,4,,5]),n=e(O.YK).users,!e(A.I9).options)return[2];return(s=(r=e(G).allConversationList).findIndex(function(e){return e.isStrangerConversation}))>-1&&r.splice(s,1),[4,(0,A.fI)().getStrangerPreview()];case 1:if(!(a=(o=null==(i=l.sent())?void 0:i.conversation).toParticipantUserId))return[2];if(c=(0,u._)(r),f=null!=(d=null==(t=o.lastVisibleMessage)?void 0:t.createdAt.getTime())?d:-1,c.some(function(e,t){var n,r;return(null!=(r=null==(n=e.lastVisibleMessage)?void 0:n.createdAt.getTime())?r:-1)<f&&!e.isStickOnTop?(c.splice(t,0,o),!0):t===c.length-1&&(c.splice(t+1,0,o),!0)}),c.length||c.splice(0,0,o),this.setAllConversationList(c),this.setConversationList(c),(0,P.IA)().multiSetConversation({list:[o],isStranger:!0}),n[a])return[3,3];return[4,this.getMultiUsersByUids({uidList:[a]})];case 2:l.sent(),l.label=3;case 3:return[3,5];case 4:return l.sent(),[3,5];case 5:return[2]}})}).call(this)},getStrangerConversationList:function(n){return(0,r._)(function(){var r,s,a,u,c,d,f,g,h,_,v,p,m;return(0,l.__generator)(this,function(l){switch(l.label){case 0:if(r=n.isLoadMore,a=void 0!==(s=n.forceRefresh)&&s,c=(u=e(G)).strangerConversationList,d=u.isFirstTimeLoadStranger,f=u.conversationMap,g=e(P.nU).strangers,!(r||d||a))return[3,3];return[4,(0,A.fI)().getConversationListOnline(function(e){return e.isStrangerConversation})];case 1:return _=null!=(h=l.sent())?h:[],v=c.reduce(function(e,t){return e[t.id]=t,e},{}),m=(p=_.filter(function(e){return!g[e.id]||!v[e.id]})).map(function(e){var t;return null!=(t=e.toParticipantUserId)?t:""}),this.setConversationMap((0,i._)({},v,f)),(0,P.IA)().multiSetConversation({list:p,isStranger:!0}),[4,this.getMultiUsersByUids({uidList:m})];case 2:l.sent(),this.setStrangerConversationList(_),l.label=3;case 3:return d&&t(G,function(e){return(0,o._)((0,i._)({},e),{isFirstTimeLoadStranger:!1})}),[2]}})}).call(this)},getMultiUsersByUids:function(t){return(0,r._)(function(){var n,s,i,o,a,c,d,g,h,v,p,m,M,y,S,I;return(0,l.__generator)(this,function(b){switch(b.label){case 0:if(b.trys.push([0,5,,6]),n=t.uidList,s=t.isGetRecentUsers,i=e(O.YK).users,o=e(G).otherUid,a=location.pathname,!(0,C.tO)(a)&&(0,C.M5)(a)===_.g.Trending||(c=n.filter(function(e){return void 0===i[e]}),!n.length))return[2];d=String(c),this.setRecentUids(d),g=[],h=0,b.label=1;case 1:var w;if(!(h<Math.ceil(c.length/99)))return[3,4];return[4,(w=c.slice(99*h,99*(h+1)),(0,r._)(function(){var e,t;return(0,l.__generator)(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e=new URLSearchParams({aid:"1988",user_ids:"[".concat(w.map(function(e){return'"'.concat(e,'"')}).join(","),"]")}),[4,window.fetch.call(null,"/tiktok/v1/im/user/profile/?".concat(e),{method:"GET"})];case 1:return[4,n.sent().text()];case 2:return t=n.sent(),[2,f().parse(t)];case 3:return console.log("err when parsing regex",n.sent()),[2,{statusCode:"400"}];case 4:return[2]}})})())];case 2:if(void 0===(v=b.sent())||0!==v.status_code)return[2,void console.log("error when calling multi user api",v)];g.push(v),b.label=3;case 3:return h++,[3,1];case 4:for(M=0,p={},m=[];M<g.length;M++)m=(0,u._)(m).concat((0,u._)(U(g[M])));return m.forEach(function(e){p[e.id]=e}),c.forEach(function(e){if(!p[e]&&!i[e]){p[e]=null;return}o===e&&N(V.jh.UserSelect,{uid:e,uniqueId:p[e].uniqueId,from:"message-init"}),p[e].id=e}),(0,O.py)().multiSetUsers(p),s&&(y=[],S=[],I=[],n.forEach(function(e){var t,n=null!=(t=p[e])?t:i[e];n&&(y.push(n.uniqueId),S.push(n.nickname),I.push(e))}),this.updateRecentUserList({uniqueIdList:y,nicknameList:S,uidList:I})),[3,6];case 5:return b.sent(),[3,6];case 6:return[2]}})}).call(this)},getFollowingUserListWithCanShare:function(n){return(0,r._)(function(){var s,c,d,f,g,h,_,v,p,m,S,C,b,w,L,U,k;return(0,l.__generator)(this,function(R){switch(R.label){case 0:var P;return R.trys.push([0,2,3,4]),this.setFollowingLoading(!0),s=n.count,d=(c=e(G).followingUser).list,f=c.nicknameList,g=c.uidList,h=(0,a._)(c,["list","nicknameList","uidList"]),[4,(P=(0,o._)((0,i._)({},h),{count:s}),(0,r._)(function(){var e,t,n,r;return(0,l.__generator)(this,function(s){return t=void 0===(e=P.minCursor)?0:e,r=void 0===(n=P.count)?30:n,[2,M.h.get("/api/im/spotlight/relation",{query:{source:"web",with_fstatus:1,device_platform:"webapp_pc",count:r,max_time:t,min_time:0},baseUrlType:y.Z4.FixedWww})]})})())];case 1:return v=(_=R.sent()).status_code,p=_.max_time,m=_.min_time,C=void 0===(S=_.followings)?[]:S,b=_.has_more,w=[],L=[],U=[],0===v?(k=[],k=C.map(function(e){var t;return w.push(null!=(t=e.unique_id)?t:""),L.push(e.nickname),U.push(e.uid),T(e)}),this.updateFollowingUserList({list:(0,u._)(d).concat((0,u._)(w)),nicknameList:(0,u._)(f).concat((0,u._)(L)),uidList:(0,u._)(g).concat((0,u._)(U)),maxCursor:p,minCursor:m,hasMore:!!b}),(0,I.Gp)().multiSetUser(k)):t(G,function(e){return(0,o._)((0,i._)({},e),{followingUser:(0,o._)((0,i._)({},e.followingUser),{hasMore:!1})})}),[3,4];case 2:return R.sent(),[3,4];case 3:return this.setFollowingLoading(!1),[7];case 4:return[2]}})}).call(this)},sendMessage:function(t){return(0,r._)(function(){var n,r,i,o,a,u,c,d,f,g,h,_,M,y,S,C,I,b,w,L,T,U,k,R,F,O,E,G,B,x,D,q,Y,H,J,j,W,z,K,Z,X;return(0,l.__generator)(this,function(l){switch(l.label){case 0:if(l.trys.push([0,7,,8]),n=t.uid,i=void 0===(r=t.relation)?v.yf.NONE:r,o=t.type,a=t.content,u=t.hasConversation,c=t.chatType,d=t.messageType,f=t.convId,g=t.fileInfo,h=t.referenceMessage,_=t.scene,y=(M=e(P.nU)).friends,S=M.strangers,!u)return[3,2];return b=null!=(I=y[f])?I:S[f],[4,(0,A.fI)().createMessage({conversation:b,type:o,content:JSON.stringify(a),referenceMessage:h,fileInfo:g,scene:_})];case 1:return C=l.sent(),[3,5];case 2:return[4,(0,A.fI)().createConversation({uid:n,inboxType:0})];case 3:return T=null!=(L=null==(w=l.sent())?void 0:w.payload)?L:{},[4,(0,A.fI)().createMessage({conversation:T,type:o,content:JSON.stringify(a),referenceMessage:h,fileInfo:g,scene:_})];case 4:C=l.sent(),l.label=5;case 5:if(o===V.Go.Placeholder)return[2];if(void 0===C)throw Error("create message response is undefined");return[4,(0,A.fI)().sendMessage({message:C})];case 6:if(void 0===(U=l.sent()))throw Error("send message response is undefined");return k=U.success,R=U.checkMsg,F=U.statusCode,O=U.statusMsg,E=U.serverMessageId,G=U.logid,B=U.innerError,x=U.payload,this.setSendMessageStatus({isFailed:!1,isLoading:!1}),this.addSentMessageSuccessCount(),k?(p.w.handleSendMessage({chat_type:null!=c?c:m.H.Private,conversation_id:null!=(D=null==x?void 0:x.conversationId)?D:"",relation_tag:i,to_user_id:n,message_type:null!=d?d:"share_video",if_contain_quote:+!!h,quote_message_type:null==h?void 0:h.type}),N(V.jh.MessageSend,{uid:n})):(p.w.handleFailSendMessage({chat_type:null!=c?c:m.H.Private,conversation_id:null!=(q=null==x?void 0:x.conversationId)?q:"",message_type:null!=d?d:"share_video",error_code:null!=(Y=JSON.parse(null!=R?R:"{}").status_code)?Y:-1,check_msg:R||(null==B?void 0:B.toString()),status_msg:O,status_code:F,relation_tag:i,to_user_id:n,logid:G,if_contain_quote:+!!h,quote_message_type:null==h?void 0:h.type}),(null==x?void 0:x.clientId)&&(0,P.IA)().addFailedMessage((0,s._)({},x.clientId,{checkMsg:null!=R?R:"null",serverMessageId:E}))),[3,8];case 7:return H=l.sent(),J=t.uid,W=void 0===(j=t.relation)?v.yf.NONE:j,z=t.chatType,K=t.messageType,Z=t.convId,X=t.referenceMessage,console.error(H),p.w.handleFailSendMessage({chat_type:null!=z?z:m.H.Private,conversation_id:Z,message_type:null!=K?K:"share_video",error_code:-2,check_msg:(null==H?void 0:H.toString())||"",status_msg:"",status_code:-2,relation_tag:W,to_user_id:J,if_contain_quote:+!!X,quote_message_type:null==X?void 0:X.type}),this.setSendMessageStatus({isFailed:!0,isLoading:!1}),[3,8];case 8:return[2]}})}).call(this)},batchSendMessages:function(t){return(0,r._)(function(){var n,a,u,c,d,f,g,h,_,M,y,S,C,I,b,w,L;return(0,l.__generator)(this,function(T){switch(T.label){case 0:if(n=this,a=t.uid,c=void 0===(u=t.relation)?v.yf.NONE:u,d=t.hasConversation,f=t.chatType,g=t.convId,h=t.batchList,M=(_=e(P.nU)).friends,y=_.strangers,this.setSendMessageStatus({isFailed:!1,isLoading:!0}),!d)return[3,1];return S=null!=(I=null!=(C=M[g])?C:y[g])?I:{},[3,4];case 1:return T.trys.push([1,3,,4]),[4,(0,A.fI)().createConversation({uid:a,inboxType:0})];case 2:return S=null!=(w=null==(b=T.sent())?void 0:b.payload)?w:{},[3,4];case 3:return console.log(T.sent()),[3,4];case 4:L=h.map(function(e){return(0,r._)(function(){var t,n,r,u,d,h,_,v,M,y,C,I,b,w,L,T,U,k,R,F;return(0,l.__generator)(this,function(l){switch(l.label){case 0:t=e.type,n=e.content,r=e.fileInfo,u=e.messageType,d=e.scene,l.label=1;case 1:return l.trys.push([1,5,,6]),[4,(0,A.fI)().createMessage({conversation:S,type:t,content:JSON.stringify(n),fileInfo:r,scene:d})];case 2:if(!(h=l.sent()))return[3,4];return[4,(0,A.fI)().sendMessage({message:h})];case 3:(_=l.sent())&&(v=_.success,M=_.checkMsg,y=_.payload,C=_.statusCode,I=_.statusMsg,b=_.serverMessageId,w=_.logid,L=_.innerError,T={chat_type:null!=f?f:m.H.Private,conversation_id:g,message_type:null!=u?u:"default",relation_tag:c,to_user_id:a,if_contain_quote:0},v?(this.addSentMessageSuccessCount(),(0,P.IA)().setSendingProgress({messageId:null!=(U=null==y?void 0:y.clientId)?U:"",sendingProgress:{finished:!0}}),p.w.handleSendMessage(T),N(V.jh.MessageSend,{uid:a})):((null==y?void 0:y.clientId)&&(0,P.IA)().addFailedMessage((0,s._)({},y.clientId,{checkMsg:null!=M?M:"null",serverMessageId:b})),R=(0,o._)((0,i._)({},T),{error_code:null!=(k=JSON.parse(null!=M?M:"{}").status_code)?k:-1,check_msg:M||(null==L?void 0:L.toString()),status_code:null!=C?C:-1,status_msg:null!=I?I:-1,logid:w}),p.w.handleFailSendMessage(R))),l.label=4;case 4:return[3,6];case 5:return F=l.sent(),p.w.handleFailSendMessage({chat_type:null!=f?f:m.H.Private,conversation_id:g,message_type:null!=u?u:"default",error_code:-2,check_msg:(null==F?void 0:F.toString())||"",status_msg:"",status_code:-2,relation_tag:c,to_user_id:a,if_contain_quote:0}),[3,6];case 6:return[2]}})}).call(n)}),T.label=5;case 5:return T.trys.push([5,7,,8]),[4,Promise.allSettled(L)];case 6:return T.sent(),this.setSendMessageStatus({isFailed:!1,isLoading:!1}),[3,8];case 7:return T.sent(),this.setSendMessageStatus({isFailed:!0,isLoading:!1}),[3,8];case 8:return[2]}})}).call(this)},loadFullFriendConversations:function(){return(0,r._)(function(){var t,n,r;return(0,l.__generator)(this,function(s){switch(s.label){case 0:n=(t=e(A.I9)).hasMoreFriends,r=t.hasMoreGroup,s.label=1;case 1:if(!(n||r))return[3,3];return[4,(0,A.fI)().loadMoreConversation()];case 2:return s.sent(),n=e(A.I9).hasMoreFriends,r=e(A.I9).hasMoreGroup,[3,1];case 3:return[2]}})})()},loadFullStrangerConversation:function(){return(0,r._)(function(){var t;return(0,l.__generator)(this,function(n){switch(n.label){case 0:t=e(A.I9).hasMoreStranger,n.label=1;case 1:if(!t)return[3,3];return[4,(0,A.fI)().loadMoreStrangerConversation()];case 2:return n.sent(),t=e(A.I9).hasMoreStranger,[3,1];case 3:return[2]}})})()}}}),x=B.useServiceState,D=B.useServiceDispatchers,q=B.useAtomService,Y=B.getStaticApi},77348:function(e,t,n){n.d(t,{BR:function(){return h},Go:function(){return p},M5:function(){return f},OQ:function(){return g},S4:function(){return m},Z5:function(){return M},eh:function(){return _},hr:function(){return d},jh:function(){return y},om:function(){return v}});var r,s,i,o,a,u,c,l,d=((r={})[r.OpenPrivacySetting=0]="OpenPrivacySetting",r[r.Report=1]="Report",r[r.Feedback=2]="Feedback",r),f=((s={})[s.Default=0]="Default",s[s.Report=1]="Report",s),g=((i={})[i.InProgress=1]="InProgress",i[i.Pass=2]="Pass",i[i.Block=3]="Block",i[i.Risk=4]="Risk",i),h="webapp-dm-accepted-list",_=1022,v=((o={}).Friends="friends",o.Strangers="strangers",o),p=((a={})[a.None=0]="None",a[a.StartChatTip=1]="StartChatTip",a[a.Text=7]="Text",a[a.Video=8]="Video",a[a.Story=1025]="Story",a[a.Inline=1031]="Inline",a[a.BusinessInvitation=1037]="BusinessInvitation",a[a.GroupNoticeGuide=1039]="GroupNoticeGuide",a[a.Placeholder=49999]="Placeholder",a[a.Sticker=1805]="Sticker",a[a.LEGACY_MESSAGE_TYPE_EMOJI=5]="LEGACY_MESSAGE_TYPE_EMOJI",a[a.MsgTypeTemplatePictureCard=1802]="MsgTypeTemplatePictureCard",a[a.MsgTypeTemplateVideoCard=1803]="MsgTypeTemplateVideoCard",a),m=((u={})[u.CreateGroupNotice=103101]="CreateGroupNotice",u[u.RemoveUserNotice=103102]="RemoveUserNotice",u[u.AdminChangeNotice=103103]="AdminChangeNotice",u[u.LeftGroupNotice=103104]="LeftGroupNotice",u[u.AddMemberNotice=103105]="AddMemberNotice",u[u.GroupNameChangeNotice=103106]="GroupNameChangeNotice",u[u.RiskMemberJoinNotice=103107]="RiskMemberJoinNotice",u[u.GroupNameViolationNotice=103108]="GroupNameViolationNotice",u[u.GroupNameViolationOnSsh=103109]="GroupNameViolationOnSsh",u[u.GroupNameViolationReportWithLink=103110]="GroupNameViolationReportWithLink",u[u.RemoveMemberByServerNotice=103111]="RemoveMemberByServerNotice",u[u.CreateGroupAndAddMember=103112]="CreateGroupAndAddMember",u[u.RiskLevelWarningWithLink=103114]="RiskLevelWarningWithLink",u),M=((c={}).EcomEmail="ecom_email",c.Business="business",c.StoryReaction="story_reaction",c.StoryReply="story_reply",c),y=((l={}).MessageSend="message-send",l.UserSelect="user-select",l.MessageCountChange="new-message",l.OnLoad="on-load",l.UserDelete="user-delete",l)},35083:function(e,t,n){n.d(t,{EL:function(){return m},L_:function(){return M},Sk:function(){return y},YK:function(){return v},py:function(){return S}});var r=n(79066),s=n(35383),i=n(5377),o=n(45996),a=n(72516),u=n(66905),c=n(10625),l=n(50870),d=n(66868),f=n(44957),g=n(54149),h=n(12293),_=n(63004),v=(0,c.p)("messageUserAtom@tiktok/webapp-atoms",{users:{}}),p=(0,u.i)(v,function(e,t){return{getUser:function(t){return e(v).users[t]},multiSetUsers:function(n){var r=e(v).users;t(v,{users:(0,i._)({},r,n)})},setUserRelation:function(n){var r=n.uid,s=n.relation,a=e(v),u=a.users,c=a.users[r];if(c){var l=(0,o._)((0,i._)({},c),{relation:s}),d=(0,i._)({},u);d[r]=l,t(v,{users:(0,i._)({},d)})}},blockUser:function(t){return(0,r._)(function(){var n,u,c,p,m,M,y,S;return(0,a.__generator)(this,function(C){switch(C.label){case 0:var I;return C.trys.push([0,2,,3]),n=t.uid,u=t.isBlock,m=void 0===(p=(null!=(c=e(v).users[n])?c:{}).uniqueId)?"":p,M=(0,_.T)(),[4,(I={user_id:n,block_type:+!!u},(0,r._)(function(){return(0,a.__generator)(this,function(e){return[2,f.h.post("/aweme/v1/user/block/",{query:(0,o._)((0,i._)({},I),{source:3}),baseUrlType:g.Z4.FixedWww,headers:(0,s._)({},g.nk,f.h.csrfToken)})]})})())];case 1:if(0!==C.sent().status_code)return[2,void d.F.open({content:M("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"})];return y=u?l.yf.BLOCK:l.yf.NONE,this.setUserRelation({uid:n,relation:y}),(0,h.Gp)().setUserRelation({uniqueId:m,relation:y}),[3,3];case 2:return console.log("block has error",C.sent()),S=(0,_.T)(),d.F.open({content:S("Sorry, something wrong with the server, please try again."),duration:3,widthType:"half"}),[3,3];case 3:return[2]}})}).call(this)}}}),m=p.useServiceState,M=p.useServiceDispatchers,y=p.useAtomService,S=p.getStaticApi},11283:function(e,t,n){n.d(t,{f:function(){return r}});var r={Min:500,XSmall:592,Small:768,Medium:1024,Large:1280,XLarge:1440}}}]);