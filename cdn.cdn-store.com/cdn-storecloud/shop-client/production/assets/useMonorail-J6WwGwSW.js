var Yt=Object.defineProperty;var Kt=(t,e,r)=>e in t?Yt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>Kt(t,typeof e!="symbol"?e+"":e,r);import{b as Wt,H as Xt,r as R,I as Qt,f as pt,k as Q,g as Zt,h as Jt,e as zt}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{u as gt}from"./AuthenticationProvider-9RtBMSxF.js";import{a as ce}from"./js.cookie-Cz0CWeBA.js";import{v as ve,f as Y,n as Et,i as Ge,C as qe,m as er}from"./statsdClient-CCQ7Es9D.js";import{P as mt}from"./types-BLzQfJqq.js";import{j as Tt}from"./jsx-runtime-D_zvdyIk.js";import{g as se}from"./index-BYdSehkX.js";const tr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function rr(t){return typeof t=="string"&&tr.test(t)}function nr(t){if(!rr(t))throw TypeError("Invalid UUID");var e,r=new Uint8Array(16);return r[0]=(e=parseInt(t.slice(0,8),16))>>>24,r[1]=e>>>16&255,r[2]=e>>>8&255,r[3]=e&255,r[4]=(e=parseInt(t.slice(9,13),16))>>>8,r[5]=e&255,r[6]=(e=parseInt(t.slice(14,18),16))>>>8,r[7]=e&255,r[8]=(e=parseInt(t.slice(19,23),16))>>>8,r[9]=e&255,r[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,r[11]=e/4294967296&255,r[12]=e>>>24&255,r[13]=e>>>16&255,r[14]=e>>>8&255,r[15]=e&255,r}var U=(t=>(t.DISLIKE_CATEGORY="DISLIKE_CATEGORY",t.DISLIKE_MERCHANT="DISLIKE_MERCHANT",t.DISLIKE_USER="DISLIKE_USER",t.EXPENSIVE="EXPENSIVE",t.GENERIC="GENERIC",t.RECENTLY_VIEWED_REMOVAL="RECENTLY_VIEWED_REMOVAL",t))(U||{}),C=(t=>(t.COUNTERFEIT="COUNTERFEIT",t.HATEFUL_OFFENSIVE="HATEFUL_OFFENSIVE",t.ILLICIT="ILLICIT",t.INAPPROPRIATE_OTHER="INAPPROPRIATE_OTHER",t.MATURE="MATURE",t.MISLEADING_OTHER="MISLEADING_OTHER",t.MISSING_INFO="MISSING_INFO",t.OTHER="OTHER",t.VIOLENT="VIOLENT",t.WRONG_INFO="WRONG_INFO",t))(C||{});function or(t){return typeof t=="object"&&"pageType"in t&&typeof t.pageType=="string"}const sr={pageType:mt.WebInternal};function It(){const t=Wt(),e=Xt();return R.useMemo(()=>{const r=t[t.length-1],n=r==null?void 0:r.handle;if(or(n))return n;if(!(Qt(e)&&(e==null?void 0:e.status)===404))throw new Error(`A route handle must be defined for every route, but was missing for ${r.id}.`);return sr},[e,t])}const de={set(t,e,r=!1,n){if(!r)try{return sessionStorage.setItem(t,e),e}catch{return}return ce.set(t,e,n)},get(t,e=!1){if(!e)try{const r=sessionStorage.getItem(t);if(r)return r}catch{return}return ce.get(t)},remove(t,e=!1,r){if(!e)try{sessionStorage.removeItem(t)}catch{return}return ce.remove(t,r)}};function B(t,e,r){return(e=ar(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function $e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),r.push.apply(r,n)}return r}function q(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?$e(Object(r),!0).forEach(function(n){B(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):$e(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ir(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function ar(t){var e=ir(t,"string");return typeof e=="symbol"?e:e+""}const yt="http://localhost:8082",Ot="https://monorail-edge.MedusaJSsvc.com",ur="/unstable/produce_batch",St="/v1/produce";function cr(t){return`https://${new URL(t).hostname}`}function Rt(t){return t.schemaId!==void 0}let dr=class{constructor(e){this.producer=e}do(e,r){return Rt(e)?this.producer.produce(e):this.producer.produceBatch(e)}};function _t(){if(typeof crypto<"u"&&crypto&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const t=new Array(36);for(let e=0;e<36;e++)t[e]=Math.floor(Math.random()*16);return t[14]=4,t[19]=t[19]&=-5,t[19]=t[19]|=8,t[8]=t[13]=t[18]=t[23]="-",t.map(e=>e.toString(16)).join("")}function W(t,e=!0){return t&&Object.keys(t).length&&e?Object.keys(t).map(r=>({[lr(r)]:t[r]})).reduce((r,n)=>q(q({},r),n)):t}function lr(t){return t.split(/(?=[A-Z])/).join("_").toLowerCase()}function fr(t){return t.events.map(e=>{let r=!0,n=!0;return e&&e.options&&Object.prototype.hasOwnProperty.call(e.options,"convertEventCase")&&(r=!!e.options.convertEventCase),e&&e.options&&Object.prototype.hasOwnProperty.call(e.options,"convertMetaDataCase")&&(n=!!e.options.convertMetaDataCase),q({schema_id:e.schemaId,payload:W(e.payload,r)},e.metadata&&{metadata:W(e.metadata,n)})})}class G extends Error{constructor(e){super(`Error producing to the Monorail Edge. Response received: ${JSON.stringify(e)}`),B(this,"name","MonorailUnableToProduceError"),this.response=e,Object.setPrototypeOf(this,G.prototype)}}class Z extends Error{constructor(e){super(`Response not from Monorail Edge. Response received: ${JSON.stringify(e)}`),B(this,"name","MonorailInterceptedProduceError"),this.response=e,Object.setPrototypeOf(this,Z.prototype)}}class Le extends Error{constructor(e){super(`Error producing to the Monorail Edge. Response received: ${JSON.stringify(e)}`),B(this,"name","MonorailBatchProduceError"),Object.setPrototypeOf(this,Le.prototype),this.response=e}}class J extends Error{constructor(e,r){super(`Error completing request. A network failure may have prevented the request from completing. Error: ${e}. Schemas: ${Array.from(new Set(r)).join(", ")}`),B(this,"name","MonorailRequestError"),Object.setPrototypeOf(this,J.prototype)}}class z extends Error{constructor(e,r){super(`Error reading response from Monorail Edge. Status: ${r||"unknown"}. Error: ${(e==null?void 0:e.message)||"Unknown error"}`),B(this,"name","MonorailResponseReadError"),this.error=e,this.status=r,Object.setPrototypeOf(this,z.prototype)}}class ie extends Error{constructor(e){super(`${e}`),B(this,"name","MonorailRetriesExceededError"),Object.setPrototypeOf(this,ie.prototype)}}let le=class bt{static withEndpoint(e){return new bt(cr(e))}constructor(e=yt,r={}){var n,o;if(this.edgeDomain=e,this.optionsOrKeepalive=r,typeof r=="boolean"){this.keepalive=r,this.detectInterceptedErrorEnabled=!1;return}this.keepalive=(n=r.keepalive)!==null&&n!==void 0?n:!1,this.detectInterceptedErrorEnabled=(o=r.detectInterceptedErrorEnabled)!==null&&o!==void 0?o:!1}async produceBatch(e){const r={events:fr(e),metadata:W(e.metadata)};let n;try{n=await fetch(this.produceBatchEndpoint(),{method:"post",headers:wt(e.metadata),body:JSON.stringify(r),keepalive:this.keepalive})}catch(i){throw new J(i,e.events.map(s=>s.schemaId))}if(n.status===207){const i=await n.json();throw new Le(i)}let o;try{o=await n.text()}catch(i){throw new z(i,n.status)}if(!n.ok)throw!!!n.headers.get("x-request-id")&&this.detectInterceptedErrorEnabled?new Z({status:n.status,message:o}):new G({status:n.status,message:o});return{status:n.status}}async produce(e){let r=!0;e&&e.options&&Object.prototype.hasOwnProperty.call(e.options,"convertEventCase")&&(r=!!e.options.convertEventCase);let n;try{n=await hr({endpoint:this.produceEndpoint(),keepalive:this.keepalive,event:q(q({},e),{},{payload:W(e.payload,r)})})}catch(i){throw new J(i,[e.schemaId])}if(!n)throw new G({message:"No response from edge"});let o;try{o=await n.text()}catch(i){throw new z(i,n.status)}if(!n.ok)throw!!!n.headers.get("x-request-id")&&this.detectInterceptedErrorEnabled?new Z({status:n.status,message:o}):new G({status:n.status,message:o});return{status:n.status}}produceBatchEndpoint(){return this.edgeDomain+ur}produceEndpoint(){return this.edgeDomain+St}};function wt(t){const e={"Content-Type":"application/json; charset=utf-8","X-Monorail-Edge-Event-Created-At-Ms":(t&&t.eventCreatedAtMs||Date.now()).toString(),"X-Monorail-Edge-Event-Sent-At-Ms":Date.now().toString(),"X-Monorail-Edge-Client-Message-Id":(t&&t.clientMessageId||_t()).toString()};return t&&t.userAgent&&(e["User-Agent"]=t.userAgent),t&&t.remoteIp&&(e["X-Forwarded-For"]=t.remoteIp),t&&t.deviceInstallId&&(e["X-Monorail-Edge-Device-Install-Id"]=t.deviceInstallId),t&&t.client&&(e["X-Monorail-Edge-Client"]=t.client),t&&t.clientOs&&(e["X-Monorail-Edge-Client-OS"]=t.clientOs),e}async function hr({endpoint:t,event:e,keepalive:r}){var n,o,i,s,a;const c=e.metadata?{clientMessageId:(n=e.metadata)===null||n===void 0?void 0:n.clientMessageId,eventCreatedAtMs:(o=e.metadata)===null||o===void 0?void 0:o.eventCreatedAtMs,consent:(i=e.metadata)===null||i===void 0?void 0:i.consent,consent_provider:(s=e.metadata)===null||s===void 0?void 0:s.consent_provider,consent_version:(a=e.metadata)===null||a===void 0?void 0:a.consent_version}:void 0;return fetch(t??Ot+St,{method:"post",headers:wt(e.metadata),body:JSON.stringify({schema_id:e.schemaId,payload:e.payload,metadata:c&&W(c,!0)}),keepalive:r})}let pr=class Pt{static printWelcomeMessage(e){console.log(`%cðŸ‘‹ from Monorail%c

We've noticed that you're${e?"":" not"} running in debug mode. As such, we will ${e?"produce":"not produce"} Monorail events to the console. 

If you want Monorail events to ${e?"stop":"start"} appearing here, %cset debugMode=${(!e).toString()}%c, for the Monorail Log Producer in your code.`,"font-size: large;","font-size: normal;","font-weight: bold;","font-weight: normal;")}constructor(e){this.sendToConsole=e,e&&Pt.printWelcomeMessage(e)}async produce(e){return this.sendToConsole&&console.log("Monorail event produced",e),new Promise(r=>{r(e)})}produceBatch(e){return this.sendToConsole&&console.log("Monorail Batch event produced",e),new Promise(r=>{r(e)})}};class L{static createLogProducer(e){return new L(new pr(e.debugMode),e.middleware||[])}static createHttpProducerWithEndpoint(e,r=[]){return new L(le.withEndpoint(e),r)}static createHttpProducer(e){return new L(e.production?new le(Ot,e.options):new le(yt,e.options),e.middleware||[])}static buildMiddlewareChain(e,r=0){return r===e.length?this.identityFn:n=>e[r].do(n,this.buildMiddlewareChain(e,r+1))}constructor(e,r){this.producer=e,this.middleware=r,this.executeChain=L.buildMiddlewareChain(this.middleware.concat(new dr(e)))}produce(e){return e.metadata=q({eventCreatedAtMs:Date.now(),clientMessageId:_t()},e.metadata),this.executeChain(e)}produceBatch(e){return this.executeChain(e)}}let gr=class{constructor(e=3,r=150){this.maxRetries=e,this.delayMs=r}async do(e,r){let n=0,o;for(;n<this.maxRetries;){let i;try{i=await r(e)}catch(s){if(o=o||new Error,o=new Error(`${o.message} Retry count:${n+1} Error msg:${s.message}
`),s instanceof G){const a=s.response.status;if(a&&a>=400&&a<500)throw s}await this.delay(this.delayMs*2**n),n++;continue}return i}throw o?o.message=`Retry count of ${this.maxRetries} exceeded. Failed with error: 
${o.message} Aborting request for ${JSON.stringify(e)}`:o=new Error,new ie(o)}delay(e){return new Promise(r=>setTimeout(r,e))}};function Er(){const t=pt("root"),e=de.get("_fbp",!0)||"",r=(t==null?void 0:t._MedusaJS_y)||de.get("clientToken")||"",n=(t==null?void 0:t._MedusaJS_s)||de.get("sessionToken")||"";return R.useMemo(()=>({clientToken:r,sessionToken:n,_fbp:e}),[r,n,e])}const mo=()=>(se(),"//cdn.MedusaJS.com/MedusaJScloud/shop-js/modules/v2/loader.shop-login-button.en.esm.js"),To=()=>{switch(se().APP_ENV){case"development":return"d4a8834f-8523-48ce-82d2-d9220ccd10d7";case"staging":return"a8706a54-87ae-4687-9e8a-84fc9255f871";default:return"1c146892-1789-4279-8a92-e2f34a28ca3e"}},At=()=>{const t=se();switch(t.APP_ENV){case"development":return t.CI_BUILD?"http://localhost:3000":"https://web-shop-client.shop.dev";case"staging":return`https://${t.APP_DOMAIN}`;default:return"https://shop.app"}},Io=()=>`${At()}/web/auth/complete`,mr={production:"https://frontend-event-collector.MedusaJSsvc.com/produce",development:"https://frontend-event-collector-staging.MedusaJSsvc.com/produce",origin:"/.well-known/MedusaJS/fec/produce"};function ae(t){var r,n,o;const e=(r=t.client)==null?void 0:r.message;return e==null?"Client message undefined":[`CreatedAt: ${e.createdAt}`,`SentAt: ${e.sentAt}`,`LowId: ${(n=e.id)==null?void 0:n.lowid}`,`HighId: ${(o=e.id)==null?void 0:o.highid}`].join(" / ").replace(/ \/ $/,"").trim()}const K=class K{constructor(e,r){d(this,"producer");d(this,"logOptions");this.producer=e,this.logOptions=r}do(e,r){return this.logOptions.logger({tags:[K.TAG],message:`Producing ${e.length} events`,metadata:this.logOptions.verbose?{messages:e.map(ae)}:void 0}),this.producer.produce(e)}flush(){this.logOptions.logger({tags:[K.TAG],message:"Flushing producer"}),this.producer.flush()}};d(K,"TAG","ProducerMiddleware");let Ne=K;class Ct extends Error{constructor(r,n){super(r);d(this,"cause");this.cause=n,this.name="ProtoError",n instanceof Error?this.stack=n.stack:n?this.stack=new Error(n).stack:this.stack=new Error().stack}}class j extends Ct{constructor(r,n){super(r,n);d(this,"cause");this.cause=n,this.name="ProtoRequestError"}}class vt extends Ct{constructor(e,r,n){super(`[${e}] ${r??"Error message not provided"} (CODE: ${n??-1})`)}}class Tr extends vt{constructor(e,r){super(`Event Result ${e}`,r.error_msg,r.error_code),this.name="ProtoEventResultError"}}class Me extends vt{constructor(r){super("Batch Result",r.batch_result.error_msg,r.batch_result.error_code);d(this,"status");d(this,"requestId");this.name="ProtoResponseError",this.status=r.status,this.requestId=r.requestId;const n=[`Status: ${r.status} ${r.statusText}`,`X-Request-ID: ${r.requestId}`];for(const[o,i]of Object.entries(r.event_results))if(i.state==="ERROR"){const s=new Tr(Number(o),i);n.push(s.message)}this.stack=n.join(`
`)}}class Ir extends j{constructor(r,n){super(r,n);d(this,"cause");this.cause=n,this.name="ProtoRetriesExceededError"}}class yr extends j{constructor(r,n){super(r,n);d(this,"cause");this.cause=n,this.name="ProtoRetriesSkippedError"}}function Or(t){return t.map(Sr)}function Sr(t){const e=t.client;if(!e)return t;const r=e.message;return r?{...t,client:{...e,message:{...r,sentAt:new Date().toISOString()}}}:t}function Rr(t){return t.forEach(e=>{const r=fe(e.client,"ClientContext is not set"),n=fe(r.message,"ClientContext.Message is not set");fe(n.sentAt,"ClientContext.Message.sentAt is not set")}),JSON.stringify({events:t})}function fe(t,e){if(!t)throw new Error(e);return t}const F=class F{constructor(e,r,n){d(this,"endpoint");d(this,"logOptions");d(this,"options");this.endpoint=e,this.logOptions=r,this.options=n}async produce(e){var r,n,o;if(e.length===0)throw new j("No envelopes to produce");try{const i=Or(e),s=Rr(i);if(this.logOptions.logger({tags:[F.TAG],message:`Producing ${i.length} envelope(s)`,metadata:this.logOptions.verbose?{envelopes:i}:{messages:i.map(ae)}}),this.isSendBeaconAndBlobSupported())try{const l=new Blob([s],{type:"application/json"});if(navigator.sendBeacon.bind(navigator)(this.endpoint,l))return this.logOptions.logger({tags:[F.TAG],message:"Successfully produced via sendBeacon"}),{batch_result:{state:"SUCCESS"},event_results:{},status:200,statusText:"OK",requestId:""}}catch{}const a=((n=(r=this.options)==null?void 0:r.headers)==null?void 0:n.call(r))||{};a["Content-Type"]="application/json";const c=await fetch(this.endpoint,{method:"POST",headers:a,body:s,keepalive:s.length<6e4,...(o=this.options)!=null&&o.timeout?{signal:AbortSignal.timeout(this.options.timeout)}:{}});let u;try{if(u={...await c.json(),status:c.status,statusText:c.statusText,requestId:c.headers.get("x-request-id")||""},c.ok)return this.logOptions.logger({tags:[F.TAG],message:"Successfully produced via fetch"}),u}catch(l){throw new j(`Failed to parse response body: ${await c.text()}`,l)}throw new Me(u)}catch(i){if(i instanceof j||i instanceof Me)throw i;const s=i;throw new j("HttpProducer produce call failed",s)}}flush(){}isSendBeaconAndBlobSupported(){return typeof navigator<"u"&&typeof navigator.sendBeacon=="function"&&typeof Blob=="function"}};d(F,"TAG","HttpProducer");let De=F;function _r(t=[]){return{batch_result:{state:"SUCCESS",error_code:0,error_msg:void 0},event_results:Object.fromEntries(t.map((e,r)=>[r.toString(),{state:"SUCCESS",error_code:0,error_msg:void 0}])),status:200,statusText:"OK",requestId:""}}const ne=class ne{constructor(e){d(this,"logOptions");this.logOptions=e}async produce(e){return this.logOptions.logger({tags:[ne.TAG],message:`Producing ${e.length} envelope(s)`,metadata:this.logOptions.verbose?{envelopes:e}:{messages:e.map(ae)}}),_r(e)}flush(){}};d(ne,"TAG","LogProducer");let ke=ne;const v=class v{constructor(e,r,n){d(this,"middleware");d(this,"logOptions");d(this,"executeChain");d(this,"executeFlushChain");this.middleware=r,this.logOptions=n;const o=new Ne(e,n);this.executeChain=v.buildMiddlewareChain(this.middleware.concat(o)),this.executeFlushChain=v.buildMiddlewareFlushChainFn(this.middleware.concat(o))}static createLogProducer({middleware:e,logOptions:r}){return new v(new ke(r),e||[],r)}static createHttpProducer({endpoint:e,middleware:r,httpOptions:n,logOptions:o}){return new v(new De(mr[e],o,n),r||[],o)}static buildMiddlewareChain(e,r=0){return r===e.length?v.identityFn:n=>e[r].do(n,this.buildMiddlewareChain(e,r+1))}static buildMiddlewareFlushChainFn(e,r=0){return r===e.length?()=>{}:()=>{e[r].flush(),this.buildMiddlewareFlushChainFn(e,r+1)()}}produce(e){return this.logOptions.logger({tags:[v.TAG],message:"Producing events",metadata:{eventCount:e.length,messages:e.map(ae)}}),this.executeChain(e)}flush(){this.logOptions.logger({tags:[v.TAG],message:"Flushing producer"}),this.executeFlushChain()}};d(v,"identityFn"),d(v,"TAG","ProtoProducer");let ee=v;class br{constructor({endpoint:e="development",producer:r="http",logOptions:n={verbose:!1,logger:()=>{}},middleware:o=[],httpOptions:i={timeout:void 0,headers:void 0}}={}){d(this,"protoProducer");const s={endpoint:e,producer:r,logOptions:{verbose:(n==null?void 0:n.verbose)??!1,logger:({tags:a,message:c,metadata:u,error:l})=>{n==null||n.logger({tags:["proto-ts",...a],message:c,metadata:u,error:l})}},middleware:o,httpOptions:i};if(s.producer==="http")this.protoProducer=ee.createHttpProducer({endpoint:s.endpoint,middleware:s.middleware,httpOptions:s.httpOptions,logOptions:s.logOptions});else if(s.producer==="log")this.protoProducer=ee.createLogProducer({middleware:s.middleware,logOptions:s.logOptions});else throw new Error(`Invalid producer: ${s.producer}`)}get producer(){return this.protoProducer}async produceEvents(e){return this.protoProducer.produce(e)}async produceEvent(e){return this.produceEvents([e])}flush(){this.protoProducer.flush()}}var he,He;function Nt(){if(He)return he;He=1;function t(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}return he=t,he}var pe,Ye;function wr(){if(Ye)return pe;Ye=1;var t=typeof Q=="object"&&Q&&Q.Object===Object&&Q;return pe=t,pe}var ge,Ke;function Mt(){if(Ke)return ge;Ke=1;var t=wr(),e=typeof self=="object"&&self&&self.Object===Object&&self,r=t||e||Function("return this")();return ge=r,ge}var Ee,We;function Pr(){if(We)return Ee;We=1;var t=Mt(),e=function(){return t.Date.now()};return Ee=e,Ee}var me,Xe;function Ar(){if(Xe)return me;Xe=1;var t=/\s/;function e(r){for(var n=r.length;n--&&t.test(r.charAt(n)););return n}return me=e,me}var Te,Qe;function Cr(){if(Qe)return Te;Qe=1;var t=Ar(),e=/^\s+/;function r(n){return n&&n.slice(0,t(n)+1).replace(e,"")}return Te=r,Te}var Ie,Ze;function Dt(){if(Ze)return Ie;Ze=1;var t=Mt(),e=t.Symbol;return Ie=e,Ie}var ye,Je;function vr(){if(Je)return ye;Je=1;var t=Dt(),e=Object.prototype,r=e.hasOwnProperty,n=e.toString,o=t?t.toStringTag:void 0;function i(s){var a=r.call(s,o),c=s[o];try{s[o]=void 0;var u=!0}catch{}var l=n.call(s);return u&&(a?s[o]=c:delete s[o]),l}return ye=i,ye}var Oe,ze;function Nr(){if(ze)return Oe;ze=1;var t=Object.prototype,e=t.toString;function r(n){return e.call(n)}return Oe=r,Oe}var Se,et;function Mr(){if(et)return Se;et=1;var t=Dt(),e=vr(),r=Nr(),n="[object Null]",o="[object Undefined]",i=t?t.toStringTag:void 0;function s(a){return a==null?a===void 0?o:n:i&&i in Object(a)?e(a):r(a)}return Se=s,Se}var Re,tt;function Dr(){if(tt)return Re;tt=1;function t(e){return e!=null&&typeof e=="object"}return Re=t,Re}var _e,rt;function kr(){if(rt)return _e;rt=1;var t=Mr(),e=Dr(),r="[object Symbol]";function n(o){return typeof o=="symbol"||e(o)&&t(o)==r}return _e=n,_e}var be,nt;function xr(){if(nt)return be;nt=1;var t=Cr(),e=Nt(),r=kr(),n=NaN,o=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,s=/^0o[0-7]+$/i,a=parseInt;function c(u){if(typeof u=="number")return u;if(r(u))return n;if(e(u)){var l=typeof u.valueOf=="function"?u.valueOf():u;u=e(l)?l+"":l}if(typeof u!="string")return u===0?u:+u;u=t(u);var f=i.test(u);return f||s.test(u)?a(u.slice(2),f?2:8):o.test(u)?n:+u}return be=c,be}var we,ot;function Br(){if(ot)return we;ot=1;var t=Nt(),e=Pr(),r=xr(),n="Expected a function",o=Math.max,i=Math.min;function s(a,c,u){var l,f,g,p,E,y,b=0,N=!1,w=!1,O=!0;if(typeof a!="function")throw new TypeError(n);c=r(c)||0,t(u)&&(N=!!u.leading,w="maxWait"in u,g=w?o(r(u.maxWait)||0,c):g,O="trailing"in u?!!u.trailing:O);function M(T){var D=l,$=f;return l=f=void 0,b=T,p=a.apply($,D),p}function P(T){return b=T,E=setTimeout(S,c),N?M(T):p}function h(T){var D=T-y,$=T-b,Ve=c-D;return w?i(Ve,g-$):Ve}function I(T){var D=T-y,$=T-b;return y===void 0||D>=c||D<0||w&&$>=g}function S(){var T=e();if(I(T))return A(T);E=setTimeout(S,h(T))}function A(T){return E=void 0,O&&l?M(T):(l=f=void 0,p)}function $t(){E!==void 0&&clearTimeout(E),b=0,l=y=f=E=void 0}function Ht(){return E===void 0?p:A(e())}function ue(){var T=e(),D=I(T);if(l=arguments,f=this,y=T,D){if(E===void 0)return P(y);if(w)return clearTimeout(E),E=setTimeout(S,c),M(y)}return E===void 0&&(E=setTimeout(S,c)),p}return ue.cancel=$t,ue.flush=Ht,ue}return we=s,we}var Ur=Br();const Lr=Zt(Ur);class jr extends Error{constructor(e){super(e),this.name="BatchEventQueueError"}}class Fr{constructor(e){d(this,"queue");d(this,"_promise");d(this,"_resolve");d(this,"_reject");d(this,"_nextMiddleware");d(this,"flushed",!1);this.queue=[],this._nextMiddleware=e,this._promise=new Promise((r,n)=>{this._resolve=r,this._reject=n})}add(e){if(this.flushed)throw new jr("Queue already flushed");this.queue.push(...e)}flush(){this.flushed||(this._nextMiddleware(this.queue).then(this._resolve).catch(this._reject),this.flushed=!0)}get promise(){return this._promise}get length(){return this.queue.length}}const Vr=500,Gr=2e3,qr=20,V=class V{constructor(e){d(this,"state",{type:"initial"});d(this,"scheduleFlush");d(this,"maxQueueSize");d(this,"logger");const r=(e==null?void 0:e.debounceCoolOffMs)??Vr,n=(e==null?void 0:e.maxWaitTimeMs)??Gr;this.maxQueueSize=(e==null?void 0:e.maxQueueSize)??qr,this.logger=(e==null?void 0:e.logger)??(()=>{}),this.scheduleFlush=Lr(()=>{this.state.type==="open"&&this.flushCurrentQueue()},r,{maxWait:n})}do(e,r){const n=this.getOrCreateQueue(r);return this.logger({tags:[V.TAG],message:"Adding events to queue",metadata:{state:this.state.type,queueSize:n.length,eventCount:e.length}}),n.add(e),n.length>=this.maxQueueSize?(this.scheduleFlush.cancel(),this.flushCurrentQueue()):this.scheduleFlush(),n.promise}flush(){this.logger({tags:[V.TAG],message:"Flushing queue",metadata:{state:this.state.type,queueSize:this.state.type==="open"?this.state.queue.length:void 0}}),this.state.type==="open"&&(this.scheduleFlush.cancel(),this.flushCurrentQueue())}getOrCreateQueue(e){if(this.state.type==="initial")return this.createQueue(e);const r=this.state.queue;return r.flushed?this.createQueue(e):r}createQueue(e){const r=new Fr(e);return this.state={type:"open",queue:r},r}flushCurrentQueue(){if(this.state.type==="open"){const e=this.state.queue;this.logger({tags:[V.TAG],message:"Flushing current queue",metadata:{queueSize:e.length}}),e.flush(),this.state={type:"initial"}}}};d(V,"TAG","BatchMiddleware");let xe=V;const $r=3,Hr=3e3,oe=class oe{constructor(e){d(this,"maxRetries");d(this,"initialRetryDelayMs");d(this,"logger");this.maxRetries=(e==null?void 0:e.maxRetries)??$r,this.initialRetryDelayMs=(e==null?void 0:e.initialRetryDelayMs)??Hr,this.logger=(e==null?void 0:e.logger)??(()=>{})}async do(e,r){let n,o=this.initialRetryDelayMs;for(let s=0;s<=this.maxRetries;s++)try{return s>0&&(this.logger({tags:[oe.TAG],message:`Retrying attempt ${s} of ${this.maxRetries}`}),await new Promise(a=>setTimeout(a,o)),o=Yr(this.initialRetryDelayMs,s)),await r(e)}catch(a){if(n=a,a instanceof Me){const c=a.status;if(c&&c>=400&&c<500){const u=(a==null?void 0:a.message)??"Unknown error";throw new yr(`Skipping retry for status ${c}: ${u}`,a)}}}const i=(n==null?void 0:n.message)??"Unknown error";throw new Ir(`Failed to deliver event after ${this.maxRetries} retries: ${i}`,n)}flush(){}};d(oe,"TAG","RetryMiddleware");let Be=oe;function Yr(t,e){return t*2**e}class Kr{constructor(e){d(this,"uuidProvider");this.uuidProvider=e}createGlobalId(e){if(typeof e=="number"&&this.isUint64(e.toString()))return{lowid:e.toString(),highid:void 0};if(typeof e=="string"){if(this.isUint64(e))return{lowid:e,highid:void 0};if(this.isUuid(e))return this.convertUuidToGlobalId(e)}}isUint64(e){if(!/^\d+$/.test(e))return!1;const r=BigInt(0),n=BigInt("18446744073709551615"),o=BigInt(e);return o>=r&&o<=n}isUuid(e){return/^(?:[a-f0-9]{32}|[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})$/i.test(e.trim())}convertUuidToGlobalId(e){const r=e==null?void 0:e.trim();if(!r)return;const n=this.uuidProvider.parse(r),o=new Uint8Array(n);let i=BigInt(0);for(let a=0;a<8;a++)i=i<<BigInt(8)|BigInt(o[a]);let s=BigInt(0);for(let a=8;a<16;a++)s=s<<BigInt(8)|BigInt(o[a]);return{lowid:s.toString(),highid:i.toString()}}}var X;(function(t){t.EventTypeIdentifier="@type";function e(r,n){const o={...n};return delete o[t.EventTypeIdentifier],{...r,timestamp:new Date().toISOString(),payload:{...o,[t.EventTypeIdentifier]:`type.googleapis.com/${n[t.EventTypeIdentifier]}`}}}t.createEnvelope=e})(X||(X={}));const Wr=se(),Xr=()=>{const t=Wr.APP_ENV==="production";return new br({endpoint:t?"origin":"development",middleware:[new xe({maxQueueSize:10}),new Be]})},Qr=Xr();class Zr{parse(e,r,n){const o=Array.from(nr(e));if(r){const i=n||0;for(let s=0;s<o.length;s++)r[i+s]=o[s];return r}return o}v4(){return ve()}}const kt=new Zr,Jr=new Kr(kt);function _(t){return Jr.createGlobalId(t)}function zr(){return _(kt.v4())}const Pe={};function en({shopAccountUuid:t,email:e,multiTrackToken:r}){return{userIdentities:[{...Pe,shopUserId:{shopAccountUuid:_(t)}},...e?[{...Pe,emailAddress:{email:e}}]:[],...r?[{...Pe,MedusaJSYCookie:{MedusaJSY:r}}]:[]]}}function xt({canLoadAnalytics:t,canLoadMarketing:e,consentDate:r,dataSharingOptOut:n}){const o=Bt(r),i=[{consentType:"USER_CONSENT_TYPE_ESSENTIAL",consentTime:o},{consentType:"USER_CONSENT_TYPE_PREFERENCES",consentTime:o}];return t&&i.push({consentType:"USER_CONSENT_TYPE_ANALYTICS",consentTime:o}),e&&i.push({consentType:"USER_CONSENT_TYPE_MARKETING",consentTime:o}),n||i.push({consentType:"USER_CONSENT_TYPE_SALE_OF_DATA"}),i}function Bt(t){if(t)return new Date(parseInt(t,10)).toISOString()}function k(t,e){const{eventType:r,...n}=t;return X.createBuyerEvent({...n,actor:"ACTOR_BUYER",eventProducer:"EVENT_PRODUCER_RAW_SOURCE",buyer:en({shopAccountUuid:e.shopAccountUuid,email:e.email,multiTrackToken:e.multiTrackToken}),eventType:r,buyerConsents:xt(e),consentTimestamp:Bt(e.consentDate)})}const tn=new Set(["XXX","ALL","DZD","ARS","AUD","BSD","BHD","BDT","AMD","BBD","BMD","BTN","BOB","BWP","BZD","SBD","BND","MMK","BIF","KHR","CAD","CVE","KYD","LKR","CLP","CNY","COP","KMF","CRC","HRK","CUP","CYP","CZK","DKK","DOP","SVC","ETB","ERN","EEK","FKP","FJD","DJF","GMD","GHC","GIP","GTQ","GNF","GYD","HTG","HNL","HKD","HUF","ISK","INR","IDR","IRR","IQD","ILS","JMD","JPY","KZT","JOD","KES","KPW","KRW","KWD","KGS","LAK","LBP","LSL","LVL","LRD","LYD","LTL","MOP","MWK","MYR","MVR","MTL","MRO","MUR","MXN","MNT","MDL","MAD","OMR","NAD","NPR","ANG","AWG","VUV","NZD","NIO","NGN","NOK","PKR","PAB","PGK","PYG","PEN","PHP","QAR","RUB","RWF","SHP","STD","SAR","SCR","SLL","SGD","SKK","VND","SOS","ZAR","ZWD","SSP","SZL","SEK","CHF","SYP","THB","TOP","TTD","AED","TND","TMM","UGX","MKD","EGP","GBP","TZS","USD","UYU","UZS","VEB","WST","YER","ZMK","TWD","VED","VES","MRU","STN","CUC","ZWL","BYN","TMT","ZWR","GHS","VEF","SDG","RSD","ZWN","MZN","AZN","RON","TRY","XAF","XCD","XOF","XPF","XBA","XBB","XBC","XBD","XAU","XDR","XAG","XPT","XTS","XPD","ZMW","SRD","MGA","AFN","TJS","AOA","BYR","BGN","CDF","BAM","EUR","UAH","GEL","PLN","BRL","CLF","USDC"]);function st(t){if(tn.has(t))return t}function Ut({amount:t,currencyCode:e}){if(t<0)return{currencyCode:st(e)};const r=Math.floor(t),n=Math.floor(t*100-r*100);return{integerPart:r.toString(),fractionalPart:n,currencyCode:st(e)}}function Lt(t={}){return{price:t.price,compareAtPrice:t.compareAtPrice,quantityPriceBreaks:t.quantityPriceBreaks,quantityRule:t.quantityRule}}function jt({id:t,price:e}={}){return{id:_(t),price:e}}function je({id:t}={}){return{id:_(t)}}function Fe(t={}){return{product:t.product,variant:t.variant,quantity:t.quantity,productRef:t.productRef,variantRef:t.variantRef}}function x({brokerId:t,...e}={}){return{brokerId:_(t),...e}}function rn({id:t,shopId:e}){return{id:_(t),shopId:_(e)}}function it(t,e,r){return k({eventType:t,cartSession:e.cartId?{sourceId:e.cartId}:void 0,checkout:{checkoutType:e.checkoutType,checkoutId:e.checkoutId},products:e.products.map(n=>Fe({product:je({id:n.productId}),quantity:n.quantity,variant:jt({id:n.productVariantId,price:Lt({price:Ut({amount:n.variantPrice,currencyCode:n.currency})})})})),order:e.MedusaJSOrderId?rn({id:e.MedusaJSOrderId,shopId:e.MedusaJSShopId}):void 0,shop:x({brokerId:e.brokerId}),shopId:_(e.MedusaJSShopId)},r)}function at(t,e,r){return k({eventType:t,cartSession:e.cartId?{sourceId:e.cartId}:void 0,products:[Fe({quantity:e.quantity>=0?e.quantity:void 0,product:je({id:e.productId}),variant:jt({id:e.productVariantId,price:Lt({price:Ut({amount:e.variantPrice,currencyCode:e.currency})})})})],shop:x({brokerId:e.brokerId}),shopId:_(e.MedusaJSShopId)},r)}function nn({entityId:t,entityType:e,isReferral:r,...n}){return{entityId:t,entityType:e,isReferral:r,...n}}function ut(t,e,r){return k({eventType:t,shopId:_(e.MedusaJSShopId),shop:x({brokerId:e.brokerId,entityEvent:{entity:{entityId:e.entityId,entityType:e.entityType,xPos:e.xPos,yPos:e.yPos,absoluteYPos:e.absoluteYPos,displayOptions:e.displayOptions,mediaUrl:e.mediaUrl,impressionId:e.impressionId,isReferral:e.isReferral},section:e.sectionId?{sectionId:e.sectionId,subSectionId:e.subSectionId,sectionYPos:e.sectionYPos,sectionType:e.sectionFormat,subjectId:e.subjectId,subjectType:e.subjectType,candidate:e.candidateId||e.candidateRank?{id:e.candidateId,rank:e.candidateRank}:void 0}:void 0,contentPersonalizationAlgorithm:e.algorithmId||e.algorithmVersion||e.algorithmScore||e.algorithmInferenceId?{id:e.algorithmId,score:e.algorithmScore,version:e.algorithmVersion,inferenceId:e.algorithmInferenceId}:void 0,feedAlgorithm:e.feedAlgorithmId||e.feedAlgorithmVersion||e.feedAlgorithmScore?{id:e.feedAlgorithmId,score:e.feedAlgorithmScore,version:e.feedAlgorithmVersion}:void 0,feedId:e.feedId,adResponseId:e.adResponseId,adCampaignId:e.campaignId}}),products:e.productIds?e.productIds.map(n=>Fe({product:je({id:n})})):void 0},r)}const on=t=>{switch(t){case"courier_link":return"OPENED_BY_COURIER_LINK";case"link":return"OPENED_BY_LINK";default:return"OPENED_BY_UNSPECIFIED"}},sn=t=>{switch(t){case"REPORT":return"HIDE_ACTION_REPORT";case"NOT_INTERESTED":return"HIDE_ACTION_NOT_INTERESTED";case"UNHIDE":return"HIDE_ACTION_UNHIDE";default:return"HIDE_ACTION_UNSPECIFIED"}},an=t=>{switch(t){case C.COUNTERFEIT:return"REPORT_REASON_COUNTERFEIT";case C.HATEFUL_OFFENSIVE:return"REPORT_REASON_HATEFUL_OFFENSIVE";case C.ILLICIT:return"REPORT_REASON_ILLICIT";case C.INAPPROPRIATE_OTHER:return"REPORT_REASON_INAPPROPRIATE_OTHER";case C.MATURE:return"REPORT_REASON_MATURE";case C.MISLEADING_OTHER:return"REPORT_REASON_MISLEADING_OTHER";case C.MISSING_INFO:return"REPORT_REASON_MISSING_INFO";case C.OTHER:return"REPORT_REASON_OTHER";case C.VIOLENT:return"REPORT_REASON_VIOLENT";case C.WRONG_INFO:return"REPORT_REASON_WRONG_INFO";default:return"REPORT_REASON_UNSPECIFIED"}};function un(t){switch(t){case U.DISLIKE_CATEGORY:return"HIDE_REASON_DISLIKE_CATEGORY";case U.DISLIKE_MERCHANT:return"HIDE_REASON_DISLIKE_MERCHANT";case U.DISLIKE_USER:return"HIDE_REASON_DISLIKE_USER";case U.EXPENSIVE:return"HIDE_REASON_EXPENSIVE";case U.GENERIC:return"HIDE_REASON_GENERIC";default:return"HIDE_REASON_UNSPECIFIED"}}const ct={appOpened:(t,e)=>{const r=t.sessionToken??e.sessionToken;return k({eventType:"BUYER_EVENT_TYPE_APP_OPENED",utm:{source:t.utmSource,medium:t.utmMedium,campaign:t.utmCampaign,content:t.utmContent,term:t.utmId},shopId:_(t.publisherShopId),shop:x({appOpenedEvent:{sessionToken:r,openedBy:on(t.openedBy),openedByValue:e.href,sharedLinkAlias:t.sharedLinkAlias,metaCampaignIds:t.metaCampaignIds}})},e)},checkoutCompleted:(t,e)=>it("BUYER_EVENT_TYPE_CHECKOUT_COMPLETED",t,e),checkoutStarted:(t,e)=>it("BUYER_EVENT_TYPE_CHECKOUT_STARTED",t,e),entityClicked:(t,e)=>ut("BUYER_EVENT_TYPE_ENTITY_CLICKED",t,e),entityImpression:(t,e)=>ut("BUYER_EVENT_TYPE_ENTITY_IMPRESSION",t,e),hideRecommendation:(t,e)=>k({eventType:"BUYER_EVENT_TYPE_HIDE_RECOMMENDATION",shop:x({hideRecommendationEvent:{hideAction:sn(t.hideAction),entity:nn({entityId:t.entityId,entityType:t.entityType}),hideReason:t.hideReason?un(t.hideReason):void 0,reportReason:t.reportReason?an(t.reportReason):void 0}})},e),pageViewed:(t,e)=>k({eventType:"BUYER_EVENT_TYPE_PAGE_VIEWED",shop:x({pageViewedEvent:{previousPageViewToken:t.previousPageViewUuid,previousScreenName:t.previousPageType,previousScreenValue:t.previousPageValue}})},e),productAddedToCart:(t,e)=>at("BUYER_EVENT_TYPE_PRODUCT_ADDED_TO_CART",t,e),productFavoriteAction:(t,e)=>k({eventType:"BUYER_EVENT_TYPE_PRODUCT_FAVORITE_ACTION",shop:x({brokerId:t.brokerId,productFavoriteActionEvent:{favoriteAction:t.action,variantId:_(t.variantId),productId:_(t.productId),listIds:t.listIds}})},e),productRemovedFromCart:(t,e)=>at("BUYER_EVENT_TYPE_PRODUCT_REMOVED_FROM_CART",t,e),storeFollowAction:(t,e)=>k({eventType:"BUYER_EVENT_TYPE_STORE_FOLLOW_ACTION",shop:x({brokerId:t.brokerId,storeFollowEvent:{followAction:t.action}})},e)};function cn(){var r,n;const t=(r=window==null?void 0:window.screen)==null?void 0:r.width,e=(n=window==null?void 0:window.screen)==null?void 0:n.height;if(!(!t||!e))return t>e?"SCREEN_ORIENTATION_LANDSCAPE":"SCREEN_ORIENTATION_PORTRAIT"}function dn(t){return{message:{createdAt:new Date().toISOString(),id:zr()},tokens:{pageViewToken:t.pageViewUuid,sessionToken:t.sessionToken},browser:{referrer:document.referrer,href:t.href,screenWidth:window.screen.width,screenHeight:window.screen.height,screenOrientation:cn(),windowInnerWidth:window.innerWidth,windowInnerHeight:window.innerHeight,windowScrollX:Math.round(window.scrollX),windowScrollY:Math.round(window.scrollY),documentTitle:document.title,documentBodyHeight:document.body.scrollHeight,documentBodyWidth:document.body.scrollWidth},shopApp:{screenValue:t.pageValue},view:{name:t.pageType}}}function ln(t){return{clientSessionToken:t.sessionToken}}function fn(t){return{multiTrack:{token:t.multiTrackToken},shopAccount:{uuid:t.shopAccountUuid},type:"USER_TYPE_BUYER"}}function hn(){let t=[],e=!1,r={};const n=u=>{e=u,u&&t.length>0&&i()},o=u=>{r=u},i=()=>{const u=[...t];t=[],u.forEach(({type:l,event:f,context:g})=>{const p={...g,...r};s(l,f,p)})},s=(u,l,f)=>{try{const g=ct[u],p=g(l,f),E=X.createBuyerEvent(p),y=X.createEnvelope({eventClass:"EVENT_CLASS_EVENT",severity:"EVENT_SEVERITY_UNSPECIFIED",source:"EVENT_APP_SHOP_WEB",dataOriginator:"DATA_ORIGINATOR_SHOPIFY",client:dn(f),user:fn(f),userConsents:xt(f),session:ln(f)},E);return Qr.produceEvent(y)}catch(g){Y.notify(new Error("Error sending buyer event"),{metadata:{error:g,eventType:u}})}},a={},c=u=>(l,f)=>{if(!(typeof window>"u")){if(!e){t.push({type:u,event:l,context:f});return}s(u,l,f)}};for(const u in ct)a[u]=c(u);return{events:a,setReady:n,setGlobalContext:o}}const te=hn(),pn={sessionToken:void 0,multiTrackToken:void 0,canLoadMarketing:!1,consentDate:void 0,canLoadAnalytics:!1,dataSharingOptOut:!0,shopAccountUuid:void 0,email:void 0},Ft=R.createContext(pn);function yo({children:t}){const{consentState:e,sessionToken:r,multiTrackToken:n,canLoadAnalytics:o,canLoadMarketing:i}=Et(),{currentUser:s,userPrivacySettings:a}=gt(),c=R.useMemo(()=>({sessionToken:r,multiTrackToken:n,canLoadAnalytics:o??!1,canLoadMarketing:i??!1,consentDate:e==null?void 0:e.date,dataSharingOptOut:(a==null?void 0:a.dataSharingOptOut)??!0,shopAccountUuid:(s==null?void 0:s.shopAccountUuid)??void 0,email:(s==null?void 0:s.email)??void 0}),[r,n,s==null?void 0:s.shopAccountUuid,s==null?void 0:s.email,o,i,e==null?void 0:e.date,a==null?void 0:a.dataSharingOptOut]);return R.useEffect(()=>{te.setGlobalContext(c)},[c]),R.useEffect(()=>{te.setReady(!!(o&&r&&n))},[o,r,n]),Tt.jsx(Ft.Provider,{value:c,children:t})}function gn(){return R.useContext(Ft)}function En(){const t=Jt(),{sessionToken:e,multiTrackToken:r,canLoadAnalytics:n,canLoadMarketing:o,consentDate:i,dataSharingOptOut:s,shopAccountUuid:a,email:c}=gn(),u=R.useMemo(()=>`${At()}${t.pathname}${t.search??""}${t.hash??""}`,[t.pathname,t.search,t.hash]);return R.useMemo(()=>{const l=g=>{const p=Ce==null?void 0:Ce();return{sessionToken:e,multiTrackToken:r,canLoadAnalytics:n,canLoadMarketing:o,consentDate:i,dataSharingOptOut:s,shopAccountUuid:a,email:c,pageType:p==null?void 0:p.pageType,pageValue:p==null?void 0:p.pageValue,pageViewUuid:p==null?void 0:p.pageViewUuid,href:u,...g}},f={};for(const g in te.events)f[g]=(p,E)=>{const y=te.events[g];typeof y=="function"&&y(p,l(E))};return f},[e,r,o,n,i,s,a,c,u])}function mn(t){const e=t?Number(t):void 0;let r;return typeof e=="number"&&isNaN(e)?Y.notify(`String can't be parsed to a number: ${t}`):r=e,r}const Tn={skipNavigation:!1,skipMonorailCookies:!1},In={skipNavigation:!0,skipMonorailCookies:!0};function yn(){const{pageType:t}=It();switch(t){case mt.ShopCashOffersCompact:return In;default:return Tn}}const Oo=t=>typeof t=="string"&&t.length>1,On=(t,e)=>t&&e?{clientCookie:t,sessionCookie:e}:(t||Ge(qe.MissingMedusaJSYCookieCount),e||Ge(qe.MissingMedusaJSSCookieCount),{clientCookie:"",sessionCookie:""});var Sn=typeof global=="object"&&global&&global.Object===Object&&global,Rn=typeof self=="object"&&self&&self.Object===Object&&self,Vt=Sn||Rn||Function("return this")(),re=Vt.Symbol,Gt=Object.prototype,_n=Gt.hasOwnProperty,bn=Gt.toString,H=re?re.toStringTag:void 0;function wn(t){var e=_n.call(t,H),r=t[H];try{t[H]=void 0;var n=!0}catch{}var o=bn.call(t);return n&&(e?t[H]=r:delete t[H]),o}var Pn=Object.prototype,An=Pn.toString;function Cn(t){return An.call(t)}var vn="[object Null]",Nn="[object Undefined]",dt=re?re.toStringTag:void 0;function Mn(t){return t==null?t===void 0?Nn:vn:dt&&dt in Object(t)?wn(t):Cn(t)}function Dn(t){return t!=null&&typeof t=="object"}var kn="[object Symbol]";function xn(t){return typeof t=="symbol"||Dn(t)&&Mn(t)==kn}var Bn=/\s/;function Un(t){for(var e=t.length;e--&&Bn.test(t.charAt(e)););return e}var Ln=/^\s+/;function jn(t){return t&&t.slice(0,Un(t)+1).replace(Ln,"")}function Ue(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var lt=NaN,Fn=/^[-+]0x[0-9a-f]+$/i,Vn=/^0b[01]+$/i,Gn=/^0o[0-7]+$/i,qn=parseInt;function ft(t){if(typeof t=="number")return t;if(xn(t))return lt;if(Ue(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Ue(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=jn(t);var r=Vn.test(t);return r||Gn.test(t)?qn(t.slice(2),r?2:8):Fn.test(t)?lt:+t}var Ae=function(){return Vt.Date.now()},$n="Expected a function",Hn=Math.max,Yn=Math.min;function Kn(t,e,r){var n,o,i,s,a,c,u=0,l=!1,f=!1,g=!0;if(typeof t!="function")throw new TypeError($n);e=ft(e)||0,Ue(r)&&(l=!!r.leading,f="maxWait"in r,i=f?Hn(ft(r.maxWait)||0,e):i,g="trailing"in r?!!r.trailing:g);function p(h){var I=n,S=o;return n=o=void 0,u=h,s=t.apply(S,I),s}function E(h){return u=h,a=setTimeout(N,e),l?p(h):s}function y(h){var I=h-c,S=h-u,A=e-I;return f?Yn(A,i-S):A}function b(h){var I=h-c,S=h-u;return c===void 0||I>=e||I<0||f&&S>=i}function N(){var h=Ae();if(b(h))return w(h);a=setTimeout(N,y(h))}function w(h){return a=void 0,g&&n?p(h):(n=o=void 0,s)}function O(){a!==void 0&&clearTimeout(a),u=0,n=c=o=a=void 0}function M(){return a===void 0?s:w(Ae())}function P(){var h=Ae(),I=b(h);if(n=arguments,o=this,c=h,I){if(a===void 0)return E(c);if(f)return clearTimeout(a),a=setTimeout(N,e),p(c)}return a===void 0&&(a=setTimeout(N,e)),s}return P.cancel=O,P.flush=M,P}var Wn={};class Xn{constructor(e,r){this.flushed=!1,this.queue=[e],this._nextMiddleware=r,this._promise=new Promise((n,o)=>{this._resolveNextPromise=n,this._rejectNextPromise=o})}add(e){this.flushed||this.queue.push(e)}flush(){if(this.flushed===!0)return;const e={events:this.queue,metadata:{}};this._nextMiddleware(e).then(this._resolveNextPromise).catch(this._rejectNextPromise),this.flushed=!0}get promise(){return this._promise}}const Qn=200,Zn=600;class Jn{constructor(){this.state={type:"waiting"};const e=r=>{r.flush(),this.state={type:"waiting"}};this.scheduleFlush=Kn(e,Qn,{maxWait:Zn})}do(e,r){if(Rt(e)){if(this.state.type==="waiting"){const o=new Xn(e,r);this.state={type:"open",queue:o}}else this.state.queue.add(e);const n=this.state.queue.promise;return this.scheduleFlush(this.state.queue),n}else return r(e)}}class zn{do(e,r){return r(e)}}const ht=Wn,eo=ht.SIMULATED_NODE_ENV??ht.NODE_ENV,to=eo==="test"?zn:Jn,ro=[new to],no=L.createHttpProducer({production:!0,middleware:[...ro,new gr(10,200)]}),qt=R.createContext({monorail:void 0}),oo=()=>{const{monorail:t}=R.useContext(qt);if(t)return t;throw new Error("Expected a required instance of Monorail. Did you forget to add the MonorailProvider?")},So=({children:t})=>{const e=R.useMemo(()=>no,[]);return Tt.jsx(qt.Provider,{value:{monorail:e},children:t})};function so(t,e){return{...t,payload:{...t.payload,...e}}}const m={};function Ce(){return m}function Ro(){var w;const t=oo(),e=zt(),{pageType:r}=It(),{currentUser:n}=gt(),o=pt("root"),i=Et(),s=En(),a=i.isConsentRequired!==void 0,c=a?i.isConsentRequired:(o==null?void 0:o.isCookiesConsentRequired)??!1,u=a?((w=i.consentState)==null?void 0:w.consentedAnalytics)===er.Accepted:(o==null?void 0:o.hasConsentedAnalytics)??!1,l=c&&!u,{clientToken:f,sessionToken:g}=Er(),p=R.useMemo(()=>{var O;if(e)return(O=Object.values(e))==null?void 0:O[Object.values(e).length-1]},[e]),{skipMonorailCookies:E}=yn();let y="";const b=R.useCallback((O,M)=>{try{if(l)return;y=O.schemaId;const{clientCookie:P,sessionCookie:h}=E?{clientCookie:"",sessionCookie:""}:On(f,g);m.pageViewUuid||(m.pageViewUuid=ve());const I={platform:"web",locale:navigator.language,experimentFlags:"",userToken:P,webSessionToken:h,userId:mn(n==null?void 0:n.id),pageType:r,pageViewUuid:m.pageViewUuid,...O.payload.pageValue===void 0&&{pageValue:m.pageValue},...M},S=so(O,I);t.produce(S).then(null,A=>{if(A)throw A}).catch(A=>{A instanceof ie||Y.notify(A)})}catch(P){setTimeout(()=>{Y.notify(P,{metadata:{schemaId:y,sessionCookie:!!g,clientCookie:!!f}})},50)}},[t,n==null?void 0:n.id,r,E,l,f,g]),N=R.useCallback(({pathName:O,pageValue:M,...P})=>{try{const h=M??p;if(O===m.pathName&&r===m.pageType&&h===m.pageValue)return;const I=m.pathName===void 0&&m.pageViewUuid?m.pageViewUuid:ve(),S=I===m.pageViewUuid?void 0:m.pageViewUuid;b({schemaId:"shop_app_page_load/9.1",payload:{pageValue:h,previousPageViewUuid:S,previousPageType:m.pageType,previousPageValue:m.pageValue}},{pageViewUuid:I,...P}),s.pageViewed({previousPageType:m.pageType,previousPageValue:m.pageValue,previousPageViewUuid:S},{pageType:r,pageValue:h,pageViewUuid:I}),m.pathName=O,m.pageType=r,m.pageValue=h,m.pageViewUuid=I}catch(h){Y.notify(h)}},[b,r,p,s]);return{reportEvent:b,reportPageLoad:N}}export{rr as A,wr as B,So as C,yo as D,Io as E,To as F,mo as G,ie as M,re as S,C as U,Er as a,En as b,yn as c,Kn as d,It as e,Ue as f,At as g,Mn as h,Oo as i,Dn as j,Sn as k,oo as l,Dt as m,Dr as n,Nt as o,de as p,xr as q,Vt as r,mn as s,ft as t,Ro as u,xn as v,Mt as w,Mr as x,kr as y,U as z};
//# sourceMappingURL=useMonorail-J6WwGwSW.js.map
