import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{r as n,a as ve}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{u as Le}from"./bundle.esm-BR5thRy_.js";import{f as Be,e as we,g as ye,h as Fe}from"./FeedCard-TpcvKHB_.js";import{I as L}from"./Icon-Vc_yr2r6.js";import{I as B}from"./IconButton-D2NlWcx2.js";import{u as Pe}from"./NavigationUIStateProvider-DQZFh1H6.js";import{I as He,E as Ve}from"./types-aSuMwFxz.js";import{D as Ce,E as Ke,F as $e}from"./ConversationProvider-BNoOA22x.js";import{I as qe}from"./index-B71n1RID.js";import{S as We}from"./ShopSpinner-BY5XJj_u.js";import{S as Qe}from"./SideSheet-BksUlFJx.js";import{u as Ue}from"./useMutation-BEBlGsA2.js";import{B as fe}from"./Button-D4K8aSAG.js";import{D as Ge}from"./Dialog-C_RA0MsZ.js";import{T as F}from"./Text-BrMatKQv.js";import{i as M}from"./i18nConfig-CLr-UH7w.js";import{c as S}from"./cn-yu2yf51J.js";import{d as Xe,f as Je,u as Ye}from"./useMonorail-J6WwGwSW.js";import{u as P}from"./useTranslation-DjeLP5O7.js";import{m as ke,e as Se}from"./toFeedSection-HH8g53oo.js";import{F as Ze}from"./Feed-al0BGZ_b.js";import{u as et}from"./useFeedQuery-7eKv811Z.js";import{u as je}from"./useMediaQuery-bbysqcAD.js";import{B as Ie}from"./deviceUtils-BLIhItqY.js";import{u as tt,T as X,S as nt}from"./SearchSuggestions-C4Ac6HSg.js";import{P as R}from"./types-BLzQfJqq.js";import{u as st,U as at}from"./AuthenticationProvider-9RtBMSxF.js";import{i as rt,C as ot}from"./statsdClient-CCQ7Es9D.js";import{T as it}from"./StoreThemeProvider-jgugnGur.js";var lt="Expected a function";function ct(e,r,s){var a=!0,o=!0;if(typeof e!="function")throw new TypeError(lt);return Je(s)&&(a="leading"in s?!!s.leading:a,o="trailing"in s?!!s.trailing:o),Xe(e,r,{leading:a,maxWait:r,trailing:o})}const ln=[R.Home,R.Threads,R.ShopCashOffersCompact,R.FrameThread];var J=(e=>(e.Home="Home",e.Agent="Agent",e.Other="Other",e))(J||{}),H={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AgentDeleteConversation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"agentConversationDelete"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"conversationId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:180}};H.loc.source={body:`mutation AgentDeleteConversation($conversationId: ID!) {
  agentConversationDelete(conversationId: $conversationId) {
    conversationId
    userErrors {
      message
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function A(e,r){if(e.kind==="FragmentSpread")r.add(e.name.value);else if(e.kind==="VariableDefinition"){var s=e.type;s.kind==="NamedType"&&r.add(s.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(a){A(a,r)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(a){A(a,r)}),e.definitions&&e.definitions.forEach(function(a){A(a,r)})}var Y={};(function(){H.definitions.forEach(function(r){if(r.name){var s=new Set;A(r,s),Y[r.name.value]=s}})})();function pe(e,r){for(var s=0;s<e.definitions.length;s++){var a=e.definitions[s];if(a.name&&a.name.value==r)return a}}function dt(e,r){var s={kind:e.kind,definitions:[pe(e,r)]};e.hasOwnProperty("loc")&&(s.loc=e.loc);var a=Y[r]||new Set,o=new Set,i=new Set;for(a.forEach(function(u){i.add(u)});i.size>0;){var c=i;i=new Set,c.forEach(function(u){if(!o.has(u)){o.add(u);var l=Y[u]||new Set;l.forEach(function(v){i.add(v)})}})}return o.forEach(function(u){var l=pe(e,u);l&&s.definitions.push(l)}),s}dt(H,"AgentDeleteConversation");const ut=()=>{const[e]=Ue(H);return{deleteConversation:n.useCallback(async s=>{try{const{data:a,errors:o}=await e({variables:{conversationId:s}});return o||a!=null&&a.agentConversationDelete.userErrors&&(a==null?void 0:a.agentConversationDelete.userErrors.length)>0?{success:!1,errors:o||(a==null?void 0:a.agentConversationDelete.userErrors)}:{success:!0,data:a}}catch(a){return{success:!1,error:a}}},[e])}},mt=({open:e,conversationId:r,onClose:s,onConfirm:a})=>{const o=n.useCallback(()=>{s(),r&&a(r)},[r,s,a]),i=n.useMemo(()=>t.jsxs("div",{className:"flex h-full flex-col justify-between","data-testid":"conversation-delete-modal-content",children:[t.jsxs("div",{className:"flex flex-col gap-space-12",children:[t.jsx(F,{variant:"bodySmall",children:M.t("shopAI:ThreadList.Deletion.WarningMessage")}),t.jsx(F,{variant:"bodySmall",color:"subdued",children:M.t("shopAI:ThreadList.Deletion.WarningSubtext")})]}),t.jsxs("div",{className:"my-space-16 flex gap-space-8 pt-space-8",children:[t.jsx(fe,{variant:"outlined-light",size:"l",onClick:s,"data-testid":"conversation-delete-modal-cancel-button",className:"w-1/2",children:M.t("shopAI:ThreadList.Deletion.Cancel")}),t.jsx(fe,{variant:"dangerous",size:"l",onClick:o,"data-testid":"conversation-delete-modal-confirm-button",className:"w-1/2",children:M.t("shopAI:ThreadList.Deletion.Delete")})]})]}),[o,s]);return t.jsx(Ge,{open:e,title:"Delete Conversation",content:i,size:"s",onOpenChange:s,floating:!0,autoHeight:!0})},ht=({imageUrls:e})=>e.length>0?e.length===1?t.jsx("div",{"data-testid":"thread-product-images",className:"relative mr-space-16 shrink-0",children:t.jsx("img",{src:e[0],alt:"",className:"size-space-40 rounded-radius-12 object-cover shadow-xs",style:{border:"0.5px solid rgba(0, 43, 83, 0.10)"}})}):t.jsxs("div",{"data-testid":"thread-product-images",className:"relative mr-space-16 shrink-0",children:[e[1]&&t.jsx("img",{src:e[1],alt:"",className:"absolute left-space-8 z-10 size-space-40 rounded-radius-12 object-cover shadow-xs",style:{transform:"rotate(4deg)",border:"0.5px solid rgba(0, 43, 83, 0.10)"}}),e[0]&&t.jsx("img",{src:e[0],alt:"",className:"relative z-20 size-space-40 rounded-radius-12 object-cover shadow-xs",style:{transform:"rotate(-3deg)",border:"0.5px solid rgba(0, 43, 83, 0.10)"}})]}):t.jsx("div",{"data-testid":"thread-product-images",className:"relative mr-space-16 shrink-0",children:t.jsx("div",{className:"size-space-40 overflow-hidden rounded-radius-12",children:t.jsx("div",{className:"flex size-full items-center justify-center bg-bg-fill-secondary","data-testid":"image-placeholder",children:t.jsx(L,{name:"agent-entrypoint",className:"text-text-tertiary"})})})}),Ne=n.memo(({conversation:e,activeConversationId:r,handleConversationClick:s,handleConversationDelete:a})=>{var u;const o=n.useMemo(()=>{const l=e.lastMessageSentAt??e.lastUpdatedAt;return l?Be(Date.parse(l)):null},[e.lastMessageSentAt,e.lastUpdatedAt]),i=n.useCallback(()=>{s(e.id)},[e.id,s]),c=n.useCallback(l=>{l.stopPropagation(),a(e.id)},[e.id,a]);return t.jsxs("div",{"data-testid":"thread-list-item",className:S("flex items-center justify-between py-space-8 pl-space-16 pr-space-8","mb-space-4","md:shadow-none",r===e.id&&"bg-bg-overlay-fixed-dark-04","hover:bg-bg-overlay-fixed-dark-04","group","rounded-radius-12 md:shadow-none"),children:[t.jsxs("button",{onClick:i,"data-testid":"thread-list-item-button",className:"flex flex-1 cursor-pointer items-center gap-space-4 border-none bg-transparent p-0 text-left",children:[t.jsx(ht,{imageUrls:((u=e.recentProductImages)==null?void 0:u.map(l=>l.url))??[]}),t.jsxs("div",{className:"flex flex-1 flex-col gap-space-2",children:[t.jsx(F,{variant:"bodyTitleLarge",className:"capitalize",children:e.title||M.t("shopAI:AgentChatWindow.NewConversation")}),o&&t.jsx(F,{variant:"captionMedium",className:"text-text-tertiary",children:o})]})]}),t.jsx("div",{className:"w-space-32 shrink-0",children:t.jsx(B,{className:"opacity-0 md:group-hover:opacity-100",name:"cross",size:"m",onClick:l=>c(l),ariaLabel:M.t("shopAI:ChatHeader.Hide")})})]},e.id)});Ne.displayName="ThreadListItem";const ft=()=>Array.from({length:10}).map((e,r)=>t.jsx("div",{className:"animate-pulse px-space-16 py-space-12",children:t.jsxs("div",{className:"flex flex-col gap-space-4",children:[t.jsx("div",{className:"h-space-20 w-3/4 rounded-radius-4 bg-bg-fill-placeholder"}),t.jsx("div",{className:"h-space-12 w-1/3 rounded-radius-4 bg-bg-fill-placeholder"})]})},r)),pt=({isOpen:e,onClose:r})=>{const{t:s}=P("shopAI"),a=ve(),{conversations:o,loading:i,fetchMore:c,fetchingMore:u,hasNextPage:l,refetch:v,initialFetchComplete:m}=Ce(),{deleteConversation:p}=ut(),[f,b]=n.useState(null),{reportEvent:w}=Ye(),x=n.useRef(!1);n.useEffect(()=>{m&&x.current&&l&&c()},[m,c,l]);const y=n.useCallback(k=>{w({schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:Ve.Conversation,entityId:k,interactionType:He.AgentConversationClick,interactionValue:k}}),a(`/threads?conversationId=${Ke(k)}`),r()},[a,r,w]),d=n.useCallback(async k=>{(await p(k)).success&&await v()},[p,v]),C=n.useCallback(()=>b(null),[]),j=n.useMemo(()=>Object.values(o).map(k=>t.jsx(Ne,{conversation:{...k,__typename:"Conversation",agentMode:k.agentMode||$e.SHOP},activeConversationId:null,handleConversationClick:y,handleConversationDelete:()=>{b(k.id)}},k.id)),[o,y]),D=t.jsx(qe,{as:"div",onChange:k=>{x.current=k,k&&m&&l&&c()},threshold:.9,className:"px-space-16 py-space-8 text-center",children:u&&t.jsx("div",{className:"flex justify-center",children:t.jsx(We,{size:20,className:"stroke-text-brand"})})});return t.jsxs(t.Fragment,{children:[t.jsx(Qe,{isOpen:e,onClose:r,dock:"left",title:s("ThreadList.Title"),children:t.jsx("div",{className:"scrollbar-hide flex flex-1 flex-col overflow-y-auto",children:i&&!o.length?t.jsx(ft,{}):t.jsxs(t.Fragment,{children:[j,l&&D]})})}),t.jsx(mt,{conversationId:f,open:!!f,onClose:C,onConfirm:d})]})};function gt(e,r){var a,o,i;if(r<0)return null;let s=0;for(const c of e)if(ke(c)){const u=((o=(a=c.items)==null?void 0:a.nodes)==null?void 0:o.length)||0;if(r<s+u){const l=r-s;return((i=c.items.nodes)==null?void 0:i[l])||null}s+=u}else if(Se(c)&&c.item){if(r===s)return c.item;s+=1}return null}function bt(e){return e.reduce((r,s)=>{var a,o;return ke(s)?r+(((o=(a=s.items)==null?void 0:a.nodes)==null?void 0:o.length)||0):Se(s)?r+(s.item?1:0):r},0)}const Te=n.createContext({selectedIndex:-1,handleKeyDown:()=>{},setTotalItemCount:()=>{},resetSelectedIndex:()=>{},registerOnEnterPress:()=>{}});function xt({children:e}){const[r,s]=n.useState(-1),[a,o]=n.useState(0),i=n.useRef(null),c=n.useRef(-1);n.useEffect(()=>{c.current=r},[r]);const u=n.useCallback(m=>{var p;switch(m.key){case"ArrowDown":m.preventDefault(),s(f=>f<a-1?f+1:0);break;case"ArrowUp":m.preventDefault(),s(f=>f>0?f-1:a-1);break;case"Tab":m.shiftKey?(m.preventDefault(),s(f=>f>0?f-1:a-1)):(m.preventDefault(),s(f=>f<a-1?f+1:0));break;case"Escape":m.preventDefault(),s(-1);break;case"Enter":c.current>=0&&(m.preventDefault(),(p=i.current)==null||p.call(i));break}},[a]),l=n.useCallback(()=>{s(-1)},[]),v=n.useCallback(m=>{i.current=m},[]);return t.jsx(Te.Provider,{value:{selectedIndex:r,handleKeyDown:u,setTotalItemCount:o,resetSelectedIndex:l,registerOnEnterPress:v},children:e})}function Z(){const e=n.useContext(Te);if(!e)throw new Error("useKeyboardNavigation must be used within a KeyboardNavigationProvider");return e}const vt=()=>{},wt=({currentSearchTerm:e,onItemSelected:r})=>{const s=we(),{selectedIndex:a,setTotalItemCount:o,registerOnEnterPress:i,resetSelectedIndex:c}=Z(),{loading:u,sections:l,feedId:v}=et({id:"typeahead",args:JSON.stringify({query:e===""?null:e}),queryOptions:{fetchPolicy:"cache-and-network"}}),m=n.useRef([]),p=n.useMemo(()=>u?m.current:(m.current=l,l),[u,l]),f=n.useRef(void 0),b=n.useMemo(()=>u?f.current:(f.current=v,v),[u,v]),w=n.useMemo(()=>bt(p),[p]);n.useEffect(()=>{o(w)},[o,w]);const x=n.useCallback(()=>{if(a<0||!s)return;const d=gt(p,a);d&&(s.navigateByContentNode(d,{index:a,searchTerm:e}),r())},[a,p,s,r,e]),y=n.useCallback(()=>{c()},[c]);return n.useEffect(()=>(i(x),()=>i(null)),[i,x]),t.jsx("div",{"data-testid":"thread-content",className:S("overflow-hidden lg:relative lg:h-full lg:pb-space-0"),onMouseDown:d=>d.preventDefault(),onTouchMove:d=>d.stopPropagation(),children:t.jsx(Ze,{sections:p,loading:!1,feedId:b,hasMoreSections:!1,fetchMore:vt,selectedItemIndex:a,onHoverIndex:y,onMouseLeave:y})})},Ee=n.forwardRef(({currentSearchTerm:e,inputClassName:r,containerClassName:s,handleSubmitButtonClick:a,ariaLabel:o,forceDesktopLayout:i,searchMobileOpen:c,disableSuggestions:u,...l},v)=>{const{t:m}=P(),p=n.useRef(null),b=!je(`(min-width: ${Ie.lg}px)`),{handleKeyDown:w,resetSelectedIndex:x}=Z();n.useImperativeHandle(v,()=>({focus:()=>{var d;(d=p.current)==null||d.focus()},blur:()=>{var d;(d=p.current)==null||d.blur()}}));const y=n.useCallback(d=>{d.preventDefault(),a()},[a]);return t.jsx("form",{onSubmit:y,children:t.jsx("div",{className:S("flex flex-row gap-space-16",s),children:t.jsxs("div",{className:"relative flex w-full flex-col items-center lg:h-space-48",children:[t.jsx("input",{name:"search",ref:p,type:"search",role:"searchbox",autoComplete:"off",value:e,"data-testid":"search-input","aria-label":o,onKeyDown:w,...l,onBlur:d=>{var C;x(),(C=l.onBlur)==null||C.call(l,d)},onChange:d=>{var C;x(),(C=l.onChange)==null||C.call(l,d)},className:S("lg:bg-overlay-fixed-light-75 h-space-48 w-full bg-transparent px-space-10 py-space-4 text-text lg:rounded-radius-max","placeholder:text-text placeholder:opacity-60","lg:pl-space-20 lg:pr-space-48 lg:placeholder:text-center",!u&&"lg:focus:border lg:focus:border-border-secondary lg:focus:bg-bg-overlay-fixed-light-75 lg:focus:shadow-xs",b?"placeholder:text-left":"placeholder:text-center",r)}),t.jsx("div",{className:S("z-10 flex h-space-48 w-full justify-end p-space-4",i&&!c?"absolute right-0 w-space-48":"lg:absolute lg:right-0 lg:w-space-48"),children:t.jsxs("button",{"data-testid":"search-submit-button",className:"group flex size-space-40 items-center justify-center rounded-radius-max bg-bg-brand shadow-[0_4px_24px_0_rgba(69,36,219,0.34)] active:scale-95 lg:absolute lg:right-space-4",type:"submit","aria-label":m("SearchInput.Clear"),children:[t.jsx(L,{name:"arrow-right",className:S("hidden text-text-inverse group-hover:scale-105",i?"block":"lg:block"),size:"l"}),t.jsx(L,{name:"arrow-up",className:S("block text-text-inverse group-hover:scale-105",i?"hidden":"lg:hidden"),size:"l"})]})})]})})})});Ee.displayName="SearchBar";const yt=15,Ct=({currentSearchTerm:e,onItemSelected:r=()=>{},typeAheadSessionRef:s})=>{const a=we(),{selectedIndex:o,setTotalItemCount:i,registerOnEnterPress:c,resetSelectedIndex:u}=Z(),{searchTypeaheadResultsLoad:l}=ye(),v=n.useCallback(d=>{s!=null&&s.current&&l({sessionRef:s,results:d})},[l,s]),{predictions:m,loading:p}=tt({query:e,maxResults:yt,skip:!1,onResultsLoad:v}),f=n.useRef([]),b=n.useMemo(()=>p?f.current:(f.current=m,m),[p,m]),w=n.useMemo(()=>!e||!b.length&&!p?X.length:b.length,[e,b.length,p]);n.useEffect(()=>{i(w)},[i,w]);const x=n.useCallback((d,C)=>{a&&a.navigateByPrediction(d,{index:C,searchTerm:e}),r()},[a,r,e]),y=n.useCallback(()=>{if(o<0)return;let d;!e||!m.length&&!p?o<X.length&&(d={__typename:"SearchQueryPredictionBasic",query:X[o]}):o<m.length&&(d=m[o]),d&&x(d,o)},[o,e,m,p,x]);return n.useEffect(()=>(c(y),()=>c(null)),[c,y]),t.jsx("div",{"data-testid":"search-suggestions-content",className:S("lg:relative lg:h-full lg:pb-space-0"),onMouseDown:d=>d.preventDefault(),children:t.jsx(nt,{loading:p,history:[],predictions:m,onMouseLeave:()=>{u()},onHoverIndex:()=>{u()},selectedIndex:o,onRemoveRecent:()=>{},currentSearchTerm:e,onPredictionClick:x,onRecentItemClick:()=>{},isFullScreen:!1})})},kt=({onClick:e,className:r,"data-testid":s="thread-button"})=>{const{t:a}=P("shopAI"),{conversations:o,loading:i}=Ce();return i||o.length===0?null:t.jsx("div",{className:r,"data-testid":s,children:t.jsx(B,{name:"history",ariaLabel:a("ChatHeader.ThreadsPanelToggle"),size:"m",className:"border border-border p-space-12",variant:"outlined",onClick:e})})},St=typeof window>"u"?n.useEffect:n.useLayoutEffect,ge=()=>typeof window>"u"?[0,0]:window.visualViewport?[window.visualViewport.width,window.visualViewport.height]:[window.innerWidth,window.innerHeight],be=()=>typeof window>"u"?[0,0]:[window.innerWidth,window.innerHeight],jt=()=>{const[e,r]=n.useState(()=>ge()),[s,a]=n.useState(()=>be()),o=n.useCallback(()=>{const i=ge(),c=be();r(u=>u[0]===i[0]&&u[1]===i[1]?u:i),a(c)},[]);return St(o,[o]),n.useEffect(()=>{var u;if(typeof window>"u")return;let i=null;const c=()=>{o(),i!==null&&clearTimeout(i),i=setTimeout(o,500)};return window.addEventListener("resize",c,{passive:!0}),window.addEventListener("orientationchange",c,{passive:!0}),(u=window.visualViewport)==null||u.addEventListener("resize",c),()=>{var l;i!==null&&clearTimeout(i),window.removeEventListener("resize",c),window.removeEventListener("orientationchange",c),(l=window.visualViewport)==null||l.removeEventListener("resize",c)}},[o]),{width:e[0],height:e[1],screenWidth:s[0],screenHeight:s[1]}},It="_SearchBar_omjax_1",Nt={SearchBar:It},Tt=10,Et=90,Mt=125,xe=130,cn=n.forwardRef(function({dock:r="top",forceDesktopLayout:s=!1,surface:a=J.Other,value:o,disableSuggestions:i=!1,onSubmitOverride:c},u){const{t:l}=P(),v=ve(),{userAuthState:m}=st(),{setIsMobileSearchActive:p}=Pe(),f=n.useRef(null),b=n.useRef(null),w=n.useRef(null),[x,y]=n.useState(!1),[d,C]=n.useState(!1),[j,D]=n.useState(o||""),[k,O]=n.useState(!1),{height:E,screenHeight:ee}=jt(),{ref:te,height:ne}=Le(),I=m!==at.Anonymous,_=je(`(min-width: ${Ie.lg}px)`),N=_===void 0?!1:!_,g=N&&d,Me=N&&!d,z=s&&!d,{searchTypeaheadChange:se,searchTypeaheadSessionStart:ae,searchTypeaheadAction:V}=ye();n.useImperativeHandle(u,()=>({focus:()=>{var h;(h=f.current)==null||h.focus()},blur:()=>{var h;(h=f.current)==null||h.blur()}})),n.useEffect(()=>()=>{w.current&&clearTimeout(w.current)},[]),n.useEffect(()=>{p(g)},[g,p]);const re=n.useCallback(h=>{D(h.currentTarget.value),h.currentTarget.value&&b.current&&se({sessionRef:b})},[se]),K=n.useCallback(()=>{var h;D(""),(h=f.current)==null||h.blur()},[]),oe=n.useCallback(()=>{w.current&&clearTimeout(w.current),w.current=setTimeout(()=>y(!1),150)},[]),ie=n.useCallback(()=>{if(j.trim())if(rt(ot.OmniboxSubmit),b.current&&V&&V({sessionRef:b,queryString:j,selectedType:"query",selectedPosition:-1,selectedQuery:j}),c)c(j);else{const h=encodeURIComponent(j);v(I?`/threads?message=${h}`:`/search/results?query=${h}`)}},[j,v,I,c,V]),$=n.useCallback(()=>{O(!0)},[O]),De=n.useCallback(()=>{O(!1)},[O]),Oe=n.useCallback(()=>{C(!1),y(!1)},[]),le=n.useMemo(()=>ct((h,T,G)=>{_e(h>0),ze(h+T>=G-1)},100),[]),ce=n.useCallback(h=>{const T=h.currentTarget;le(T.scrollTop,T.clientHeight,T.scrollHeight)},[le]),de=n.useMemo(()=>t.jsx(Fe,{typeAheadSessionRef:b,children:I?t.jsx(wt,{currentSearchTerm:j,onItemSelected:K}):t.jsx(Ct,{currentSearchTerm:j,onItemSelected:K,typeAheadSessionRef:b})}),[I,j,K]),q=n.useMemo(()=>x&&!i,[x,i]);n.useEffect(()=>{D(o||"")},[o]),n.useEffect(()=>{C(!1),y(!1)},[N]),n.useEffect(()=>{var h;g&&((h=f.current)==null||h.focus())},[g]),n.useEffect(()=>{x?C(!0):N&&C(!1)},[x,N]),n.useEffect(()=>{const h=()=>{window.scrollTo(0,0)};return g?(document.body.classList.add("overflow-hidden","fixed","w-full"),document.body.style.setProperty("max-height",`${E}px`),document.body.style.setProperty("height",`${E}px`),window.addEventListener("scroll",h)):(document.body.classList.remove("overflow-hidden","fixed","w-full"),document.body.style.removeProperty("max-height"),window.removeEventListener("scroll",h)),()=>{document.body.classList.remove("overflow-hidden","fixed","w-full"),window.removeEventListener("scroll",h)}},[g,E]);const ue=n.useMemo(()=>{const h=S("bg-bg-fill lg:bottom-none lg:opacity-100 rounded-[32px]","lg:!bg-transparent lg:shadow-none lg:p-space-0 lg:inset-x-space-8 lg:block","p-space-8 shadow-m border border-bg-overlay-fixed-light-75",{block:g,"p-space-0 shadow-none":z,"hidden h-0 w-0":!s&&N&&!d}),T=Math.max(Et,ee-E+Tt);return t.jsx("div",{className:S(g&&"fixed inset-x-space-12 top-auto z-[60] opacity-0",g&&Nt.SearchBar),style:{bottom:g?`${T}px`:void 0},"data-search-mobile-state":d?"open":"closed",children:t.jsx(Ee,{ref:f,currentSearchTerm:j,handleSubmitButtonClick:ie,onChange:re,onFocus:()=>{y(!0),b.current=new it,ae({query:j,sessionRef:b})},onBlur:oe,"aria-label":l("Omnibox.OmniboxAriaLabel"),placeholder:x?"":l("Omnibox.Placeholder"),containerClassName:h,forceDesktopLayout:s,searchMobileOpen:d,disableSuggestions:i})})},[g,z,s,N,d,ee,E,j,ie,re,oe,x,i,ae,l]),[W,_e]=n.useState(!1),[Q,ze]=n.useState(!1),U=n.useMemo(()=>W&&!Q?"linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%)":W&&Q?"linear-gradient(to bottom, transparent 0%, black 10%, black 90%, black 100%)":"linear-gradient(to bottom, black 0%, black 100%)",[W,Q]),me=n.useMemo(()=>{const h=E+xe,T=Mt+xe,G=g&&I?64:20,he=ne??0,Re=g?"100%":0,Ae=q?he:0;return t.jsxs("div",{"data-testid":"typeahead-content-container",className:S("relative overflow-hidden bg-[rgba(255,255,255,0.9)] backdrop-blur-[10px] lg:bg-transparent lg:backdrop-blur-none",{"fixed inset-x-0 top-0 z-40 pt-space-8":g,"my-space-10":q&&he>0,"my-space-0":g}),style:{height:g?h:void 0,paddingBottom:g?T:void 0,paddingTop:g?G:void 0},children:[_&&I?t.jsx(kt,{"data-testid":"icon-button-threads-panel",className:"absolute right-space-8 top-space-0 z-40",onClick:$}):null,t.jsx("div",{"data-testid":"typeahead-content-scrollable-container",className:S("h-auto w-full lg:h-fit lg:max-h-[calc(45dvh-88px)]","scrollbar-hide overflow-y-auto overscroll-contain",{"transition-all duration-200 ease-in-out":_}),style:{height:N?Re:Ae,maskImage:U,WebkitMaskImage:U},onScroll:ce,children:t.jsx("div",{className:"h-auto min-h-0 w-full lg:h-fit lg:overflow-hidden",ref:te,children:de})})]})},[E,ne,g,q,_,I,$,N,U,ce,te,de]);return t.jsx(xt,{children:t.jsxs("div",{className:"relative",children:[t.jsxs(t.Fragment,{children:[g?t.jsxs(t.Fragment,{children:[I&&t.jsx(t.Fragment,{children:t.jsx(B,{name:"history",ariaLabel:l("Omnibox.OpenThreads"),size:"l",className:"fixed left-space-16 top-space-16 z-50 border border-border",variant:"outlined","data-testid":"search-mobile-thread-button",onClick:$})}),t.jsx(B,{name:"cross",ariaLabel:l("Omnibox.OpenThreads"),size:"l",className:"fixed right-space-16 top-space-16 z-50 border border-border",variant:"outlined","data-testid":"search-mobile-close-button",onClick:Oe})]}):null,t.jsx("div",{className:S("relative lg:block lg:h-[66px] lg:w-full",z&&"h-[66px]"),children:t.jsx("div",{"data-testid":"omnibox-container",className:S("outline-backdrop-blur-[20px] rounded-[32px] p-space-8 outline-4 outline-bg-overlay-fixed-light-20","lg:w-full lg:overflow-hidden lg:bg-[rgba(255,255,255,0.9)] ","lg:[box-shadow:0px_4px_24px_0_rgba(0,0,0,0.12),0_0_0_4.5px_rgba(0,0,0,0.04)]","lg:outline-backdrop-blur-[20px] lg:outline lg:outline-4 lg:outline-bg-overlay-fixed-light-20","lg:absolute lg:max-h-[45dvh] lg:backdrop-blur-lg",{"bg-[rgba(255,255,255,0.9)] [box-shadow:0px_4px_24px_0_rgba(0,0,0,0.12),0_0_0_4.5px_rgba(0,0,0,0.04)]":z,"lg:bottom-0":r==="bottom"}),children:r==="top"?t.jsxs(t.Fragment,{children:[ue,i?null:me]}):t.jsxs(t.Fragment,{children:[i?null:me,ue]})})})]}),Me&&a!==J.Home?t.jsx("button",{"data-testid":"search-button-mobile",onClick:()=>{C(!0)},className:S("border-[2px] border-bg-overlay-fixed-dark-04 shadow-l backdrop-blur-[4px]","flex size-space-48 border-spacing-space-2 items-center justify-center","fixed bottom-[86px] right-space-16 z-[100]","[box-shadow:inset_0_0_0_1.5px_rgba(255,255,255,1)]","rounded-radius-max bg-[rgba(255,255,255,0.9)]","active:scale-95"),children:t.jsx(L,{name:"search",className:"text-text-tertiary",size:"l"})}):null,I&&t.jsx(pt,{isOpen:k,onClose:De})]})})});export{mt as C,cn as O,Ne as T,J as a,ft as b,ln as o,ut as u};
//# sourceMappingURL=Omnibox-IvaUBNhZ.js.map
