import{j as i}from"./jsx-runtime-D_zvdyIk.js";import{f as N,g as V,a as M}from"./MoneyUtils-CzooDnh_.js";import{P as U}from"./PlaceholderText-7te30dxx.js";import{c as g}from"./cn-yu2yf51J.js";import{i as x}from"./i18nConfig-CLr-UH7w.js";import{T as G}from"./Text-BrMatKQv.js";import{u as W}from"./useTranslation-DjeLP5O7.js";import{h as q,c as H,g as J}from"./toFeedSection-HH8g53oo.js";import{l as K,m as Q,r as b,u as X,f as Y}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{u as k,L as E}from"./Link-CnJfyO2i.js";import{P as S}from"./ProductCardImage-D-YSW4cr.js";import{c as Z}from"./createProductUrl-D0TYWuIE.js";import{B as ee}from"./Badge-D9a9Zb-D.js";import{T as te}from"./TrackingPixel-D8humLZO.js";var I=(t=>(t.ORDER="ORDER",t.PRODUCT="PRODUCT",t))(I||{});const w={PRODUCT_CARD_IMAGE:"product-card-image",HEADER_WRAPPER:"header-wrapper"};var v=(t=>(t[t.Large=0]="Large",t[t.Small=1]="Small",t[t.CaptionBold=2]="CaptionBold",t[t.Caption=3]="Caption",t))(v||{});function ae(t){switch(t.format){case 0:return{className:"font-bodyTitleLarge text-bodyTitleLarge"};case 1:return{className:"font-bodySmall text-bodySmall"};case 2:return{className:"font-captionBold text-captionBold"};case 3:return{className:"font-caption text-caption"}}}const se=({price:t,originalPrice:e,format:r,isSoldOut:a=!1,className:n,loading:s=!1,hideOriginalPriceOnMobile:l=!1})=>{const c=e&&!a&&parseFloat(t.amount)<parseFloat(e.amount),f=c||a,o=c?e:t,u=c?N(t):null,y=ae({format:r}),d=N(o);return s?i.jsx(U,{className:"flex",text:d}):i.jsx("div",{"data-testid":"product-card-price",children:i.jsxs("span",{className:g("flex flex-row gap-space-4 text-text",y.className,n),children:[u&&i.jsx("span",{className:"text-text","data-testid":"salePrice",children:u}),o?i.jsx("span",{className:g(f&&"font-normal text-text-tertiary line-through",l&&u&&"hidden md:block"),"data-testid":"regularPrice","aria-label":x.t("ProductDetails.PriceAriaLabel"," {{price}}",{price:d}),children:d}):void 0,a&&i.jsx("span",{className:"text-text",children:x.t("ProductDetails.SoldOut")})]})})},je=({product:t,variant:e,hideOriginalPriceOnMobile:r=!1})=>{const a=(e==null?void 0:e.price)||t.price,n=(e==null?void 0:e.compareAtPrice)||t.originalPrice;return i.jsx(se,{price:a,originalPrice:n,format:v.CaptionBold,hideOriginalPriceOnMobile:r,className:"mt-space-2"})},De=({product:t,textVariant:e="caption"})=>{const{t:r}=W(),a=t.shop.name;return i.jsx(G,{variant:e,className:"line-clamp-1 text-text","aria-label":r("ProductCard.StoreTitleAriaLabel","{{store}}",{store:a}),children:a})};function re(t){return t!=null}function ie(t){return t.__typename==="AutomaticDiscount"}const oe=t=>t==null?void 0:t.filter(e=>ie(e)),ne=(t,e=I.PRODUCT)=>{const r=t.offers;if(!r)return;const a=oe(r);return a?a.find(s=>s.discountClass===e):void 0},Re=({product:t,showPrice:e=!1,showHiddenValueIncentives:r,isSingleMerchantSurface:a=!1,showCondensedShopCashVariant:n=!1})=>{var A,p;const{price:s,originalPrice:l,offers:c,shopCashIncentive:f}=t;if(!a&&!n&&!e&&q(f))return{badgeVariant:"cashBack",badgeText:x.t("ShopCash.ExclusiveOffers.OfferAvailable")};const o=H(f),u=N(s),y=N(s,V(s));if((!a||n)&&!e&&(o!=null&&o.cashback))return{badgeVariant:"cashBack",badgeText:x.t("ShopCash.CashBack.BadgeText",{percent:(A=o.cashback.ratePercentage)==null?void 0:A.toFixed()})};if(o!=null&&o.boosted&&n&&!e)return{badgeVariant:"multiplierFilled",badgeText:y};const d=(p=o==null?void 0:o.boosted)==null?void 0:p.boostedCash;if(o!=null&&o.boosted&&re(d)&&!a&&!e){const h=N(d,V(d)),{offerText:m,accessibilityLabel:C}=J({formattedBoostedCash:h,cashType:o.boosted.cashType});return{badgeVariant:"multiplierFilled",badgeText:m,badgeTextAccessibilityLabel:C}}if(c&&c.length>0){const h={badgeVariant:"priceFilled",badgeText:u,badgeIconAccessibilityLabel:u},m={badgeVariant:"discountFilled",badgeText:x.t("ProductCard.Badges.extraSavings")};if(!a||ne(t,I.PRODUCT))return e?h:m}const T=M({price:s,originalPrice:l,formatAsPositive:!0});return T?{badgeVariant:e?"priceFilled":"saleFilled",badgeText:e?u:x.t("ProductCard.Badges.percentOff",{percentageDiscount:T}),badgeIconAccessibilityLabel:e?u:x.t("ProductCard.Badges.percentDiscountIconA11yLabel")}:e?{badgeVariant:"priceFilled",badgeText:u,badgeIconAccessibilityLabel:u}:null};function ce({product:t,variant:e}){var r,a;if(e){if("image"in e)return e.image;if("variantImage"in e)return(r=e.variantImage)==null?void 0:r.image}return(a=t.images)==null?void 0:a[0]}const le=({productId:t,link:e})=>{const r=k(),a=K(),n=Q(e),[s]=b.useState(r&&n&&a==="POP"),l=b.useRef(null);return b.useEffect(()=>{var o;if(!r||!s)return;document.documentElement.classList.add("back-transition");const c=`${w.PRODUCT_CARD_IMAGE}-${t}`;document.querySelectorAll(`[style*="${c}"]`).length>0||(o=l.current)==null||o.style.setProperty("view-transition-name",c)},[t,r,a,s]),b.useEffect(()=>{var c;r&&!n&&s&&((c=l.current)==null||c.style.removeProperty("view-transition-name"),document.documentElement.classList.remove("back-transition"))},[n,s,r]),{productViewTransitionRef:l}};function de(t){const n=t.toLowerCase().trim().replace(/['′'`´]/g,"").replace(/[^a-z0-9\s-]/g," ").replace(/\s+/g," ").trim().split(" ").filter(l=>l.length>0).slice(0,13);let s=n.join("-");if(s.length>80){s="";for(const l of n){const c=s?`${s}-${l}`:l;if(c.length<=80)s=c;else{!s&&l.length>80&&(s=l.slice(0,80));break}}}return s=s.replace(/-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),s}const Ie=({adjustProductImageAspectRatio:t,product:e,variant:r,onClick:a,onImpression:n,lazy:s,imageBottomRightActions:l,imageBottomLeftActions:c,imageTopLeftActions:f,imageTopRightActions:o,impressionThreshold:u,isMerchantReferrer:y,badge:d,navigateToPDP:T=!0,forceHideBadge:A,hideActionUntilHover:p=!1,appendFromShopUrlParam:h=!0,children:m,fetchPriority:C})=>{const[_]=X(),{isBot:$}=Y("root")||{},P=Z({productId:e.id,variantId:r==null?void 0:r.id,isMerchantReferrer:h&&!$?y||_.get("fromShop")==="true":!1,slug:e.slug?e.slug:de(e.title)}),z=d==null?void 0:d.badgeVariant,j="hidden opacity-0 transition group-hover:opacity-100 md:flex",L=b.useMemo(()=>ce({product:e,variant:r}),[e,r]),B=k(),{productViewTransitionRef:D}=le({productId:e.id,link:P}),R=b.useCallback(()=>{var O;B&&D.current&&((O=D.current)==null||O.style.setProperty("view-transition-name",`${w.PRODUCT_CARD_IMAGE}-${e.id}`)),a==null||a()},[e.id,B,a,D]),F=b.useMemo(()=>m?T?i.jsx(E,{"data-testid":"product-link-test-id",to:P,onClick:R,className:"flex flex-col pl-space-4 leading-4",prefetch:"intent","aria-label":e.title,children:m}):i.jsx("button",{className:"flex flex-col gap-space-2 pl-space-4 text-left",onClick:a,children:m}):null,[m,R,P,T,a,e.title]);return i.jsx(te,{onImpression:n,threshold:u,triggerOnce:!0,children:i.jsxs("div",{className:"group flex flex-col gap-space-8","data-testid":"product-card",children:[i.jsxs("div",{className:"relative","aria-labelledby":`product-card-image-${e.id}`,children:[i.jsx("div",{ref:D,style:{viewTransitionClass:"product-image"},className:"light flex",children:T?i.jsx(E,{id:`product-card-image-${e.id}`,"data-testid":"product-link-test-id",to:P,onClick:R,"aria-label":e.title,className:"w-full",children:i.jsx(S,{adjustProductImageAspectRatio:t,productTitle:e.title,image:L,lazy:s,productId:e.id,fetchPriority:C})}):i.jsx("button",{className:"w-full appearance-none","data-testid":"product-image-button",onClick:R,children:i.jsx(S,{adjustProductImageAspectRatio:t,productTitle:e.title,image:L,lazy:s,productId:e.id,fetchPriority:C})})}),i.jsx("div",{className:g("absolute left-space-12 top-space-12 z-[1]"),children:d&&!A?i.jsx(ee,{variant:d.badgeVariant,text:d.badgeText,iconAccessibilityLabel:d.badgeIconAccessibilityLabel,testID:z}):null}),i.jsx("div",{className:g("absolute left-space-12 top-space-12 z-[1]",p&&j),children:f}),i.jsx("div",{className:g("absolute right-space-12 top-space-12 z-[3]",p&&j),children:o}),i.jsx("div",{className:g("absolute bottom-space-12 right-space-12 z-[1] ",p&&j),children:l}),i.jsx("div",{className:g("absolute bottom-space-12 left-space-12 z-[1] ",p&&j),children:c})]}),F]})})};export{Ie as P,w as V,De as a,je as b,se as c,v as d,de as e,ce as f,Re as g};
//# sourceMappingURL=ProductCard-Dp2OWc-v.js.map
