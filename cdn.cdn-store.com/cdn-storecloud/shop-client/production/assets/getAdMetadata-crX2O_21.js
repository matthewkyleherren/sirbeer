import{r as s}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{j as H}from"./jsx-runtime-D_zvdyIk.js";import{m as $,o as y,p as A}from"./toFeedSection-HH8g53oo.js";import{u as M}from"./ConversationProvider-BNoOA22x.js";import{u as S}from"./useMonorail-J6WwGwSW.js";import{a as F}from"./useTriggerLogInWithShop-D9VKR_6P.js";import{d as T}from"./FilterUtils-8PUBFIQ_.js";let b={};const V="shop_app_entity_recommendation_impressions/6.11",N=()=>{const{reportEvent:e}=S(),i=(o,n)=>{b[o]||(e(n),b[o]=!0)};return{reportEventOnce:i,reportImpressionEventOnce:o=>{const n=`shop_app_entity_recommendation_impressions_${o.entityType}_${o.entityId}`;i(n,{schemaId:V,payload:o})}}},x=s.createContext({trackingValues:{sectionId:"",subject:void 0,sectionYPos:-1,sectionFormat:"",metadata:{},sectionDisplayOptions:void 0,pageInfo:void 0,backgroundColorHsl:void 0},displayHints:{fitToScale:!1,experimentalOptions:[]},sectionGlobalStartIndex:0}),w=()=>s.useContext(x),J=({section:e,sectionIndex:i,sectionGlobalStartIndex:a=0,children:o})=>{var m;const n=M(),p=s.useMemo(()=>{var t,r,l;return{sectionId:e.id,subject:e.subject&&A(e.subject)?e.subject:void 0,metadata:e.metadata,sectionYPos:e.yPos,sectionFormat:e.__typename,sectionDisplayOptions:(t=e.displayHints)==null?void 0:t.options,pageInfo:$(e)||y(e)?(r=e.items)==null?void 0:r.pageInfo:void 0,backgroundColorHsl:(l=e.displayHints)==null?void 0:l.backgroundColorHsl}},[e]),u=s.useMemo(()=>!!(y(e)&&n),[e,n]),c=s.useMemo(()=>{var t;return{trackingValues:p,displayHints:{fitToScale:u,experimentalOptions:((t=e.displayHints)==null?void 0:t.experimentalOptions)||[]},sectionIndex:i,sectionGlobalStartIndex:a}},[p,u,(m=e.displayHints)==null?void 0:m.experimentalOptions,i,a]);return H.jsx(x.Provider,{value:c,children:o})},Y=s.createContext({railResponseId:void 0,checkoutShopId:void 0,checkoutToken:void 0,orderId:void 0,placement:void 0,preview:!1});function k(e){return T(e)&&Number(e)>0}function Q(){const{reportEvent:e}=S(),{reportEventOnce:i}=N(),{railResponseId:a,checkoutShopId:o,checkoutToken:n,orderId:p,placement:u,preview:c}=s.useContext(Y),{trackingValues:{sectionYPos:m,sectionId:t}}=w(),{availableShopCashBalance:r}=F(),l=s.useCallback(({adResponseId:_,campaignCountryCode:h,adType:v,brokerId:f,campaignId:I,sectionId:O,yPos:g,xPos:P,cacheKeySuffix:j=""})=>{if(!_||c)return;const d={adResponseId:_,buyerShopCashCurrencyCode:r==null?void 0:r.currencyCode,campaignCountryCode:h??void 0,adType:v,brokerId:f,campaignId:I??void 0,sectionYPos:m,sectionId:O??t,xPos:P,yPos:g,publisherShopId:k(o)?Number(o):void 0,railResponseId:a,checkoutToken:n,orderId:p,pageValue:u},E=`${d.adResponseId}_${d.xPos}_${d.yPos}_${d.sectionId}_${d.sectionYPos}`;i(`shop_ad_impression_event_instance_${E}_${j}`,{schemaId:"shop_ads_ad_impression/1.7",payload:d})},[r==null?void 0:r.currencyCode,o,n,p,u,c,a,m,t,i]),C=s.useCallback(({adResponseId:_,adType:h,brokerId:v,campaignId:f,sectionId:I})=>{_&&(c||e({schemaId:"shop_ads_ad_click/1.4",payload:{adResponseId:_,adType:h,brokerId:v,campaignId:f??void 0,publisherShopId:k(o)?Number(o):void 0,sectionId:I??t}}))},[o,c,t,e]);return s.useMemo(()=>({shopAdOnPress:C,shopAdOnView:l}),[l,C])}function U(e){switch(e==null?void 0:e.__typename){case"ShopCashOffer":case"FlatAmountCashbackOffer":case"SponsoredAd":return e.adMetadata;case"ShopCashCashbackIncentive":return e.adMetadata??null;case void 0:case"":return null}}export{Y as C,J as F,Q as a,w as b,U as g,k as i,N as u};
//# sourceMappingURL=getAdMetadata-crX2O_21.js.map
