import{j as g}from"./jsx-runtime-D_zvdyIk.js";import{r as p}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{E as h,I as G}from"./types-aSuMwFxz.js";import{u as U,d as te,U as L}from"./AuthenticationProvider-9RtBMSxF.js";import{u as re,S as oe}from"./useTriggerLogInWithShop-D9VKR_6P.js";import{L as C}from"./statsdClient-CCQ7Es9D.js";import{i as B}from"./isLocalStorageAvailable-dH0-gchv.js";import{u as H}from"./useMutation-BEBlGsA2.js";import{u as W}from"./ConversationProvider-BNoOA22x.js";import{u as ae}from"./useActions-CMwTuc_r.js";import{u as se,a as de,g as Q}from"./getAdMetadata-crX2O_21.js";import{u as X,b as Y,s as b}from"./useMonorail-J6WwGwSW.js";import{u as ce}from"./Toast-Bb3RYazJ.js";import{u as Z}from"./useTranslation-DjeLP5O7.js";import{I as le}from"./IconButton-D2NlWcx2.js";import{T as z}from"./Text-BrMatKQv.js";import{c as ue}from"./cn-yu2yf51J.js";var O={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"FavoriteAdd"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"variantId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"brokerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productListAddItem"},arguments:[{kind:"Argument",name:{kind:"Name",value:"listId"},value:{kind:"NullValue"}},{kind:"Argument",name:{kind:"Name",value:"variantId"},value:{kind:"Variable",name:{kind:"Name",value:"variantId"}}},{kind:"Argument",name:{kind:"Name",value:"brokerId"},value:{kind:"Variable",name:{kind:"Name",value:"brokerId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"field"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"productListItem"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"variant"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:264}};O.loc.source={body:`mutation FavoriteAdd($variantId: ID!, $brokerId: ID!) {
  productListAddItem(listId: null, variantId: $variantId, brokerId: $brokerId) {
    userErrors {
      field
      message
    }
    productListItem {
      id
      variant {
        id
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function w(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var i=e.type;i.kind==="NamedType"&&n.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(t){w(t,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(t){w(t,n)}),e.definitions&&e.definitions.forEach(function(t){w(t,n)})}var E={};(function(){O.definitions.forEach(function(n){if(n.name){var i=new Set;w(n,i),E[n.name.value]=i}})})();function J(e,n){for(var i=0;i<e.definitions.length;i++){var t=e.definitions[i];if(t.name&&t.name.value==n)return t}}function me(e,n){var i={kind:e.kind,definitions:[J(e,n)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var t=E[n]||new Set,a=new Set,s=new Set;for(t.forEach(function(c){s.add(c)});s.size>0;){var f=s;s=new Set,f.forEach(function(c){if(!a.has(c)){a.add(c);var u=E[c]||new Set;u.forEach(function(v){s.add(v)})}})}return a.forEach(function(c){var u=J(e,c);u&&i.definitions.push(u)}),i}me(O,"FavoriteAdd");var _={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"FavoriteRemove"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"variantId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"productListRemoveItem"},arguments:[{kind:"Argument",name:{kind:"Name",value:"listId"},value:{kind:"NullValue"}},{kind:"Argument",name:{kind:"Name",value:"variantId"},value:{kind:"Variable",name:{kind:"Name",value:"variantId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"field"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"deletedProductListItem"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"variant"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inDefaultProductList"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"defaultVariantId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inDefaultProductList"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:368}};_.loc.source={body:`mutation FavoriteRemove($variantId: ID!) {
  productListRemoveItem(listId: null, variantId: $variantId) {
    userErrors {
      field
      message
    }
    deletedProductListItem {
      id
      variant {
        id
        inDefaultProductList
        product {
          id
          defaultVariantId
          inDefaultProductList
        }
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function V(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var i=e.type;i.kind==="NamedType"&&n.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(t){V(t,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(t){V(t,n)}),e.definitions&&e.definitions.forEach(function(t){V(t,n)})}var $={};(function(){_.definitions.forEach(function(n){if(n.name){var i=new Set;V(n,i),$[n.name.value]=i}})})();function q(e,n){for(var i=0;i<e.definitions.length;i++){var t=e.definitions[i];if(t.name&&t.name.value==n)return t}}function fe(e,n){var i={kind:e.kind,definitions:[q(e,n)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var t=$[n]||new Set,a=new Set,s=new Set;for(t.forEach(function(c){s.add(c)});s.size>0;){var f=s;s=new Set,f.forEach(function(c){if(!a.has(c)){a.add(c);var u=$[c]||new Set;u.forEach(function(v){s.add(v)})}})}return a.forEach(function(c){var u=q(e,c);u&&i.definitions.push(u)}),i}fe(_,"FavoriteRemove");var D=(e=>(e.UserNotSignedIn="UserNotSignedIn",e))(D||{});const M=()=>{const{userAuthState:e,currentUser:n}=U(),[i]=H(O),[t]=H(_),a=te(),s=re();return{toggleFavoriteProduct:p.useCallback(async({variables:c,action:u,productId:v})=>{var o,m,d,y;if(e!==L.EmailVerified)throw B()&&localStorage.setItem(C.pendingFavorite,JSON.stringify({variables:c,action:u,productId:v})),s({entityId:oe.Favorites,email:n==null?void 0:n.email,scope:"EMAIL"}),Error("UserNotSignedIn");let l;if(u==="favorite"){l=await i({variables:c});const r=l.errors||((o=l.data)==null?void 0:o.productListAddItem.userErrors);if(r&&r.length)throw Error((m=r==null?void 0:r[0])==null?void 0:m.message)}else{l=await t({variables:c});const r=l.errors||((d=l.data)==null?void 0:d.productListRemoveItem.userErrors);if(r&&r.length)throw Error((y=r==null?void 0:r[0])==null?void 0:y.message)}return a.cache.modify({id:a.cache.identify({__typename:"StorefrontProductVariant",id:c.variantId}),fields:{inDefaultProductList:()=>u==="favorite"}}),l},[e,a,s,n==null?void 0:n.email,i,t])}},ve={isPendingFavorite:()=>!1,favoredProducts:new Map,addFavoredProduct:()=>null,removeFavoredProduct:()=>null,isProductFavorited:()=>!1},ee=p.createContext(ve),ke=()=>p.useContext(ee),pe=({productId:e,shopId:n,variantId:i})=>{const t=B()?localStorage.getItem(C.pendingFavorite):void 0;if(!t)return!1;try{const a=JSON.parse(t),{productId:s,variables:{brokerId:f,variantId:c}}=a;if(e===s&&n===f&&i===c)return!0}catch{return!1}return!1},x=({productId:e,shopId:n,variantId:i})=>`${e}-${n}-${i}`,Ee=({children:e=null})=>{const{toggleFavoriteProduct:n}=M(),{userAuthState:i}=U(),t=W(),a=t==null?void 0:t.handleUpdateProductLists,[s,f]=p.useState(void 0),c=p.useCallback(o=>{a&&a({...o,actionIntent:"save"});const m=x(o);f(d=>d?d.get(m)?d:new Map(d.set(m,o)):new Map([[m,o]]))},[a]),u=p.useCallback(o=>{a&&a({...o,actionIntent:"unsave"});const m=x(o);f(d=>d?d.delete(m)?new Map(d):d:new Map)},[a]),v=p.useCallback(({isInitialyFavorited:o,...m})=>{if(!s)return o||!1;const d=x(m);return!!s.get(d)},[s]),l=p.useMemo(()=>({isPendingFavorite:pe,favoredProducts:s,addFavoredProduct:c,removeFavoredProduct:u,isProductFavorited:v}),[c,s,v,u]);return p.useEffect(()=>{if(i!==L.EmailVerified)return;const o=B()?localStorage.getItem(C.pendingFavorite):void 0;o&&(async()=>{try{const m=JSON.parse(o);await n(m),localStorage.removeItem(C.pendingFavorite)}catch(m){console.log(m)}})()},[n,i]),g.jsx(ee.Provider,{value:l,children:e})},Ie=/\/(\w[\w-]*)(?:\?(.*))*$/,j=e=>{const n=e.match(Ie);return n&&n[1]!==void 0?b(n[1]):b(e)};function K(e){const n=e.__typename==="DiscoveryProductVariant",i=n?e.product:e,t=n?e.id:e.defaultVariantId;return{isVariant:n,product:i,variantId:t}}const $e=()=>{const{reportEvent:e}=X(),n=Y(),{reportImpressionEventOnce:i}=se(),{shopAdOnView:t,shopAdOnPress:a}=de(),s=({item:u,xPos:v,containerType:l,upiEventData:o})=>{var F,S;const{isVariant:m,product:d,variantId:y}=K(u),r=Q(d.shopCashIncentive),R=m?h.Variant:h.Product;t({brokerId:parseInt(d.shop.id,10),campaignId:r==null?void 0:r.campaignHandle,xPos:v,yPos:0,adResponseId:r==null?void 0:r.adResponseId,campaignCountryCode:r==null?void 0:r.campaignCountryCode,adType:r==null?void 0:r.adType,cacheKeySuffix:u.id});const A=o!=null&&o.universalProductId?o.universalProductId:void 0,N=o!=null&&o.universalProductId?h.UniversalProduct:void 0,I={entityId:A||d.id,entityType:N||R,variantId:j(y),xPos:v,yPos:0,brokerId:b(d.shop.id),MedusaJSShopId:b(d.shop.MedusaJSId),totalReviews:(F=d.reviewAnalytics)==null?void 0:F.count,averageRating:((S=d.reviewAnalytics)==null?void 0:S.averageRating)??void 0,campaignId:r==null?void 0:r.campaignHandle,adResponseId:r==null?void 0:r.adResponseId,containerType:l,isRestricted:d.isRestricted};i({...I,isReferral:d.referral??!1,entityId:o!=null&&o.universalProductId?o.universalProductId:I.entityId,entityType:o!=null&&o.universalProductId?h.UniversalProduct:I.entityType}),n.entityImpression({...I,productIds:o==null?void 0:o.productIds})},f=({item:u,xPos:v,upiEventData:l,entityTypeOverride:o})=>{const{isVariant:m,product:d,variantId:y}=K(u),r=Q(d.shopCashIncentive),R=l!=null&&l.universalProductId?l.universalProductId:void 0,A=l!=null&&l.universalProductId?h.UniversalProduct:void 0,N=m?h.Variant:h.Product;a({adResponseId:r==null?void 0:r.adResponseId,adType:r==null?void 0:r.adType,brokerId:parseInt(d.shop.id,10),campaignId:r==null?void 0:r.campaignHandle});const I={entityType:o||A||N,entityId:R||d.id,variantId:j(y),brokerId:b(d.shop.id),MedusaJSShopId:b(d.shop.MedusaJSId),xPos:v,yPos:0};e({schemaId:"shop_app_entity_recommendation_clicks/6.7",payload:I}),n.entityClicked({...I,adResponseId:r==null?void 0:r.adResponseId,campaignId:r==null?void 0:r.campaignHandle,productIds:l==null?void 0:l.productIds})},{send:c}=ae(()=>({productViewed:s,productPressed:f}));return c},ge=({variantId:e,shopId:n,productId:i,productTitle:t,imageUrl:a,isFavorite:s,onFavoritedSuccess:f,loading:c=!1,showText:u=!1,children:v})=>{const{t:l}=Z(),{userAuthState:o,currentUser:m}=U(),d=p.useRef(!1),{toggleFavoriteProduct:y}=M(),{reportEvent:r}=X(),R=Y(),{showToast:A}=ce(),N=W(),{isPendingFavorite:I,removeFavoredProduct:F,addFavoredProduct:S,isProductFavorited:ne}=ke();p.useEffect(()=>{if(N||o!==L.EmailVerified)return;const k={productId:i,shopId:n,variantId:e,productTitle:t,imageUrl:a};I(k)||s?S(k):F(k)},[S,N,a,s,I,i,t,F,n,o,e]);const P=ne({productId:i,productTitle:t,shopId:n,variantId:e,isInitialyFavorited:s});async function ie(){o===L.EmailVerified&&(P?F({productId:i,shopId:n,variantId:e,productTitle:t,imageUrl:a}):S({productId:i,shopId:n,variantId:e,productTitle:t,imageUrl:a})),d.current=!0;try{const k=P?"unfavorite":"favorite",T={brokerId:Number(n),productId:Number(i),variantId:e,action:k};r({schemaId:"shop_app_product_favorite_action/6.0",payload:T}),R.productFavoriteAction({action:k==="favorite"?"FAVORITE_ACTION_FAVORITE":"FAVORITE_ACTION_UNFAVORITE",variantId:Number(j(e)),productId:T.productId,brokerId:T.brokerId}),r({schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:h.AccountFavorites,entityId:"account_favorites",interactionType:P?G.AccountFavoritesUnsave:G.AccountFavoritesSave,shopAccountUuid:(m==null?void 0:m.shopAccountUuid)??void 0}}),await y({variables:{brokerId:n,variantId:e},action:k,productId:i}),f==null||f(!P)}catch(k){if(k instanceof Error&&(k==null?void 0:k.message)===D.UserNotSignedIn)return;P?S({productId:i,shopId:n,variantId:e,productTitle:t,imageUrl:a}):F({productId:i,shopId:n,variantId:e,productTitle:t,imageUrl:a}),A({title:l("ProductDetails.AddedToFavoritesError"),variant:"error"})}finally{d.current=!1}}return g.jsx(g.Fragment,{children:v({isFavorited:P,loading:c,showText:u,onClick:()=>{d.current||ie()}})})},je=({product:e,variant:n,favoritedButtonVariant:i="primary",unfavoritedButtonVariant:t="blurred"})=>{var c;const{t:a}=Z(),s=(n==null?void 0:n.id)??e.defaultVariantId,f=(n==null?void 0:n.inDefaultProductList)??e.inDefaultProductList;return g.jsx(ge,{variantId:s,shopId:e.shop.id,productId:e.id,productTitle:e.title,imageUrl:(c=e.images[0])==null?void 0:c.url,isFavorite:f,children:({isFavorited:u,onClick:v})=>g.jsx(le,{"data-testid":"favorite-overlay-item",name:u?"favorites-filled":"favorites",variant:u?i:t,ariaLabel:a("ProductCard.AddToFavorites"),onClick:l=>{l.preventDefault(),l.stopPropagation(),v()},size:"m"})})},Ue=({product:e,variant:n,productTitleVariant:i="captionBold",lineClampClassName:t="line-clamp-1"})=>{const a=e.title,s=n==null?void 0:n.title;return g.jsxs(g.Fragment,{children:[g.jsx(z,{"data-testid":"product-title",variant:i,as:"h3",className:ue("text-text",t),children:a}),s&&s!==a?g.jsx(z,{"data-testid":"variant-title",variant:"caption",as:"h3",className:"line-clamp-1 text-text-tertiary",children:s}):null]})};export{Ee as F,Ue as P,je as a,M as b,ke as c,ge as d,j as e,$e as u};
//# sourceMappingURL=ProductCardProductTitle-GOnUA0Qh.js.map
