import{j as a}from"./jsx-runtime-D_zvdyIk.js";import{r as u}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{i as T}from"./ColorUtils-CiNsKf89.js";import{d as w}from"./FilterUtils-8PUBFIQ_.js";import{n as ee}from"./ratingsUtils-C4036l3G.js";import{C as J,c as te,h as ae}from"./toFeedSection-HH8g53oo.js";import{B as re}from"./Badge-D9a9Zb-D.js";import{B as se}from"./Button-D4K8aSAG.js";import{C as oe}from"./ContactModalContent-D-hW0kLh.js";import{D as le}from"./Dialog-C_RA0MsZ.js";import{I as ne}from"./Icon-Vc_yr2r6.js";import{M as Q}from"./MerchantLogo-USLrWjfI.js";import{R as F}from"./index-DxO_0hRA.js";import{T as K}from"./Text-BrMatKQv.js";import{T as ie}from"./TrackingPixel-D8humLZO.js";import{I as y}from"./ImageUtils-D5ojfjzT.js";import{i as n}from"./i18nConfig-CLr-UH7w.js";import{u as ce,a as ue}from"./ConversationProvider-BNoOA22x.js";import{S as de}from"./StoreFollowButton-CGWxuR_B.js";import{S as me}from"./StoreLink-CT-7O9Ag.js";import{c as b}from"./cn-yu2yf51J.js";import{f as fe}from"./formatCompactNumber-C_JtNFLO.js";const xe=({shop:e,cardTheme:t,logoBackgroundClassName:r})=>{var d,g,m,f,x;const s=(m=(g=(d=e.visualTheme)==null?void 0:d.brandSettings)==null?void 0:g.headerTheme)==null?void 0:m.wordmark,c=u.useMemo(()=>(t==null?void 0:t.type)!=="coverImage"?null:a.jsxs(a.Fragment,{children:[a.jsx(F,{src:t.coverImageUrl,thumbhash:t==null?void 0:t.coverImageThumbhash,alt:e.name,imageSizeAtBreakpoint:{default:y.lUrl,md:y.xlUrl},loading:"eager",className:"size-full object-cover"}),a.jsx("div",{className:"absolute inset-0 z-[1] bg-bg-overlay-fixed-dark-20"}),t!=null&&t.backgroundColor?a.jsx("div",{className:"absolute bottom-0 z-[1] size-full ",style:{background:`linear-gradient(to top, ${t.backgroundColor} 0%,  ${t.backgroundColor.slice(0,7)}00 40%)`}}):null]}),[t,e.name]);return a.jsxs("div",{className:"size-full",children:[c,a.jsx("div",{className:"absolute inset-0 z-[1] flex items-center justify-center",children:s?a.jsx(F,{src:s==null?void 0:s.url,alt:(s==null?void 0:s.altText)||e.name,className:"max-h-space-64 min-h-space-40 max-w-[112px] object-contain","data-testid":"store-data-wordmark",imageSizeAtBreakpoint:{default:y.mUrl}}):a.jsx(Q,{src:(x=(f=e.visualTheme)==null?void 0:f.logoImage)==null?void 0:x.url,size:"l",shopName:e.name,className:r})})]})},be=({hasStoreDiscount:e,campaign:t,promotionalCashBackRate:r,hiddenValueIncentive:s=!1})=>u.useMemo(()=>{if(w(r))return{text:n.t("MerchantCard.ShopCashBack.TextV2",{percent:parseInt(r,10)}),accessibilityLabel:n.t("MerchantCard.ShopCashBack.A11yText",{percent:parseInt(r,10)}),variant:"cashBack"};if(w(t))switch(t==null?void 0:t.cashType){case J.EarnShopCash:return{text:n.t("MerchantCard.FlatCashBack.Text",t),accessibilityLabel:n.t("MerchantCard.FlatCashBack.Text",t),variant:"multiplierFilled"};case J.ImmediateDiscount:return{text:n.t("MerchantCard.ShopCash.TextV2",t),accessibilityLabel:n.t("MerchantCard.ShopCash.A11yText",t),variant:"multiplierFilled"}}return e?{text:n.t("MerchantCard.StoreDiscount.Text"),accessibilityLabel:n.t("MerchantCard.StoreDiscount.A11yText"),variant:"discountFilled"}:s?{text:n.t("ShopCash.ExclusiveOffers.OfferAvailable"),accessibilityLabel:n.t("ShopCash.ExclusiveOffers.OfferAvailable"),variant:"unauthOffer"}:null},[t,e,r,s]),ge=e=>{var t,r,s,c,d,g,m,f,x;if(e.headerTheme){const h=((t=e.headerTheme.coverImage)==null?void 0:t.url)??((r=e.headerTheme.thumbnailImage)==null?void 0:r.url),M=((s=e.headerTheme.coverImage)==null?void 0:s.thumbhash)??((c=e.headerTheme.thumbnailImage)==null?void 0:c.thumbhash)??void 0,v=(d=e.colors)==null?void 0:d.coverDominant;if(h&&v)return{type:"coverImage",coverImageUrl:h,coverImageThumbhash:M,backgroundColor:v}}if((g=e.colors)!=null&&g.primary)return{type:"brandColor",backgroundColor:(m=e.colors)==null?void 0:m.primary};if((f=e.colors)!=null&&f.logoDominant)return{type:"logoColor",backgroundColor:(x=e.colors)==null?void 0:x.logoDominant}},Ce=(e,t=4)=>{const r=e==null?void 0:e.featuredImages.slice(0,t);return r?r.length===3?e==null?void 0:e.featuredImages.slice(0,2):r:[]};function ve(e){return e.length!==4?e:e.split("").map(r=>r==="#"?r:r+r).join("")}function he(e){const t=ve(e).substring(1,7),r=parseInt(t.substring(0,2),16),s=parseInt(t.substring(2,4),16),c=parseInt(t.substring(4,6),16);return Math.sqrt(.299*r**2+.587*s**2+.114*c**2)<163?"dark":"light"}const pe=({hideCTA:e,replaceFollowWithContact:t,shopId:r,followedByMe:s,onContactClick:c,buttonVariant:d})=>e?null:t?a.jsx(se,{variant:"secondary",size:"m",onClick:c,children:n.t`Store.MoreActions.Contact`}):a.jsx(de,{shopId:r,followedByMe:s,buttonSize:"l",heightPx:40,variant:d}),$e=({shop:e,fixedHeight:t=!1,featuredImagesLimit:r=4,hideCTA:s,className:c,onImpression:d,onClick:g,imageTopRightActions:m,replaceFollowWithContact:f=!1,wrapperClassName:x})=>{var U,V,E,q,_,$,W,G;const[h,M]=u.useState(!1),v=ce(),p=ue(),X=u.useCallback(()=>{p==null||p.navigateToShop({shopId:e.id})},[p,e.id]),O=u.useCallback(i=>{i.preventDefault(),i.stopPropagation(),M(!0)},[]),l=te(e.shopCashIncentive),A=n.language,C=Ce(e==null?void 0:e.visualTheme,r),j=e==null?void 0:e.productReviewAnalytics,R=(C==null?void 0:C.length)??0,Y=(E=(V=(U=e==null?void 0:e.visualTheme)==null?void 0:U.brandSettings)==null?void 0:V.colors)==null?void 0:E.logoAverage,Z=($=(_=(q=e==null?void 0:e.visualTheme)==null?void 0:q.brandSettings)==null?void 0:_.colors)==null?void 0:$.logoDominant,z=Y||Z,S=u.useMemo(()=>z&&he(z)==="dark"?"bg-bg-fill-fixed-light":"bg-bg-fill-fixed-dark",[z]),P=u.useMemo(()=>{var i;return{promotionalCashBackRate:(i=l==null?void 0:l.cashback)==null?void 0:i.ratePercentage.toString(),boostCampaign:l==null?void 0:l.boosted}},[l==null?void 0:l.boosted,(W=l==null?void 0:l.cashback)==null?void 0:W.ratePercentage]),H=u.useMemo(()=>e.offers.find(i=>i.__typename==="AutomaticDiscount")!==void 0,[e.offers]),o=u.useMemo(()=>{var i,k;return(i=e.visualTheme)!=null&&i.brandSettings?ge((k=e.visualTheme)==null?void 0:k.brandSettings):void 0},[(G=e.visualTheme)==null?void 0:G.brandSettings]),B=u.useMemo(()=>!!(o!=null&&o.backgroundColor&&T(o==null?void 0:o.backgroundColor)),[o==null?void 0:o.backgroundColor]),D=be({hasStoreDiscount:H,campaign:P.boostCampaign,promotionalCashBackRate:P.promotionalCashBackRate,hiddenValueIncentive:ae(e.shopCashIncentive)}),I=B?"text-text-fixed-light":"text-text-fixed-dark",L=u.useMemo(()=>{var i,k;return a.jsxs("div",{"data-testid":"MerchantCard",className:b("relative flex w-full flex-col overflow-hidden rounded-radius-28 border border-border-image",c),style:{backgroundColor:o==null?void 0:o.backgroundColor},children:[a.jsxs("div",{className:b("relative flex overflow-hidden",t?"h-[120px]":"flex-1"),children:[(o==null?void 0:o.type)==="coverImage"||(o==null?void 0:o.type)==="brandColor"?a.jsx(xe,{shop:e,cardTheme:o,logoBackgroundClassName:S}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"absolute left-0 top-0 z-[2] flex size-full items-center justify-center",children:a.jsx(Q,{src:(k=(i=e.visualTheme)==null?void 0:i.logoImage)==null?void 0:k.url,size:"l",shopName:e.name.slice(0,1),className:S,hasIncentive:w(l)})}),R>0?C==null?void 0:C.map(N=>a.jsx("div",{className:"z-0 flex h-full flex-1",children:a.jsx(F,{alt:N.altText||"",src:N.url,thumbhash:N.thumbhash,className:"aspect-square size-full object-cover",imageSizeAtBreakpoint:{default:y.xxsmUrl,md:y.xsUrl},lazy:!1})},N.url)):a.jsx("div",{className:"h-[82px] bg-bg-fill-secondary","data-testid":"image-fallback"})]}),m&&a.jsx("div",{className:"absolute right-space-12 top-space-12 z-[3]",children:m})]}),a.jsx("div",{className:"pointer-events-none absolute inset-0 z-[1] bg-bg-fill-fixed-dark opacity-0 transition-all group-hover:opacity-10"}),a.jsxs("div",{"data-testid":"MerchantCardFooter",className:b("flex items-center justify-between rounded-b-radius-12 p-space-16"),children:[a.jsxs("div",{className:"flex flex-col items-start gap-space-8",children:[D&&a.jsx(re,{testID:"merchant-card-badge",...D}),a.jsxs("div",{className:"flex min-w-space-0 flex-1 flex-col",children:[a.jsx(K,{variant:"bodyTitleSmall",as:"h3",className:b("line-clamp-1 overflow-hidden text-ellipsis",I),children:e.name}),j&&j.averageRating?a.jsxs("div",{className:"flex items-center gap-space-2",children:[a.jsx(ne,{name:"star-filled",className:b("!h-[10px] !w-[11px]",I)}),a.jsx(K,{variant:"captionMedium",className:b("line-clamp-1",I),children:n.t("ProductDetails.TotalReviews",{rating:ee(j.averageRating,A),totalReviews:fe(j.totalProductRatings,A)})})]}):null]})]}),a.jsx(pe,{hideCTA:s,replaceFollowWithContact:f,shopId:e.id,followedByMe:e.followedByMe,onContactClick:O,buttonVariant:B?"blurred":"blurred-theme"})]})]})},[c,o,t,e,S,l,R,C,m,D,I,j,A,s,f,O,B]);return a.jsxs(a.Fragment,{children:[a.jsx(ie,{onImpression:d,triggerOnce:!0,children:p&&(v!=null&&v.inNativeWebView)?a.jsx("div",{className:b("flex rounded-radius-12",x,t?"":"aspect-square h-full"),onClick:X,children:L}):a.jsx(me,{shop:e,className:b("flex rounded-radius-12",x,t?"":"aspect-square h-full"),onClick:g,children:L})}),f&&h&&a.jsx(le,{open:h,onOpenChange:M,title:n.t("Store.MoreActions.ContactInformation",{shopName:e.name}),contentWrapperClassName:"flex flex-1 md:pb-space-24",content:a.jsx(oe,{address:"businessAddress"in e&&e.businessAddress&&typeof e.businessAddress=="object"&&"formatted"in e.businessAddress&&Array.isArray(e.businessAddress.formatted)?{formatted:e.businessAddress.formatted}:void 0,contacts:"contacts"in e&&e.contacts&&Array.isArray(e.contacts)?e.contacts:[]})})]})};export{$e as M};
//# sourceMappingURL=MerchantCard-DfeHZkIJ.js.map
