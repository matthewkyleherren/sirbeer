import{j as Z}from"./jsx-runtime-D_zvdyIk.js";import{f as M,r as S}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{r as h,d as V,b as E,R as $,f as ee,h as U,w as re,j as te,k as ne,l as ae,_ as O,o as H,e as D,p as j,q as se,s as ie,m as oe,N as m,t as W,A as q,U as ue}from"./UserQuery-BcvHLWZm.js";function B(e){var r=h.useContext(V()),t=e||r.client;return E(!!t,79),t}var k=!1,ce="useSyncExternalStore",fe=$[ce],le=fe||function(e,r,t){var n=r();globalThis.__DEV__!==!1&&!k&&n!==r()&&(k=!0,globalThis.__DEV__!==!1&&E.error(92));var a=h.useState({inst:{value:n,getSnapshot:r}}),s=a[0].inst,o=a[1];return ee?h.useLayoutEffect(function(){Object.assign(s,{value:n,getSnapshot:r}),T(s)&&o({inst:s})},[e,n,r]):Object.assign(s,{value:n,getSnapshot:r}),h.useEffect(function(){return T(s)&&o({inst:s}),e(function(){T(s)&&o({inst:s})})},[e]),n};function T(e){var r=e.value,t=e.getSnapshot;try{return r!==t()}catch{return!0}}var g;(function(e){e[e.Query=0]="Query",e[e.Mutation=1]="Mutation",e[e.Subscription=2]="Subscription"})(g||(g={}));var P;function G(e){var r;switch(e){case g.Query:r="Query";break;case g.Mutation:r="Mutation";break;case g.Subscription:r="Subscription";break}return r}function x(e){re("parser",function(){globalThis.__DEV__!==!1&&E.warn(94)}),P||(P=new te(ne.parser||1e3));var r=P.get(e);if(r)return r;var t,n,a;E(!!e&&!!e.kind,95,e);for(var s=[],o=[],i=[],c=[],d=0,_=e.definitions;d<_.length;d++){var u=_[d];if(u.kind==="FragmentDefinition"){s.push(u);continue}if(u.kind==="OperationDefinition")switch(u.operation){case"query":o.push(u);break;case"mutation":i.push(u);break;case"subscription":c.push(u);break}}E(!s.length||o.length||i.length||c.length,96),E(o.length+i.length+c.length<=1,97,e,o.length,c.length,i.length),n=o.length?g.Query:g.Mutation,!o.length&&!i.length&&(n=g.Subscription);var f=o.length?o:i.length?i:c;E(f.length===1,98,e,f.length);var l=f[0];t=l.variableDefinitions||[],l.name&&l.name.kind==="Name"?a=l.name.value:a="data";var v={name:a,type:n,variables:t};return P.set(e,v),v}x.resetCache=function(){P=void 0};globalThis.__DEV__!==!1&&ae("parser",function(){return P?P.size:0});function de(e,r){var t=U("parser",x,[e]),n=G(r),a=G(t.type);E(t.type===r,99,n,n,a)}function L(e,r,t,n){"use no memo";n===void 0&&(n="Please remove this option.");var a=h.useRef(!1);r in e&&!a.current&&(globalThis.__DEV__!==!1&&E.warn(78,t,r,n),a.current=!0)}var _e=Symbol.for("apollo.hook.wrappers");function ve(e,r,t){var n=t.queryManager,a=n&&n[_e],s=a&&a[e];return s?s(r):r}var he=Object.prototype.hasOwnProperty;function R(){}var N=Symbol();function pe(e,r){return r===void 0&&(r=Object.create(null)),ve("useQuery",Ee,B(r&&r.client))(e,r)}function Ee(e,r){globalThis.__DEV__!==!1&&(L(r,"canonizeResults","useQuery"),L(r,"partialRefetch","useQuery"),L(r,"defaultOptions","useQuery","Pass the options directly to the hook instead."),L(r,"onCompleted","useQuery","If your `onCompleted` callback sets local state, switch to use derived state using `data` returned from the hook instead. Use `useEffect` to perform side-effects as a result of updates to `data`."),L(r,"onError","useQuery","If your `onError` callback sets local state, switch to use derived state using `data`, `error` or `errors` returned from the hook instead. Use `useEffect` if you need to perform side-effects as a result of updates to `data`, `error` or `errors`."));var t=Se(e,r),n=t.result,a=t.obsQueryFields;return h.useMemo(function(){return O(O({},n),a)},[n,a])}function ye(e,r,t,n,a){function s(u){var f;de(r,g.Query);var l={client:e,query:r,observable:n&&n.getSSRObservable(a())||se.inactiveOnCreation.withValue(!n,function(){return U("canonizeResults",function(){return e.watchQuery(z(void 0,e,t,a()))})}),resultData:{previousData:(f=u==null?void 0:u.resultData.current)===null||f===void 0?void 0:f.data}};return l}var o=h.useState(s),i=o[0],c=o[1];function d(u){var f,l;Object.assign(i.observable,(f={},f[N]=u,f));var v=i.resultData;c(O(O({},i),{query:u.query,resultData:Object.assign(v,{previousData:((l=v.current)===null||l===void 0?void 0:l.data)||v.previousData,current:void 0})}))}if(e!==i.client||r!==i.query){var _=s(i);return c(_),[_,d]}return[i,d]}function Se(e,r){var t=B(r.client),n=h.useContext(V()).renderPromises,a=!!n,s=t.disableNetworkFetches,o=r.ssr!==!1&&!r.skip,i=r.partialRefetch,c=Pe(t,e,r,a),d=ye(t,e,r,n,c),_=d[0],u=_.observable,f=_.resultData,l=d[1],v=c(u);Oe(f,u,t,r,v);var b=h.useMemo(function(){return be(u)},[u]);Ae(u,n,o);var I=ge(f,u,t,r,v,s,i,a,{onCompleted:r.onCompleted||R,onError:r.onError||R});return{result:I,obsQueryFields:b,observable:u,resultData:f,client:t,onQueryExecuted:l}}function ge(e,r,t,n,a,s,o,i,c){var d=h.useRef(c);h.useEffect(function(){d.current=c});var _=(i||s)&&n.ssr===!1&&!n.skip?Y:n.skip||a.fetchPolicy==="standby"?J:void 0,u=e.previousData,f=h.useMemo(function(){return _&&K(_,u,r,t)},[t,r,_,u]);return le(h.useCallback(function(l){if(i)return function(){};var v=function(){var y=e.current,p=r.getCurrentResult();y&&y.loading===p.loading&&y.networkStatus===p.networkStatus&&D(y.data,p.data)||F(p,e,r,t,o,l,d.current)},b=function(y){if(I.current.unsubscribe(),I.current=r.resubscribeAfterError(v,b),!he.call(y,"graphQLErrors"))throw y;var p=e.current;(!p||p&&p.loading||!D(y,p.error))&&F({data:p&&p.data,error:y,loading:!1,networkStatus:m.error},e,r,t,o,l,d.current)},I={current:r.subscribe(v,b)};return function(){setTimeout(function(){return I.current.unsubscribe()})}},[s,i,r,e,o,t]),function(){return f||w(e,r,d.current,o,t)},function(){return f||w(e,r,d.current,o,t)})}function Ae(e,r,t){r&&t&&(r.registerSSRObservable(e),e.getCurrentResult().loading&&r.addObservableQueryPromise(e))}function Oe(e,r,t,n,a){var s;r[N]&&!D(r[N],a)&&(r.reobserve(z(r,t,n,a)),e.previousData=((s=e.current)===null||s===void 0?void 0:s.data)||e.previousData,e.current=void 0),r[N]=a}function Pe(e,r,t,n){t===void 0&&(t={});var a=t.skip;t.ssr,t.onCompleted,t.onError;var s=t.defaultOptions,o=H(t,["skip","ssr","onCompleted","onError","defaultOptions"]);return function(i){var c=Object.assign(o,{query:r});return n&&(c.fetchPolicy==="network-only"||c.fetchPolicy==="cache-and-network")&&(c.fetchPolicy="cache-first"),c.variables||(c.variables={}),a?(c.initialFetchPolicy=c.initialFetchPolicy||c.fetchPolicy||Q(s,e.defaultOptions),c.fetchPolicy="standby"):c.fetchPolicy||(c.fetchPolicy=(i==null?void 0:i.options.initialFetchPolicy)||Q(s,e.defaultOptions)),c}}function z(e,r,t,n){var a=[],s=r.defaultOptions.watchQuery;return s&&a.push(s),t.defaultOptions&&a.push(t.defaultOptions),a.push(ie(e&&e.options,n)),a.reduce(oe)}function F(e,r,t,n,a,s,o){var i=r.current;i&&i.data&&(r.previousData=i.data),!e.error&&W(e.errors)&&(e.error=new q({graphQLErrors:e.errors})),r.current=K(me(e,t,a),r.previousData,t,n),s(),Ie(e,i==null?void 0:i.networkStatus,o)}function Ie(e,r,t){if(!e.loading){var n=Le(e);Promise.resolve().then(function(){n?t.onError(n):e.data&&r!==e.networkStatus&&e.networkStatus===m.ready&&t.onCompleted(e.data)}).catch(function(a){globalThis.__DEV__!==!1&&E.warn(a)})}}function w(e,r,t,n,a){return e.current||F(r.getCurrentResult(),e,r,a,n,function(){},t),e.current}function Q(e,r){var t;return(e==null?void 0:e.fetchPolicy)||((t=r==null?void 0:r.watchQuery)===null||t===void 0?void 0:t.fetchPolicy)||"cache-first"}function Le(e){return W(e.errors)?new q({graphQLErrors:e.errors}):e.error}function K(e,r,t,n){var a=e.data;e.partial;var s=H(e,["data","partial"]),o=O(O({data:a},s),{client:n,observable:t,variables:t.variables,called:e!==Y&&e!==J,previousData:r});return o}function me(e,r,t){return e.partial&&t&&!e.loading&&(!e.data||Object.keys(e.data).length===0)&&r.options.fetchPolicy!=="cache-only"?(r.refetch(),O(O({},e),{loading:!0,networkStatus:m.refetch})):e}var Y=j({loading:!0,data:void 0,error:void 0,networkStatus:m.loading}),J=j({loading:!1,data:void 0,error:void 0,networkStatus:m.ready});function be(e){return{refetch:e.refetch.bind(e),reobserve:function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return globalThis.__DEV__!==!1&&globalThis.__DEV__!==!1&&E.warn(84),e.reobserve.apply(e,r)},fetchMore:e.fetchMore.bind(e),updateQuery:e.updateQuery.bind(e),startPolling:e.startPolling.bind(e),stopPolling:e.stopPolling.bind(e),subscribeToMore:e.subscribeToMore.bind(e)}}const Qe="f_caa0d12f",Me="f_41cbec17",Ve="f_8142c7a3",Ue="f_e6f0be97",He="f_c0b14bc4",je="f_a424d5d3",We="f_9fabb34b",qe="f_d07f5a57",Be="f_9f6da881",xe="f_9cacaad2",ze="f_98a671d6",Ke="f_81e5f0da",Ye="f_8e034b6c",Je="f_09b6e130",Xe="f_d3950fde",Ze="f_67233d24",$e="f_69b8317a",er="f_10a8f7bf",Ne="f_c74ea4dd",Te=(e,r)=>r?r.features.includes(e):!1,De=()=>{const{flags:e}=M("root")||{};return S.useCallback(r=>Te(r,e),[e])},Fe=e=>De()(e);var C=(e=>(e.ANDROID="ANDROID",e.IOS="IOS",e.IOS_APP_CLIP="IOS_APP_CLIP",e.WEB="WEB",e))(C||{});function Ce(){var u;const{hasSession:e}=M("root")||{},[r,t]=S.useState(!e),{data:n,loading:a,error:s,networkStatus:o,refetch:i}=pe(ue,{variables:{anonymous:r}}),c=S.useCallback(()=>(t(!1),i({anonymous:!1})),[i]),d=S.useMemo(()=>{if(!n||s||!n.currentUser)return null;const f=n.currentUser.email,l=n.currentUser.displayName;if(!f)return null;const v=(l==null?void 0:l.charAt(0).toUpperCase())||(f==null?void 0:f.charAt(0).toUpperCase());return{email:f,initial:v}},[n,s]),_=S.useMemo(()=>{var f;return(f=n==null?void 0:n.registeredDevices)==null?void 0:f.some(l=>l.deviceType&&[C.IOS,C.ANDROID].includes(l.deviceType))},[n]);return{loading:a,networkStatus:o,identity:d,currentUser:n==null?void 0:n.currentUser,refetchIdentity:c,currentUserRequestId:(u=n==null?void 0:n.currentUser)==null?void 0:u.requestID,userHasSession:!r,userPrivacySettings:n==null?void 0:n.userPrivacySettings,currentJurisdiction:n==null?void 0:n.currentJurisdiction,shopAppInstalled:_}}var A=(e=>(e.Anonymous="Anonymous",e.Guest="Guest",e.PhoneOnlyVerified="PhoneOnlyVerified",e.EmailVerified="EmailVerified",e.FullyVerified="FullyVerified",e))(A||{});const ke={userAuthState:A.Anonymous,isLoggedIn:!1,identity:null,currentUser:void 0,isStaff:!1,refetchIdentity:()=>new Promise(()=>{}),currentUserRequestId:void 0,userHasSession:!0,userPrivacySettings:void 0,currentJurisdiction:void 0,shopAppInstalled:void 0,identityDataLoading:!1},X=S.createContext(ke),rr=()=>S.useContext(X),tr=({children:e=null})=>{const{identity:r,currentUser:t,refetchIdentity:n,currentUserRequestId:a,userHasSession:s,userPrivacySettings:o,currentJurisdiction:i,shopAppInstalled:c,loading:d}=Ce(),_=Fe(Ne),u=S.useMemo(()=>t?t!=null&&t.email?t!=null&&t.emailVerified?A.EmailVerified:A.PhoneOnlyVerified:A.Guest:A.Anonymous,[t]),f=u===A.EmailVerified||u===A.PhoneOnlyVerified,l=S.useMemo(()=>({userAuthState:u,identity:r,currentUser:t,isStaff:_,isLoggedIn:f,refetchIdentity:n,currentUserRequestId:a,userHasSession:s,userPrivacySettings:o,currentJurisdiction:i,shopAppInstalled:c,identityDataLoading:d}),[u,r,t,_,f,n,a,s,o,i,c,d]);return Z.jsx(X.Provider,{value:l,children:e})};export{K as A,Xe as B,tr as C,g as D,De as E,Ne as F,Qe as G,A as U,pe as a,Fe as b,L as c,B as d,ze as e,$e as f,er as g,Me as h,xe as i,We as j,Be as k,qe as l,Ue as m,je as n,He as o,Ze as p,Ve as q,Je as r,Ke as s,Ye as t,rr as u,de as v,Se as w,Q as x,Pe as y,z};
//# sourceMappingURL=AuthenticationProvider-9RtBMSxF.js.map
