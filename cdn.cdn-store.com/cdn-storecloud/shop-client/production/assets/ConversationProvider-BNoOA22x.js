import{j as Hn}from"./jsx-runtime-D_zvdyIk.js";import{r as g,f as or,g as dr,u as ni,a as cr}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{u as Ea}from"./useActions-CMwTuc_r.js";import{I as de,E as pn}from"./types-aSuMwFxz.js";import{e as lr}from"./_baseIteratee-CsWtfwh7.js";import{i as ye}from"./i18nConfig-CLr-UH7w.js";import{a as ur,k as mr,z as fr,b as ti,A as vr,d as ii,t as gr,o as kr,m as pr,e as Aa,ae as vn}from"./toFeedSection-HH8g53oo.js";import{d as Sn}from"./ReducedImageFragment-CkTGK3vJ.js";import{r as ve,m as hi,_ as Fe,b as yi,a7 as Ni,N as Je}from"./UserQuery-BcvHLWZm.js";import{c as Re,w as Sr,x as hr,y as yr,z as Nr,A as Ci,u as Ia,a as gn,U as mn,d as Cr,b as Fr,B as Er}from"./AuthenticationProvider-9RtBMSxF.js";import{a as Ar,u as Yn}from"./useMutation-BEBlGsA2.js";import{u as ai}from"./updatePaginatedQuery-sQa1HKQl.js";import{u as _a}from"./Toast-Bb3RYazJ.js";import{d as Ir}from"./FilterUtils-8PUBFIQ_.js";import{d as ze,D as je,f as Ct,v as Be,i as ce,C as le}from"./statsdClient-CCQ7Es9D.js";import{c as Ta}from"./react-C2mnCN9A.js";import{a as _r,e as Tr,A as wa,u as Pa,g as wr}from"./useMonorail-J6WwGwSW.js";import{c as ba,d as Ma,W as Pr}from"./graphqlUtils-DUagluhW.js";import{g as br}from"./get-o4MP-hQJ.js";import{m as Mr}from"./PayAddressUtils-BUNh7j1F.js";import{u as Rr,S as Fi}from"./useTriggerLogInWithShop-D9VKR_6P.js";import{c as Dr}from"./createGuestUser-FgpzrQxO.js";import{u as Or}from"./usePayAddresses-BJssbwmF.js";import{P as gt}from"./types-BLzQfJqq.js";import{L as Lr}from"./LocalizableError-DuJTnl85.js";import{d as Zn}from"./MoneyV2Fragment-XdlHnX2E.js";var kt;function $r(){}function Vr(){return kt||(kt=ve.createContext(null)),ve.useCallback(function(){var e=console.error;try{return console.error=$r,ve.useContext(kt),!0}catch{return!1}finally{console.error=e}},[])}var xr=["refetch","reobserve","fetchMore","updateQuery","startPolling","stopPolling","subscribeToMore"],Ur=["initialFetchPolicy","onCompleted","onError","defaultOptions","partialRefetch","canonizeResults"],qr=["query","ssr","client","fetchPolicy","nextFetchPolicy","refetchWritePolicy","errorPolicy","pollInterval","notifyOnNetworkStatusChange","returnPartialData","skipPollAttempt"];function Ra(e,n){var t;if(globalThis.__DEV__!==!1){var i=n||{};Re(i,"canonizeResults","useLazyQuery"),Re(i,"variables","useLazyQuery","Pass all `variables` to the returned `execute` function instead."),Re(i,"context","useLazyQuery","Pass `context` to the returned `execute` function instead."),Re(i,"onCompleted","useLazyQuery","If your `onCompleted` callback sets local state, switch to use derived state using `data` returned from the hook instead. Use `useEffect` to perform side-effects as a result of updates to `data`."),Re(i,"onError","useLazyQuery","If your `onError` callback sets local state, switch to use derived state using `data`, `error` or `errors` returned from the hook instead. Use `useEffect` if you need to perform side-effects as a result of updates to `data`, `error` or `errors`."),Re(i,"defaultOptions","useLazyQuery","Pass the options directly to the hook instead."),Re(i,"initialFetchPolicy","useLazyQuery","Use the `fetchPolicy` option instead."),Re(i,"partialRefetch","useLazyQuery")}var r=ve.useRef(void 0),s=ve.useRef(void 0),d=ve.useRef(void 0),a=hi(n,r.current||{}),o=(t=a==null?void 0:a.query)!==null&&t!==void 0?t:e;s.current=n,d.current=o;var l=Fe(Fe({},a),{skip:!r.current}),c=Sr(o,l),m=c.obsQueryFields,p=c.result,h=c.client,y=c.resultData,u=c.observable,v=c.onQueryExecuted,N=u.options.initialFetchPolicy||hr(l.defaultOptions,h.defaultOptions),f=ve.useReducer(function(R){return R+1},0)[1],S=ve.useMemo(function(){for(var R={},K=function(M){var x=m[M];R[M]=function(){return globalThis.__DEV__!==!1&&M==="reobserve"&&globalThis.__DEV__!==!1&&yi.warn(80),r.current||(r.current=Object.create(null),f()),x.apply(this,arguments)}},D=0,P=xr;D<P.length;D++){var A=P[D];K(A)}return R},[f,m]),b=!!r.current,U=ve.useMemo(function(){return Fe(Fe(Fe({},p),S),{called:b})},[p,S,b]),V=Vr(),z=ve.useRef(new Set),q=ve.useCallback(function(R){if(globalThis.__DEV__!==!1){V()&&globalThis.__DEV__!==!1&&yi.warn(81);for(var K=0,D=Ur;K<D.length;K++){var P=D[K];z.current.has(P)||(Ni(R||{},P,"useLazyQuery.execute"),z.current.add(P))}for(var A=0,M=qr;A<M.length;A++){var x=M[A];z.current.has(x)||(Ni(R||{},x,"useLazyQuery.execute","Please pass the option to the `useLazyQuery` hook instead."),z.current.add(x))}}r.current=R?Fe(Fe({},R),{fetchPolicy:R.fetchPolicy||N}):{fetchPolicy:N};var te=hi(s.current,Fe({query:d.current},r.current)),ne=Gr(y,u,h,o,Fe(Fe({},te),{skip:!1}),v).then(function(ie){return Object.assign(ie,S)});return ne.catch(function(){}),ne},[V,h,o,S,N,u,y,v]),I=ve.useRef(q);Ar(function(){I.current=q});var re=ve.useCallback(function(){for(var R=[],K=0;K<arguments.length;K++)R[K]=arguments[K];return I.current.apply(I,R)},[]);return[re,U]}function Gr(e,n,t,i,r,s){var d=r.query||i,a=yr(t,d,r,!1)(n),o=n.reobserveAsConcast(Nr(n,t,r,a));return s(a),new Promise(function(l){var c;o.subscribe({next:function(m){c=m},error:function(){l(Ci(n.getCurrentResult(),e.previousData,n,t))},complete:function(){l(Ci(n.maskResult(c),e.previousData,n,t))}})})}const Qr="modulepreload",Wr=function(e){return"https://cdn.MedusaJS.com/MedusaJScloud/shop-client/production/"+e},Ei={},Br=function(n,t,i){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),a=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));r=Promise.allSettled(t.map(o=>{if(o=Wr(o),o in Ei)return;Ei[o]=!0;const l=o.endsWith(".css"),c=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${c}`))return;const m=document.createElement("link");if(m.rel=l?"stylesheet":Qr,l||(m.as="script"),m.crossOrigin="",m.href=o,a&&m.setAttribute("nonce",a),document.head.appendChild(m),l)return new Promise((p,h)=>{m.addEventListener("load",p),m.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${o}`)))})}))}function s(d){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=d,window.dispatchEvent(a),!a.defaultPrevented)throw d}return r.then(d=>{for(const a of d||[])a.status==="rejected"&&s(a.reason);return n().catch(s)})};var Ft=(e=>(e.ALL="ALL",e.IN_NETWORK="IN_NETWORK",e.IN_NETWORK_WITH_FALLBACK="IN_NETWORK_WITH_FALLBACK",e.OUT_OF_NETWORK="OUT_OF_NETWORK",e))(Ft||{}),Xn=(e=>(e.ASSISTANT_MESSAGE="ASSISTANT_MESSAGE",e.SEARCH_MESSAGE="SEARCH_MESSAGE",e.TOOL_MESSAGE="TOOL_MESSAGE",e.USER_MESSAGE="USER_MESSAGE",e))(Xn||{}),Da=(e=>(e.READ_AND_WRITE="READ_AND_WRITE",e.READ_ONLY="READ_ONLY",e))(Da||{}),Oa=(e=>(e.SHOP="SHOP",e.STOREFRONT="STOREFRONT",e))(Oa||{});class Ai extends Lr{constructor(n){super(n.message),this.code=n.code,this.name="CartError",this.localizedMessage=this.localizeErrorMessage()}localizeErrorMessage(){return{CART_PRODUCT_NOT_FOUND:ye.t("LocalizedErrorMessage.CartProductNotFound"),CART_PRODUCT_OUT_OF_STOCK:ye.t("LocalizedErrorMessage.CartProductOutOfStock"),CART_SHOP_INELIGIBLE:ye.t("LocalizedErrorMessage.CartShopNotEligible"),CART_PRODUCT_NOT_ENOUGH_STOCK:ye.t("LocalizedErrorMessage.CartProductNotEnoughStock"),CART_PRODUCT_QUANTITY_INVALID:ye.t("LocalizedErrorMessage.CartProductQuantityInvalid"),CART_PRODUCT_STOCK_LIMIT_REACHED:ye.t("LocalizedErrorMessage.CartProductStockLimitReached")}[this.code]??ye.t("LocalizedErrorMessage.Default")}}var et={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"PromotionsInlineContent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"screenName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"promotions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"handle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"display"},arguments:[{kind:"Argument",name:{kind:"Name",value:"screenName"},value:{kind:"Variable",name:{kind:"Name",value:"screenName"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PromotionsInlineContent"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"primaryText"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"secondaryText"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayHints"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"primaryText"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"textVariant"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"textColor"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"secondaryText"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"textVariant"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"textColor"},arguments:[],directives:[]}]}}]}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:525}};et.loc.source={body:`query PromotionsInlineContent($screenName: String) {
  promotions {
    nodes {
      handle
      display(screenName: $screenName) {
        ... on PromotionsInlineContent {
          primaryText
          secondaryText
          displayHints {
            primaryText {
              textVariant
              textColor
            }
            secondaryText {
              textVariant
              textColor
            }
          }
        }
      }
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Fn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Fn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Fn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Fn(i,n)})}var Et={};(function(){et.definitions.forEach(function(n){if(n.name){var t=new Set;Fn(n,t),Et[n.name.value]=t}})})();function Ii(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function zr(e,n){var t={kind:e.kind,definitions:[Ii(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Et[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Et[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Ii(e,a);o&&t.definitions.push(o)}),t}zr(et,"PromotionsInlineContent");var Ze={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ShopInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Shop"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"followedByMe"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"websiteUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shareUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shopNetwork"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nativeProductPagesEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"storeEligible"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"defaultHandle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visualTheme"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"VisualTheme"},directives:[]}]}}]}}],loc:{start:0,end:235}};Ze.loc.source={body:`#import "./VisualThemeFragment.graphql"

fragment ShopInfo on Shop {
  id
  name
  followedByMe
  websiteUrl
  shareUrl
  shopNetwork
  nativeProductPagesEnabled
  storeEligible
  defaultHandle
  visualTheme {
    ...VisualTheme
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var _i={};function jr(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return _i[t]?!1:(_i[t]=!0,!0)})}Ze.definitions=Ze.definitions.concat(jr(ur.definitions));function En(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){En(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){En(i,n)}),e.definitions&&e.definitions.forEach(function(i){En(i,n)})}var At={};(function(){Ze.definitions.forEach(function(n){if(n.name){var t=new Set;En(n,t),At[n.name.value]=t}})})();function Ti(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Jr(e,n){var t={kind:e.kind,definitions:[Ti(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=At[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=At[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Ti(e,a);o&&t.definitions.push(o)}),t}Jr(Ze,"ShopInfo");var en={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"SellingPlanAllocationFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SellingPlanAllocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"priceAdjustments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"compareAtPrice"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"perDeliveryPrice"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"sellingPlan"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"recurringDeliveries"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"billingPolicy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SellingPlanRecurringBillingPolicy"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"interval"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"intervalCount"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"deliveryPolicy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SellingPlanRecurringDeliveryPolicy"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"interval"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"intervalCount"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"priceAdjustments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"orderCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"adjustmentValue"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SellingPlanPercentagePriceAdjustment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"adjustmentPercentage"},arguments:[],directives:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SellingPlanFixedPriceAdjustment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SellingPlanFixedAmountPriceAdjustment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"adjustmentAmount"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]},{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:1165}};en.loc.source={body:`#import "./MoneyV2Fragment.graphql"

fragment SellingPlanAllocationFragment on SellingPlanAllocation {
  priceAdjustments {
    price {
      ...MoneyV2Fragment
      __typename
    }
    compareAtPrice {
      ...MoneyV2Fragment
      __typename
    }
    perDeliveryPrice {
      ...MoneyV2Fragment
      __typename
    }
  }
  sellingPlan {
    id
    name
    recurringDeliveries
    billingPolicy {
      __typename
      ... on SellingPlanRecurringBillingPolicy {
        interval
        intervalCount
      }
    }
    deliveryPolicy {
      __typename
      ... on SellingPlanRecurringDeliveryPolicy {
        interval
        intervalCount
      }
    }
    priceAdjustments {
      orderCount
      adjustmentValue {
        __typename
        ... on SellingPlanPercentagePriceAdjustment {
          adjustmentPercentage
        }
        ... on SellingPlanFixedPriceAdjustment {
          price {
            ...MoneyV2Fragment
            __typename
          }
        }
        ... on SellingPlanFixedAmountPriceAdjustment {
          adjustmentAmount {
            ...MoneyV2Fragment
            __typename
          }
        }
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var wi={};function Kr(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return wi[t]?!1:(wi[t]=!0,!0)})}en.definitions=en.definitions.concat(Kr(Zn.definitions));function An(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){An(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){An(i,n)}),e.definitions&&e.definitions.forEach(function(i){An(i,n)})}var It={};(function(){en.definitions.forEach(function(n){if(n.name){var t=new Set;An(n,t),It[n.name.value]=t}})})();function Pi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Hr(e,n){var t={kind:e.kind,definitions:[Pi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=It[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=It[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Pi(e,a);o&&t.definitions.push(o)}),t}Hr(en,"SellingPlanAllocationFragment");var nn={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CartOfferFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CartOffer"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discountSummary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"addToCartSummary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"percentThresholdMet"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"hideProgressBar"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ShopCashOffer"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"adResponseId"},arguments:[],directives:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ShopCashCashbackIncentive"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AutomaticDiscount"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discountAmount"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"discountPercentage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discountType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discountClass"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"constraints"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FreeDeliveryCartOffer"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:745}};nn.loc.source={body:`#import "../../../data/fragments/MoneyV2Fragment.graphql"

fragment CartOfferFragment on CartOffer {
  id
  title
  description
  discountSummary
  addToCartSummary
  percentThresholdMet
  hideProgressBar
  source {
    ... on ShopCashOffer {
      id
      adResponseId # including for legacy reasons; this can be removed once all callsites are using shopCashIncentive and cacheConfig gets updated
    }
    ... on ShopCashCashbackIncentive {
      __typename
    }
    ... on AutomaticDiscount {
      id
      discountAmount {
        ...MoneyV2Fragment
      }
      discountPercentage
      discountType
      discountClass
      constraints {
        type
        text
      }
    }
    ... on FreeDeliveryCartOffer {
      id
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var bi={};function Yr(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return bi[t]?!1:(bi[t]=!0,!0)})}nn.definitions=nn.definitions.concat(Yr(Zn.definitions));function In(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){In(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){In(i,n)}),e.definitions&&e.definitions.forEach(function(i){In(i,n)})}var _t={};(function(){nn.definitions.forEach(function(n){if(n.name){var t=new Set;In(n,t),_t[n.name.value]=t}})})();function Mi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Xr(e,n){var t={kind:e.kind,definitions:[Mi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=_t[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=_t[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Mi(e,a);o&&t.definitions.push(o)}),t}Xr(nn,"CartOfferFragment");var nt={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DiscountAllocations"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"DiscountAllocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CartCodeDiscountAllocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discountedAmount"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currencyCode"},arguments:[],directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CartAutomaticDiscountAllocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discountedAmount"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currencyCode"},arguments:[],directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CartCustomDiscountAllocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discountedAmount"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currencyCode"},arguments:[],directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CartShopCashDiscountAllocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discountedAmount"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currencyCode"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:517}};nt.loc.source={body:`fragment DiscountAllocations on DiscountAllocation {
  ... on CartCodeDiscountAllocation {
    code
    discountedAmount {
      amount
      currencyCode
    }
  }
  ... on CartAutomaticDiscountAllocation {
    title
    discountedAmount {
      amount
      currencyCode
    }
  }
  ... on CartCustomDiscountAllocation {
    title
    discountedAmount {
      amount
      currencyCode
    }
  }
  ... on CartShopCashDiscountAllocation {
    title
    discountedAmount {
      amount
      currencyCode
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function _n(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){_n(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){_n(i,n)}),e.definitions&&e.definitions.forEach(function(i){_n(i,n)})}var Tt={};(function(){nt.definitions.forEach(function(n){if(n.name){var t=new Set;_n(n,t),Tt[n.name.value]=t}})})();function Ri(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Zr(e,n){var t={kind:e.kind,definitions:[Ri(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Tt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Tt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Ri(e,a);o&&t.definitions.push(o)}),t}Zr(nt,"DiscountAllocations");var tn={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CartVariantFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StorefrontProductVariant"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"slug"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"referral"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isPublishedToOnlineStoreChannel"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"variantImage"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ReducedImage"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"availableForSale"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"quantityAvailable"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"compareAtPrice"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currencyCode"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currencyCode"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:437}};tn.loc.source={body:`#import "../../../data/fragments/ReducedImageFragment.graphql"

fragment CartVariantFragment on StorefrontProductVariant {
  id
  title
  product {
    id
    url
    title
    slug
    referral
    isPublishedToOnlineStoreChannel
  }
  variantImage {
    id
    image {
      ...ReducedImage
    }
  }
  availableForSale
  quantityAvailable
  compareAtPrice {
    amount
    currencyCode
  }
  price {
    amount
    currencyCode
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var Di={};function es(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return Di[t]?!1:(Di[t]=!0,!0)})}tn.definitions=tn.definitions.concat(es(Sn.definitions));function Tn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Tn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Tn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Tn(i,n)})}var wt={};(function(){tn.definitions.forEach(function(n){if(n.name){var t=new Set;Tn(n,t),wt[n.name.value]=t}})})();function Oi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function ns(e,n){var t={kind:e.kind,definitions:[Oi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=wt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=wt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Oi(e,a);o&&t.definitions.push(o)}),t}ns(tn,"CartVariantFragment");var Ee={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CartRecommendedProductFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CartRecommendedProduct"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"discoveryProduct"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ProductCard"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"storefrontVariant"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inDefaultProductList"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"price"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"compareAtPrice"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"variantImage"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ReducedImage"},directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"recommendationSource"},arguments:[],directives:[]}]}}],loc:{start:0,end:559}};Ee.loc.source={body:`#import "../../../data/fragments/ProductCardFragment.graphql"
#import "../../../data/fragments/ReducedImageFragment.graphql"
#import "../../../data/fragments/MoneyV2Fragment.graphql"

fragment CartRecommendedProductFragment on CartRecommendedProduct {
  id
  discoveryProduct {
    ...ProductCard
  }
  storefrontVariant {
    id
    inDefaultProductList
    price {
      ...MoneyV2Fragment
    }
    compareAtPrice {
      ...MoneyV2Fragment
    }
    variantImage {
      id
      image {
        ...ReducedImage
      }
    }
  }
  recommendationSource
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var Li={};function ri(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return Li[t]?!1:(Li[t]=!0,!0)})}Ee.definitions=Ee.definitions.concat(ri(mr.definitions));Ee.definitions=Ee.definitions.concat(ri(Sn.definitions));Ee.definitions=Ee.definitions.concat(ri(Zn.definitions));function wn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){wn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){wn(i,n)}),e.definitions&&e.definitions.forEach(function(i){wn(i,n)})}var Pt={};(function(){Ee.definitions.forEach(function(n){if(n.name){var t=new Set;wn(n,t),Pt[n.name.value]=t}})})();function $i(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function ts(e,n){var t={kind:e.kind,definitions:[$i(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Pt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Pt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=$i(e,a);o&&t.definitions.push(o)}),t}ts(Ee,"CartRecommendedProductFragment");var tt={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CartWarningFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CartWarning"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}],loc:{start:0,end:65}};tt.loc.source={body:`fragment CartWarningFragment on CartWarning {
  code
  message
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Pn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Pn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Pn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Pn(i,n)})}var bt={};(function(){tt.definitions.forEach(function(n){if(n.name){var t=new Set;Pn(n,t),bt[n.name.value]=t}})})();function Vi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function is(e,n){var t={kind:e.kind,definitions:[Vi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=bt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=bt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Vi(e,a);o&&t.definitions.push(o)}),t}is(tt,"CartWarningFragment");var J={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CartFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Cart"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cartType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cartCost"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalPrice"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"discountAllocations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DiscountAllocations"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"warnings"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CartWarningFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"lines"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"IntValue",value:"50"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"cost"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalPrice"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"subtotalPrice"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"pricePerQuantity"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"compareAtPricePerQuantity"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MoneyV2Fragment"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"sellingPlanAllocation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SellingPlanAllocationFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"quantity"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"addedByUser"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lineComponents"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"productVariant"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CartVariantFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"quantity"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"productVariant"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CartVariantFragment"},directives:[]},{kind:"Field",name:{kind:"Name",value:"bundledBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CartVariantFragment"},directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ProductCardWithoutShopCash"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"lineItemErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"warnings"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CartWarningFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"discountAllocations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DiscountAllocations"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"inDefaultProductList"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"totalCount"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"shop"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"MedusaJSId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nativeSubscriptionsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"defaultHandle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shopCashCampaignValue"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currencyCode"},arguments:[],directives:[]}]}},{kind:"FragmentSpread",name:{kind:"Name",value:"ShopInfo"},directives:[]},{kind:"Field",name:{kind:"Name",value:"productReviewAnalytics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalProductReviews"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProductRatings"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"averageRating"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"shopCashIncentive"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ShopCashIncentiveFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"totalQuantity"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"offers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CartOfferFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"recommendations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CartRecommendedProductFragment"},directives:[]}]}}]}}],loc:{start:0,end:2328}};J.loc.source={body:`#import "../../../data/fragments/ShopInfoFragment.graphql"
#import "../../../data/fragments/MoneyV2Fragment.graphql"
#import "../../../data/fragments/ProductCardWithoutShopCashFragment.graphql"
#import "../../../data/fragments/ShopCashIncentiveFragment.graphql"
#import "../../../data/fragments/SellingPlanAllocationFragment.graphql"
#import "./CartOfferFragment.graphql"
#import "./DiscountAllocations.graphql"
#import "./CartVariantFragment.graphql"
#import "./CartRecommendedProductFragment.graphql"
#import "./CartWarningFragment.graphql"

fragment CartFragment on Cart {
  id
  cartType
  updatedBy
  cartCost {
    totalPrice {
      ...MoneyV2Fragment
    }
  }
  discountAllocations {
    ...DiscountAllocations
  }
  warnings {
    ...CartWarningFragment
  }
  lines(first: 50) {
    nodes {
      id
      cost {
        totalPrice {
          ...MoneyV2Fragment
        }
        subtotalPrice {
          ...MoneyV2Fragment
        }
        pricePerQuantity {
          ...MoneyV2Fragment
        }
        compareAtPricePerQuantity {
          ...MoneyV2Fragment
        }
      }
      sellingPlanAllocation {
        ...SellingPlanAllocationFragment
      }
      status
      quantity
      addedByUser
      lineComponents {
        id
        productVariant {
          ...CartVariantFragment
        }
        quantity
      }
      productVariant {
        ...CartVariantFragment
        bundledBy {
          nodes {
            ...CartVariantFragment
            product {
              ...ProductCardWithoutShopCash
            }
          }
          pageInfo {
            hasNextPage
          }
        }
      }
      lineItemErrors {
        code
        message
      }
      warnings {
        ...CartWarningFragment
      }
      discountAllocations {
        ...DiscountAllocations
      }
      inDefaultProductList
    }
    totalCount
  }
  shop {
    id
    MedusaJSId
    nativeSubscriptionsEnabled
    defaultHandle
    shopCashCampaignValue {
      amount
      currencyCode
    }
    ...ShopInfo

    productReviewAnalytics {
      totalProductReviews
      totalProductRatings
      averageRating
    }
  }
  shopCashIncentive {
    ...ShopCashIncentiveFragment
  }
  totalQuantity
  offers {
    ...CartOfferFragment
  }
  recommendations {
    ...CartRecommendedProductFragment
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var xi={};function Ie(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return xi[t]?!1:(xi[t]=!0,!0)})}J.definitions=J.definitions.concat(Ie(Ze.definitions));J.definitions=J.definitions.concat(Ie(Zn.definitions));J.definitions=J.definitions.concat(Ie(fr.definitions));J.definitions=J.definitions.concat(Ie(ti.definitions));J.definitions=J.definitions.concat(Ie(en.definitions));J.definitions=J.definitions.concat(Ie(nn.definitions));J.definitions=J.definitions.concat(Ie(nt.definitions));J.definitions=J.definitions.concat(Ie(tn.definitions));J.definitions=J.definitions.concat(Ie(Ee.definitions));J.definitions=J.definitions.concat(Ie(tt.definitions));function bn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){bn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){bn(i,n)}),e.definitions&&e.definitions.forEach(function(i){bn(i,n)})}var Mt={};(function(){J.definitions.forEach(function(n){if(n.name){var t=new Set;bn(n,t),Mt[n.name.value]=t}})})();function Ui(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function as(e,n){var t={kind:e.kind,definitions:[Ui(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Mt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Mt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Ui(e,a);o&&t.definitions.push(o)}),t}as(J,"CartFragment");var an={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CartLineItemAdd"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CartLineItemAddInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cartLineItemAdd"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cart"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"CartFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"field"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:241}};an.loc.source={body:`#import "./CartFragment.graphql"

mutation CartLineItemAdd($input: CartLineItemAddInput!) {
  cartLineItemAdd(input: $input) {
    cart {
      id
      ...CartFragment
    }
    userErrors {
      field
      message
      code
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var qi={};function rs(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return qi[t]?!1:(qi[t]=!0,!0)})}an.definitions=an.definitions.concat(rs(J.definitions));function Mn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Mn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Mn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Mn(i,n)})}var Rt={};(function(){an.definitions.forEach(function(n){if(n.name){var t=new Set;Mn(n,t),Rt[n.name.value]=t}})})();function Gi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function ss(e,n){var t={kind:e.kind,definitions:[Gi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Rt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Rt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Gi(e,a);o&&t.definitions.push(o)}),t}ss(an,"CartLineItemAdd");var rn={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CartLineItemSet"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shopId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"lineItemId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"quantity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cartLineItemSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"shopId"},value:{kind:"Variable",name:{kind:"Name",value:"shopId"}}},{kind:"ObjectField",name:{kind:"Name",value:"lineItemId"},value:{kind:"Variable",name:{kind:"Name",value:"lineItemId"}}},{kind:"ObjectField",name:{kind:"Name",value:"quantity"},value:{kind:"Variable",name:{kind:"Name",value:"quantity"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cart"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"CartFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"field"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:323}};rn.loc.source={body:`#import "./CartFragment.graphql"
mutation CartLineItemSet($shopId: ID!, $lineItemId: ID!, $quantity: Int!) {
  cartLineItemSet(
    input: {shopId: $shopId, lineItemId: $lineItemId, quantity: $quantity}
  ) {
    cart {
      id
      ...CartFragment
    }
    userErrors {
      code
      field
      message
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var Qi={};function os(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return Qi[t]?!1:(Qi[t]=!0,!0)})}rn.definitions=rn.definitions.concat(os(J.definitions));function Rn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Rn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Rn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Rn(i,n)})}var Dt={};(function(){rn.definitions.forEach(function(n){if(n.name){var t=new Set;Rn(n,t),Dt[n.name.value]=t}})})();function Wi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function ds(e,n){var t={kind:e.kind,definitions:[Wi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Dt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Dt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Wi(e,a);o&&t.definitions.push(o)}),t}ds(rn,"CartLineItemSet");var Ke={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CartList"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"carts"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"CartFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:230}};Ke.loc.source={body:`#import "./CartFragment.graphql"

query CartList($first: Int, $after: String) {
  carts(first: $first, after: $after) {
    nodes {
      id
      ...CartFragment
    }
    pageInfo {
      hasNextPage
      endCursor
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var Bi={};function cs(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return Bi[t]?!1:(Bi[t]=!0,!0)})}Ke.definitions=Ke.definitions.concat(cs(J.definitions));function Dn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Dn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Dn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Dn(i,n)})}var Ot={};(function(){Ke.definitions.forEach(function(n){if(n.name){var t=new Set;Dn(n,t),Ot[n.name.value]=t}})})();function zi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function ls(e,n){var t={kind:e.kind,definitions:[zi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Ot[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Ot[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=zi(e,a);o&&t.definitions.push(o)}),t}ls(Ke,"CartList");const ji=10,us={data:void 0,error:void 0,refetch(){},addToCart:()=>Promise.resolve(void 0),addToCartLoading:!1,setQuantity:()=>Promise.resolve(void 0),fetchMore(){},hasActiveCarts:!1,cartCount:{totalCartItems:0,totalCarts:0},cartForStore:()=>{},cartsLoading:!1,cartPromotionData:void 0},La=g.createContext(us);function ms(){return g.useContext(La)}const wd=({children:e})=>{const[n,t]=g.useState(!1),{userAuthState:i,currentUser:r,refetchIdentity:s}=Ia(),[d,a]=g.useState(!1),o=Rr(),l=_r(),{isCookiesConsentRequired:c}=or("root")||{isCookiesConsentRequired:!1},{preferredAddress:m}=Or(),[p]=Yn(an),[h]=Yn(rn),{pageType:y}=Tr(),{data:u}=gn(et,{variables:{screenName:"cart"},skip:y!==gt.Cart,ssr:y===gt.Cart,fetchPolicy:"cache-and-network"}),{data:v,error:N,loading:f,refetch:S,fetchMore:b,networkStatus:U}=gn(Ke,{variables:{first:ji},ssr:y===gt.Cart,fetchPolicy:"cache-first",nextFetchPolicy:"cache-and-network",errorPolicy:"all",skip:i===mn.Anonymous||i===mn.PhoneOnlyVerified}),V=g.useCallback(()=>{v!=null&&v.carts.pageInfo.hasNextPage&&U!==Je.fetchMore&&b({query:Ke,variables:{first:ji,after:v==null?void 0:v.carts.pageInfo.endCursor},updateQuery:ai("carts")})},[v,b,U]);g.useEffect(()=>{f||(v!=null&&v.carts.nodes&&(v==null?void 0:v.carts.nodes.length)>0?t(!0):t(!1))},[f,v==null?void 0:v.carts.nodes,t]);const z=g.useCallback(async({brokerId:D,variantId:P,quantity:A=1,attribution:M,sellingPlanId:x})=>{var te,ne,ie;try{if(i===mn.PhoneOnlyVerified){o({entityId:Fi.AddToCart,email:r==null?void 0:r.email,scope:"EMAIL"});return}a(!0);let T;if(i===mn.Anonymous&&(T=await Dr({triggerLogInWithShop:()=>o({entityId:Fi.AddToCart,scope:"EMAIL"}),cookies:l}),s()),T!=null&&T.ok||i!==mn.Anonymous){const{errors:_,data:Y}=await p({variables:{input:{shopId:D,variantId:P,quantity:A,attribution:M,sellingPlanId:x,mailingAddress:m!=null&&m.address?Mr(m.address):void 0}}});if(_)throw _;const j=(te=Y==null?void 0:Y.cartLineItemAdd)==null?void 0:te.userErrors;if(j&&j.length>0)throw new Ai(j[0]);if(((ne=Y==null?void 0:Y.cartLineItemAdd)==null?void 0:ne.cart)===null)throw new Error("null cart no userErrors");return S(),n||t(!0),ze(je.AddToCart,{success:!0,isCookiesConsentRequired:c}),a(!1),(ie=Y==null?void 0:Y.cartLineItemAdd)==null?void 0:ie.cart}else throw(T==null?void 0:T.ok)===!1?new Error("Failed to create guest user"):new Error("Failed to add to cart")}catch(T){throw a(!1),ze(je.AddToCart,{success:!1,isCookiesConsentRequired:c}),T}},[i,r==null?void 0:r.email,s,p,m==null?void 0:m.address,S,n,o,l,c]),q=g.useCallback(async({shopId:D,lineItemId:P,quantity:A=1})=>{var ne,ie,T,_;const{errors:M,data:x}=await h({variables:{shopId:D,lineItemId:P,quantity:A}});if(M)throw M;const te=(ne=x==null?void 0:x.cartLineItemSet)==null?void 0:ne.userErrors;if(te&&te.length>0)throw new Ai(te[0]);if(((ie=x==null?void 0:x.cartLineItemSet)==null?void 0:ie.cart)===null)throw new Error("null cart no userErrors");return(_=(T=x==null?void 0:x.cartLineItemSet)==null?void 0:T.cart)==null?void 0:_.id},[h]),I=g.useMemo(()=>{let D=0,P=0;return v==null||v.carts.nodes.forEach(A=>{D+=A.totalQuantity,P+=1}),{totalCartItems:D,totalCarts:P}},[v==null?void 0:v.carts.nodes]),re=g.useCallback(D=>v==null?void 0:v.carts.nodes.find(P=>P.shop.id===D),[v==null?void 0:v.carts.nodes]),R=g.useMemo(()=>{var A,M;const D=(M=(A=u==null?void 0:u.promotions)==null?void 0:A.nodes)==null?void 0:M[0];if(!D)return;const P=D.display;if((P==null?void 0:P.__typename)==="PromotionsInlineContent")return{handle:D.handle,primaryText:P.primaryText,secondaryText:P.secondaryText,displayHints:P.displayHints}},[u]),K=g.useMemo(()=>({data:v,error:N,refetch:S,cartCount:I,cartForStore:re,cartsLoading:f,fetchMore:V,addToCart:z,addToCartLoading:d,setQuantity:q,hasActiveCarts:n,availableShopCash:void 0,networkStatus:U,cartPromotionData:R}),[v,N,S,I,re,f,V,z,d,q,n,U,R]);return Hn.jsx(La.Provider,{value:K,children:e})},fs=/\/(\w[\w-]*)(?:\?(.*))*$/,Oe=e=>{const n=e.match(fs);if(n&&n[1]!==void 0)return n[1]},vs=({domain:e,model:n,modelId:t})=>`gid://${e}/${n}/${t}`,pt=e=>vs({domain:"MedusaJS",model:"AgentConversation",modelId:e});var St,Ji;function gs(){if(Ji)return St;Ji=1;var e=lr();function n(t,i){return e(t,i)}return St=n,St}var ks=gs();const ps=dr(ks);var Ss=(e=>(e.SearchBar="SearchBar",e.SimilaritySearch="SimilaritySearch",e.Chat="Chat",e.SoftAutoCorrection="SoftAutoCorrection",e.HardAutoCorrection="HardAutoCorrection",e.AgentConversation="AgentConversation",e))(Ss||{});const hs=-1;var $a=(e=>(e.ProductSearchModuleEmptyResult="ProductSearchModuleEmptyResult",e.ProductSearchModuleMerchantCard="ProductSearchModuleMerchantCard",e.ProductSearchModuleMerchantList="ProductSearchModuleMerchantList",e.ProductSearchModuleProductList="ProductSearchModuleProductList",e.ProductSearchModuleUniversalProductList="ProductSearchModuleUniversalProductList",e.ProductSearchModuleResultCount="ProductSearchModuleResultCount",e.ProductSearchModuleTrackingCTA="ProductSearchModuleTrackingCTA",e.ProductSearchModuleSoftAutoCorrection="ProductSearchModuleSoftAutoCorrection",e.ProductSearchModuleHardAutoCorrection="ProductSearchModuleHardAutoCorrection",e))($a||{});function Pd(e){return e.key==="price"}function bd(e){return e.key==="ratings"}function Md(e){return e.isToggle??!1}function ys(e){return e===void 0||e===0||e==="undefined"||e===null||Array.isArray(e)&&e.length===0}function Va(e){const n={...e};return Object.keys(n).forEach(t=>ys(n[t])&&delete n[t]),n}function Ye(e,n=!0){return e==null?n:e==="true"}function Rd(e){var n;if(!(!e.trim()||!e.startsWith("data:"))&&e.startsWith("data:")){const t=e.split("data:");if(t&&t.length===2)return JSON.parse((n=t[1])==null?void 0:n.trim())}}function Ns(e){return e==="null"||e==null||Number.isNaN(Number(e))?null:Number(e)}function Cs(e){let n;if(!e)return;const t=/(\d+)x(\d+)/,i=/(\d+)/;if(t.test(e))n=!0;else if(i.test(e))n=!1;else return;if(n){const[r,s]=t.exec(e).slice(1);return`gid://MedusaJS/ProductCategory/${r}?version=${s}`}return e}function Fs(e){if(!e)return;const n=/gid:\/\/MedusaJS\/ProductCategory\/(\d+)\?version=(\d+)/;if(!n.test(e))return;const[t,i]=n.exec(e).slice(1);return`${t}x${i}`}function Dd(e){var u;const n=e.getAll("colors"),t=e.getAll("sizes"),i=e.get("minPrice"),r=e.get("maxPrice"),s=e.get("quParams"),d=e.get("inStock"),a=e.getAll("brands"),o=e.get("onSale"),l=e.get("shipsFrom"),c=e.get("deepSearch"),m=e.get("network"),p=e.get("category"),h=e.get("ratings"),y=e.get("shopCashOffer");return Va({query:(e.get("query")||e.get("upsellSearchQuery"))??void 0,q:e.get("q")??void 0,sortBy:e.get("sortBy")??void 0,categorySortBy:e.get("categorySortBy")??void 0,shipsTo:((u=e.get("shipsTo"))==null?void 0:u.toUpperCase())??void 0,gender:e.get("gender")??void 0,colors:n.length>0?n:void 0,sizes:t.length>0?t:void 0,similarTo:e.get("similarTo")??void 0,initial:e.get("initial")??void 0,minPrice:Number(i)??void 0,maxPrice:Number(r)??void 0,brands:a.length>0?a:void 0,quParams:s?JSON.stringify(s):void 0,inStock:Ye(d,!1),onSale:Ye(o,!1),shipsFrom:Ye(l,!1),deepSearch:Ye(c,!1),network:Ye(m,!1),shopCashOffer:Ye(y,!1),category:Cs(p)??void 0,ratings:Ns(h),promotedProductId:e.get("promotedProduct")??void 0})}function Od(e,n){const t=e.find(i=>i.key==="price");return n.map(i=>(t&&i.key==="price"&&(i.options=t.options),i))}function Ld(e,n,t){return Array.isArray(n)?e.filter(i=>n.includes(i.value))||[]:e.find(i=>i.value===n)}function $d(e,n){const{key:t,options:i}=e,r=n[t];return Array.isArray(r)?i.filter(s=>r.includes(s.value))||[]:i.find(s=>s.value===r)}const Es=e=>e==="true"?!0:e==="false"?!1:e,Vd=(e,n)=>{var d;const{key:t,options:i}=e,r=n[t];if(t==="network"&&r===!0)return!0;if(Array.isArray(r))return r.some(a=>{var o;return(o=i.find(l=>l.value===a))==null?void 0:o.value});const s=Es(r);return!!((d=i.find(a=>a.value===s))!=null&&d.value)};function As(e,n){const{sortBy:t,categorySortBy:i,colors:r,sizes:s,gender:d,shipsTo:a,shipsFrom:o,minPrice:l,maxPrice:c,onSale:m,network:p,deepSearch:h,brands:y,ratings:u,category:v,shopCashOffer:N}=e,f=[];return t&&f.push({key:"sortBy",value:t}),i&&f.push({key:"categorySortBy",value:i}),r&&f.push({key:"colors",value:r}),s&&f.push({key:"sizes",value:s}),d&&f.push({key:"gender",value:d}),y&&f.push({key:"brands",value:y}),u&&f.push({key:"ratings",value:u}),v&&f.push({key:"category",value:{categoryGid:v}}),f.push({key:"shipsTo",value:a?{address:{country:a}}:{useDefault:!0}}),f.push({key:"price",value:{min:l||void 0,max:c||void 0}}),m&&f.push({key:"onSale",value:m}),o&&f.push({key:"shipsFrom",value:o}),p&&f.push({key:"network",value:p?Ft.IN_NETWORK:Ft.ALL}),h&&f.push({key:"deepSearch",value:h}),N&&f.push({key:"shopCashOffer",value:N}),f.push({key:"inStock",value:!0}),n&&f.push({key:"quParams",value:{preference:n}}),f}function xd(e){return e.__typename==="ProductSearchModuleProductList"}function Ud(e){return e.__typename==="ProductSearchModuleUniversalProductList"}function qd(e){return e.__typename==="ProductSearchModuleMerchantList"}function Gd(e){return e.__typename==="ProductSearchModuleMerchantCard"}function Qd(e){return e.__typename==="ProductSearchModuleSoftAutoCorrection"}function Wd(e){return e.__typename==="ProductSearchModuleHardAutoCorrection"}const Is=[{key:"sortBy",isMulti:!1},{key:"categorySortBy",isMulti:!1},{key:"colors",isMulti:!0},{key:"price",isMulti:!0},{key:"sizes",isMulti:!0},{key:"gender",isMulti:!1},{key:"onSale",isMulti:!1,isToggle:!0},{key:"ratings",isMulti:!1},{key:"category",isMulti:!1},{key:"shipsTo",isMulti:!1},{key:"shopCashOffer",isMulti:!1,isToggle:!0},{key:"network",isMulti:!1,isToggle:!0},{key:"shipsFrom",isMulti:!1,isToggle:!0},{key:"deepSearch",isMulti:!1,isToggle:!0}];function Bd(e){const n=[];return e==null||e.forEach(t=>{const i=t.configurations.find(r=>r.__typename==="ProductFilterSheetConfiguration");if(i){const r=Is.find(s=>s.key===t.key);if(r){const s=t.configurations.find(l=>l.__typename==="ProductFilterPillConfiguration");let d=(s==null?void 0:s.position)??hs;r.key==="shipsTo"&&(d=i.position);let a=i.options.map(l=>({label:l.label,value:l.value,configuration:l.configuration}));r.key==="sortBy"&&(a=a.filter(l=>l.value!=="most_recent"));const o=r.key==="network"?ye.t("Search.Filters.Following"):i.title;r.isMulti?n.push({key:r.key,title:o,options:a,isMulti:!0,selectedValue:t.value,isToggle:!1,defaultValue:t.defaultValue,inferredValue:t.inferredValue,sheetPosition:i.position,barPosition:d}):n.push({key:t.key,title:o,options:a,isMulti:r==null?void 0:r.isMulti,selectedValue:t.value,isToggle:r==null?void 0:r.isToggle,defaultValue:t.defaultValue,inferredValue:t.inferredValue,sheetPosition:i.position,barPosition:d})}}}),n}function _s(e){return e==null?void 0:e.replace(/"/g,"")}function zd(e){const n=new URLSearchParams;return Object.entries(Va(e)).forEach(([t,i])=>{if(Array.isArray(i)){i.forEach(r=>n.append(t,r));return}else{if(t==="onSale"&&!i)return;if(t==="shipsFrom"&&!i)return;if(t==="deepSearch"&&!i)return;if(t==="shopCashOffer"&&!i)return;if(t==="inStock"&&i)return;if(t==="ratings"&&i===null)return;if(t==="network"){if(!i)return;n.append(t,i?"true":"false");return}else if(t==="category"&&i){const r=Fs(i);if(!r)return;n.append(t,r);return}}n.append(t,i)}),n.toString()}const Ts=e=>e.__typename in $a,jd=e=>{if(e)return e.filter(Ts)},Jd=e=>{var t,i;let n=null;switch(e.__typename){case"ProductSearchModuleMerchantList":n={id:((t=e==null?void 0:e.gid)==null?void 0:t.modelId)??"-1",type:"merchant_list",results:e.shops??[]};break;case"ProductSearchModuleMerchantCard":n={id:((i=e==null?void 0:e.gid)==null?void 0:i.modelId)??"-1",type:"merchant_card",results:[e.shop]};break;case"ProductSearchModuleProductList":n={id:e.gid.modelId??"-1",type:"product_list",results:e.products};break;case"ProductSearchModuleUniversalProductList":n={id:e.gid.modelId??"-1",type:"universal_product_list",results:e.products};break;case"ProductSearchModuleSoftAutoCorrection":n={id:e.gid.modelId??"-1",type:"soft_auto_correction",results:[{suggestedQuery:e.suggestedQuery,__typename:"SoftAutoCorrection"}]};break;case"ProductSearchModuleHardAutoCorrection":n={id:e.gid.modelId??"-1",type:"hard_auto_correction",results:[{suggestedQuery:e.suggestedQuery,originalQuery:e.originalQuery,__typename:"HardAutoCorrection"}]};break}return n};var it={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ShopFollowedByMe"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Shop"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followedByMe"},arguments:[],directives:[]}]}}],loc:{start:0,end:53}};it.loc.source={body:`fragment ShopFollowedByMe on Shop {
  followedByMe
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function On(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){On(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){On(i,n)}),e.definitions&&e.definitions.forEach(function(i){On(i,n)})}var Lt={};(function(){it.definitions.forEach(function(n){if(n.name){var t=new Set;On(n,t),Lt[n.name.value]=t}})})();function Ki(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function ws(e,n){var t={kind:e.kind,definitions:[Ki(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Lt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Lt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Ki(e,a);o&&t.definitions.push(o)}),t}ws(it,"ShopFollowedByMe");var $e={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ProductSearchModuleMerchantCardFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleMerchantCard"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shop"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"defaultHandle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"MedusaJSId"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ShopFollowedByMe"},directives:[]},{kind:"Field",name:{kind:"Name",value:"websiteUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"productReviewAnalytics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalProductReviews"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProductRatings"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"averageRating"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"inAppVisibilityStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shopCashIncentive"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ShopCashIncentiveFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"visualTheme"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"logoImage"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"altText"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sensitive"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:677}};$e.loc.source={body:`#import "../../../data/fragments/ShopCashIncentiveFragment.graphql"
#import "../../../data/fragments/ShopFollowedByMe.graphql"

fragment ProductSearchModuleMerchantCardFragment on ProductSearchModuleMerchantCard {
  gid {
    modelId
  }
  id
  shop {
    id
    name
    defaultHandle
    MedusaJSId
    ...ShopFollowedByMe
    websiteUrl
    productReviewAnalytics {
      totalProductReviews
      totalProductRatings
      averageRating
    }
    inAppVisibilityStatus
    shopCashIncentive {
      ...ShopCashIncentiveFragment
    }
    visualTheme {
      id
      logoImage {
        url
        altText
        height
        width
        sensitive
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var Hi={};function xa(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return Hi[t]?!1:(Hi[t]=!0,!0)})}$e.definitions=$e.definitions.concat(xa(ti.definitions));$e.definitions=$e.definitions.concat(xa(it.definitions));function Ln(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Ln(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Ln(i,n)}),e.definitions&&e.definitions.forEach(function(i){Ln(i,n)})}var $t={};(function(){$e.definitions.forEach(function(n){if(n.name){var t=new Set;Ln(n,t),$t[n.name.value]=t}})})();function Yi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Ps(e,n){var t={kind:e.kind,definitions:[Yi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=$t[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=$t[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Yi(e,a);o&&t.definitions.push(o)}),t}Ps($e,"ProductSearchModuleMerchantCardFragment");var at={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ProductSearchModuleResultCount"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleResultCount"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"totalCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}],loc:{start:0,end:120}};at.loc.source={body:`fragment ProductSearchModuleResultCount on ProductSearchModuleResultCount {
  gid {
    modelId
  }
  totalCount
  id
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function $n(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){$n(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){$n(i,n)}),e.definitions&&e.definitions.forEach(function(i){$n(i,n)})}var Vt={};(function(){at.definitions.forEach(function(n){if(n.name){var t=new Set;$n(n,t),Vt[n.name.value]=t}})})();function Xi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function bs(e,n){var t={kind:e.kind,definitions:[Xi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Vt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Vt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Xi(e,a);o&&t.definitions.push(o)}),t}bs(at,"ProductSearchModuleResultCount");var rt={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ProductSearchModuleTrackingCTA"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleTrackingCTA"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}],loc:{start:0,end:107}};rt.loc.source={body:`fragment ProductSearchModuleTrackingCTA on ProductSearchModuleTrackingCTA {
  gid {
    modelId
  }
  id
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Vn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Vn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Vn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Vn(i,n)})}var xt={};(function(){rt.definitions.forEach(function(n){if(n.name){var t=new Set;Vn(n,t),xt[n.name.value]=t}})})();function Zi(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Ms(e,n){var t={kind:e.kind,definitions:[Zi(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=xt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=xt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=Zi(e,a);o&&t.definitions.push(o)}),t}Ms(rt,"ProductSearchModuleTrackingCTA");var st={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ProductSearchModuleEmptyResult"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleEmptyResult"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}],loc:{start:0,end:107}};st.loc.source={body:`fragment ProductSearchModuleEmptyResult on ProductSearchModuleEmptyResult {
  gid {
    modelId
  }
  id
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function xn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){xn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){xn(i,n)}),e.definitions&&e.definitions.forEach(function(i){xn(i,n)})}var Ut={};(function(){st.definitions.forEach(function(n){if(n.name){var t=new Set;xn(n,t),Ut[n.name.value]=t}})})();function ea(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Rs(e,n){var t={kind:e.kind,definitions:[ea(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Ut[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Ut[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=ea(e,a);o&&t.definitions.push(o)}),t}Rs(st,"ProductSearchModuleEmptyResult");var Ae={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ProductSearchModuleMerchantList"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleMerchantList"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"shops"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shareUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visualTheme"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"logoImage"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ReducedImage"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"featuredImages"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ReducedImage"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"brandSettings"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"BrandSettings"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"productReviewAnalytics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"averageRating"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProductReviews"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"totalProductRatings"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"shopCashIncentive"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeShopCashOfferMerchants"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ShopCashIncentiveFragment"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"offers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AutomaticDiscount"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:841}};Ae.loc.source={body:`#import "../../../../data/fragments/ReducedImageFragment.graphql"
#import "../../../../data/fragments/ShopCashIncentiveFragment.graphql"
#import "../../../../data/fragments/BrandSettingsFragment.graphql"

fragment ProductSearchModuleMerchantList on ProductSearchModuleMerchantList {
  title
  gid {
    modelId
  }
  shops {
    id
    name
    shareUrl
    visualTheme {
      id
      logoImage {
        ...ReducedImage
      }
      featuredImages {
        ...ReducedImage
      }
      brandSettings {
        ...BrandSettings
      }
    }
    productReviewAnalytics {
      averageRating
      totalProductReviews
      totalProductRatings
    }
    shopCashIncentive @include(if: $includeShopCashOfferMerchants) {
      ...ShopCashIncentiveFragment
    }
    offers {
      ... on AutomaticDiscount {
        id
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var na={};function si(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return na[t]?!1:(na[t]=!0,!0)})}Ae.definitions=Ae.definitions.concat(si(Sn.definitions));Ae.definitions=Ae.definitions.concat(si(ti.definitions));Ae.definitions=Ae.definitions.concat(si(vr.definitions));function Un(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Un(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Un(i,n)}),e.definitions&&e.definitions.forEach(function(i){Un(i,n)})}var qt={};(function(){Ae.definitions.forEach(function(n){if(n.name){var t=new Set;Un(n,t),qt[n.name.value]=t}})})();function ta(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Ds(e,n){var t={kind:e.kind,definitions:[ta(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=qt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=qt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=ta(e,a);o&&t.definitions.push(o)}),t}Ds(Ae,"ProductSearchModuleMerchantList");var ot={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ProductSearchModuleSoftAutoCorrection"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleSoftAutoCorrection"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"suggestedQuery"},arguments:[],directives:[]}]}}],loc:{start:0,end:138}};ot.loc.source={body:`fragment ProductSearchModuleSoftAutoCorrection on ProductSearchModuleSoftAutoCorrection {
  gid {
    modelId
  }
  id
  suggestedQuery
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function qn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){qn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){qn(i,n)}),e.definitions&&e.definitions.forEach(function(i){qn(i,n)})}var Gt={};(function(){ot.definitions.forEach(function(n){if(n.name){var t=new Set;qn(n,t),Gt[n.name.value]=t}})})();function ia(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Os(e,n){var t={kind:e.kind,definitions:[ia(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Gt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Gt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=ia(e,a);o&&t.definitions.push(o)}),t}Os(ot,"ProductSearchModuleSoftAutoCorrection");var dt={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ProductSearchModuleHardAutoCorrection"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleHardAutoCorrection"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"suggestedQuery"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"originalQuery"},arguments:[],directives:[]}]}}],loc:{start:0,end:154}};dt.loc.source={body:`fragment ProductSearchModuleHardAutoCorrection on ProductSearchModuleHardAutoCorrection {
  gid {
    modelId
  }
  id
  suggestedQuery
  originalQuery
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Gn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Gn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Gn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Gn(i,n)})}var Qt={};(function(){dt.definitions.forEach(function(n){if(n.name){var t=new Set;Gn(n,t),Qt[n.name.value]=t}})})();function aa(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Ls(e,n){var t={kind:e.kind,definitions:[aa(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Qt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Qt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=aa(e,a);o&&t.definitions.push(o)}),t}Ls(dt,"ProductSearchModuleHardAutoCorrection");var sn={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ProductSearchModuleUniversalProductList"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleUniversalProductList"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"products"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shopCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"productIds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"highlightedProduct"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"DiscoveryProductFragment"},directives:[]}]}}]}}]}}],loc:{start:0,end:326}};sn.loc.source={body:`#import "../../../product/graphql/fragments/DiscoveryProductFragment.graphql"

fragment ProductSearchModuleUniversalProductList on ProductSearchModuleUniversalProductList {
  gid {
    modelId
  }
  products {
    id
    shopCount
    productIds
    highlightedProduct {
      id
      ...DiscoveryProductFragment
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var ra={};function $s(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return ra[t]?!1:(ra[t]=!0,!0)})}sn.definitions=sn.definitions.concat($s(ii.definitions));function Qn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Qn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Qn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Qn(i,n)})}var Wt={};(function(){sn.definitions.forEach(function(n){if(n.name){var t=new Set;Qn(n,t),Wt[n.name.value]=t}})})();function sa(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function Vs(e,n){var t={kind:e.kind,definitions:[sa(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Wt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Wt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=sa(e,a);o&&t.definitions.push(o)}),t}Vs(sn,"ProductSearchModuleUniversalProductList");var Z={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"WebModular"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"query"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SearchFilterV2"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"similarTo"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"categoryBrowseId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeFilters"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!0},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeMerchantCards"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!0},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeShopCashOfferMerchants"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webProductSearchModular"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"query"},value:{kind:"Variable",name:{kind:"Name",value:"query"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"filters"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"categoryBrowseId"},value:{kind:"Variable",name:{kind:"Name",value:"categoryBrowseId"}}},{kind:"Argument",name:{kind:"Name",value:"similarTo"},value:{kind:"Variable",name:{kind:"Name",value:"similarTo"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"debugDetails"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ProductSearchModuleResultCount"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ProductSearchModuleTrackingCTA"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ProductSearchModuleEmptyResult"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ProductSearchModuleSoftAutoCorrection"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ProductSearchModuleHardAutoCorrection"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ProductSearchModuleUniversalProductList"},directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleMerchantCard"}},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMerchantCards"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ProductSearchModuleMerchantCardFragment"},directives:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleProductList"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"gid"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"products"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"DiscoveryProduct"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DiscoveryProductFragment"},directives:[]}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductSearchModuleMerchantList"}},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMerchantCards"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ProductSearchModuleMerchantList"},directives:[]},{kind:"Field",name:{kind:"Name",value:"shops"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"defaultHandle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"websiteUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inAppVisibilityStatus"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"MedusaJSId"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"productFilters"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeFilters"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"defaultValue"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"inferredValue"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"value"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"configurations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductFilterSheetConfiguration"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"icon"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"screenTitle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filterKind"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"refreshOnUpdate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"refreshOptionsOnUpdate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accessibilityLabel"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"configuration"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"icon"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"value"},arguments:[],directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ProductFilterPillConfiguration"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"endCursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"startCursor"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:2776}};Z.loc.source={body:`#import "../../product/graphql/fragments/DiscoveryProductFragment.graphql"
#import "./ProductSearchModuleMerchantCardFragment.graphql"
#import "./fragments/ProductSearchModuleResultCountFragment.graphql"
#import "./fragments/ProductSearchModuleTrackingCTAFragment.graphql"
#import "./fragments/ProductSearchModuleEmptyResultFragment.graphql"
#import "./fragments/ProductSearchModuleMerchantListFragment.graphql"
#import "./fragments/ProductSearchModuleSoftAutoCorrectionFragment.graphql"
#import "./fragments/ProductSearchModuleHardAutoCorrectionFragment.graphql"
#import "./fragments/ProductSearchModuleUniversalProductListFragment.graphql"

query WebModular(
  $first: Int!
  $query: String
  $after: String
  $filter: [SearchFilterV2!]
  $similarTo: [ID!]
  $categoryBrowseId: ID
  $includeFilters: Boolean = true
  $includeMerchantCards: Boolean = true
  $includeShopCashOfferMerchants: Boolean = false
) {
  webProductSearchModular(
    first: $first
    query: $query
    after: $after
    filters: $filter
    categoryBrowseId: $categoryBrowseId
    similarTo: $similarTo
  ) {
    debugDetails
    nodes {
      __typename
      ...ProductSearchModuleResultCount
      ...ProductSearchModuleTrackingCTA
      ...ProductSearchModuleEmptyResult
      ...ProductSearchModuleSoftAutoCorrection
      ...ProductSearchModuleHardAutoCorrection
      ...ProductSearchModuleUniversalProductList
      ... on ProductSearchModuleMerchantCard
        @include(if: $includeMerchantCards) {
        ...ProductSearchModuleMerchantCardFragment
      }
      ... on ProductSearchModuleProductList {
        gid {
          modelId
        }
        products {
          __typename
          id
          ... on DiscoveryProduct {
            ...DiscoveryProductFragment
          }
        }
      }
      ... on ProductSearchModuleMerchantList
        @include(if: $includeMerchantCards) {
        ...ProductSearchModuleMerchantList
        shops {
          id
          defaultHandle
          websiteUrl
          inAppVisibilityStatus
          MedusaJSId
        }
      }
    }
    productFilters @include(if: $includeFilters) {
      key
      defaultValue
      inferredValue
      value
      configurations {
        ... on ProductFilterSheetConfiguration {
          __typename
          title
          icon
          screenTitle
          filterKind
          position
          refreshOnUpdate
          refreshOptionsOnUpdate
          options {
            accessibilityLabel
            configuration
            icon
            label
            value
          }
        }

        ... on ProductFilterPillConfiguration {
          __typename
          position
        }
      }
    }
    pageInfo {
      endCursor
      hasNextPage
      startCursor
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var oa={};function be(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return oa[t]?!1:(oa[t]=!0,!0)})}Z.definitions=Z.definitions.concat(be(ii.definitions));Z.definitions=Z.definitions.concat(be($e.definitions));Z.definitions=Z.definitions.concat(be(at.definitions));Z.definitions=Z.definitions.concat(be(rt.definitions));Z.definitions=Z.definitions.concat(be(st.definitions));Z.definitions=Z.definitions.concat(be(Ae.definitions));Z.definitions=Z.definitions.concat(be(ot.definitions));Z.definitions=Z.definitions.concat(be(dt.definitions));Z.definitions=Z.definitions.concat(be(sn.definitions));function Wn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Wn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Wn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Wn(i,n)})}var Bt={};(function(){Z.definitions.forEach(function(n){if(n.name){var t=new Set;Wn(n,t),Bt[n.name.value]=t}})})();function da(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function xs(e,n){var t={kind:e.kind,definitions:[da(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Bt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Bt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=da(e,a);o&&t.definitions.push(o)}),t}xs(Z,"WebModular");const Us=30,Ua=()=>{const[e]=Ra(Z,{notifyOnNetworkStatusChange:!0,fetchPolicy:"cache-and-network"});return{prefetchSearchResults:g.useCallback(t=>{e({variables:{first:Us,query:_s(t),filter:As({}),includeShopCashOfferMerchants:!0}})},[e])}};function qs(e){return{version:1,navigateToCanvas(n){var t;(t=e.navigateToCanvas)==null||t.call(e,n.query,n.productId)},navigateToCheckout(n){var t;(t=e.navigateToCheckout)==null||t.call(e,n.cartId,n.shopId)},navigateToProduct(n){var t;(t=e.navigateToProduct)==null||t.call(e,n.productId,n.variantId)},navigateToOrder(n){var t;(t=e.navigateToOrder)==null||t.call(e,n.orderId)},navigateToOrderHistory(){var n;(n=e.navigateToOrderHistory)==null||n.call(e)},navigateToSearch(n){var t;(t=e.navigateToSearch)==null||t.call(e,n.searchTerm)},navigateToShop(n){var t;(t=e.navigateToShop)==null||t.call(e,n.shopId,n.searchParams)},addToCart(n){var t;(t=e.addToCart)==null||t.call(e,n.brokerId,n.variantId,n.variantImageUrl)},streamingStateChanged(n){var t;(t=e.streamingStateChanged)==null||t.call(e,n.isStreaming)},emptyStateVisible(n){var t;(t=e.emptyStateVisible)==null||t.call(e,n.visible)},hasMessages(n){var t;(t=e.hasMessages)==null||t.call(e,n.hasMessages)},ratingFormVisible(n){var t;(t=e.ratingFormVisible)==null||t.call(e,n.visible)},readyToPostMessage(){var n;(n=e.readyToPostMessage)==null||n.call(e)},logToNative(n){var t;(t=e.logToNative)==null||t.call(e,n.message)},refetchThreads(){var n;(n=e.refetchThreads)==null||n.call(e)},refetchCarts(){var n;(n=e.refetchCarts)==null||n.call(e)},updateProductLists(n){var t;(t=e.updateProductLists)==null||t.call(e,n.productId,n.productTitle,n.variantId,n.shopId,n.actionIntent,n.imageUrl)},setConversationId(n){var t;(t=e.setConversationId)==null||t.call(e,n.conversationId)},setConversationTitle(n){var t;(t=e.setConversationTitle)==null||t.call(e,n.conversationTitle)},openAgentSources(n){var t;(t=e.openAgentSources)==null||t.call(e,n.sources)},openProductFeedback(n){var t;(t=e.openProductFeedback)==null||t.call(e,n.products,n.assistantMessageId,n.overallRating)}}}function Gs(){if(typeof window>"u"||!window.AgentSDK)return;const e=window.AgentSDK;return typeof e.version=="number"&&e.version>=2?e:qs(e)}let ht;function qa(){return ht===void 0&&(ht=Gs()),ht}var Q=(e=>(e.Text="text",e.RawProducts="raw_products",e.HydratedProducts="hydrated_products",e.Feedback="feedback",e.Cart="cart",e.ExternalResource="external_resource",e.FeedSection="feed_section",e.WorkPreview="work_preview",e.LoadingSkeleton="loading_skeleton",e))(Q||{}),H=(e=>(e.User="user",e.Assistant="assistant",e.Search="search",e))(H||{}),G=(e=>(e.Failed="failed",e.Success="success",e.Aborted="aborted",e.Reconnecting="reconnecting",e.ConnectionFailed="connection_failed",e))(G||{}),Ga=(e=>(e.MessageLimitExceeded="message_limit_exceeded",e))(Ga||{}),$=(e=>(e.CreateShopSupportRequest="create_shop_support_request",e.DeleteMemories="delete_memories",e.ExtractMemories="extract_memories",e.GetActiveShoppingCarts="get_active_shopping_carts",e.GetGlobalProductDetails="get_global_product_details",e.GetProductShippingDetails="get_product_shipping_details",e.GetShoppingCartDetails="get_shopping_cart_details",e.MerchantContactInfo="merchant_contact_info",e.SearchBuyerOrders="search_buyer_orders",e.SearchGlobalProducts="search_global_products",e.SearchShopPoliciesAndFaqs="search_shop_policies_and_faqs",e.UpdateShoppingCarts="update_shopping_carts",e.WebSearch="web_search",e))($||{}),we=(e=>(e.Text="text",e.Thinking="thinking",e))(we||{}),Qs=(e=>(e.Suggestion="suggestion",e.User="user",e))(Qs||{}),Qa=(e=>(e.SimilarTo="SimilarTo",e.Sources="Sources",e))(Qa||{});class Wa extends Error{constructor(){super("Aborted"),this.name="AbortError"}}const Ws=10,Kd=50,Hd=4,Bs=5,zs=1e3,Yd={[$.SearchGlobalProducts]:"shopAI:AgentWorkPreview.SearchingGlobalProducts",[$.WebSearch]:"shopAI:AgentWorkPreview.WebSearch",[$.CreateShopSupportRequest]:"shopAI:AgentWorkPreview.CreateShopSupportRequest",[$.DeleteMemories]:"shopAI:AgentWorkPreview.DeleteMemories",[$.ExtractMemories]:"shopAI:AgentWorkPreview.ExtractMemories",[$.GetActiveShoppingCarts]:"shopAI:AgentWorkPreview.GetActiveShoppingCarts",[$.GetGlobalProductDetails]:"shopAI:AgentWorkPreview.GetGlobalProductDetails",[$.GetProductShippingDetails]:"shopAI:AgentWorkPreview.GetProductShippingDetails",[$.GetShoppingCartDetails]:"shopAI:AgentWorkPreview.GetShoppingCartDetails",[$.MerchantContactInfo]:"shopAI:AgentWorkPreview.MerchantContactInfo",[$.SearchBuyerOrders]:"shopAI:AgentWorkPreview.SearchBuyerOrders",[$.SearchShopPoliciesAndFaqs]:"shopAI:AgentWorkPreview.SearchShopPoliciesAndFaqs",[$.UpdateShoppingCarts]:"shopAI:AgentWorkPreview.UpdateShoppingCarts"},js="web",Js="native-webview",ge="gid://MedusaJS/AgentConversation/temp-id",Ks={headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"},streaming_format:"simplified_v2",streaming_format_delta:"delta"},me={MESSAGE:"message",THINKING:"thinking",END:"end",UI:"ui",ASSISTANT_MESSAGE_ID:"assistant_message_id",SEARCH_MESSAGE_ID:"search_message_id",CONVERSATION_TITLE:"conversation_title",CONVERSATION_SUGGESTIONS:"conversation_suggestions",MESSAGE_LOADER:"message_loader",LOADER_ADAPTIVE_UI_MESSAGE:"loader_adaptive_ui_message",PRODUCT_REASON:"product_reason",TOOL_CALL:"tool_call",TOOL_CALL_START:"tool_call_start"},ca={REFRESH_CART:"refresh_cart",NAVIGATE:"navigate"},Ba=e=>e.includes("```adaptive_ui");function zt(e){return e==="USER_MESSAGE"}function Hs(e){return e==="SEARCH_MESSAGE"}function Ys(e){return e==="ASSISTANT_MESSAGE"}function Xd(e){return e.sender===H.Search&&e.content.type===Q.WorkPreview}function Zd(e){return Ir(e.__typename)&&e.__typename==="AgentSource"}const Xs=e=>{let n;switch(!0){case zt(e):n=H.User;break;case Hs(e):n=H.Search;break;case Ys(e):n=H.Assistant;break;default:n=H.Assistant;break}return n},Zs=({url:e,size:n=32})=>{if(!e)return null;try{return`https://www.google.com/s2/favicons?domain=${new URL(e).hostname}&sz=${n}`}catch{return null}},eo=e=>{try{return!!new URL(e)}catch{return!1}},no=e=>{try{const n=new URL(e).hostname,t="www.";return n.startsWith(t)?n.substring(t.length):n}catch{return null}},ec=e=>{try{if(new URL(e).protocol==="shopapp:")return!1;const t=no(e);return!(t==="shop.app"||t==="web-shop-client.shop.dev"||t!=null&&t.endsWith(".shop.app"))}catch{return!0}};function De(e){switch(to(e)){case Q.FeedSection:return{...gr([e])[0],type:Q.FeedSection};case Q.ExternalResource:{if(!e.url||!eo(e.url))return null;const t=e.faviconUrl||Zs({url:e.url,size:128});return{__typename:"AgentSource",url:e.url,title:e.title||"",description:e.description||"",faviconUrl:t}}default:return null}}function to(e){return e===null||typeof e!="object"?null:kr(e)||pr(e)||Aa(e)?Q.FeedSection:e.__typename==="ExternalResource"?Q.ExternalResource:null}function za(e){const n=/```(?:json|adaptive_ui)?\s*([\s\S]*?)\s*```/gi,t=/<ui id="([^"]+)">([\s\S]*?)<\/ui>/gi,i=/<ui id="([^"]+)">[\s\S]*$/i,r=[];let s=0;const d=[];let a;for(;(a=n.exec(e))!==null;)d.push({type:"code_block",index:a.index,length:a[0].length,content:a[1].trim()});let o;for(;(o=t.exec(e))!==null;)d.push({type:"ui_block",index:o.index,length:o[0].length,content:"",uiBlockId:o[1]});const l=e.match(i);if(l){const c=e.lastIndexOf(l[0]);d.some(p=>p.type==="ui_block"&&p.index===c)||d.push({type:"ui_block",index:c,length:l[0].length,content:"",uiBlockId:l[1]})}d.sort((c,m)=>c.index-m.index);for(const c of d){if(c.index>s){const m=e.slice(s,c.index).trim();m&&r.push({type:"text",content:m})}if(c.type==="code_block")try{const m=JSON.parse(c.content);r.push({type:"json",content:c.content,parsedJson:m})}catch{r.push({type:"text",content:`\`\`\`${c.content}\`\`\``})}else c.type==="ui_block"&&r.push({type:"ui_block",content:"",uiBlockId:c.uiBlockId});s=c.index+c.length}if(s<e.length){const c=e.slice(s).trim();c&&r.push({type:"text",content:c})}return r}const la="<shop:thinking>";function ja(e){const n=/<shop:\s*?thinking>([\s\S]*?)<\/shop:\s*?thinking>/g,t=[];let i=0,r;for(;(r=n.exec(e))!==null;){if(r.index>i){const o=e.slice(i,r.index).trim();o&&t.push({type:we.Text,content:o,done:!0})}const a=r[1].trim();a&&t.push({type:we.Thinking,content:a,done:!0}),i=r.index+r[0].length}const s=e.lastIndexOf(la);if(s!==-1&&s>=i){if(s>i){const o=e.slice(i,s).trim();o&&t.push({type:we.Text,content:o,done:!0})}const a=e.slice(s+la.length).trim();a&&t.push({type:we.Thinking,content:a})}else if(i<e.length){const a=e.slice(i).trim();a&&t.push({type:we.Text,content:a})}return t.length===0&&e.trim()&&t.push({type:we.Text,content:e}),t}function io(e){return(e==null?void 0:e.__typename)==="UpdateCartResponse"}const ao=e=>{const n=e.id,t=e.toolResponse,i=[];return io(t)&&t.carts.forEach(r=>{i.push({id:n,assistantMessageId:n,sender:H.Assistant,content:{type:Q.Cart,id:r.id,brokerId:r.shopId},status:G.Success})}),i};var Pe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AgentConversationMessages"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"agentConversationMessages"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"messages"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"feedback"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"rating"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"content"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"toolResponse"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UpdateCartResponse"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"carts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shopId"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"products"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"DiscoveryProduct"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DiscoveryProductFragment"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"messageContext"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shops"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visualTheme"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"logoImage"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ReducedImage"},directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"products"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"images"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ReducedImage"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"images"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ReducedImage"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"orders"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"page"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"screen"},arguments:[],directives:[]}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"startCursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"mode"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:1491}};Pe.loc.source={body:`#import "../../product/graphql/fragments/DiscoveryProductFragment.graphql"
#import "../../../data/fragments/ReducedImageFragment.graphql"

query AgentConversationMessages(
  $conversationId: ID!
  $first: Int
  $after: String
) {
  agentConversationMessages(
    conversationId: $conversationId
    first: $first
    after: $after
  ) {
    id
    title
    messages {
      nodes {
        content
        id
        type
        updatedAt
        createdAt
        feedback {
          rating
          content
        }
        toolResponse {
          __typename
          ... on UpdateCartResponse {
            carts {
              id
              shopId
            }
          }
        }
        products {
          ... on DiscoveryProduct {
            ...DiscoveryProductFragment
          }
        }
        messageContext {
          shops {
            id
            name
            visualTheme {
              id
              logoImage {
                ...ReducedImage
              }
            }
          }
          products {
            id
            title
            images {
              ...ReducedImage
            }
          }
          images {
            id
            image {
              ...ReducedImage
            }
          }
          orders {
            id
          }
          page {
            screen
          }
        }
      }
      pageInfo {
        hasNextPage
        startCursor
        endCursor
      }
    }
    mode
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var ua={};function Ja(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return ua[t]?!1:(ua[t]=!0,!0)})}Pe.definitions=Pe.definitions.concat(Ja(ii.definitions));Pe.definitions=Pe.definitions.concat(Ja(Sn.definitions));function Bn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Bn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Bn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Bn(i,n)})}var jt={};(function(){Pe.definitions.forEach(function(n){if(n.name){var t=new Set;Bn(n,t),jt[n.name.value]=t}})})();function ma(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function ro(e,n){var t={kind:e.kind,definitions:[ma(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=jt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=jt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=ma(e,a);o&&t.definitions.push(o)}),t}ro(Pe,"AgentConversationMessages");const fa=new Set,so=({conversationId:e,isConversationGenerating:n})=>{var S,b,U;const{prefetchSearchResults:t}=Ua(),[i,r]=ni(),s=g.useRef(null),{showToast:d}=_a(),a=g.useRef(!1),{data:o,loading:l,networkStatus:c,error:m,refetch:p,fetchMore:h}=gn(Pe,{variables:{conversationId:e,first:Bs},skip:e===ge,fetchPolicy:"cache-and-network",notifyOnNetworkStatusChange:!0}),y=(S=o==null?void 0:o.agentConversationMessages)==null?void 0:S.messages,{messages:u,firstUserMessage:v}=g.useMemo(()=>{let V=null;return l&&!(y!=null&&y.nodes)?{messages:[],firstUserMessage:null}:y?{messages:y.nodes.reduce((q,I,re)=>{var T;const R=Xs(I.type),K=I.content,D=I.type,P=G.Success,A=I.toolResponse,M=I.messageContext;if(R===H.User&&(V||(V=I.content)),D===Xn.TOOL_MESSAGE){if(A){const _=ao(I);q.push(..._)}return q}const x=Ba(K),te=za(K),ne=[];x&&te.forEach(_=>{if(_.type==="json"&&_.parsedJson)if(Array.isArray(_.parsedJson))for(const Y of _.parsedJson){const j=De(Y);j&&j.__typename==="AgentSource"&&ne.push(j)}else{const Y=De(_.parsedJson);Y&&Y.__typename==="AgentSource"&&ne.push(Y)}});let ie=!1;if(te.forEach((_,Y)=>{if(_.type==="text"){const j=ne.length>0&&Y===0,ke=Y===0&&R===H.User;ie=!0,q.push({id:I.id,assistantMessageId:I.id,sender:R,content:{type:Q.Text,text:_.content},status:P,...j&&{sources:ne},...ke&&{context:M}})}else if(_.type==="json"&&_.parsedJson&&x)if(Array.isArray(_.parsedJson))for(const j of _.parsedJson){const ke=De(j);ke&&ke.__typename!=="AgentSource"&&q.push({id:I.id,assistantMessageId:I.id,sender:R,content:ke,status:G.Success})}else{const j=De(_.parsedJson);j&&j.__typename!=="AgentSource"&&q.push({id:I.id,assistantMessageId:I.id,sender:R,content:j,status:G.Success})}}),ne.length>0&&!ie&&q.push({id:`${I.id}_sources`,assistantMessageId:I.id,sender:R,content:{type:Q.Text,text:""},status:P,sources:ne}),te.length>0&&!zt(I.type)){const _=ja(I.content);if(!new Set(_.map(j=>j.type)).has(we.Thinking)){const j=y==null?void 0:y.nodes[re+1];(!j||zt(j.type))&&q.push({id:I.id,assistantMessageId:I.id,sender:R,feedback:(T=I.feedback)==null?void 0:T.rating,content:{type:Q.Feedback}})}}return q},[]),firstUserMessage:V}:{messages:[],firstUserMessage:null}},[l,y]);g.useEffect(()=>{if(!v||e===ge)return;t(v);const V=Oe(e)||e;!(s.current!==V)||i.get("conversationId")!==V||(s.current=V,r(I=>(I.set("query",v),I),{preventScrollReset:!0,replace:!0}))},[v,e,t,i,r]);const N=g.useCallback(async()=>{if(e!==ge)try{a.current&&(a.current=!1,await p()),await h({variables:{conversationId:e,after:y==null?void 0:y.pageInfo.endCursor,first:zs},updateQuery:ai("agentConversationMessages.messages",{reverse:!0})}),fa.add(e)}catch(V){Ct.notify(V),d({variant:"error",title:ye.t("shopAI:Messages.FailedToLoadOlderMessages")})}},[e,h,y==null?void 0:y.pageInfo.endCursor,p,d]);g.useEffect(()=>{n&&(a.current=!0)},[n]),g.useEffect(()=>()=>{p()},[p]);const f=c===Je.ready&&(o==null?void 0:o.agentConversationMessages)!==void 0;return{messages:u||[],title:((b=o==null?void 0:o.agentConversationMessages)==null?void 0:b.title)??null,mode:((U=o==null?void 0:o.agentConversationMessages)==null?void 0:U.mode)??Da.READ_AND_WRITE,loading:l&&!(u!=null&&u.length),responseReceived:f,isLoadingPreviousMessages:c===Je.fetchMore,hasPreviousMessages:!!(y!=null&&y.pageInfo.endCursor)&&!fa.has(e),fetchPreviousMessages:N,error:m}};var on={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AgentConversations"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"agentConversations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastMessageSentAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastUpdatedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"agentMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"shopId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"recentProductImages"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ReducedImage"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"startCursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:425}};on.loc.source={body:`#import "../../../data/fragments/ReducedImageFragment.graphql"

query AgentConversations($first: Int, $after: String) {
  agentConversations(first: $first, after: $after) {
    nodes {
      id
      lastMessageSentAt
      lastUpdatedAt
      title
      agentMode
      shopId
      recentProductImages {
        ...ReducedImage
      }
    }

    pageInfo {
      hasNextPage
      startCursor
      endCursor
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};var va={};function oo(e){return e.filter(function(n){if(n.kind!=="FragmentDefinition")return!0;var t=n.name.value;return va[t]?!1:(va[t]=!0,!0)})}on.definitions=on.definitions.concat(oo(Sn.definitions));function zn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){zn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){zn(i,n)}),e.definitions&&e.definitions.forEach(function(i){zn(i,n)})}var Jt={};(function(){on.definitions.forEach(function(n){if(n.name){var t=new Set;zn(n,t),Jt[n.name.value]=t}})})();function ga(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function co(e,n){var t={kind:e.kind,definitions:[ga(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Jt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Jt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=ga(e,a);o&&t.definitions.push(o)}),t}co(on,"AgentConversations");const lo=()=>{var m,p,h,y,u;const[e,n]=g.useState(!1),{data:t,loading:i,fetchMore:r,networkStatus:s,refetch:d}=gn(on,{variables:{first:Ws,after:null},notifyOnNetworkStatusChange:!0});g.useEffect(()=>{!i&&t&&!e&&n(!0)},[i,t,e]);const a=g.useMemo(()=>{var v,N;return((N=(v=t==null?void 0:t.agentConversations)==null?void 0:v.pageInfo)==null?void 0:N.hasNextPage)||!1},[(p=(m=t==null?void 0:t.agentConversations)==null?void 0:m.pageInfo)==null?void 0:p.hasNextPage]),o=g.useMemo(()=>{var v,N;return((N=(v=t==null?void 0:t.agentConversations)==null?void 0:v.nodes)==null?void 0:N.filter(f=>f.title))||[]},[(h=t==null?void 0:t.agentConversations)==null?void 0:h.nodes]),l=s===Je.fetchMore,c=g.useCallback(()=>{var v,N;!a||s!==Je.ready||!((N=(v=t==null?void 0:t.agentConversations)==null?void 0:v.pageInfo)!=null&&N.endCursor)||r({variables:{first:10,after:t.agentConversations.pageInfo.endCursor},updateQuery:ai("agentConversations")})},[(u=(y=t==null?void 0:t.agentConversations)==null?void 0:y.pageInfo)==null?void 0:u.endCursor,r,a,s]);return{conversations:o,loading:i,fetchMore:c,fetchingMore:l,networkStatus:s,refetch:d,hasNextPage:a,initialFetchComplete:e}};var ct={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AgentCreateConversation"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"agentConversationCreate"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"agentConversation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:108}};ct.loc.source={body:`mutation AgentCreateConversation {
  agentConversationCreate {
    agentConversation {
      id
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function jn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){jn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){jn(i,n)}),e.definitions&&e.definitions.forEach(function(i){jn(i,n)})}var Kt={};(function(){ct.definitions.forEach(function(n){if(n.name){var t=new Set;jn(n,t),Kt[n.name.value]=t}})})();function ka(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function uo(e,n){var t={kind:e.kind,definitions:[ka(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Kt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Kt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=ka(e,a);o&&t.definitions.push(o)}),t}uo(ct,"AgentCreateConversation");function mo(){const[e]=Yn(ct);return{createConversation:g.useCallback(async()=>{var t,i;try{const{data:r,errors:s}=await e();if(s||!((i=(t=r==null?void 0:r.agentConversationCreate)==null?void 0:t.agentConversation)!=null&&i.id))throw new Error("Failed to create conversation");return{conversationId:r.agentConversationCreate.agentConversation.id||null}}catch{return{conversationId:null}}},[e])}}var lt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AgentStreamUrlCreate"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"agentStreamUrlCreate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"streamUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"field"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:192}};lt.loc.source={body:`mutation AgentStreamUrlCreate($conversationId: ID!) {
  agentStreamUrlCreate(conversationId: $conversationId) {
    streamUrl
    userErrors {
      code
      field
      message
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Jn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Jn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Jn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Jn(i,n)})}var Ht={};(function(){lt.definitions.forEach(function(n){if(n.name){var t=new Set;Jn(n,t),Ht[n.name.value]=t}})})();function pa(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function fo(e,n){var t={kind:e.kind,definitions:[pa(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Ht[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Ht[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=pa(e,a);o&&t.definitions.push(o)}),t}fo(lt,"AgentStreamUrlCreate");const vo=()=>{const[e]=Yn(lt);return{createStreamUrl:g.useCallback(async t=>{try{const{data:i,errors:r}=await e({variables:{conversationId:t}});return r||i!=null&&i.agentStreamUrlCreate.userErrors&&(i==null?void 0:i.agentStreamUrlCreate.userErrors.length)>0?{success:!1,errors:r||(i==null?void 0:i.agentStreamUrlCreate.userErrors)}:{success:!0,streamUrl:i==null?void 0:i.agentStreamUrlCreate.streamUrl}}catch(i){return{success:!1,error:i}}},[e])}};function go(e){const{isStaff:n,promptContext:t,streamingFormat:i,queryClassifierIntent:r}=e,s=ko({isStaff:n,promptContext:t,queryClassifierIntent:r});return{streaming_format:i,...s?{overrides:s}:{}}}function ko(e){var s,d,a,o;const{isStaff:n,promptContext:t,queryClassifierIntent:i}=e,r={};if(i&&(r.query_classifier={intent:i}),n&&(t!=null&&t.enabled)){t.model&&(r.model=t.model),t.prompt_version&&t.prompt_version!=="custom"&&(r.prompt_version=t.prompt_version),(!t.prompt_version||t.prompt_version==="custom")&&t.system_prompt&&(r.system_prompt=t.system_prompt),t.context_message&&(r.context_message=t.context_message),t.tools&&(r.tools=t.tools.map(h=>({tool_name:h.tool_name,overrides:{name:h.name||h.tool_name,description:h.description}}))),t.search_first!==void 0&&(r.search_first=t.search_first),t.reasoning_effort!==void 0&&(r.reasoning_effort=t.reasoning_effort),(s=t.query_classifier)!=null&&s.fast_agent&&(r.query_classifier={...r.query_classifier,fast_agent:t.query_classifier.fast_agent}),(d=t.shopkick)!=null&&d.staging_id&&(r.shopkick={staging_id:t.shopkick.staging_id});const l={},c=t.agentic_search;(a=c==null?void 0:c.query_rewriter)!=null&&a.model&&(l.query_rewriter={model:c.query_rewriter.model});const m=c==null?void 0:c.product_reranker;if(m&&(m.model||m.threshold!==void 0||m.max_products!==void 0)){const h={};m.model&&(h.model=m.model),m.threshold!==void 0&&(h.threshold=m.threshold),m.max_products!==void 0&&(h.max_products=m.max_products),l.product_reranker=h}(o=c==null?void 0:c.option_filter)!=null&&o.model&&(l.option_filter={model:c.option_filter.model});const p=c==null?void 0:c.final_response;p&&(p.model||p.system_prompt)&&(l.final_response={...p.model?{model:p.model}:{},...p.system_prompt?{system_prompt:p.system_prompt}:{}}),Object.keys(l).length>0&&(r.agentic_search=l)}return Object.keys(r).length>0?r:void 0}function Sa(e){return e.filter(n=>n.sender===H.User).length+1}function po(e){return{__typename:"RichText",segments:[{__typename:"RichTextSegment",text:e,traits:[],action:null,image:null}],blockHints:null}}function So(e,n,t){var o,l;if(Aa(e)){const c=e.item;if(vn(c)&&((o=c.product)==null?void 0:o.id)===n){const m=c.descriptors||[],p=m.length?m:[t];return{...e,item:{...c,descriptors:p}}}return null}if(!("items"in e)||!((l=e.items)!=null&&l.nodes)||!Array.isArray(e.items.nodes))return null;const i=e.items.nodes.findIndex(c=>{var m;return vn(c)&&((m=c.product)==null?void 0:m.id)===n});if(i===-1)return null;const r=e.items.nodes[i];if(!vn(r))return null;const s=r.descriptors||[],d=s.length?s:[t],a=[...e.items.nodes];return a[i]={...r,descriptors:d},{...e,items:{...e.items,nodes:a}}}const Ka="shop-ai-agent-mode",Yt="shop-ai-shop-id",ho=()=>typeof window>"u"?"shop":localStorage.getItem(Ka)==="storefront"?"storefront":"shop",yo=()=>{if(typeof window>"u")return;const e=localStorage.getItem(Yt);return e?parseInt(e,10):void 0},No=Ta()(e=>({context:{enabled:!1,model:"",overrided:!1,system_prompt:"",context_message:"",tools:[],prompt_version:"custom",override_fast_agent_settings:!1,shopkick:{staging_id:""},agentic_search:{query_rewriter:{model:""},product_reranker:{model:"",threshold:void 0,max_products:void 0},option_filter:{model:""},final_response:{model:"",system_prompt:""}}},agentMode:ho(),shopId:yo(),actions:{setOverrides:n=>{e(t=>({context:{...t.context,...n}}))},setAgentMode:n=>{typeof window<"u"&&localStorage.setItem(Ka,n),e({agentMode:n})},setShopId:n=>{typeof window<"u"&&(n===void 0?localStorage.removeItem(Yt):localStorage.setItem(Yt,n.toString())),e({shopId:n})}}}));function ha(e){var r,s,d;const{images:n,resources:t,page:i}=e;return{__typename:"MessageContext",images:(n==null?void 0:n.map(a=>({__typename:"UserImage",id:Be(),image:{__typename:"Image",url:a,sensitive:!1}})))||[],products:((r=t==null?void 0:t.products)==null?void 0:r.filter(a=>a.image_url).map(a=>({__typename:"DiscoveryProduct",id:a.product_id,title:a.title||"",images:[{__typename:"Image",url:a.image_url||"",sensitive:!1}]})))||[],shops:((s=t==null?void 0:t.shops)==null?void 0:s.filter(a=>a.name).map(a=>({__typename:"Shop",id:a.shop_id,name:a.name||"",visualTheme:{__typename:"VisualTheme",id:Be(),logoImage:{__typename:"Image",url:a.logo_image_url||"",sensitive:!1}}})))||[],orders:((d=t==null?void 0:t.orders)==null?void 0:d.map(a=>({__typename:"Order",id:Oe(a.order_id)||""})))||[],page:i!=null&&i.screen?{__typename:"Page",screen:i.screen}:void 0}}function nc(e){var s,d,a,o,l;if(!e)return;const n=(s=e.images)==null?void 0:s.map(c=>{var m;return(m=c.image)==null?void 0:m.url}).filter(c=>!!c),t=(d=e.products)==null?void 0:d.map(c=>{var m,p;return{product_id:c.id,title:c.title||void 0,image_url:((p=(m=c.images)==null?void 0:m[0])==null?void 0:p.url)||void 0}}),i=(a=e.shops)==null?void 0:a.map(c=>{var m,p;return{shop_id:c.id,name:c.name||void 0,logo_image_url:((p=(m=c.visualTheme)==null?void 0:m.logoImage)==null?void 0:p.url)||void 0}}),r=(o=e.orders)==null?void 0:o.map(c=>({order_id:c.id}));return{...n?{images:n}:{},resources:{...t?{products:t}:{},...i?{shops:i}:{},...r?{orders:r}:{}},...(l=e.page)!=null&&l.screen?{page:{screen:e.page.screen}}:{}}}function Ha(e,n){switch(e){case $.SearchGlobalProducts:{const t=n.queries;if(!t||!Array.isArray(t)||t.length===0)return null;const i=t.map(r=>typeof r=="string"?r:r==null?void 0:r.query).filter(Boolean);return i.length>0?{type:$.SearchGlobalProducts,queries:i}:null}case $.WebSearch:case"batch_web_search":{const t=n.queries;if(!t||!Array.isArray(t)||t.length===0)return null;const i=t.map(s=>s==null?void 0:s.buyer_explanation).filter(Boolean);if(i.length>0)return{type:$.WebSearch,searchExplanations:i};const r=t.filter(s=>typeof s=="string"&&!!s);return r.length>0?{type:$.WebSearch,searchExplanations:r}:null}case $.CreateShopSupportRequest:case $.DeleteMemories:case $.ExtractMemories:case $.GetActiveShoppingCarts:case $.GetGlobalProductDetails:case $.GetProductShippingDetails:case $.MerchantContactInfo:case $.SearchBuyerOrders:case $.SearchShopPoliciesAndFaqs:case $.UpdateShoppingCarts:return{type:e,queries:[],sources:[]};default:return null}}const Co=({rawMessageData:e})=>{var n;try{const t=JSON.parse(e),i=(n=t==null?void 0:t.tool_call)==null?void 0:n.function;return(t==null?void 0:t.status)!=="start"?null:Ha(i==null?void 0:i.name,(i==null?void 0:i.arguments)??{})}catch{return null}};function Fo(e){let n=e.trim(),t="";for(;t!==n;)t=n,n=n.replace(/^```(?:adaptive_ui|json)?\s*\n?/,""),n=n.replace(/\n?```\s*$/,""),n=n.trim();return n}function Eo(e){const n=e.trim().toLowerCase();return n.startsWith("<ui>")||n.startsWith("<ui ")}function Ao(e,n){let t=n;if(typeof t=="string"){const i=Fo(t);if(Eo(i))return null;t=i}try{const i=typeof t=="string"?JSON.parse(t):t,r=De(i);return r&&r.__typename!=="AgentSource"?{content:r,id:e}:null}catch{return null}}class Io{constructor(){this.pendingToolCalls=new Map}getKey(n,t=0){return`${n}:${t}`}onToolCall(n){const t=n.index??0,i=this.getKey(n.name,t),r=this.pendingToolCalls.get(i);r?r.arguments+=n.arguments_delta:this.pendingToolCalls.set(i,{name:n.name,index:t,arguments:n.arguments_delta})}onToolCallStart(n){const t=n.index??0,i=this.getKey(n.name,t),r=this.pendingToolCalls.get(i);if(!r)return null;this.pendingToolCalls.delete(i);try{const s=JSON.parse(r.arguments);return Ha(n.name,s)}catch{return null}}getPendingToolCall(n,t=0){const i=this.getKey(n,t);return this.pendingToolCalls.get(i)}reset(){this.pendingToolCalls.clear()}}var ut={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"UserFiles"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userFiles"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nodes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fileStatus"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserImage"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:180}};ut.loc.source={body:`query UserFiles($ids: [ID!]!) {
  userFiles(ids: $ids) {
    nodes {
      id
      fileStatus
      ... on UserImage {
        image {
          url
        }
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function Kn(e,n){if(e.kind==="FragmentSpread")n.add(e.name.value);else if(e.kind==="VariableDefinition"){var t=e.type;t.kind==="NamedType"&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(i){Kn(i,n)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(i){Kn(i,n)}),e.definitions&&e.definitions.forEach(function(i){Kn(i,n)})}var Xt={};(function(){ut.definitions.forEach(function(n){if(n.name){var t=new Set;Kn(n,t),Xt[n.name.value]=t}})})();function ya(e,n){for(var t=0;t<e.definitions.length;t++){var i=e.definitions[t];if(i.name&&i.name.value==n)return i}}function _o(e,n){var t={kind:e.kind,definitions:[ya(e,n)]};e.hasOwnProperty("loc")&&(t.loc=e.loc);var i=Xt[n]||new Set,r=new Set,s=new Set;for(i.forEach(function(a){s.add(a)});s.size>0;){var d=s;s=new Set,d.forEach(function(a){if(!r.has(a)){r.add(a);var o=Xt[a]||new Set;o.forEach(function(l){s.add(l)})}})}return r.forEach(function(a){var o=ya(e,a);o&&t.definitions.push(o)}),t}_o(ut,"UserFiles");const To=()=>{const[e]=Ra(ut,{fetchPolicy:"network-only"}),{send:n}=Ea(()=>({fetchUserFiles:async t=>{var r,s,d,a,o,l;const i=await e({variables:{ids:t}});if(((d=(s=(r=i.data)==null?void 0:r.userFiles)==null?void 0:s.nodes)==null?void 0:d.length)!==0)return(l=(o=(a=i.data)==null?void 0:a.userFiles)==null?void 0:o.nodes)==null?void 0:l.map(c=>{var m;return(c==null?void 0:c.__typename)==="UserImage"?(m=c.image)==null?void 0:m.url:null}).filter(c=>c!=null)}}));return{actions:n}},Zt={SUCCESS:"sse_success",ERROR:"sse_error"};class Ya extends Error{constructor(n="Message limit exceeded for this conversation"){super(n),this.name="MessageLimitExceededError"}}class Xa extends Error{constructor(n){super("EventSource connection failed"),this.name="StreamDisconnectError",this.messageId=n,this.shouldRecover=!0}}class Za extends Error{constructor(n){super("Invalid conversation ID: must be a GID or valid UUID format"),this.name="InvalidConversationIdError",this.conversationId=n}}class er extends Error{constructor(){super("Turn mismatch: client state is stale"),this.name="TurnMismatchError"}}function wo(e){return{url:e.streamUrl,body:{message:{conversation_id:e.validatedId,content:e.content,context:e.context,scenario:"ShopAgent",features:["shop_agent/default"]},config:e.config,expected_turn_number:e.expectedTurnNumber},headers:{"Content-Type":"application/json",Accept:"text/event-stream","MedusaJS-Client-Id":"shop"}}}function Po(e){return{url:`${ba()}/agents/conversations/${e.validatedId}/messages`,body:{message:{content:e.content,context:e.context},config:e.config,expected_turn_number:e.expectedTurnNumber},headers:{"Content-Type":"application/json",Accept:"text/event-stream","X-Allow-Cookie-Auth":"true","X-User-Agent":Ma(navigator.userAgent)}}}function Na(e,n,t){!n||!t||t({schemaId:"shop_app_agent_event_tracked/1.0",payload:{name:e,timestamp:Date.now(),conversationId:n.conversationId,shopAiMessageId:n.shopAiMessageId,turn:n.turn,clientPlatformType:n.clientPlatformType,toolName:n.toolName??"",metadata:n.metadata??"{}"}})}function bo(e){var t;if(!e.firstTextTimestamp)return;const n=new Date().getTime();(t=e.reportEvent)==null||t.call(e,{schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:pn.Conversation,entityId:e.messageId?`${e.conversationId}:${e.messageId}`:e.conversationId,interactionType:de.AiChatStreamEnd,interactionValue:(n-e.streamStartTimestamp).toString()}}),ze(je.AiChatMessageStreamingTotalDuration,{},n-e.firstTextTimestamp)}async function Mo(e){let n=null;if(e.startsWith("gid://")){const i=Oe(e);i&&(n=i)}else wa(e)&&(n=e);if(!n)throw new Za(e);const t=`${ba()}/agents/conversations/${n}/stream`;await fetch(t,{method:"DELETE",headers:{"X-Allow-Cookie-Auth":"true","X-User-Agent":Ma(navigator.userAgent)},credentials:"include"})}async function Ro(e,n){const{conversationId:t,content:i,context:r,config:s,abortSignal:d,reportEvent:a,eventContext:o,expectedTurnNumber:l,streamUrl:c,inNativeWebView:m}=e,p=new Date().getTime(),h=m?Js:js;a==null||a({schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:pn.Conversation,entityId:t,interactionType:de.AiChatStreamStart,interactionValue:p.toString()}});let y=null;if(t.startsWith("gid://")){const N=Oe(t);N&&(y=N)}else wa(t)&&(y=t);if(!y)throw new Za(t);const u=c?wo({streamUrl:c,validatedId:y,content:i,context:r,config:s,expectedTurnNumber:l}):Po({validatedId:y,content:i,context:r,config:s,expectedTurnNumber:l}),v=await fetch(u.url,{method:"POST",headers:u.headers,body:JSON.stringify(u.body),signal:d,credentials:"include"});if(v.status===422)throw new Ya;if(v.status===409)throw new er;if(!v.ok)throw ce(le.AiChatMessageHttpStatus,{error:!0,type:Zt.ERROR,httpStatus:v.status.toString(),platform:h}),new Error(`Streaming failed: ${v.status}`);return Do(v.body,n,{conversationId:t,streamStartTimestamp:p,reportEvent:a,abortSignal:d,eventContext:o,platform:h})}async function Do(e,n,t){const{EventSourceParserStream:i}=await Br(async()=>{const{EventSourceParserStream:r}=await import("./stream-DJPM25mX.js");return{EventSourceParserStream:r}},[]);return new Promise((r,s)=>{const d=new TextDecoder,a=e.pipeThrough(new TransformStream({transform(u,v){v.enqueue(d.decode(u,{stream:!0}))},flush(u){const v=d.decode();v&&u.enqueue(v)}})).pipeThrough(new i).getReader();let o=null,l,c=!1,m=!1,p=!1;const h=()=>{y(),s(new Wa)},y=(u=!0)=>{var v;p||(p=!0,u&&!m&&(bo({conversationId:t.conversationId,streamStartTimestamp:t.streamStartTimestamp,messageId:l,firstTextTimestamp:o,reportEvent:t.reportEvent}),m=!0),Na(de.AgentSseConnectionClosed,t.eventContext,t.reportEvent),(v=t.abortSignal)==null||v.removeEventListener("abort",h),a.releaseLock())};t.abortSignal&&t.abortSignal.addEventListener("abort",h),(async()=>{var u,v,N,f,S,b,U,V,z,q,I,re,R,K;try{for(Na(de.AgentSseConnectionOpened,t.eventContext,t.reportEvent);;){const{done:D,value:P}=await a.read();if(D)break;const A=P;switch(A.event){case me.MESSAGE:{!o&&A.data.length>0&&(o=new Date().getTime(),(u=t.reportEvent)==null||u.call(t,{schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:pn.Conversation,entityId:t.conversationId,interactionType:de.AiChatStreamMessageStart,interactionValue:(o-t.streamStartTimestamp).toString()}}),c||(ce(le.AiChatMessageHttpStatus,{error:!1,type:Zt.SUCCESS,platform:t.platform}),c=!0)),(v=n.onMessage)==null||v.call(n,A.data);break}case me.ASSISTANT_MESSAGE_ID:l=A.data,(N=n.onAssistantMessageId)==null||N.call(n,A.data);break;case me.SEARCH_MESSAGE_ID:l=A.data,(f=n.onSearchMessageId)==null||f.call(n,A.data);break;case me.MESSAGE_LOADER:(S=n.onMessageLoader)==null||S.call(n,A.data);break;case me.THINKING:(b=n.onThinking)==null||b.call(n);break;case me.UI:(U=n.onUi)==null||U.call(n,JSON.parse(A.data));break;case me.LOADER_ADAPTIVE_UI_MESSAGE:(V=n.onLoaderAdaptiveUiMessage)==null||V.call(n,A.data);break;case me.CONVERSATION_TITLE:(z=n.onConversationTitle)==null||z.call(n,A.data);break;case me.CONVERSATION_SUGGESTIONS:(q=n.onConversationSuggestion)==null||q.call(n,A.data);break;case me.PRODUCT_REASON:try{const M=JSON.parse(A.data);(I=n.onProductReason)==null||I.call(n,M)}catch(M){console.error("Failed to parse product reason JSON:",M)}break;case me.TOOL_CALL:try{const M=JSON.parse(A.data);(re=n.onToolCall)==null||re.call(n,M)}catch(M){console.error("Failed to parse tool call JSON:",M)}break;case me.TOOL_CALL_START:try{const M=JSON.parse(A.data);(R=n.onToolCallStart)==null||R.call(n,M)}catch(M){console.error("Failed to parse tool call start JSON:",M)}break;case me.END:(K=n.onEnd)==null||K.call(n),y(),r();return;default:break}}y(),r()}catch(D){if(ce(le.AiChatMessageHttpStatus,{error:!0,type:Zt.ERROR,platform:t.platform}),D instanceof SyntaxError){y(),s(D);return}y(!1),s(new Xa(l))}})()})}function Oo(){return typeof window<"u"&&"AgentSDK"in window&&window.AgentSDK?"native":"web"}function Lo(){if(typeof navigator>"u")return null;const e=navigator.userAgent.match(Pr);return e!=null&&e.groups?{mobilePlatform:e.groups.platform,platformVersion:e.groups.platform_version,appVersion:e.groups.app_version}:null}function $o({onAddCompletedMessage:e,onUpdateLoadingStatus:n}){return{completeMessage:g.useCallback((i,r)=>{const s=i||r||Be();i&&(i.startsWith("gid://")||/^\d/.test(i))&&e({assistantMessageId:s,sender:H.Assistant,content:{type:Q.Feedback},status:G.Success}),n("idle")},[e,n])}}function Vo({send:e}){const[n,t]=g.useState(!1),i=g.useRef(null),r=g.useRef(void 0),s=g.useRef(null),d=g.useRef(0),a=g.useRef(0),o=g.useRef(0),l=g.useRef(null),{data:c,error:m,stopPolling:p,refetch:h,networkStatus:y}=gn(Pe,{variables:{conversationId:i.current??""},ssr:!1,skip:!n||!i.current,fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0,pollInterval:r.current}),u=g.useCallback(f=>{var S;t(!1),p(),(S=l.current)==null||S.call(l,f),l.current=null},[p]);g.useEffect(()=>{var b,U;if(!n)return;const f=i.current,S=s.current;if(!(!f||!S)){if(m){y===Je.error&&(a.current+=1,a.current>=d.current?(e.updateAssistantMessage(S,{status:G.ConnectionFailed,isStreaming:!1},f),ce(le.AiChatStreamRecoveryFailed),ze(je.AiChatStreamRecoveryDuration,{},Date.now()-o.current),u(!1)):e.updateAssistantMessage(S,{status:G.Reconnecting,isStreaming:!1},f));return}if(c&&y===Je.ready){a.current+=1;const V=(U=(b=c==null?void 0:c.agentConversationMessages)==null?void 0:b.messages)==null?void 0:U.nodes;if(V&&V.length>0){const z=V[V.length-1];if(z&&z.type===Xn.ASSISTANT_MESSAGE){(async()=>{try{ce(le.AiChatStreamRecoverySucceeded),ze(je.AiChatStreamRecoveryDuration,{},Date.now()-o.current),e.bulkAddMessages([]),await h({conversationId:f}),u(!0)}catch{e.updateAssistantMessage(S,{status:G.ConnectionFailed,isStreaming:!1},f),u(!1)}})();return}}a.current>=d.current&&(e.updateAssistantMessage(S,{status:G.ConnectionFailed,isStreaming:!1},f),ce(le.AiChatStreamRecoveryFailed),ze(je.AiChatStreamRecoveryDuration,{},Date.now()-o.current),u(!1))}}},[c,m,y,n,e,u,h]);const v=g.useCallback(async(f,S,b)=>(ce(le.AiChatStreamRecoveryStarted),s.current=f,i.current=S,d.current=b.maxAttempts,r.current=b.pollIntervalMs,a.current=0,o.current=Date.now(),t(!0),new Promise(U=>{l.current=U})),[]),N=g.useCallback(async f=>{var S,b,U;try{const z=(U=(b=(S=(await h({conversationId:f})).data)==null?void 0:S.agentConversationMessages)==null?void 0:b.messages)==null?void 0:U.nodes;return z?z.filter(I=>I.type===Xn.USER_MESSAGE).length+1:void 0}catch{return}},[h]);return{recover:v,refetchConversation:N}}function xo(){const e=g.useRef(new AbortController),n=g.useCallback(()=>{e.current.abort(),e.current=new AbortController},[]);return g.useEffect(()=>()=>{n()},[n]),{abortController:e,cleanup:n}}function Uo({navigate:e,conversationId:n,onSuggestions:t,onLoadingStatusUpdate:i,onAddCustomerMessage:r,refetchNativeCarts:s}){const{refetch:d}=ms(),a=g.useCallback(async()=>{d(),s()},[d,s]),o=g.useCallback(c=>{e==null||e(c.params.path)},[e]);return{processUiEvent:g.useCallback(c=>{try{switch(c.action){case ca.REFRESH_CART:c.data&&c.data[0]&&c.data[0]instanceof Object&&c.data.forEach(p=>{n&&r({sender:H.Assistant,content:{type:Q.Cart,id:p.cart.id,brokerId:p.cart.brokerId},status:G.Success},n)}),a();break;case ca.NAVIGATE:o(c);break;default:{const m=br(c,"text.conversation_suggestions");m&&t(m);break}}}catch{i("idle")}},[a,o,r,t,i,n])}}const fn={PRODUCT:"product",MERCHANT:"merchant",ORDER:"order",OTHER:"other"},qo=2,Go=1;function Ca(e){var i,r;const n="items"in e&&((r=(i=e.items)==null?void 0:i.nodes)==null?void 0:r.some(s=>vn(s))),t="item"in e&&vn(e.item);return!!(n||t)}function Qo({state:e,send:n,conversationLoading:t,handleRefetchThreads:i,handleRefetchCarts:r,navigate:s}){var ie;const{context:d}=No(),{isStaff:a}=Ia(),{reportEvent:o}=Pa(),{showToast:l}=_a(),{actions:{fetchUserFiles:c}}=To(),m=Cr(),{createStreamUrl:p}=vo(),h=Fr(Er),y=g.useRef(null),u=g.useRef(!1),v=g.useRef(!1),N=g.useRef(!1),f=e.activeConversationId,S=g.useRef(f);S.current=f;const b=g.useMemo(()=>{var T;return f?((T=e.conversations[f])==null?void 0:T.messages)||[]:[]},[f,e.conversations]),U=g.useRef(Sa(b));U.current=Sa(b);const V=f&&((ie=e.conversations[f])==null?void 0:ie.loadingStatus)||"initializing",{abortController:z,cleanup:q}=xo(),{completeMessage:I}=$o({onAddCompletedMessage:g.useCallback(T=>S.current?n.addCompletedMessage(T,S.current):null,[n]),onUpdateLoadingStatus:g.useCallback(T=>{S.current&&n.updateLoadingStatus(T,S.current)},[n])}),re=g.useCallback(T=>f?n.updateLoadingStatus(T,f):null,[n,f]),{processUiEvent:R}=Uo({onAddCustomerMessage:n.addCustomerMessage,navigate:s,conversationId:f,onSuggestions:n.setSuggestions,onLoadingStatusUpdate:re,refetchNativeCarts:r}),K=t?"initializing":V,D=g.useRef(K);D.current=K;const P=g.useMemo(()=>!!(b!=null&&b.length),[b]),{recover:A,refetchConversation:M}=Vo({send:n}),x=g.useCallback(async T=>{!T||!S.current||(ce(le.AiChatStreamManualReload),n.updateAssistantMessage(T,{status:G.Reconnecting},S.current),await A(T,S.current,{maxAttempts:3,pollIntervalMs:5e3}))},[n,A]),te=g.useCallback(async({content:T,context:_,conversationId:Y,isRetry:j=!1,turnOverride:ke})=>{var qe,cn;y.current=Date.now(),u.current=!1,v.current=!1,N.current=!1;const pe=ke??U.current,F=Y??S.current;if(!F||D.current==="generating"||F===ge){n.setActiveConversation(ge);const ae={id:Be(),sender:H.User,content:{type:Q.Text,text:T},status:G.Failed};return n.addCustomerMessage(ae,ge)}q();const se=Be(),Ve=(qe=_==null?void 0:_.images)!=null&&qe.length?c(_.images):void 0,dn={id:se,sender:H.User,content:{type:Q.Text,text:T},status:G.Success,context:_?ha(_):void 0};n.addCustomerMessage(dn,F),(cn=_==null?void 0:_.images)!=null&&cn.length&&(Ve==null||Ve.then(ae=>{if(ae&&ae.length>0){const Ne=ha({..._,images:ae.filter(Boolean)});n.updateAssistantMessage(se,{context:Ne},F)}}).catch(()=>null));const xe=Lo(),hn=xe?JSON.stringify({mobilePlatform:xe.mobilePlatform,platformVersion:xe.platformVersion,appVersion:xe.appVersion}):"{}";o==null||o({schemaId:"shop_app_agent_event_tracked/1.0",payload:{name:de.AgentUserInputSubmitted,timestamp:Date.now(),conversationId:F,shopAiMessageId:se,turn:pe,clientPlatformType:Oo(),toolName:"",metadata:hn}});let W=Be(),Ue=!1;const _e=`work-preview-${W}`;W&&n.addCustomerMessage({id:W,sender:H.Assistant,content:{type:Q.Text,text:""},isStreaming:!0},F);try{n.updateLoadingStatus("generating",F);const ae=go({isStaff:a,promptContext:d,streamingFormat:Ks.streaming_format_delta,queryClassifierIntent:_==null?void 0:_.query_classifier_intent});let Ne="",oe,Ge=!1;const ln={},k=new Set,C=new Set,B=new Map;let ee=[],Se=[],Qe=!1,He=!1,mt=0,un=H.Assistant;const ci=new Io;let li;if(h){const O=Oe(F);if(!O)throw new Error("Invalid conversation ID format");const L=await p(O);if(!L.success||!L.streamUrl)throw new Error("Failed to create stream URL");li=L.streamUrl}if(await Ro({conversationId:F,content:T,context:_,config:ae,abortSignal:z.current.signal,reportEvent:o,expectedTurnNumber:pe,eventContext:{conversationId:F,shopAiMessageId:se,turn:pe,clientPlatformType:""},streamUrl:li,inNativeWebView:e.inNativeWebView},{onMessage:O=>{mt++;const L=un===H.Search?mt>=qo:mt>=Go;!He&&L&&(He=!0,n.updateAssistantMessage(_e,{hasReceivedContent:He},F)),Ne+=O;const yn=Ba(Ne),Te=za(Ne),he=[];yn&&Te.forEach(E=>{if(E.type==="json"&&E.parsedJson)if(Array.isArray(E.parsedJson))for(const X of E.parsedJson){const w=De(X);w&&w.__typename==="AgentSource"&&he.push(w)}else{const X=De(E.parsedJson);X&&X.__typename==="AgentSource"&&he.push(X)}}),he.length>0&&(ee=he,n.updateAssistantMessage(_e,{content:{type:Q.WorkPreview,sources:ee,workPreviewMessages:Se},hasReceivedContent:He},F));let Nn=-1;for(let E=Te.length-1;E>=0;E--)if(Te[E].type==="text"){Nn=E;break}let ui=-1;for(let E=0;E<Te.length;E++)if(Te[E].type==="text"){ui=E;break}const tr=E=>!E||!E.trim()?!1:E.includes("<shop:thinking>")?ja(E).some(Ce=>Ce.type===we.Text&&Ce.content.trim().length>0&&!Ce.content.includes("<shop:thinking>")):!0,mi=(E,X)=>{var Ce,Me,gi;const w=De(E);if(w&&w.__typename!=="AgentSource"){const ki=oe||W,ft="title"in w&&w.title||"notitle",ar=`${oe}:${w.type}:${ft}:${X}`,rr=`${W}:${w.type}:${ft}:${X}`;if(k.has(ar)||k.has(rr))return!1;const sr=`${ki}:${w.type}:${ft}:${X}`;k.add(sr);const pi=`${W}_${X}`;if(w.type===Q.FeedSection){const Si="item"in w;let We;if("subject"in w&&w.subject)w.subject.subjectKind==="ORDER"?We=fn.ORDER:w.subject.subjectKind==="SHOP"?We=fn.MERCHANT:w.subject.subjectKind==="PRODUCT"&&(We=fn.PRODUCT);else{let ue=null;"items"in w&&((Me=(Ce=w.items)==null?void 0:Ce.nodes)!=null&&Me[0])?ue=w.items.nodes[0]:"item"in w&&(ue=w.item),(ue==null?void 0:ue.__typename)==="OrderDeliveryCard"?We=fn.ORDER:((ue==null?void 0:ue.__typename)==="ProductCard"||(ue==null?void 0:ue.__typename)==="ProductDetailsCard")&&(We=fn.PRODUCT)}!Si&&We&&(o==null||o({schemaId:"shop_app_agent_event_tracked/1.0",payload:{name:de.AgentSearchResultsRendered,timestamp:Date.now(),conversationId:F,shopAiMessageId:se,turn:pe,clientPlatformType:"",toolName:"",metadata:JSON.stringify({search_type:We})}})),Si&&!N.current&&(N.current=!0,o==null||o({schemaId:"shop_app_agent_event_tracked/1.0",payload:{name:de.AgentProductRecommendationRendered,timestamp:Date.now(),conversationId:F,shopAiMessageId:se,turn:pe,clientPlatformType:"",toolName:"",metadata:"{}"}}));let vt=[];"items"in w&&((gi=w.items)!=null&&gi.nodes)?vt=w.items.nodes:"item"in w&&w.item&&(vt=[w.item]),vt.forEach(ue=>{ce(le.AiChatAdaptiveUiReceived,{content_type:ue.__typename,sender:un})})}return w.type===Q.FeedSection&&Ca(w)&&B.set(pi,w),n.addCustomerMessage({id:pi,assistantMessageId:ki,sender:un,content:w,status:G.Success},F),!0}return!1},ir=(E,X)=>{const w=X===ui,Ce=`${W}_${X}`,Me=w&&he.length>0&&!Ue?he:void 0;Me&&(Ue=!0),ln[Ce]?n.updateAssistantMessage(Ce,{content:{type:Q.Text,text:E.content},isStreaming:X===Nn,...Me&&{sources:Me}},F):(ln[Ce]=!0,n.addCustomerMessage({id:Ce,sender:H.Assistant,content:{type:Q.Text,text:E.content},status:G.Success,isStreaming:X===Nn,...Me&&{sources:Me}},F))};let fi=!1,vi=!1;if(Te.forEach((E,X)=>{if(E.type==="text")u.current||(fi=!0),tr(E.content)&&(vi=!0),ir(E,X);else if(E.type==="ui_block"&&E.uiBlockId&&!C.has(E.uiBlockId))C.add(E.uiBlockId),n.addCustomerMessage({id:E.uiBlockId,assistantMessageId:oe||W,sender:H.Assistant,content:{type:Q.LoadingSkeleton},status:G.Success},F);else if(E.type==="json"&&E.parsedJson&&yn)if(Array.isArray(E.parsedJson))for(const w of E.parsedJson)mi(w,X);else mi(E.parsedJson,X)}),he.length>0&&Nn===-1){const E=`${W}_sources`,X=oe||W;n.addCustomerMessage({id:E,assistantMessageId:X,sender:H.Assistant,content:{type:Q.Text,text:""},status:G.Success,sources:he},F)}if(vi&&!v.current&&y.current){v.current=!0;const E=Date.now();o==null||o({schemaId:"shop_app_agent_event_tracked/1.0",payload:{name:de.AgentFirstTextToken,timestamp:E,conversationId:F,shopAiMessageId:se,turn:pe,clientPlatformType:"",toolName:"",metadata:"{}"}})}fi&&!u.current&&y.current&&(u.current=!0,requestAnimationFrame(()=>{const E=Date.now()-y.current;ze(je.AiChatMessageRenderTime,{firstChunk:!0},E),o({schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:pn.Conversation,entityId:F,interactionType:de.AiChatStreamMessageStart,interactionValue:E.toString()}})}))},onAssistantMessageId:O=>{un=H.Assistant,Qe||(Qe=!0,n.addCustomerMessage({id:_e,sender:H.Search,content:{type:Q.WorkPreview,sources:[],workPreviewMessages:[]},status:G.Success},F)),oe=O,W&&(n.updateAssistantMessage(W,{assistantMessageId:oe||W},F),n.updateAssistantMessageId(W,oe,F))},onSearchMessageId:()=>{un=H.Search},onLoaderAdaptiveUiMessage:O=>{const L=JSON.parse(O);n.updateLoadingAUIState(L.status==="start",F)},onMessageLoader:O=>{try{const L=Co({rawMessageData:O});L!==null&&(Se=[...Se,L],L.type===$.WebSearch&&(ee=L.sources||[]),n.updateAssistantMessage(_e,{content:{type:Q.WorkPreview,sources:ee,workPreviewMessages:Se},hasReceivedContent:He},F))}catch{}},onThinking:()=>{n.updateLoadingStatus("generating",F)},onUi:O=>{if(h){if(!(O!=null&&O.id)||!(O!=null&&O.data))return;const L=Ao(O.id,O.data);L?(L.content.type===Q.FeedSection&&Ca(L.content)&&B.set(L.id,L.content),n.updateAssistantMessage(L.id,{content:L.content,status:G.Success,isStreaming:!1},F)):n.removeMessage(O.id)}else R(O)},onEnd:()=>{Ge=!0,o==null||o({schemaId:"shop_app_agent_event_tracked/1.0",payload:{name:de.AgentMessageCompleted,timestamp:Date.now(),conversationId:F,shopAiMessageId:se,turn:pe,clientPlatformType:"",toolName:"",metadata:"{}"}}),W&&(n.updateAssistantMessage(W,{status:G.Success,assistantMessageId:oe||W,isStreaming:!1},F),W=void 0)},onConversationTitle:O=>{i(),n.updateConversationTitle(O??"",F)},onConversationSuggestion:O=>{const L=JSON.parse(O);Array.isArray(L)&&n.setSuggestions(L)},onProductReason:O=>{const L=po(O.reason);B.forEach((yn,Te)=>{const he=So(yn,O.product_id,L);he&&(B.set(Te,he),n.updateAssistantMessage(Te,{content:he},F))})},onToolCall:O=>{ci.onToolCall(O)},onToolCallStart:O=>{const L=ci.onToolCallStart(O);L!==null&&(Se=[...Se,L],L.type===$.WebSearch&&(ee=L.sources||[]),n.updateAssistantMessage(_e,{content:{type:Q.WorkPreview,sources:ee,workPreviewMessages:Se},hasReceivedContent:He},F))}}),!Ge){n.updateAssistantMessage(se,{status:G.Failed},F),W&&n.updateAssistantMessage(W,{status:G.Failed},F),n.updateLoadingStatus("idle",F),ce(le.AiChatStreamEndedIncomplete);return}I(oe,W)}catch(ae){const Ne=ae instanceof Ya,oe=ae instanceof Wa,Ge=ae instanceof Xa;if(ae instanceof er&&!j){ce(le.AiChatStreamFailed,{errorType:"turn_mismatch"}),n.removeMessage(se),n.removeMessage(W),n.removeMessage(_e),n.updateLoadingStatus("idle",F);const k=await M(F);return await m.refetchQueries({include:["AgentConversationMessages"]}),te({content:T,context:_,conversationId:F,isRetry:!0,turnOverride:k})}if(Ge){const k=ae.messageId||W;k&&(n.updateAssistantMessage(k,{status:G.Reconnecting},F),A(k,F,{maxAttempts:4,pollIntervalMs:5e3}))}else{const k=oe?G.Aborted:G.Failed;n.updateAssistantMessage(se,{status:k,...Ne&&{errorType:Ga.MessageLimitExceeded}},F),W&&n.updateAssistantMessage(W,{status:G.Failed},F)}if(Ne){if(ce(le.AiChatStreamFailed,{errorType:"message_limit_exceeded"}),l({title:ye.t("shopAI:Messages.MessageLimitExceeded")}),F){n.setMessageLimitReached(F,!0);const k={id:Be(),sender:H.Assistant,content:{type:Q.Text,text:ye.t("shopAI:Messages.StartNewConversationSuggestion")},status:G.Success};n.addCompletedMessage(k,F)}}else ce(le.AiChatStreamFailed);n.updateLoadingStatus("idle",F)}},[q,c,n,o,a,d,h,z,e.inNativeWebView,I,p,R,i,M,m,A,l]),ne=g.useCallback(async()=>{if(S.current){try{await Mo(S.current)}catch{ce(le.AiChatStreamFailed,{errorType:"stop_stream_failed"})}const T=U.current-1;o==null||o({schemaId:"shop_app_agent_event_tracked/1.0",payload:{name:de.AgentResponseAborted,timestamp:Date.now(),conversationId:S.current,shopAiMessageId:"",turn:T,clientPlatformType:"",toolName:"",metadata:"{}"}})}q(),S.current&&n.updateLoadingStatus("idle",S.current)},[q,n,o]);return{messages:b,hasMessages:P,isGenerating:K==="generating",sendMessage:te,abortMessage:ne,manualReloadMessage:x}}var Le=(e=>(e.Chat="chat",e.Search="search",e))(Le||{});const oi=g.createContext(void 0),Wo=({children:e})=>{const n=qa(),t=cr(),[,i]=ni(),r=g.useCallback(({query:p,productId:h})=>{n==null||n.navigateToCanvas({query:p,productId:h})},[n]),s=g.useCallback(async({cart:p})=>{n==null||n.navigateToCheckout({cartId:p.id,shopId:p.shop.id})},[n]),d=g.useCallback(({productId:p,variantId:h})=>{n==null||n.navigateToProduct({productId:p,variantId:h})},[n]),a=g.useCallback(({orderId:p})=>{n?n.navigateToOrder({orderId:p}):t(`/orders/${p}`)},[n,t]),o=g.useCallback(()=>{n?n.navigateToOrderHistory():t("/account/order-history")},[n,t]),l=g.useCallback(({url:p})=>{try{const y=new URL(p,wr()).searchParams.get("query");y&&(n?n.navigateToSearch({searchTerm:y}):i(u=>(u.set("tab",Le.Search),u.set("query",y),u),{preventScrollReset:!0,replace:!1}))}catch{Ct.notify(new Error("Error decoding search url"),{metadata:{url:p}})}},[n,i]),c=g.useCallback(({url:p,shopId:h,shopHandle:y})=>{if(!n){p?t(p):y&&t(`/m/${y}`);return}if(h){n.navigateToShop({shopId:h});return}if(p&&p.includes("shopapp://store/"))try{const u=new URL(p),v=u.pathname.split("/")[1];v&&n.navigateToShop({shopId:v,searchParams:u.searchParams})}catch{Ct.notify(new Error("Error decoding store url"),{metadata:{url:p}})}},[n,t]),m={navigateToCanvas:r,navigateToCheckout:s,navigateToProduct:d,navigateToOrder:a,navigateToOrderHistory:o,navigateToSearch:l,navigateToShop:c};return Hn.jsx(oi.Provider,{value:m,children:e})},tc=()=>{const e=g.useContext(oi);if(!e)throw new Error("useAgentNavigation must be used within an AgentNavigationProvider");return e},ic=()=>g.useContext(oi),Fa={BASE_URL:"https://cdn.MedusaJS.com/MedusaJScloud/shop-client/production/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},kn=new Map,Cn=e=>{const n=kn.get(e);return n?Object.fromEntries(Object.entries(n.stores).map(([t,i])=>[t,i.getState()])):{}},Bo=(e,n,t)=>{if(e===void 0)return{type:"untracked",connection:n.connect(t)};const i=kn.get(t.name);if(i)return{type:"tracked",store:e,...i};const r={connection:n.connect(t),stores:{}};return kn.set(t.name,r),{type:"tracked",store:e,...r}},zo=(e,n)=>{if(n===void 0)return;const t=kn.get(e);t&&(delete t.stores[n],Object.keys(t.stores).length===0&&kn.delete(e))},jo=e=>{var n,t;if(!e)return;const i=e.split(`
`),r=i.findIndex(d=>d.includes("api.setState"));if(r<0)return;const s=((n=i[r+1])==null?void 0:n.trim())||"";return(t=/.+ (.+) .+/.exec(s))==null?void 0:t[1]},Jo=(e,n={})=>(t,i,r)=>{const{enabled:s,anonymousActionType:d,store:a,...o}=n;let l;try{l=(s??(Fa?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!l)return e(t,i,r);const{connection:c,...m}=Bo(a,l,o);let p=!0;r.setState=(u,v,N)=>{const f=t(u,v);if(!p)return f;const S=N===void 0?{type:d||jo(new Error().stack)||"anonymous"}:typeof N=="string"?{type:N}:N;return a===void 0?(c==null||c.send(S,i()),f):(c==null||c.send({...S,type:`${a}/${S.type}`},{...Cn(o.name),[a]:r.getState()}),f)},r.devtools={cleanup:()=>{c&&typeof c.unsubscribe=="function"&&c.unsubscribe(),zo(o.name,a)}};const h=(...u)=>{const v=p;p=!1,t(...u),p=v},y=e(r.setState,i,r);if(m.type==="untracked"?c==null||c.init(y):(m.stores[m.store]=r,c==null||c.init(Object.fromEntries(Object.entries(m.stores).map(([u,v])=>[u,u===m.store?y:v.getState()])))),r.dispatchFromDevtools&&typeof r.dispatch=="function"){let u=!1;const v=r.dispatch;r.dispatch=(...N)=>{(Fa?"production":void 0)!=="production"&&N[0].type==="__setState"&&!u&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),u=!0),v(...N)}}return c.subscribe(u=>{var v;switch(u.type){case"ACTION":if(typeof u.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return yt(u.payload,N=>{if(N.type==="__setState"){if(a===void 0){h(N.state);return}Object.keys(N.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const f=N.state[a];if(f==null)return;JSON.stringify(r.getState())!==JSON.stringify(f)&&h(f);return}r.dispatchFromDevtools&&typeof r.dispatch=="function"&&r.dispatch(N)});case"DISPATCH":switch(u.payload.type){case"RESET":return h(y),a===void 0?c==null?void 0:c.init(r.getState()):c==null?void 0:c.init(Cn(o.name));case"COMMIT":if(a===void 0){c==null||c.init(r.getState());return}return c==null?void 0:c.init(Cn(o.name));case"ROLLBACK":return yt(u.state,N=>{if(a===void 0){h(N),c==null||c.init(r.getState());return}h(N[a]),c==null||c.init(Cn(o.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return yt(u.state,N=>{if(a===void 0){h(N);return}JSON.stringify(r.getState())!==JSON.stringify(N[a])&&h(N[a])});case"IMPORT_STATE":{const{nextLiftedState:N}=u.payload,f=(v=N.computedStates.slice(-1)[0])==null?void 0:v.state;if(!f)return;h(a===void 0?f:f[a]),c==null||c.send(null,N);return}case"PAUSE_RECORDING":return p=!p}return}}),y},Ko=Jo,yt=(e,n)=>{let t;try{t=JSON.parse(e)}catch(i){console.error("[zustand devtools middleware] Could not parse the received json",i)}t!==void 0&&n(t)};function Ho(e,n){let t;try{t=e()}catch{return}return{getItem:r=>{var s;const d=o=>o===null?null:JSON.parse(o,void 0),a=(s=t.getItem(r))!=null?s:null;return a instanceof Promise?a.then(d):d(a)},setItem:(r,s)=>t.setItem(r,JSON.stringify(s,void 0)),removeItem:r=>t.removeItem(r)}}const ei=e=>n=>{try{const t=e(n);return t instanceof Promise?t:{then(i){return ei(i)(t)},catch(i){return this}}}catch(t){return{then(i){return this},catch(i){return ei(i)(t)}}}},Yo=(e,n)=>(t,i,r)=>{let s={storage:Ho(()=>localStorage),partialize:u=>u,version:0,merge:(u,v)=>({...v,...u}),...n},d=!1;const a=new Set,o=new Set;let l=s.storage;if(!l)return e((...u)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),t(...u)},i,r);const c=()=>{const u=s.partialize({...i()});return l.setItem(s.name,{state:u,version:s.version})},m=r.setState;r.setState=(u,v)=>{m(u,v),c()};const p=e((...u)=>{t(...u),c()},i,r);r.getInitialState=()=>p;let h;const y=()=>{var u,v;if(!l)return;d=!1,a.forEach(f=>{var S;return f((S=i())!=null?S:p)});const N=((v=s.onRehydrateStorage)==null?void 0:v.call(s,(u=i())!=null?u:p))||void 0;return ei(l.getItem.bind(l))(s.name).then(f=>{if(f)if(typeof f.version=="number"&&f.version!==s.version){if(s.migrate){const S=s.migrate(f.state,f.version);return S instanceof Promise?S.then(b=>[!0,b]):[!0,S]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,f.state];return[!1,void 0]}).then(f=>{var S;const[b,U]=f;if(h=s.merge(U,(S=i())!=null?S:p),t(h,!0),b)return c()}).then(()=>{N==null||N(h,void 0),h=i(),d=!0,o.forEach(f=>f(h))}).catch(f=>{N==null||N(void 0,f)})};return r.persist={setOptions:u=>{s={...s,...u},u.storage&&(l=u.storage)},clearStorage:()=>{l==null||l.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>y(),hasHydrated:()=>d,onHydrate:u=>(a.add(u),()=>{a.delete(u)}),onFinishHydration:u=>(o.add(u),()=>{o.delete(u)})},s.skipHydration||y(),h||p},Xo=Yo,Nt={threadsPanelOpen:!1,legalDisclaimerViewed:!1,pdpQuickview:{selectedProductId:null,selectedVariantId:null,similarToProductId:null,activeConversation:null},sourcesPanel:{messageId:null,sources:[]}},Zo=Ta()(Ko(Xo((e,n)=>({preferences:Nt,actions:{setThreadsPanelOpen:t=>{e(i=>({preferences:{...i.preferences,threadsPanelOpen:t}}))},setLegalDisclaimerViewed:t=>{e(i=>({preferences:{...i.preferences,legalDisclaimerViewed:t}}))},setPdpQuickview:t=>{e(i=>({preferences:{...i.preferences,pdpQuickview:{...i.preferences.pdpQuickview,...t}}}))},setSourcesPanel:t=>{e(i=>({preferences:{...i.preferences,sourcesPanel:{...i.preferences.sourcesPanel,...t}}}))},toggleThreadsPanel:()=>{const t=n().preferences.threadsPanelOpen;e(i=>({preferences:{...i.preferences,threadsPanelOpen:!t}}))},clearPdpQuickview:()=>{e(t=>({preferences:{...t.preferences,pdpQuickview:Nt.pdpQuickview}}))},reset:()=>{e({preferences:Nt})}}}),{name:"shop-ai-user-preferences",partialize:e=>({preferences:e.preferences}),version:3,migrate:(e,n)=>{let t=e;return n<2&&(t={...t,preferences:{...t.preferences,sourcesPanel:{messageId:null,sources:[]}}}),n<3&&(t={...t,preferences:{...t.preferences,legalDisclaimerViewed:!1}}),t}}),{name:"shop-ai-user-preferences"})),ed=e=>{for(let n=e.length-1;n>=0;n--)if(e[n].sender===H.Search&&e[n].content.type===Q.WorkPreview)return n;return-1},nr={conversations:{},activeConversationId:ge,lastProfileFetchTimestamp:null,suggestions:[],activeWidget:null};function Xe(e,n){return e.conversations[n]||{id:n,messages:[],loadingStatus:"initializing",composerDisplayMode:"text",lastMessageSentAt:new Date().toISOString(),lastUpdatedAt:new Date().toISOString(),title:ye.t("shopAI:AgentChatWindow.NewConversation"),__typename:"Conversation",recentProductImages:[],agentMode:Oa.SHOP,shopId:null,loadingAUIState:!1,hasReachedMessageLimit:!1}}function fe(e,n,t){return{...e,conversations:{...e.conversations,[n]:{...e.conversations[n],...t}}}}function nd(e,n){const i={ADD_CUSTOMER_MESSAGE:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=Xe(r,d);return fe(r,d,{...a,messages:[...a.messages,s.message],loadingStatus:G.Failed===s.message.status?"idle":"generating",lastMessageSentAt:new Date().toISOString(),lastUpdatedAt:new Date().toISOString()})},ADD_COMPLETED_MESSAGE:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=Xe(r,d);return fe(r,d,{...a,messages:[...a.messages,s.message],loadingStatus:"idle",lastMessageSentAt:new Date().toISOString(),lastUpdatedAt:new Date().toISOString()})},UPDATE_LOADING_STATUS:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=Xe(r,d);return fe(r,d,{...a,loadingStatus:s.newStatus,lastUpdatedAt:new Date().toISOString()})},UPDATE_COMPOSER_DISPLAY_MODE:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=r.conversations[d];return a?fe(r,d,{...a,composerDisplayMode:s.newMode,lastUpdatedAt:new Date().toISOString()}):r},CREATE_NEW_CONVERSATION:r=>{const s=crypto.randomUUID(),d=Xe(r,s);return fe(r,s,d)},DELETE_CONVERSATION:(r,s)=>{const d=Object.fromEntries(Object.entries(r.conversations).filter(([a])=>a!==s.conversationId));return{...r,conversations:d}},RESET:()=>nr,REMOVE_MESSAGE:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=r.conversations[d];return a?fe(r,d,{messages:a.messages.filter(o=>o.id!==s.messageId)}):r},BULK_ADD_MESSAGES:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=Xe(r,d);return fe(r,d,{...a,messages:s.messages})},UPDATE_PROFILE_FETCH_TIMESTAMP:(r,s)=>({...r,lastProfileFetchTimestamp:s.timestamp||Date.now()}),SET_SUGGESTIONS:(r,s)=>({...r,suggestions:s.suggestions}),CLEAR_SUGGESTIONS:r=>({...r,suggestions:[]}),ADD_FEEDBACK:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=r.conversations[d];return a?fe(r,d,{...a,messages:a.messages.map(o=>o.assistantMessageId===s.assistantMessageId?{...o,feedback:s.feedback}:o)}):r},UPDATE_CONVERSATION_TITLE:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=r.conversations[d];return a?fe(r,d,{...a,title:s.title}):r},UPDATE_ASSISTANT_MESSAGE:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=r.conversations[d];return a?fe(r,d,{...a,messages:a.messages.map(o=>o.id===s.messageId||o.assistantMessageId===s.messageId?{...o,...s.partial}:o)}):r},UPDATE_ASSISTANT_MESSAGE_ID:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=r.conversations[d];return a?fe(r,d,{messages:a.messages.map(o=>o.assistantMessageId===s.oldAssistantMessageId?{...o,assistantMessageId:s.newAssistantMessageId}:o)}):r},SYNC_CONVERSATIONS:(r,s)=>({...r,conversations:{...r.conversations,...s.conversations}}),SET_ACTIVE_WIDGET:(r,s)=>({...r,activeWidget:s.activeWidget}),UPDATE_LOADING_AUI_STATE:(r,s)=>{const d=s.conversationId;if(!d)return r;const a=Xe(r,d);return fe(r,d,{...a,loadingAUIState:s.loadingAUIState})},SET_MESSAGE_LIMIT_REACHED:(r,s)=>r.conversations[s.conversationId]?fe(r,s.conversationId,{hasReachedMessageLimit:s.hasReachedLimit}):r}[n.type];return i?i(e,n):e}const di=g.createContext(void 0);function td(e){const n=e.get("tab"),t=e.get("query");return n===Le.Search?{type:Le.Search,query:t||void 0}:{type:Le.Chat}}const ac=({children:e,initialConversationId:n,inNativeWebView:t})=>{const i=qa(),[r,s]=ni(),d=r.get("conversationId"),a=g.useMemo(()=>n?n.startsWith("gid://")?n:pt(n):d?pt(d):ge,[n,d]),{actions:{setThreadsPanelOpen:o,setSourcesPanel:l}}=Zo(),{conversations:c,loading:m,fetchMore:p,fetchingMore:h,networkStatus:y,refetch:u,hasNextPage:v,initialFetchComplete:N}=lo(),[f,S]=g.useReducer(nd,nr),b=Object.values(f.conversations).some(k=>k.loadingStatus==="generating"),{mode:U,title:V,messages:z,loading:q,hasPreviousMessages:I,isLoadingPreviousMessages:re,fetchPreviousMessages:R,error:K}=so({conversationId:a,isConversationGenerating:b}),D=g.useRef(void 0),P=a?f.conversations[a]:null,A=P==null?void 0:P.messages,M=q&&!(A!=null&&A.length);g.useEffect(()=>{if(a===ge)return;const k=A||[],C=!q;if(z.length>k.length){S({type:"BULK_ADD_MESSAGES",messages:z,conversationId:a});return}C&&(P==null?void 0:P.loadingStatus)==="initializing"&&!k.length&&!z.length&&(S({type:"BULK_ADD_MESSAGES",messages:z,conversationId:a}),S({type:"UPDATE_LOADING_STATUS",newStatus:"idle",conversationId:a}))},[a,P,A,z,q]),g.useEffect(()=>{if(c&&c!==D.current){D.current=c;const k=Object.fromEntries(c.map(C=>{var B,ee,Se,Qe;return[C.id,{...f.conversations[C.id]||{},__typename:C.__typename??"Conversation",id:C.id,title:C.title??"",messages:((B=f.conversations[C.id])==null?void 0:B.messages)||[],loadingStatus:((ee=f.conversations[C.id])==null?void 0:ee.loadingStatus)||"initializing",composerDisplayMode:"text",lastMessageSentAt:C.lastMessageSentAt??((Se=f.conversations[C.id])==null?void 0:Se.lastMessageSentAt)??new Date().toISOString(),lastUpdatedAt:C.lastUpdatedAt??new Date().toISOString(),agentMode:C.agentMode,shopId:C.shopId,loadingAUIState:((Qe=f.conversations[C.id])==null?void 0:Qe.loadingAUIState)??!1}]}));ps(k,f.conversations)||S({type:"SYNC_CONVERSATIONS",conversations:k})}},[c]);const{send:x}=Ea(()=>({addCustomerMessage:(k,C)=>{S({type:"ADD_CUSTOMER_MESSAGE",message:k,conversationId:C})},addCompletedMessage:(k,C)=>{S({type:"ADD_COMPLETED_MESSAGE",message:k,conversationId:C})},updateLoadingStatus:(k,C)=>{S({type:"UPDATE_LOADING_STATUS",newStatus:k,conversationId:C})},updateComposerDisplayMode:k=>{a&&S({type:"UPDATE_COMPOSER_DISPLAY_MODE",newMode:k,conversationId:a})},setActiveConversation:k=>{const C=Oe(k)||k;s(B=>(B.set("conversationId",C),B.delete("message"),B),{preventScrollReset:!0,replace:!0})},createNewConversation:()=>{S({type:"CREATE_NEW_CONVERSATION"})},deleteConversation:k=>{if(k===a){const B=Object.keys(f.conversations).filter(ee=>ee!==k)[0]||null;s(ee=>(B?ee.set("conversationId",Oe(B)||B):ee.delete("conversationId"),ee),{preventScrollReset:!0,replace:!0})}S({type:"DELETE_CONVERSATION",conversationId:k})},reset:()=>{S({type:"RESET"})},removeMessage:k=>{a&&S({type:"REMOVE_MESSAGE",messageId:k,conversationId:a})},bulkAddMessages:k=>{a&&S({type:"BULK_ADD_MESSAGES",messages:k,conversationId:a})},updateProfileFetchTimestamp:k=>{S({type:"UPDATE_PROFILE_FETCH_TIMESTAMP",timestamp:k})},setSuggestions:k=>{S({type:"SET_SUGGESTIONS",suggestions:k})},clearSuggestions:()=>{S({type:"CLEAR_SUGGESTIONS"})},addFeedback:(k,C)=>{a&&S({type:"ADD_FEEDBACK",assistantMessageId:k,feedback:C,conversationId:a})},updateConversationTitle:(k,C)=>{i==null||i.setConversationTitle({conversationTitle:k}),S({type:"UPDATE_CONVERSATION_TITLE",title:k,conversationId:C})},syncConversations:k=>{S({type:"SYNC_CONVERSATIONS",conversations:k})},updateAssistantMessage:(k,C,B)=>{S({type:"UPDATE_ASSISTANT_MESSAGE",messageId:k,partial:C,conversationId:B})},updateAssistantMessageId:(k,C,B)=>{S({type:"UPDATE_ASSISTANT_MESSAGE_ID",oldAssistantMessageId:k,newAssistantMessageId:C,conversationId:B})},setActiveWidget:k=>{S({type:"SET_ACTIVE_WIDGET",activeWidget:k})},updateLoadingAUIState:(k,C)=>{S({type:"UPDATE_LOADING_AUI_STATE",loadingAUIState:k,conversationId:C})},setMessageLimitReached:(k,C)=>{S({type:"SET_MESSAGE_LIMIT_REACHED",conversationId:k,hasReachedLimit:C})},sendMessageIfReady:k=>{a&&a!==ge?Ue(k):(j.current.push(k),!ke.current&&a===ge&&F())},setActiveThreadTab:k=>{s(C=>(k.type===Le.Search?(C.set("tab",Le.Search),k.query&&C.set("query",k.query)):C.delete("tab"),C),{preventScrollReset:!0,replace:!1})}})),{createConversation:te}=mo(),{reportEvent:ne}=Pa(),{prefetchSearchResults:ie}=Ua(),T=g.useMemo(()=>td(r),[r]),_=g.useRef(!1),Y=g.useCallback(()=>{_.current=!0},[]),j=g.useRef([]),ke=g.useRef(!1),pe=g.useRef(void 0);pe.current=async()=>{ke.current=!0;const{conversationId:k}=await te(),C=k??ge;if(_.current)return;u();const B=C.startsWith("gid://")?C:pt(C);x.setActiveConversation(B),ke.current=!1,j.current.length>0&&(j.current.forEach(ee=>{Ue({...ee,conversationId:B})}),j.current=[]),x.setActiveThreadTab({type:Le.Chat}),ne({schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:pn.Conversation,entityId:C,interactionType:t?de.AgentWebviewConversationCreate:de.AgentConversationCreate,interactionValue:C}})};const F=g.useCallback(async()=>{var k;await((k=pe.current)==null?void 0:k.call(pe))},[]),se=g.useCallback((k,C,B)=>{i==null||i.addToCart({brokerId:k,variantId:C,variantImageUrl:B})},[i]),Ve=g.useCallback(()=>{i==null||i.refetchThreads()},[i]),dn=g.useCallback(()=>{i==null||i.refetchCarts()},[i]),xe=g.useCallback(({productId:k,productTitle:C,variantId:B,shopId:ee,actionIntent:Se,imageUrl:Qe})=>{i==null||i.updateProductLists({productId:k,productTitle:C,variantId:B,shopId:ee,actionIntent:Se,imageUrl:Qe})},[i]),hn=g.useCallback(k=>{i==null||i.ratingFormVisible({visible:k})},[i]),W=g.useCallback((k,C)=>{if(i){const B=k.filter(ee=>!!ee.title);i.openAgentSources({sources:B})}else x.setActiveWidget(Qa.Sources),l({messageId:C,sources:k})},[i,x,l]),{sendMessage:Ue,hasMessages:_e,messages:qe,isGenerating:cn,abortMessage:ae,manualReloadMessage:Ne}=Qo({state:{...f,activeConversationId:a,inNativeWebView:t},send:x,conversationLoading:M,handleRefetchThreads:Ve,handleRefetchCarts:dn}),oe=g.useCallback(async k=>{k.isInitialMessage&&(ie(k.content),s(C=>(C.set("query",k.content),C),{preventScrollReset:!0,replace:!0})),await Ue({...k,conversationId:k.conversationId})},[Ue,ie,s]),Ge=g.useMemo(()=>ed(qe),[qe]);g.useEffect(()=>{if(!i||!a||a===ge)return;const k=Oe(a);V&&i.setConversationTitle({conversationTitle:V}),k&&i.setConversationId({conversationId:k})},[i,a,V]),g.useEffect(()=>{!m&&c.length<=1&&o(!1)},[c.length,m,o]);const ln=g.useMemo(()=>({state:{...f,activeConversationId:a},activeThreadTab:T,send:x,activeConversationId:a,conversations:c,loading:m,conversationLoading:M,fetchMore:p,fetchingMore:h,networkStatus:y,refetch:u,hasNextPage:v,isConversationGenerating:b,createNewConversation:F,handleAddToCart:se,handleRefetchThreads:Ve,handleRefetchCarts:dn,handleUpdateProductLists:xe,handleSetRatingFormVisibility:hn,handleOpenAgentSources:W,mode:U,fetchPreviousMessages:R,hasPreviousMessages:I,isLoadingPreviousMessages:re,conversationError:K,initialFetchComplete:N,messages:qe,hasMessages:_e,isGenerating:cn,sendMessage:oe,markConversationIdAsSentFromParent:Y,inNativeWebView:t,lastWorkPreviewIndex:Ge,abortMessage:ae,manualReloadMessage:Ne}),[f,a,T,x,c,m,M,p,h,y,u,v,b,F,se,Ve,dn,xe,hn,W,U,R,I,re,K,N,qe,_e,cn,oe,Y,t,Ge,ae,Ne]);return Hn.jsx(di.Provider,{value:ln,children:Hn.jsx(Wo,{children:e})})},rc=()=>{const e=g.useContext(di);if(!e)throw new Error("useConversationContext must be used within a ConversationProvider");return e},sc=()=>g.useContext(di);export{H as $,Is as A,Es as B,ac as C,lo as D,Oe as E,Oa as F,Rd as G,Md as H,Pd as I,bd as J,Vd as K,$d as L,Ld as M,hs as N,Kd as O,Zo as P,vs as Q,Le as R,Ss as S,ge as T,Da as U,No as V,no as W,Qa as X,so as Y,Qs as Z,Br as _,ic as a,$ as a0,Yd as a1,Zd as a2,Hd as a3,tc as a4,G as a5,ja as a6,we as a7,ec as a8,Q as a9,Ga as aa,mo as ab,nc as ac,Xd as ad,wd as ae,rc as b,pt as c,Ra as d,it as e,en as f,qa as g,ms as h,Ai as i,Dd as j,jd as k,Jd as l,As as m,_s as n,Z as o,xd as p,Ud as q,qd as r,zd as s,Gd as t,sc as u,Qd as v,Wd as w,Bd as x,Od as y,ys as z};
//# sourceMappingURL=ConversationProvider-BNoOA22x.js.map
