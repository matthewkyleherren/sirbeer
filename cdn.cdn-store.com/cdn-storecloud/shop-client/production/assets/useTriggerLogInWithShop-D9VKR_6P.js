import{u as x,r as f,h as W,f as M}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{I as q,E as $}from"./types-aSuMwFxz.js";import{g as B}from"./index-BYdSehkX.js";import{p as O,u as G,e as Q}from"./useMonorail-J6WwGwSW.js";import{d as V,D as j}from"./statsdClient-CCQ7Es9D.js";import{u as U,a as A,U as Y}from"./AuthenticationProvider-9RtBMSxF.js";import{j as z}from"./jsx-runtime-D_zvdyIk.js";import{P as p}from"./types-BLzQfJqq.js";var J=(e=>(e.Account="account",e.AccountAddCard="account_add_card",e.AccountAddress="account_address",e.AccountEditCard="account_edit_card",e.AccountInstallments="account_installments",e.AccountInstallmentsDetail="account_installments_detail",e.AccountMakeInstallmentPayment="account_make_installment_payment",e.AccountManageInstallmentPaymentType="account_manage_installment_payment_type",e.AccountPaymentMethods="account_payment_methods",e.AccountSubscriptions="account_subscriptions",e.AccountOrderHistory="account_order_history",e.AccountSubscriptionDetail="account_subscription_detail",e.SignInHeaderLink="sign_in_header_link",e.BottomBarCart="bottom_bar_cart",e.BottomBarProfile="bottom_bar_profile",e.HeaderCart="header_cart",e.ReviewItemHelpfulRating="review_item_helpful_rating",e.CartScreenSignInCta="cart_screen_sign_in_cta",e.MarketingEventSignInCta="marketing_event_sign_in_cta",e.MarketingEventToast="marketing_event_toast",e.ShopCashSignInPrompt="shop_cash_sign_in_prompt",e.Favorites="favorites",e.ShipsToFilter="ships_to_filter",e.ShopCashGiveaway="shop_cash_giveaway",e.FollowStore="follow_store",e.RecentlyViewed="recently_viewed",e.AddToCart="add_to_cart",e.ShopCashOffers="shop_cash_offers_sign_in",e.ThankYouPage="thank_you_page",e.DeleteAccount="delete_account",e.FavoriteHeaderLink="favorite_header_link",e.BuyNow="buy_now",e.ProductListInvite="product_list_invite",e.ShopAiAgentChatWindow="shop_ai_agent_chat_window",e))(J||{});const K=B();function X(e){let a="";switch(e){case"PAY":a="email pay:address:validate pay:manage pay:voucher:read phone";break;default:a="email email:verified phone identities"}return K.APP_ENV!=="production"?`${a} first_party_user_state_inferrable`:a}const Z=B(),y={verifier:"",state:""};let g;function ve(e){g=e}function P(){const e=document.querySelector("shop-login-button"),a=document.getElementById("LoginWithShopButton");e==null||e.removeEventListener("loaded",P),a==null||a.click()}function I(e){const a=new URLSearchParams(window.location.search);return e&&e.forEach(n=>{a.set(n[0],n[1])}),window.location.pathname+(a.toString()?`?${a.toString()}`:"")}const ee=(e=void 0,a,n,t=!1)=>{Z.APP_ENV!=="production"&&(O.set("web_oauth_verifier",y.verifier,!0,{secure:!0}),O.set("web_oauth_state",y.state,!0,{secure:!0}));const o=document.querySelector("shop-login-button"),r=document.getElementById("LoginWithShopButton"),c=()=>r==null?void 0:r.click();let i=!1;if(o){const l=o.getAttribute("redirect-uri");if(l){const h=new URL(l),u=I(n);h.searchParams.get("lastpath")!==u&&(i=!0,h.searchParams.set("lastpath",u),o.setAttribute("redirect-uri",h.toString()))}}const s=typeof a=="string"&&a!==g;e&&e!==(o==null?void 0:o.getAttribute("email"))&&(o==null||o.setAttribute("email",e)),s&&(o==null||o.setAttribute("scope",X(a)),g=a),s||i?o==null||o.addEventListener("loaded",P):(o==null||o.removeEventListener("loaded",P),c()),V(j.SignInInit,{success:!0,isCookiesConsentRequired:t})};var v={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"PayShopCashBalance"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"payShopCashBalance"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PayShopCashBalance"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"available"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"currencyCode"},arguments:[],directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PayShopCashBalanceError"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"field"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:256}};v.loc.source={body:`query PayShopCashBalance {
  payShopCashBalance {
    ... on PayShopCashBalance {
      available {
        amount
        currencyCode
      }
    }
    ... on PayShopCashBalanceError {
      userErrors {
        field
        message
      }
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function m(e,a){if(e.kind==="FragmentSpread")a.add(e.name.value);else if(e.kind==="VariableDefinition"){var n=e.type;n.kind==="NamedType"&&a.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(t){m(t,a)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(t){m(t,a)}),e.definitions&&e.definitions.forEach(function(t){m(t,a)})}var b={};(function(){v.definitions.forEach(function(a){if(a.name){var n=new Set;m(a,n),b[a.name.value]=n}})})();function R(e,a){for(var n=0;n<e.definitions.length;n++){var t=e.definitions[n];if(t.name&&t.name.value==a)return t}}function ae(e,a){var n={kind:e.kind,definitions:[R(e,a)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var t=b[a]||new Set,o=new Set,r=new Set;for(t.forEach(function(i){r.add(i)});r.size>0;){var c=r;r=new Set,c.forEach(function(i){if(!o.has(i)){o.add(i);var s=b[i]||new Set;s.forEach(function(l){r.add(l)})}})}return o.forEach(function(i){var s=R(e,i);s&&n.definitions.push(s)}),n}ae(v,"PayShopCashBalance");var _={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ShopCashInfo"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shopCashInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasShopCashBack"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"eligibleShopCashBackRate"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:93}};_.loc.source={body:`query ShopCashInfo {
  shopCashInfo {
    hasShopCashBack
    eligibleShopCashBackRate
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function S(e,a){if(e.kind==="FragmentSpread")a.add(e.name.value);else if(e.kind==="VariableDefinition"){var n=e.type;n.kind==="NamedType"&&a.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(t){S(t,a)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(t){S(t,a)}),e.definitions&&e.definitions.forEach(function(t){S(t,a)})}var w={};(function(){_.definitions.forEach(function(a){if(a.name){var n=new Set;S(a,n),w[a.name.value]=n}})})();function F(e,a){for(var n=0;n<e.definitions.length;n++){var t=e.definitions[n];if(t.name&&t.name.value==a)return t}}function te(e,a){var n={kind:e.kind,definitions:[F(e,a)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var t=w[a]||new Set,o=new Set,r=new Set;for(t.forEach(function(i){r.add(i)});r.size>0;){var c=r;r=new Set,c.forEach(function(i){if(!o.has(i)){o.add(i);var s=w[i]||new Set;s.forEach(function(l){r.add(l)})}})}return o.forEach(function(i){var s=F(e,i);s&&n.definitions.push(s)}),n}te(_,"ShopCashInfo");function ne(e){return(e==null?void 0:e.__typename)==="PayShopCashBalance"}function oe(e){var u;const{userAuthState:a}=U(),{skip:n=!1}=e??{},{data:t,loading:o}=A(_,{fetchPolicy:"cache-and-network",ssr:!1,...e,skip:a===Y.Anonymous?!0:n}),r=(t==null?void 0:t.shopCashInfo.hasShopCashBack)||!1,c=(u=t==null?void 0:t.shopCashInfo)==null?void 0:u.eligibleShopCashBackRate,i=!!c&&Number(c)>0,{data:s,loading:l,refetch:h}=A(v,{fetchPolicy:"cache-and-network",ssr:!1,...e,skip:r?n:!0});return{loading:!!(o||l),isShopCashEnabled:r,availableShopCashBalance:ne(s==null?void 0:s.payShopCashBalance)?s==null?void 0:s.payShopCashBalance:null,isEligibleForShopCash:i,eligibleShopCashBackRate:c?Number(c):0,refetchBalance:h}}const k="offer",ie=()=>{const[e,a]=x(),n=e.get(k)==="true"||e.get(k)==="1",[t]=f.useState(n);return f.useEffect(()=>{t&&(e.delete(k),a(e))},[e,a,t]),{hasShopCashOfferUrlParam:t}},se={isShopCashEnabled:!1,isEligibleForShopCash:!1,availableShopCashBalance:null,currentShopCashOffer:null,setCurrentShopCashOffer:()=>{},hasShopCashOfferUrlParam:!1,loadingShopCashInfo:!0,hasUnauthedShopCashOfferOrCashBackPromotion:!1,setHasUnauthedShopCashOfferOrCashBackPromotion:()=>{},refetchBalance:()=>{}},re=["/products/","/web/random-product","/m"],T=f.createContext(se),ce=()=>f.useContext(T),_e=({children:e=null})=>{const a=W(),{isShopCashEnabled:n,availableShopCashBalance:t,isEligibleForShopCash:o,loading:r,refetchBalance:c}=oe(),{hasShopCashOfferUrlParam:i}=ie(),[s,l]=f.useState(null),[h,u]=f.useState(!1);f.useEffect(()=>{re.some(C=>a.pathname.startsWith(C))||l(null)},[a.pathname]);const d=f.useMemo(()=>({isShopCashEnabled:n,availableShopCashBalance:(t==null?void 0:t.available)||null,isEligibleForShopCash:o,currentShopCashOffer:s,setCurrentShopCashOffer:l,hasShopCashOfferUrlParam:i,hasUnauthedShopCashOfferOrCashBackPromotion:h,setHasUnauthedShopCashOfferOrCashBackPromotion:u,loadingShopCashInfo:r,refetchBalance:c}),[n,t==null?void 0:t.available,o,s,i,h,r,c]);return z.jsx(T.Provider,{value:d,children:e})},Ce=()=>{const{reportEvent:e}=G(),{isCookiesConsentRequired:a}=M("root")||{isCookiesConsentRequired:!1},{currentUser:n}=U(),{pageType:t}=Q(),{hasUnauthedShopCashOfferOrCashBackPromotion:o,hasShopCashOfferUrlParam:r}=ce(),c=t===p.ShopCashOffers,i=t===p.ShopCashGiveaway,s=t===p.ShoppingEvent,l=t===p.Shops,u=(t===p.Products||l)&&o,d=r||c||s||i||u?"PAY":"EMAIL";return f.useCallback(({entityId:C,interactionValue:L,email:H=void 0,scope:N,urlQueryParams:D})=>{ee(H,N??d,D,a),e({schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:$.SignIn,entityId:C,interactionType:q.SignInTapped,interactionValue:L,shopAccountUuid:(n==null?void 0:n.shopAccountUuid)??void 0}})},[e,d,a,n==null?void 0:n.shopAccountUuid])};export{J as S,ce as a,oe as b,_e as c,X as g,ve as o,y as s,Ce as u};
//# sourceMappingURL=useTriggerLogInWithShop-D9VKR_6P.js.map
