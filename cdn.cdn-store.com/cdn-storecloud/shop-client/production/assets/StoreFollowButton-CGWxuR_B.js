import{j as b}from"./jsx-runtime-D_zvdyIk.js";import{r as S}from"./chunk-DQRVZFIR-mrH3D8v7.js";import{I as x,E as C}from"./types-aSuMwFxz.js";import{B as $}from"./Button-D4K8aSAG.js";import{I as V}from"./Icon-Vc_yr2r6.js";import{u as W}from"./Toast-Bb3RYazJ.js";import{u as U,d as j,U as H}from"./AuthenticationProvider-9RtBMSxF.js";import{u as z,S as Q}from"./useTriggerLogInWithShop-D9VKR_6P.js";import{e as M}from"./ConversationProvider-BNoOA22x.js";import{f as A,L as G}from"./statsdClient-CCQ7Es9D.js";import{u as R}from"./useMutation-BEBlGsA2.js";import{u as q,b as P,e as J}from"./useMonorail-J6WwGwSW.js";import{P as K}from"./types-BLzQfJqq.js";import{c as Y}from"./cn-yu2yf51J.js";import{i as g}from"./i18nConfig-CLr-UH7w.js";var N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ShopFollow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shopFollow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shop"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"followedByMe"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"field"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:156}};N.loc.source={body:`mutation ShopFollow($id: ID!) {
  shopFollow(id: $id) {
    shop {
      id
      followedByMe
    }
    userErrors {
      field
      message
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function y(e,i){if(e.kind==="FragmentSpread")i.add(e.name.value);else if(e.kind==="VariableDefinition"){var n=e.type;n.kind==="NamedType"&&i.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(o){y(o,i)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(o){y(o,i)}),e.definitions&&e.definitions.forEach(function(o){y(o,i)})}var O={};(function(){N.definitions.forEach(function(i){if(i.name){var n=new Set;y(i,n),O[i.name.value]=n}})})();function I(e,i){for(var n=0;n<e.definitions.length;n++){var o=e.definitions[n];if(o.name&&o.name.value==i)return o}}function X(e,i){var n={kind:e.kind,definitions:[I(e,i)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var o=O[i]||new Set,c=new Set,l=new Set;for(o.forEach(function(t){l.add(t)});l.size>0;){var m=l;l=new Set,m.forEach(function(t){if(!c.has(t)){c.add(t);var s=O[t]||new Set;s.forEach(function(f){l.add(f)})}})}return c.forEach(function(t){var s=I(e,t);s&&n.definitions.push(s)}),n}X(N,"ShopFollow");var E={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ShopUnfollow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shopUnfollow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shop"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"followedByMe"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"userErrors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"field"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"message"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:160}};E.loc.source={body:`mutation ShopUnfollow($id: ID!) {
  shopUnfollow(id: $id) {
    shop {
      id
      followedByMe
    }
    userErrors {
      field
      message
    }
  }
}
`,name:"GraphQL request",locationOffset:{line:1,column:1}};function F(e,i){if(e.kind==="FragmentSpread")i.add(e.name.value);else if(e.kind==="VariableDefinition"){var n=e.type;n.kind==="NamedType"&&i.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach(function(o){F(o,i)}),e.variableDefinitions&&e.variableDefinitions.forEach(function(o){F(o,i)}),e.definitions&&e.definitions.forEach(function(o){F(o,i)})}var D={};(function(){E.definitions.forEach(function(i){if(i.name){var n=new Set;F(i,n),D[i.name.value]=n}})})();function T(e,i){for(var n=0;n<e.definitions.length;n++){var o=e.definitions[n];if(o.name&&o.name.value==i)return o}}function Z(e,i){var n={kind:e.kind,definitions:[T(e,i)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var o=D[i]||new Set,c=new Set,l=new Set;for(o.forEach(function(t){l.add(t)});l.size>0;){var m=l;l=new Set,m.forEach(function(t){if(!c.has(t)){c.add(t);var s=D[t]||new Set;s.forEach(function(f){l.add(f)})}})}return c.forEach(function(t){var s=T(e,t);s&&n.definitions.push(s)}),n}Z(E,"ShopUnfollow");var B=(e=>(e.Follow="follow",e.Unfollow="unfollow",e))(B||{}),_=(e=>(e.UserNotSignedIn="UserNotSignedIn",e))(_||{});const ee=({initialFollowedByMe:e})=>{const{userAuthState:i,currentUser:n}=U(),[o]=R(N),[c]=R(E),l=z(),[m,t]=S.useState(e??!1),s=j(),f=S.useCallback(({shopId:p,follow:a})=>{try{s.writeFragment({id:`Shop:${p}`,fragment:M,fragmentName:"ShopFollowedByMe",data:{__typename:"Shop",followedByMe:a}})}catch(r){A.notify(r)}},[s]),u=S.useCallback(p=>{try{const a=s.readFragment({id:`Shop:${p}`,fragment:M,fragmentName:"ShopFollowedByMe"});return a==null?void 0:a.followedByMe}catch(a){return A.notify(a),null}},[s]);return{toggleFollowStore:S.useCallback(async({action:p,shopId:a})=>{if(i!==H.EmailVerified){localStorage.setItem(G.pendingFollow,JSON.stringify({action:p,shopId:a})),l({entityId:Q.FollowStore,email:n==null?void 0:n.email,scope:"EMAIL"});return}return t(!m),f({shopId:a,follow:!m}),p==="follow"?o({variables:{id:a}}).then(({data:r})=>{var w,v,h,k;(v=(w=r==null?void 0:r.shopFollow)==null?void 0:w.shop)!=null&&v.id||(t(!1),f({shopId:a,follow:!1}));const d=(h=r==null?void 0:r.shopFollow)==null?void 0:h.userErrors;if(d&&d.length)throw t(!1),f({shopId:a,follow:!1}),Error((k=d==null?void 0:d[0])==null?void 0:k.message)}):c({variables:{id:a}}).then(({data:r})=>{var w,v,h,k;(v=(w=r==null?void 0:r.shopUnfollow)==null?void 0:w.shop)!=null&&v.id||(t(!0),f({shopId:a,follow:!0}));const d=(h=r==null?void 0:r.shopUnfollow)==null?void 0:h.userErrors;if(d&&d.length)throw t(!0),f({shopId:a,follow:!0}),Error((k=d==null?void 0:d[0])==null?void 0:k.message)})},[i,m,f,l,n==null?void 0:n.email,o,c]),getFollowedByMe:u,followedByMe:m}},we=({shopId:e,buttonSize:i="m",followedByMe:n,useThemedVariants:o,variant:c,heightPx:l})=>{const{showToast:m}=W(),{reportEvent:t}=q(),s=P(),{toggleFollowStore:f,followedByMe:u}=ee({initialFollowedByMe:n}),{pageType:L}=J(),{currentUser:p}=U(),a=S.useMemo(()=>c||(o?u?"outlined":"secondary":u?"blurred-theme":"secondary"),[u,o,c]),r=l?"py-[10px]":void 0,d=S.useMemo(()=>{switch(a){case"blurred":return"text-text-fixed-light";case"secondary":return"text-text-inverse";case"blurred-theme":default:return"text-text"}},[a]);return b.jsx($,{"data-testid":"follow-store-button",size:i,variant:a,className:Y("min-w-0",u?"px-space-12":"px-space-16",r),style:l?{minHeight:l,height:l}:void 0,"aria-label":u?g.t("Store.Header.Unfollow"):g.t("Store.Header.Follow"),onClick:w=>{w.preventDefault(),w.stopPropagation();try{t({schemaId:"shop_app_client_follow/2.0",payload:{action:u?"unfollow":"follow",context:L===K.SearchResults?"search":"shop_store",shopId:Number(e)}}),s.storeFollowAction({action:u?"FOLLOW_ACTION_UNFOLLOW":"FOLLOW_ACTION_FOLLOW",brokerId:Number(e)}),t({schemaId:"shop_app_entity_interaction/4.4",payload:{entityType:C.AccountFollowingShop,entityId:"account_following",interactionType:u?x.AccountUnfollowShop:x.AccountFollowShop,shopAccountUuid:(p==null?void 0:p.shopAccountUuid)??void 0}}),f({action:u?B.Unfollow:B.Follow,shopId:e})}catch(v){if(v instanceof Error&&(v==null?void 0:v.message)===_.UserNotSignedIn)return;m({title:g.t("Store.SomethingWentWrong"),variant:"error"})}},children:u?b.jsx(V,{name:"checkmark-verify-filled",size:"m",className:d}):b.jsx("span",{className:"font-buttonLarge text-buttonLarge",children:g.t("Store.Header.Follow")})})};export{B as F,we as S,ee as u};
//# sourceMappingURL=StoreFollowButton-CGWxuR_B.js.map
