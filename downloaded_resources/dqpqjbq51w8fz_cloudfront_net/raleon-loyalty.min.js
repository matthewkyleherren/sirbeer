const RaleonFreeGift=()=>{let d=null,u=null,x=null;async function w(l){try{const f=await fetch(`${window.MedusaStore.routes.root}variants/${l}`,{headers:{Accept:"text/html"}});if(!f.ok)return console.error("Error fetching variant page:",await f.text()),null;const c=f.url,t=c.split("/products/")[1]?.split("?")[0];if(!t)return console.error("Could not extract product handle from URL:",c),null;const r=await fetch(`${window.MedusaStore.routes.root}variants/${l}.js`);if(!r.ok)return console.error("Error fetching variant details:",await r.text()),null;const o=await r.json(),s=await fetch(`${window.MedusaStore.routes.root}products/${t}.js`);if(!s.ok)return console.error("Error fetching product details:",await s.text()),null;const h=await s.json();console.log("Product data:",h);const e=o.featured_image?.src||h.featured_image||h.images[0];return console.log("Selected image URL:",e),{title:h.title,variantTitle:o.title,image:e,price:o.price/100,productId:h.id,variantId:o.id,product:h,variant:o}}catch(f){return console.error("Error getting product details:",f),null}}async function V(l){return console.log("Using CSS variables for free gift styling"),new Promise(async f=>{console.log("Fetching product details for gift options:",l);const c=l.map(async m=>{try{const _=await w(m.productVariantId);return _||(console.warn(`Failed to fetch details for variant ${m.productVariantId}`),{price:m.price})}catch(_){return console.error(`Error fetching details for variant ${m.productVariantId}:`,_),{price:m.price}}});let t;try{t=await Promise.all(c),console.log("Successfully fetched gift details:",t)}catch(m){console.error("Error fetching gift details:",m),t=l.map(_=>({price:_.price}))}const r={};t.forEach((m,_)=>{m.productId&&(r[m.productId]||(r[m.productId]={productTitle:m.title,image:m.image,variants:[]}),r[m.productId].variants.push({...m,originalIndex:_,giftOption:l[_]}))});const o=m=>m&&m.trim()!==""&&m!=="undefined",s=window.getComputedStyle(document.documentElement),h=s.getPropertyValue("--raleon-free-gift-rounded-corners").trim(),e=s.getPropertyValue("--raleon-free-gift-modal-background-color").trim(),g=s.getPropertyValue("--raleon-free-gift-button-background-color").trim(),b=s.getPropertyValue("--raleon-free-gift-text-color").trim(),I=s.getPropertyValue("--raleon-free-gift-image-background-color").trim(),v=s.getPropertyValue("--raleon-free-gift-border-color").trim(),S=s.getPropertyValue("--raleon-free-gift-button-font-size").trim(),E=s.getPropertyValue("--raleon-free-gift-button-letter-spacing").trim(),T=s.getPropertyValue("--raleon-free-gift-button-font-family").trim(),p=s.getPropertyValue("--raleon-free-gift-button-font-style").trim(),C=s.getPropertyValue("--raleon-free-gift-button-font-weight").trim(),R=s.getPropertyValue("--raleon-free-gift-button-text-transform").trim(),A=h==="true"?"8px":"0px",O=o(b)?b:x?.rewards?.textColor||"#231F20",L=o(e)?e:x?.colors?.backgroundColor||x?.home?.backgroundColor||"#FBF9F0",P=o(g)?g:x?.rewards?.buttonBackgroundColor||x?.colors?.buttonBackgroundColor||"#B7BAE8",B=o(I)?I:"#FFFFFF",U=o(v)?v:"#DDDDDD",W=o(S)?S:"1.1em",H=o(E)?E:"normal",J=o(T)?T:"inherit",q=o(p)?p:"normal",Y=o(C)?C:"bold",X=o(R)?R:"none",K=`
				<div id="gift-selection-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999;">
					<div style="background: ${L}; padding: 20px 20px 10px 20px; border-radius: ${A}; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto; color: ${O}; position: relative;">
						<h2 style="margin-top: 0; text-align: center; color: ${O}; font-size: 1.6em;">You've Earned a Free Gift!</h2>
						<div id="gift-options" style="margin: 20px 0 10px 0; display: flex; flex-wrap: wrap; gap: 15px; width: 100%; justify-content: flex-start;">
							<style>
								#gift-options > div {
									flex: 0 0 calc(33.333% - 10px);
								}
								/* For exactly 2 products - make them 50% width */
								#gift-options.two-products > div {
									flex: 0 0 calc(50% - 8px);
								}
								@media (max-width: 768px) {
									#gift-options > div {
										flex: 0 0 calc(50% - 8px);
									}
								}
								@media (max-width: 480px) {
									#gift-options > div {
										flex: 0 0 100%;
									}
								}
							</style>
							${Object.entries(r).map(([m,_])=>`
								<div style="
									margin: 10px 0;
									padding: 15px;
									border: 1px solid ${U};
									border-radius: ${A};
									text-align: center;
									display: flex;
									flex-direction: column;
									align-items: center;
									justify-content: space-between;
									min-height: 260px;
									color: ${O};
									background: ${B};
								">
									<div style="flex: 1; display: flex; flex-direction: column; gap: 10px; width: 100%;">
										${_.image?`
											<div style="width: 85%; padding-bottom: 85%; position: relative; overflow: hidden; border-radius: 4px; margin: 0 auto;">
												<img
													src="${_.image}"
													alt="${_.productTitle}"
													style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: contain;"
												>
											</div>
										`:""}
										<strong>${_.productTitle}</strong>
										${_.variants.length>1?`
											<select
												id="variant-select-${m}"
												style="
													margin: 10px 0;
													padding: 8px;
													border-radius: ${A};
													background: ${L};
													color: ${O};
													border: 1px solid ${P};
													width: 100%;
												"
											>
												${_.variants.map(N=>`
													<option value="${N.originalIndex}">
														${N.variantTitle} - $${N.giftOption.price} (FREE)
													</option>
												`).join("")}
											</select>
										`:`
											<div style="color: ${O};">
												<span style="text-decoration: line-through;">$${_.variants[0].giftOption.price}</span><span style="color: red; margin-left: 10px;">$0.00</span>
											</div>
										`}
									</div>
									<div style="width: 100%;">
										<button
											onclick="window.selectGift(${_.variants.length>1?`document.getElementById('variant-select-${m}').value`:_.variants[0].originalIndex})"
											style="
												background: ${P};
												color: ${x?.rewards?.buttonTextColor||x?.colors?.buttonTextColor||"white"};
												border: none;
												padding: 8px 16px;
												border-radius: ${A};
												cursor: pointer;
												width: 100%;
												transition: transform 0.2s;
												font-weight: ${Y};
												font-size: ${W};
												letter-spacing: ${H};
												font-family: ${J};
												font-style: ${q};
												text-transform: ${X};
											"
											onmouseover="this.style.transform='translateY(-2px)'"
											onmouseout="this.style.transform='none'"
										>
											Select Gift
										</button>
									</div>
								</div>
							`).join("")}
						</div>
					</div>
				</div>
			`,z=document.createElement("div");if(z.innerHTML=K,document.body.appendChild(z),Object.keys(r).length===2){const m=z.querySelector("#gift-options");m&&m.classList.add("two-products")}const D=document.createElement("div");D.id="gift-modal-close-btn",D.innerHTML="\u2715",D.setAttribute("title","Close"),document.body.appendChild(D);const M=z.querySelector("#gift-selection-modal > div");setTimeout(()=>{if(M){const m=M.getBoundingClientRect();D.style.cssText=`
						position: fixed;
						top: ${m.top-14}px;
						left: ${m.right-14}px;
						width: 28px;
						height: 28px;
						border-radius: 50%;
						background: #000000;
						display: flex;
						justify-content: center;
						align-items: center;
						cursor: pointer;
						color: white;
						font-weight: bold;
						line-height: 1;
						z-index: 10000;
						box-shadow: 0 2px 4px rgba(0,0,0,0.2);
					`}},0),D.addEventListener("click",()=>{document.body.removeChild(z),document.body.removeChild(D),delete window.selectGift,sessionStorage.setItem("freeGiftModalDismissed","true"),f(null)}),window.selectGift=m=>{document.body.removeChild(z),document.body.removeChild(D),delete window.selectGift,f(l[m])}})}async function j(l,f){if(x=JSON.parse(f),window.location.origin.includes("localhost")||window.location.origin.includes("raleon.io")||d===!1){a(window,window.fetch,l,!0);return}if(d===!1)return;if(d==null)try{const g=`${`${location.origin}/apps/raleon`}/free-gift-enabled?orgId=${l}`,b=await fetch(g,{method:"GET",headers:{"Content-Type":"application/json"}});if(!b.ok){const I=await b.json();throw console.error("Free gift API error:",I),new Error(`API returned ${b.status}: ${I.error?.message||"Unknown error"}`)}if(u=await b.json(),d=u.active,!d){console.log("Free gift not enabled, stopping cart updates listener"),a(window,window.fetch,l,!0);return}}catch(e){console.error("Error fetching free gift data:",e),d=!1,a(window,window.fetch,l,!0);return}await a(window,window.fetch,l);const{mode:c,minimumOrderAmount:t}=u.config;if(sessionStorage.getItem("freeGiftModalDismissed")==="true"){console.log("Free gift modal was dismissed, not showing again until navigation");return}try{const e=await fetch(`${window.MedusaStore.routes.root}cart.js?src=raleon`);if(!e.ok){console.error("Error fetching cart:",await e.text());return}const g=await e.json();if(g.items_subtotal_price/100<t){console.log("Cart total below minimum order amount, not adding free gift"),sessionStorage.removeItem("cartPageReloaded");return}const I=c==="choose_gift"?u.config.giftOptions:[{productVariantId:u.config.productVariantId,price:u.config.price}];if(g.items?.some(S=>I.some(E=>E.productVariantId==S.variant_id)&&S.properties&&S.properties["Free Gift"])){console.log("Gift already in cart, not adding again"),window.location.pathname=="/cart"&&sessionStorage.getItem("cartPageReloaded")!=="true"?(sessionStorage.setItem("cartPageReloaded","true"),await new Promise(S=>setTimeout(S,550)),window.location.reload()):sessionStorage.removeItem("cartPageReloaded");return}}catch(e){console.error("Error checking cart on page load:",e);return}let r;try{const e=await fetch(`${window.MedusaStore.routes.root}cart.js?src=raleon`);if(!e.ok){console.error("Error fetching cart:",await e.text());return}r=await e.json()}catch(e){console.error("Error fetching cart:",e);return}const o=c==="choose_gift"?u.config.giftOptions:[{productVariantId:u.config.productVariantId,price:u.config.price}],s=c==="choose_gift"?await V(o):o[0];let h;try{try{const g=r?.token?.split("?")[0];g&&(u.config.cartToken=g)}catch(g){console.error("Error processing cart token:",g)}y("free-gift-added",{...u.config,selectedGiftVariantId:s.productVariantId,selectedGiftPrice:s.price,mode:c}),console.log("Adding free gift to cart:",s);const e=await fetch(`${window.MedusaStore.routes.root}cart/add.js?src=raleon`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({items:[{quantity:1,id:Number(s.productVariantId),properties:{"Free Gift":`A $${s.price} value!`,_campaignId:u.config.campaignId,_campaignDetailsId:u.config.campaignDetailsId}}],sections:["cart-drawer","cart-icon-bubble","cart-count-bubble","cart-items"]})});if(!e.ok){const g=await e.text();throw console.error("Error adding gift to cart:",{status:e.status,statusText:e.statusText,body:g}),new Error(`Failed to add gift to cart: ${e.status} ${e.statusText}`)}h=await e.json(),console.log("Successfully added gift to cart:",h)}catch(e){console.error("Error in gift addition process:",e),y("free-gift-added-failure",{...u.config,selectedGiftVariantId:s.productVariantId,selectedGiftPrice:s.price,mode:c,error:e.message});return}await fetch(`${window.MedusaStore.routes.root}cart.js?src=raleon`),u.config.discountCode&&await fetch(`${window.MedusaStore.routes.root}discount/${u.config.discountCode}`),k(h.sections["cart-drawer"]),G(h.sections["cart-icon-bubble"]),window.location.pathname=="/cart"&&sessionStorage.getItem("cartPageReloaded")!=="true"?(sessionStorage.setItem("cartPageReloaded","true"),await new Promise(e=>setTimeout(e,550)),window.location.reload()):sessionStorage.removeItem("cartPageReloaded")}async function $(l=1){if(!u)return;const c=await(await fetch(`${window.MedusaStore.routes.root}cart.js?src=raleon`)).json(),{mode:t}=u.config,r=t==="choose_gift"?u.config.giftOptions:[{productVariantId:u.config.productVariantId,price:u.config.price}],o=c.items.find(e=>r.some(g=>g.productVariantId==e.variant_id));if(!o)return;const h=await(await fetch(`${window.MedusaStore.routes.root}cart/change.js?src=raleon`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:l<=0?0:l-1,id:o.key,sections:["cart-drawer","cart-icon-bubble","cart-count-bubble","cart-items"]})})).json();k(h.sections["cart-drawer"]),G(h.sections["cart-icon-bubble"])}const k=l=>{if(!l)return;const c=new DOMParser().parseFromString(l,"text/html").getElementById("CartDrawer-CartItems"),t=document.getElementById("CartDrawer-CartItems");t&&(t.innerHTML=c.innerHTML)},G=l=>{if(!l)return;const f=document.getElementById("cart-icon-bubble"),t=new DOMParser().parseFromString(l,"text/html").getElementById("MedusaJS-section-cart-icon-bubble");t&&(f.innerHTML=t.innerHTML)};let F=null,n=!1;function a(l,f,c,t){if(typeof f!="function")return;if(t){F&&(l.fetch=F,n=!1);return}if(n)return;F=f,n=!0;const r=["/cart/add","/cart/change","/cart/update","/cart/clear"];l.fetch=async function(){let o=!1;try{const s=F.apply(this,arguments);if(!r.some(e=>arguments[0].startsWith(e)))return s;const h=await s;if(!h.url.includes("src=raleon")){let e;try{e=await(await h.clone()).json()}catch(p){return console.warn("Response was not JSON:",p),s}if(!e)return s;sessionStorage.removeItem("freeGiftModalDismissed"),console.log("Cart updated, cleared free gift modal dismissed flag");try{const p=await f(`${window.MedusaStore.routes.root}cart.js?src=raleon`);if(p.ok){const C=await p.json(),R=C.items_subtotal_price/100;if(console.log("Cart total after modification:",R),R>=u.config.minimumOrderAmount){console.log("Cart meets minimum after modification, checking for free gift...");const{mode:A}=u.config,O=A==="choose_gift"?u.config.giftOptions:[{productVariantId:u.config.productVariantId,price:u.config.price}],L=C.items?.find(P=>O.some(B=>B.productVariantId==P.variant_id)&&P.properties&&P.properties["Free Gift"]);return L?(console.log("Free gift already in cart, skipping addition"),L.line_price>0&&await $(1)):await new Promise(P=>{setTimeout(async()=>{try{await j(c,JSON.stringify(x||{}))}catch(B){console.error("Error adding free gift:",B)}P()},100)}),s}}}catch(p){console.error("Error checking cart after modification:",p)}const{mode:g}=u.config,b=g==="choose_gift"?u.config.giftOptions:[{productVariantId:u.config.productVariantId,price:u.config.price}],I=e.items&&e.items.filter(p=>b.some(C=>C.productVariantId==p.variant_id)),v=I?.length||0,S=e?.items_removed&&e.items_removed.some(p=>b.some(C=>C.productVariantId==p.variant_id));if(!I?.length&&!S)try{await j(c,JSON.stringify(x||{})),o=!0}catch(p){console.error(`Error adding free gift: ${p}`)}let E=e.items_subtotal_price/100;if(I?.length&&(E-=I.reduce((p,C)=>p+C.final_price/100,0)),E<u.config.minimumOrderAmount&&(await $(v),o=!0),e?.items&&e?.items?.length===1&&b.some(p=>p.productVariantId==e.items[0].variant_id)&&e.items[0].properties["Free Gift"]&&(await $(v),o=!0),e.items?.length===0)return s;const T=e.items?.filter(p=>b.some(C=>C.productVariantId==p.variant_id));T?.length&&e.items?.length===T.length&&(await $(v),o=!0),o&&window.location.pathname=="/cart"&&sessionStorage.getItem("cartPageReloaded")!=="true"?(sessionStorage.setItem("cartPageReloaded","true"),await new Promise(p=>setTimeout(p,550)),window.location.reload()):sessionStorage.removeItem("cartPageReloaded")}return s}catch(s){return console.error("Error in cart update process:",s),F.apply(this,arguments)}}}async function y(l,f){const c={free_gift_added:"Free Gift Added to Cart"},t=`${location.origin}/apps/raleon/loyalty-event`,r={"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},o=localStorage.getItem("raleon_org_id");if(!o){console.error("Organization ID not found in localStorage");return}const s=localStorage.getItem("raleon_raleon_id"),h=localStorage.getItem("raleon_wallet_address"),e={event:l,friendlyName:c[l],organization:o,timestamp:new Date().toISOString(),customer:""};f?e.data={...f,raleonId:s,shopId:h}:e.data={raleonId:s,shopId:h};try{await fetch(t,{method:"PUT",headers:r,body:JSON.stringify(e)})}catch(g){console.error("Failed to send telemetry event:",g)}}return{addFreeGiftRaleon:j}},addFreeGiftRaleon=RaleonFreeGift().addFreeGiftRaleon;window.raleonPreview||(window.raleonPreview={isEventListenerRegistered:!1}),window.setupRaleonLoyalty=function(d){const u="https://j0v36abmdj.execute-api.us-east-1.amazonaws.com/api/utm/",x="https://j0v36abmdj.execute-api.us-east-1.amazonaws.com/api/event/";let w={org_id:d.orgId,application_id:d.applicationId||"",page_location:d.pageLocation||"landing-page",defaultOpenChat:d.defaultOpenChat,quest_dom_id:d.questDomId||"",position:d.position||{},walletEnabled:!1,userLoggedIn:d.userLoggedIn,customerId:d.customerId,branding:d.branding,parentElementId:d.parentElementId,initializedView:d.initializedView,relativeNotifications:d.relativeNotifications},V=localStorage.getItem("raleon_raleon_id");V==null&&(V=generateRaleonId(),localStorage.setItem("raleon_raleon_id",V)),w.customerId&&localStorage.setItem("raleon_wallet_address",w.customerId);var j=window.location.toString(),$=j.split("?");if($.length>1){var k=$[1].split("&");for(i in k){var G=k[i].split("=");localStorage.setItem(`raleon_${G[0]}`,decodeURIComponent(G[1]))}}if(location.search.includes("referral_code")){const n=new URLSearchParams(location.search).get("referral_code");localStorage.setItem("referral_code",n||"")}if(location.search.includes("apply_coupon")||localStorage.getItem("apply_coupon")){const n=new URLSearchParams(location.search).get("apply_coupon")||localStorage.getItem("apply_coupon");localStorage.setItem("apply_coupon",n),localStorage.removeItem("closed_coupon_notification"),applyInventoryCouponId(n).catch(a=>{localStorage.setItem("apply_coupon",n),console.error(`Error applying inventory coupon ${n} from URL params`,a)})}addFreeGiftRaleon(w.org_id,w.branding).then(()=>console.log("Free gift call finished")).catch(n=>console.error("Error adding free gift",n)),location.search.includes("loyalty=open")&&(w.defaultOpenChat=!0),localStorage.setItem("raleon_org_id",w.org_id),localStorage.setItem("raleon_application_id",w.application_id),window.raleon||(window.raleon={registeredBrandingHandler:!1,registeredViewHandler:!1,pageVisited:function(n){let a=localStorage.getItem("raleon_utm_campaign"),y=localStorage.getItem("raleon_utm_source"),l=localStorage.getItem("raleon_raleon_id");if(l==null&&(l=raleon.generateRaleonId()),a!=null&&y!=null){let f={address:"anonymous_to_do_adduser_here",network:"ETH",utm_campaign:a,utm_content:localStorage.getItem("raleon_utm_content"),utm_medium:localStorage.getItem("raleon_utm_medium"),utm_source:y,org_id:localStorage.getItem("raleon_org_id"),raleon_id:l.toString(),application_id:localStorage.getItem("raleon_application_id"),event_type:n,time:new Date().toISOString()};try{fetch(u,{method:"post",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(f)},()=>{})}catch{}}else raleon.registerEvent(n,"add_customer_here",{utm_campaign:a,utm_source:y})},generateRaleonId:function(){let n=localStorage.getItem("raleon_raleon_id");return n==null&&(crypto!=null&&crypto.randomUUID?(n=crypto.randomUUID(),localStorage.setItem("raleon_raleon_id",n)):(n=Math.floor(Math.random()*9e11)+1e8,localStorage.setItem("raleon_raleon_id",n))),n},registerEvent:function(n,a,y,l=x){if(n==null||n==""||a==null||a=="")throw new Error("Please provide a valid event name and customerId");a=a.toLowerCase();let f=localStorage.getItem("raleon_raleon_id");f==null&&(f=raleon.generateRaleonId()),y==null&&(y="");let c=typeof y;c!="string"&&c!="object"&&c!="number"&&(c="string"),c=c=="object"?"json":c;let t={address:a,network:"ETH",org_id:localStorage.getItem("raleon_org_id"),application_id:localStorage.getItem("raleon_application_id"),data_type:c,raleon_id:f.toString(),data:typeof y=="string"?y:JSON.stringify(y),event_type:n};fetch(l,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}).catch(console.error)},enableActionPrompts:function(n){var a=document.createElement("script");a.src="https://dqpqjbq51w8fz.cloudfront.net/raleon_quest.min.js",document.head.appendChild(a),a.onload=()=>{window.raleon_quest_enabled=!0,localStorage.getItem("raleon_wallet_address")&&raleon.addPopup(localStorage.getItem("raleon_org_id"),localStorage.getItem("raleon_wallet_address")),n&&n()}},enableLoyalty:function(n){var a=document.createElement("script");a.src="https://dqpqjbq51w8fz.cloudfront.net/main.js",a.type="module",document.head.appendChild(a),a.onload=()=>{window.loyalty_enabled=!0,n&&n()}}}),window.raleonPreview.registeredBrandingHandler||(window.addEventListener("message",n=>{if(n.data.type==="raleon-branding-update"){const a=document.getElementsByTagName("loyalty-main");a[0].branding={...n.data.branding}}}),window.raleonPreview.registeredBrandingHandler=!0),window.raleonPreview.registeredViewHandler||(window.addEventListener("message",n=>{if(n.data.type==="raleon-view-changed"){let a={type:"loyalty-update-view",view:n.data.view};n.data.item&&(a.item=n.data.item),window.postMessage(a,"*")}}),window.raleonPreview.registeredViewHandler=!0),F(),raleon.pageVisited(w.page_location),w.enable_action_prompts&&raleon.enableActionPrompts(()=>{});function F(n){window.raleon.loyaltyInitializing=!0,window.raleon.enableLoyalty(()=>{console.log("Loyalty enabled");const a=document.createElement("loyalty-main");a.divId=w.quest_dom_id,a.defaultOpenChat=w.defaultOpenChat,a.relativeNotifications=w.relativeNotifications,a.position=w.position,a.userLoggedIn=n??w.userLoggedIn,a.branding=w.branding,a.containerId="raleon-quest",a.divId=w.parentElementId||void 0,a.storeCurrencyCode=d.storeCurrencyCode,a.userCurrencyCode=d.userCurrencyCode,a.userCountryCode=d.userCountryCode,w.initializedView&&(a.initializedView=w.initializedView),a.divId?document.getElementById(a.divId).appendChild(a):document.body.appendChild(a);const y=document.getElementsByClassName("raleon-referrals-section");for(let c=0;c<y.length;c++){const t=y[c],r=document.createElement("referral-link");try{let o=JSON.parse(w.branding);const s=t.getAttribute("data-button-text-color"),h=t.getAttribute("data-button-background-color"),e=t.getAttribute("data-background-color"),g=t.getAttribute("data-text-color"),b=t.getAttribute("data-share-icon-fill-color"),I=t.getAttribute("data-title-font-size"),v=t.getAttribute("data-description-font-size"),S=t.getAttribute("data-title-font-weight"),E=t.getAttribute("data-description-font-weight"),T=t.getAttribute("data-button-max-width"),p=t.getAttribute("data-button-font-size"),C=t.getAttribute("data-button-font-weight"),R=t.getAttribute("data-input-width"),A=t.getAttribute("data-input-font-size");o.colors||(o.colors={}),o.colors.buttonTextColor=s||o.colors?.buttonTextColor,o.colors.buttonBackgroundColor=h||o.colors?.buttonBackgroundColor,o.colors.backgroundColor=e||o.colors?.backgroundColor,o.referrals.styling.textColor=g||o.referrals.styling.textColor,o.referrals.styling.fillBorderColor=b||o.referrals.styling.fillBorderColor,o.referrals.styling.titleFontWeight=S,o.referrals.styling.descriptionFontWeight=E,o.referrals.styling.buttonMaxWidth=T,o.referrals.styling.buttonFontSize=p,o.referrals.styling.buttonFontWeight=C,o.referrals.styling.titleFontSize=I,o.referrals.styling.descriptionFontSize=v,o.referrals.styling.inputFontSize=A,o.referrals.styling.inputWidth=R,r.brandingOverride=o,r.appEmbedInfo={userLoggedIn:n??w.userLoggedIn,showSendEmail:!0}}catch(o){console.log("ERROR: ",o),console.error(o)}r.setAttribute("style","display: block; background-color: "+r.brandingOverride.colors.backgroundColor),t.appendChild(r)}const l=document.getElementsByClassName("raleon-product-page-section");for(let c=0;c<l.length;c++){const t=l[c],r=document.createElement("product-page-embed");try{const o=t.getAttribute("data-price"),s=t.getAttribute("data-user-currency-code"),h=t.getAttribute("data-user-country-code"),e=t.getAttribute("data-store-currency-code");let g=JSON.parse(w.branding);const b=t.getAttribute("data-background-color"),I=t.getAttribute("data-text-color"),v=t.getAttribute("data-backgrounded-text-color"),S=t.getAttribute("data-link-color"),E=t.getAttribute("data-padding-x"),T=t.getAttribute("data-padding-y"),p=t.getAttribute("data-banner-scaling"),C=t.getAttribute("data-banner-width"),R=t.getAttribute("data-banner-font-weight"),A=t.getAttribute("data-banner-font-size"),O=t.getAttribute("data-loading-spinner-color"),L=t.getAttribute("data-checkbox-scaling"),P=t.getAttribute("data-text-font-size"),B=t.getAttribute("data-text-font-weight"),U=t.getAttribute("data-dropdown-arrow-scaling");g.colors||(g.colors={}),g.colors.backgroundColor=b||g.colors.backgroundColor,g.colors.textColor=I||g.colors.textColor,g.colors.buttonTextColor=v||g.colors.buttonTextColor,g.colors.linkColor=S||g.colors.linkColor,r.brandingOverride=g,r.productPrice=o,r.userCurrencyCode=s,r.userCountryCode=h,r.storeCurrencyCode=e,r.paddingX=E,r.paddingY=T,r.bannerScaling=p,r.bannerWidth=C,r.bannerFontSize=A,r.bannerFontWeight=R,r.checkboxScaling=L,r.textFontSize=P,r.textFontWeight=B,r.loadingSpinnerColor=O,r.dropdownArrowScaling=U,r.appEmbedInfo={userLoggedIn:n??w.userLoggedIn,productPrice:o,showSendEmail:!0}}catch(o){console.error(o)}t.appendChild(r)}const f=document.getElementsByClassName("raleon-gwp-cart-section");for(let c=0;c<f.length;c++){const t=f[c],r=document.createElement("gwp-cart-embed");try{const o=t.getAttribute("data-user-currency-code"),s=t.getAttribute("data-user-country-code"),h=t.getAttribute("data-store-currency-code");let e=JSON.parse(w.branding);const g=t.getAttribute("data-button-background-color"),b=t.getAttribute("data-background-color"),I=t.getAttribute("data-text-color"),v=t.getAttribute("data-subtotal-price"),S=t.getAttribute("data-original-total-price"),E=t.getAttribute("data-total-discount"),T=t.getAttribute("data-total-price"),p=t.getAttribute("data-padding-x"),C=t.getAttribute("data-padding-y");e?.colors&&(e.colors.buttonBackgroundColor=g||e.colors.buttonBackgroundColor,e.colors.backgroundColor=b||e.colors.backgroundColor,e.colors.textColor=I||e.colors.textColor),r.brandingOverride=e,r.subtotal=v,r.originalTotal=S,r.discount=E,r.total=T,r.userCurrencyCode=o,r.userCountryCode=s,r.storeCurrencyCode=h,r.paddingX=p,r.paddingY=C,r.appEmbedInfo={userLoggedIn:n??w.userLoggedIn,subtotal:v,originalTotal:S,discount:E,total:T,showSendEmail:!0}}catch(o){console.error(o)}t.appendChild(r)}window.raleon.loyaltyInitializing=!1}),window.raleon.setKeyValue=function(a,y){const l=`${location.origin}/apps/raleon`,f={"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},c=`${l}/raleon-users/set-key-value`;return fetch(c,{method:"POST",headers:f,body:JSON.stringify({key:a,value:y})})},window.raleon.getKeyValue=function(a){const y=`${location.origin}/apps/raleon`,l={"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},f=`${y}/raleon-users/key-value/${a}`;return fetch(f,{method:"GET",headers:l})}}try{window.location.hash.includes("raleon-snippet-autoverify")&&(window.opener&&window.opener.postMessage("configured-"+d.orgId,document.referrer),window.close())}catch{}};function generateRaleonId(){let d=localStorage.getItem("raleon_raleon_id");return d==null&&(crypto!=null&&crypto.randomUUID?(d=crypto.randomUUID(),localStorage.setItem("raleon_raleon_id",d)):(d=Math.floor(Math.random()*9e8)+1e8,localStorage.setItem("raleon_raleon_id",d))),d}function isInteger(d){return Number.isInteger(Number(d))&&!isNaN(parseInt(d,10))}async function applyInventoryCouponId(d){const u=`${location.origin}/apps/raleon`,x={"Content-Type":"application/json","ngrok-skip-browser-warning":"true"},w=isInteger(d)?`${u}/inventory-coupons/${d}`:`${u}/inventory-coupons/uuid/${d}`,V=await fetch(w,{method:"POST",headers:x});if(!V.ok)throw new Error("Failed to redeem coupon.");const $=await(await fetch(`${window.MedusaStore.routes.root}cart.js`)).json(),k=[];$.cart_level_discount_applications?.length&&$.cart_level_discount_applications.forEach(n=>{n.type=="discount_code"&&k.push(n.title)});const G=await V.text();if(k.includes(G))return;k.push(G);const F=k.join(",");await fetch(`${location.origin}/checkout?discount=${F}`)}
//# sourceMappingURL=raleon-loyalty.min.js.map
